import{q as F,r as o,a as Q,j as e,Y as X,y as C}from"./app-BrPd_5NA.js";import{M as Z}from"./MainLayout-B0Hj4_qT.js";import{T as O,a as P,b as n,c as l}from"./tabs-VnPkUC9E.js";import{B as h}from"./button-D_c8cCUP.js";import{B as ee}from"./badge-C-rv9uJ4.js";import{A as te,a as se}from"./avatar-HuhwrEH0.js";import{T as ae}from"./textarea-D5wt2kvG.js";import{S as re}from"./scroll-area-9ivrOSrd.js";import{T as ie,a as oe,b as ne,c as q}from"./tooltip-Do508To7.js";import le from"./ScheduleMeetingDialog-CB3CwR2j.js";import de from"./UnbindRequestModal-BupJFIN6.js";import ce from"./ResearchTab-BDgZM9jF.js";import me from"./DocumentsTab-CH_b9r5g.js";import{T}from"./ThreadPane-BDKDZsV9.js";import pe from"./UnifiedOverviewTab-Dxqh_bSb.js";import{R as he}from"./RelationshipHistoryTab-C0SlsGIa.js";import{c as N}from"./index-BBpOhVGp.js";import{l as _}from"./logError-BloCzXDJ.js";import{A as xe}from"./arrow-left-D1B-9LOO.js";import{C as ve}from"./calendar-g0DizSmb.js";import{V as ue}from"./video-B9y2Pr0J.js";import{U as be}from"./user-minus-_-mhnsTB.js";import{S as B}from"./sticky-note-BA6L03Kq.js";import{L}from"./loader-circle-DSxVtQi0.js";import{T as je}from"./trash-2-DrYXxk5a.js";import{f as ge}from"./format-BOijCLBA.js";import"./house-BVVJ6M88.js";import"./createLucideIcon-BuUp2DP1.js";import"./zap-BesWUIe-.js";import"./users-Bm8PtVb1.js";import"./folder-open-BriNDaJd.js";import"./settings-DopYltds.js";import"./useRoles-CxdVnjSe.js";import"./chevron-left-CNCaNPDJ.js";import"./proxy-DqGN9o1W.js";import"./user-round-CmjIdno-.js";import"./clipboard-list-Bd3irJ4P.js";import"./dollar-sign-D9EFmCGr.js";import"./file-text-D7d1fAn0.js";import"./message-square-Ba9o6uXG.js";import"./graduation-cap-BVpuDxYd.js";import"./building-2woNU6dF.js";import"./Dropdown-B-Hm1OJE.js";import"./transition-C1LRY1ul.js";import"./sparkles-BtDPQTAL.js";import"./bookmark-CvR_-39C.js";import"./folder-kanban-DVwJKoZA.js";import"./building-2-BO21CEE8.js";import"./database-bMm2ZFRt.js";import"./shield-DhdnsNWZ.js";import"./index-65ttqxxV.js";import"./analytics-BQ374C1C.js";import"./index-CSsgwYU6.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-CBfrqCZ4.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";import"./constructNow-6bIQB1GK.js";import"./addDays-KHeCUDUr.js";import"./Modal-RZHZPq1U.js";import"./dialog-C-QKEJiA.js";import"./index-B8zdXgNA.js";import"./PrimaryButton-DgeCsnCZ.js";import"./SecondaryButton-BsHb4DCA.js";import"./search-D1RvesB3.js";import"./circle-check-big-DB3PkcXK.js";import"./x-CWW5msPO.js";import"./chevron-right-Teb7wt3n.js";import"./index-Chjiymov.js";import"./dialog-xaHZuvoA.js";import"./index-DjPa4PiY.js";import"./index-BINPKaee.js";import"./index-CfSCNicO.js";import"./index-CbW9dcCk.js";import"./index-BsS7Hkv-.js";import"./index-CbgwQkER.js";import"./index-trzRZPTl.js";import"./index-Be2_8SSR.js";import"./briefcase-DUAxgeVE.js";import"./user-XOKCZTSF.js";import"./index-D7NdPX5u.js";import"./index-DDsMp2PF.js";import"./index-sCVn0dxs.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./index-Bg98LDa9.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-CG9XqnVQ.js";import"./index-cpcYRf8f.js";import"./input-CTQwd9Zb.js";import"./label-BfkwUhKT.js";import"./alert-DBAharqk.js";import"./useGoogleCalendar-C3GvL7sq.js";import"./external-link-BT9Iv05v.js";import"./triangle-alert-Klzlhe8T.js";import"./separator-BkyD_kuE.js";import"./plus-DuhnkOU6.js";import"./circle-check-C8NnlNDG.js";import"./circle-ob-_Vdzy.js";import"./select-8_l01y6v.js";import"./index-Bf7zMkfS.js";import"./chevron-down-CyOkOypn.js";import"./check-Z2_kxFvT.js";import"./chevron-up-E7xn4Z9S.js";import"./DocumentPreviewModal-BLRjLkFD.js";import"./download-BR6OYre6.js";import"./upload-KffCg5e5.js";import"./eye-CDXUErhg.js";import"./history-BN--zRDq.js";import"./mail-XASeurjZ.js";import"./phone-FyFqrHxg.js";import"./globe-fzlAyqNM.js";import"./calendar-clock-D_-a412M.js";import"./circle-alert-CpcUkcJ4.js";function _s({relationship:x,userRole:r}){const{auth:v}=F().props,t=F().props.relationship||x,[u,f]=o.useState("overview"),[w,m]=o.useState(!1),[a,y]=o.useState(!1),[E,H]=o.useState([]),[U,A]=o.useState(""),[R,M]=o.useState(!1),[k,I]=o.useState(null);o.useEffect(()=>{t?.id&&V()},[t?.id]);const V=async()=>{if(t?.id)try{const s=await Q.get(route("supervision.relationships.show",t.id));H(s.data.data?.notes||[])}catch(s){_(s,"RelationshipFullPage loadNotes")}},$=()=>{r==="supervisor"?C.visit(route("supervision.supervisor.index")):C.visit(route("supervision.student.index"))},d=()=>{C.reload({only:["relationship"]})},J=async()=>{if(!(!U.trim()||R)){M(!0);try{N.success("Note added"),A("")}catch(s){_(s,"RelationshipFullPage handleAddNote"),N.error("Failed to add note")}finally{M(!1)}}},z=async s=>{if(!k){I(s);try{N.success("Note deleted")}catch(K){_(K,"RelationshipFullPage handleDeleteNote"),N.error("Failed to delete note")}finally{I(null)}}},i=r==="supervisor",c=i?t?.student??{}:t?.academician??{},b=c.full_name??(i?"Student":"Supervisor"),D=c.profile_picture?`/storage/${c.profile_picture}`:null,j=t?.status??"active",p=t?.active_unbind_request||t?.activeUnbindRequest,S=p?"pending_unbind":j,g=j==="active"&&!p,W=b.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),Y=S==="pending_unbind"?"Pending Unbind":S.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),G=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(Z,{title:"Supervision Relationship",children:[e.jsx(X,{title:`Supervision: ${b}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(h,{variant:"outline",onClick:$,className:"mb-4",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(te,{className:"h-16 w-16",children:D?e.jsx("img",{src:D,alt:b,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:W})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b}),e.jsxs("p",{className:"text-sm text-slate-600",children:[i?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(ee,{className:`${G(S)} border`,children:Y})})]})]})})]}),g&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(h,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(h,{className:"bg-slate-900 hover:bg-slate-800",disabled:!t?.meetings||t.meetings.length===0||!t.meetings[0]?.location_link,onClick:()=>{const s=t?.meetings?.[0];s?.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsx("div",{children:e.jsxs(h,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>y(!0),disabled:p||j!=="active",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),p&&e.jsx(q,{children:e.jsx("p",{children:"Unbind request pending approval"})}),j!=="active"&&!p&&e.jsx(q,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(O,{value:u,onValueChange:f,className:"w-full",children:[e.jsxs(P,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(n,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(n,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"})]}),e.jsx(n,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),i&&e.jsx(n,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(n,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"overview",className:"mt-0 p-2",children:e.jsx(pe,{relationship:t,person:c,userRole:r,activeUnbindRequest:p})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(ce,{relationship:t,onUpdated:d,isReadOnly:!g})})}),e.jsx(l,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:d,isReadOnly:!g})})})]}),e.jsx(l,{value:"chat",className:"mt-0 p-6",children:i?e.jsxs(O,{defaultValue:"direct",className:"w-full",children:[e.jsxs(P,{className:"mb-4",children:[e.jsx(n,{value:"direct",children:"Direct Message"}),e.jsx(n,{value:"group",disabled:!c?.supervision_group_conversation_id,children:"Team Chat"})]}),e.jsx(l,{value:"direct",className:"mt-0",children:t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),e.jsx(l,{value:"group",className:"mt-0",children:c?.supervision_group_conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:c.supervision_group_conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Team chat will be available when a co-supervisor joins."})})})]}):t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),i&&e.jsx(l,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(Ne,{notesList:E,newNote:U,setNewNote:A,isAddingNote:R,isDeletingNoteId:k,onAddNote:J,onDeleteNote:z,isReadOnly:!g})})}),e.jsx(l,{value:"history",className:"mt-0 p-0",children:e.jsx(re,{className:"h-[calc(100vh-350px)]",children:e.jsx(he,{relationship:t})})})]})]})})]}),e.jsx(le,{relationship:w?t:null,onClose:()=>m(!1),onScheduled:()=>{m(!1),d()},userRole:r}),e.jsx(de,{isOpen:a,relationship:t,onClose:()=>y(!1),onUnbindInitiated:()=>{y(!1),d()},userRole:r})]})}function Ne({notesList:x,newNote:r,setNewNote:v,isAddingNote:t,isDeletingNoteId:u,onAddNote:f,onDeleteNote:w,isReadOnly:m}){return e.jsxs("div",{className:"space-y-6",children:[!m&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(ae,{rows:4,value:r,onChange:a=>v(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(h,{onClick:f,disabled:!r.trim()||t,children:[t&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",x.length,")"]}),x.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(B,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:x.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?ge(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!m&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>w(a.id),disabled:u===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:u===a.id?e.jsx(L,{className:"h-4 w-4 animate-spin"}):e.jsx(je,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{_s as default};
