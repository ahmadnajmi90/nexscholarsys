import{r as i,a as g,j as s}from"./app-DG_dKa7-.js";import{V as t}from"./index-I5pcdcpa.js";import te from"./FieldOfResearchFormModal-LaVdKGfO.js";import oe from"./ResearchAreaFormModal-h6fOHUf5.js";import le from"./NicheDomainFormModal-DwaSn-f2.js";import S from"./ConfirmationModal-Lk2KTGWj.js";import{d as k,F as M,p as E,q as $}from"./index-CjGnhiG_.js";function fe(){const[R,L]=i.useState([]),[_,O]=i.useState([]),[I,P]=i.useState([]),[N,h]=i.useState({fields:!0,areas:!1,domains:!1}),[l,T]=i.useState(null),[n,b]=i.useState(null),[c,U]=i.useState({fields:"",areas:"",domains:""}),[f,o]=i.useState({fieldForm:!1,areaForm:!1,domainForm:!1,fieldDelete:!1,areaDelete:!1,domainDelete:!1}),[m,F]=i.useState(null),[u,w]=i.useState(null),[x,D]=i.useState(null),[A,p]=i.useState({field:"create",area:"create",domain:"create"});i.useEffect(()=>{y()},[c.fields]),i.useEffect(()=>{l?j():(O([]),b(null))},[l,c.areas]),i.useEffect(()=>{n?v():P([])},[n,c.domains]);const y=async()=>{h(e=>({...e,fields:!0}));try{const e=await g.get("/api/v1/fields-of-research",{params:{per_page:100,search:c.fields||void 0}});L(e.data.data)}catch(e){console.error("Error fetching fields of research:",e),t.error("Failed to load fields of research")}finally{h(e=>({...e,fields:!1}))}},j=async()=>{if(l){h(e=>({...e,areas:!0}));try{const e=await g.get("/api/v1/research-areas",{params:{field_of_research_id:l.id,per_page:100,search:c.areas||void 0}});O(e.data.data)}catch(e){console.error("Error fetching research areas:",e),t.error("Failed to load research areas")}finally{h(e=>({...e,areas:!1}))}}},v=async()=>{if(n){h(e=>({...e,domains:!0}));try{const e=await g.get("/api/v1/niche-domains",{params:{research_area_id:n.id,per_page:100,search:c.domains||void 0}});P(e.data.data)}catch(e){console.error("Error fetching niche domains:",e),t.error("Failed to load niche domains")}finally{h(e=>({...e,domains:!1}))}}},Q=e=>{T(e),b(null)},V=e=>{b(e)},C=(e,r)=>{U(d=>({...d,[e]:r}))},q=()=>{F(null),p(e=>({...e,field:"create"})),o(e=>({...e,fieldForm:!0}))},H=e=>{F(e),p(r=>({...r,field:"edit"})),o(r=>({...r,fieldForm:!0}))},z=e=>{F(e),o(r=>({...r,fieldDelete:!0}))},B=()=>{o(e=>({...e,fieldForm:!1})),y()},G=()=>{if(!m)return;(async()=>{var r,d;try{await g.delete(`/api/v1/fields-of-research/${m.id}`),t.success("Field of Research deleted successfully!"),y()}catch(a){a.response?a.response.status===404?(t.error("Field of research not found. It may have been already deleted."),y()):a.response.status===409?t.error("Cannot delete field of research with existing research areas. Delete the research areas first."):(r=a.response.data)!=null&&r.error?t.error(a.response.data.error):(d=a.response.data)!=null&&d.message?t.error(a.response.data.message):t.error(`Error (${a.response.status}): Unable to delete field of research.`):t.error("Network error or server not responding."),console.error("Error deleting field of research:",a)}finally{o(a=>({...a,fieldDelete:!1})),l&&l.id===m.id&&T(null)}})()},J=()=>{w(null),p(e=>({...e,area:"create"})),o(e=>({...e,areaForm:!0}))},K=e=>{w(e),p(r=>({...r,area:"edit"})),o(r=>({...r,areaForm:!0}))},W=e=>{w(e),o(r=>({...r,areaDelete:!0}))},X=()=>{o(e=>({...e,areaForm:!1})),j()},Y=()=>{if(!u)return;(async()=>{var r,d;try{await g.delete(`/api/v1/research-areas/${u.id}`),t.success("Research Area deleted successfully!"),j()}catch(a){a.response?a.response.status===404?(t.error("Research area not found. It may have been already deleted."),j()):a.response.status===409?t.error("Cannot delete research area with existing niche domains. Delete the niche domains first."):(r=a.response.data)!=null&&r.error?t.error(a.response.data.error):(d=a.response.data)!=null&&d.message?t.error(a.response.data.message):t.error(`Error (${a.response.status}): Unable to delete research area.`):t.error("Network error or server not responding."),console.error("Error deleting research area:",a)}finally{o(a=>({...a,areaDelete:!1})),n&&n.id===u.id&&b(null)}})()},Z=()=>{D(null),p(e=>({...e,domain:"create"})),o(e=>({...e,domainForm:!0}))},ee=e=>{D(e),p(r=>({...r,domain:"edit"})),o(r=>({...r,domainForm:!0}))},se=e=>{D(e),o(r=>({...r,domainDelete:!0}))},re=()=>{o(e=>({...e,domainForm:!1})),v()},ae=()=>{if(!x)return;(async()=>{var r,d;try{await g.delete(`/api/v1/niche-domains/${x.id}`),t.success("Niche Domain deleted successfully!"),v()}catch(a){a.response?a.response.status===404?(t.error("Niche domain not found. It may have been already deleted."),v()):(r=a.response.data)!=null&&r.error?t.error(a.response.data.error):(d=a.response.data)!=null&&d.message?t.error(a.response.data.message):t.error(`Error (${a.response.status}): Unable to delete niche domain.`):t.error("Network error or server not responding."),console.error("Error deleting niche domain:",a)}finally{o(a=>({...a,domainDelete:!1}))}})()};return s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Research Fields Hierarchy"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"border rounded-lg shadow-sm p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-700",children:"Fields of Research"}),s.jsxs("button",{onClick:q,className:"inline-flex items-center px-3 py-1 bg-blue-600 border border-transparent rounded-md text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300",children:[s.jsx(k,{className:"mr-1"})," Add"]})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(M,{className:"text-gray-400"})}),s.jsx("input",{type:"text",value:c.fields,onChange:e=>C("fields",e.target.value),placeholder:"Search fields...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]})}),s.jsx("div",{className:"overflow-y-auto max-h-96",children:N.fields?s.jsx("p",{className:"text-center py-4",children:"Loading..."}):R.length===0?s.jsx("p",{className:"text-center py-4 text-gray-500",children:"No fields found"}):s.jsx("ul",{className:"divide-y divide-gray-200",children:R.map(e=>s.jsxs("li",{className:`py-3 px-2 cursor-pointer hover:bg-gray-50 ${l&&l.id===e.id?"bg-blue-50":""}`,onClick:()=>Q(e),children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"block text-sm font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:r=>{r.stopPropagation(),H(e)},className:"text-blue-600 hover:text-blue-900",children:s.jsx(E,{})}),s.jsx("button",{onClick:r=>{r.stopPropagation(),z(e)},className:"text-red-600 hover:text-red-900",children:s.jsx($,{})})]})]}),s.jsxs("span",{className:"block text-xs text-gray-500",children:[e.research_areas_count||0," research areas"]})]},e.id))})})]}),s.jsxs("div",{className:"border rounded-lg shadow-sm p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-700",children:"Research Areas"}),s.jsxs("button",{onClick:()=>{l&&J()},disabled:!l,className:`inline-flex items-center px-3 py-1 bg-blue-600 border border-transparent rounded-md text-xs text-white uppercase tracking-widest ${l?"hover:bg-blue-700 active:bg-blue-900":"opacity-50 cursor-not-allowed"} focus:outline-none focus:border-blue-900 focus:ring ring-blue-300`,children:[s.jsx(k,{className:"mr-1"})," Add Area"]})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(M,{className:"text-gray-400"})}),s.jsx("input",{type:"text",value:c.areas,onChange:e=>C("areas",e.target.value),placeholder:"Search areas...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",disabled:!l})]})}),s.jsx("div",{className:"overflow-y-auto max-h-96",children:l?N.areas?s.jsx("p",{className:"text-center py-4",children:"Loading..."}):_.length===0?s.jsx("p",{className:"text-center py-4 text-gray-500",children:"No research areas found"}):s.jsx("ul",{className:"divide-y divide-gray-200",children:_.map(e=>s.jsxs("li",{className:`py-3 px-2 cursor-pointer hover:bg-gray-50 ${n&&n.id===e.id?"bg-blue-50":""}`,onClick:()=>V(e),children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"block text-sm font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:r=>{r.stopPropagation(),K(e)},className:"text-blue-600 hover:text-blue-900",children:s.jsx(E,{})}),s.jsx("button",{onClick:r=>{r.stopPropagation(),W(e)},className:"text-red-600 hover:text-red-900",children:s.jsx($,{})})]})]}),s.jsxs("span",{className:"block text-xs text-gray-500",children:[e.niche_domains_count||0," niche domains"]})]},e.id))}):s.jsx("p",{className:"text-center py-4 text-gray-500",children:"Select a field to view research areas"})})]}),s.jsxs("div",{className:"border rounded-lg shadow-sm p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-700",children:"Niche Domains"}),s.jsxs("button",{onClick:()=>{n&&Z()},disabled:!n,className:`inline-flex items-center px-3 py-1 bg-blue-600 border border-transparent rounded-md text-xs text-white uppercase tracking-widest ${n?"hover:bg-blue-700 active:bg-blue-900":"opacity-50 cursor-not-allowed"} focus:outline-none focus:border-blue-900 focus:ring ring-blue-300`,children:[s.jsx(k,{className:"mr-1"})," Add Domain"]})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(M,{className:"text-gray-400"})}),s.jsx("input",{type:"text",value:c.domains,onChange:e=>C("domains",e.target.value),placeholder:"Search domains...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",disabled:!n})]})}),s.jsx("div",{className:"overflow-y-auto max-h-96",children:n?N.domains?s.jsx("p",{className:"text-center py-4",children:"Loading..."}):I.length===0?s.jsx("p",{className:"text-center py-4 text-gray-500",children:"No niche domains found"}):s.jsx("ul",{className:"divide-y divide-gray-200",children:I.map(e=>s.jsx("li",{className:"py-3 px-2 hover:bg-gray-50",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"block text-sm font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>ee(e),className:"text-blue-600 hover:text-blue-900",children:s.jsx(E,{})}),s.jsx("button",{onClick:()=>se(e),className:"text-red-600 hover:text-red-900",children:s.jsx($,{})})]})]})},e.id))}):s.jsx("p",{className:"text-center py-4 text-gray-500",children:"Select a research area to view niche domains"})})]})]}),s.jsx(te,{isOpen:f.fieldForm,onClose:B,field:m,mode:A.field}),s.jsx(oe,{isOpen:f.areaForm,onClose:X,area:u,fieldId:l?l.id:null,mode:A.area}),s.jsx(le,{isOpen:f.domainForm,onClose:re,domain:x,areaId:n?n.id:null,mode:A.domain}),s.jsx(S,{isOpen:f.fieldDelete,title:"Delete Field of Research",message:`Are you sure you want to delete "${m==null?void 0:m.name}"? This action cannot be undone.`,onConfirm:G,onCancel:()=>o(e=>({...e,fieldDelete:!1}))}),s.jsx(S,{isOpen:f.areaDelete,title:"Delete Research Area",message:`Are you sure you want to delete "${u==null?void 0:u.name}"? This action cannot be undone.`,onConfirm:Y,onCancel:()=>o(e=>({...e,areaDelete:!1}))}),s.jsx(S,{isOpen:f.domainDelete,title:"Delete Niche Domain",message:`Are you sure you want to delete "${x==null?void 0:x.name}"? This action cannot be undone.`,onConfirm:ae,onCancel:()=>o(e=>({...e,domainDelete:!1}))})]})}export{fe as default};
