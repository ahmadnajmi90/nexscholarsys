import{r as h,j as e,b as A,a as w}from"./app-A8xQkvSk.js";import{c as C}from"./index-Km-vM6Jb.js";import{l as R}from"./logError-D4ezqrCx.js";import{B as k}from"./badge-CFoP9Krf.js";import{C as M,a as U,b as T,c as D}from"./card-DyHgWaPU.js";import{B as y}from"./button-Dz_rydmG.js";import"./separator-B59s4oDI.js";import P from"./RequestDetailCard-BCfln0Rn.js";import{C as B}from"./ConfirmationModal-C-j5S7kM.js";import{U as _}from"./user-round-CEZUuFcg.js";import{C as E}from"./clock-3-C_DEcbhV.js";import{F as L}from"./file-text-BfC4OSQU.js";import{M as $}from"./message-circle-BHBy_nP-.js";import{C as F}from"./circle-check-ddCD_g9w.js";import{L as I}from"./loader-circle-DkpR38mE.js";import{C as O}from"./circle-x-R0AwPcda.js";import{f as V}from"./format-hTuirObu.js";import{f as Y}from"./formatDistanceToNow-GKXiLTrL.js";import"./index-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./utils-CIsb_jhR.js";import"./index-7Qlnuq3l.js";import"./tabs-Cbyzn-fX.js";import"./index-BEzQHz4a.js";import"./index-CG1gsK_f.js";import"./index-DwuY8lh1.js";import"./index-OrEFxIKi.js";import"./index-DMPy21CI.js";import"./index-B0SlzLk6.js";import"./avatar-CbIr_OjG.js";import"./scroll-area-COMlVIOb.js";import"./ThreadPane-CPpSuURI.js";import"./Modal-D_n_zj3N.js";import"./dialog-BkDQGxoj.js";import"./transition-Bvb6H6Z4.js";import"./AttachmentPreviewModal-CXErbNPv.js";import"./en-US-DNUEYIb-.js";import"./download-CMnE0euH.js";import"./createLucideIcon-DPzobtnR.js";import"./x-vL7g-LuD.js";import"./AcceptSupervisorOfferModal-CGntPWdr.js";import"./label-BcrT7TVM.js";import"./checkbox-DDgIuOJc.js";import"./index-rTP0VXgG.js";import"./index-Db3xrL5F.js";import"./check-BeDd_wJ7.js";import"./alert-BBFXwXFc.js";import"./circle-alert-CPnO62Yc.js";import"./message-square-C9nAneZj.js";import"./calendar-EpaZ4Aad.js";import"./video-DL3IJgDp.js";import"./briefcase-CfUq1pnR.js";import"./mail-Dtimj1fp.js";import"./phone-D1xIudn-.js";import"./graduation-cap-the7C-yQ.js";import"./calendar-clock-BwBj7N73.js";import"./triangle-alert-BND9SWEh.js";import"./constructNow-DtVD-0hX.js";const S={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},z={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function Qe({requests:t=[],reload:n,onOpenDetail:v}){var N;const[f,o]=h.useState(null),[x,l]=h.useState(null),[m,r]=h.useState(!1),[s,d]=h.useState(null),b=i=>{d(i),r(!0)},g=async()=>{var i,p;if(s!=null&&s.id){o(s.id),r(!1);try{await A.post(route("supervision.requests.cancel",s.id)),C.success("Proposal withdrawn"),n==null||n()}catch(c){R(c,"RequestStatusList handleCancel");const j=((p=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:p.message)||"Unable to cancel your request right now";C.error(j)}finally{o(null),d(null)}}},u=!Array.isArray(t)||t.length===0,a=h.useMemo(()=>Array.isArray(t)?[...t].sort((i,p)=>{const c=["cancelled","auto_cancelled"].includes(i.status),j=["cancelled","auto_cancelled"].includes(p.status);return c&&!j?1:!c&&j?-1:0}):[],[t]);return u?e.jsxs(M,{className:"border-dashed border-slate-200",children:[e.jsx(U,{children:e.jsx(T,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),e.jsx(D,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>e.jsx(G,{request:i,onCancel:b,onOpenDetail:p=>l(p),isCancelling:f===i.id},i.id))}),x&&e.jsx(P,{request:x,onClose:()=>l(null),onUpdated:n}),e.jsx(B,{show:m,onClose:()=>{r(!1),d(null)},onConfirm:g,title:"Cancel Supervision Request",message:`Are you sure you want to withdraw your supervision request${(N=s==null?void 0:s.academician)!=null&&N.full_name?` to ${s.academician.full_name}`:""}? This action cannot be undone.`,confirmButtonText:"Yes, Cancel Request"})]})}function G({request:t,onCancel:n,onOpenDetail:v,isCancelling:f}){var u;const o=(t==null?void 0:t.academician)??{},x=((u=o.university)==null?void 0:u.name)??null,l=o.full_name??"Supervisor",m=o.profile_picture?`/storage/${o.profile_picture}`:null,r=o.url||null,s=S[t==null?void 0:t.status]??S.pending,d=z[t==null?void 0:t.status]??"Pending supervisor response",b=t!=null&&t.submitted_at?V(new Date(t.submitted_at),"dd/MM/yyyy"):"—",g=t!=null&&t.submitted_at?Y(new Date(t.submitted_at),{addSuffix:!0}):null;return e.jsxs("div",{className:"border rounded-xl p-5 bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>v(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[r?e.jsx(w,{href:route("academicians.show",r),className:"flex-shrink-0",onClick:a=>a.stopPropagation(),children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden hover:ring-2 hover:ring-indigo-300 transition-all cursor-pointer",children:m?e.jsx("img",{src:m,alt:l,className:"w-full h-full object-cover rounded-full"}):e.jsx(_,{className:"w-5 h-5 text-indigo-600"})})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:m?e.jsx("img",{src:m,alt:l,className:"w-full h-full object-cover rounded-full"}):e.jsx(_,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[r?e.jsx(w,{href:route("academicians.show",r),onClick:a=>a.stopPropagation(),children:e.jsx("h3",{className:"text-[1.05rem] font-semibold text-gray-900 leading-snug truncate hover:text-indigo-600 transition-colors cursor-pointer",children:l})}):e.jsx("h3",{className:"text-[1.05rem] font-semibold text-gray-900 leading-snug truncate",children:l}),x&&e.jsx("p",{className:"text-sm text-gray-600 truncate font-normal",children:x}),g&&e.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:g})]})]}),e.jsx(k,{className:`${s.className} flex-shrink-0`,children:((t==null?void 0:t.status)??"pending").split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")})]}),e.jsx("div",{className:"mt-4",children:e.jsx("h4",{className:"text-base font-semibold text-slate-900 line-clamp-2 leading-snug",children:(t==null?void 0:t.proposal_title)??"Supervision request"})}),d&&e.jsx("div",{className:"mt-2 flex items-start gap-1.5",children:e.jsx("span",{className:"text-sm text-slate-600",children:d})}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:b})]}),(t==null?void 0:t.attachments)&&t.attachments.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[t.attachments.length," file",t.attachments.length!==1?"s":""]})]}),(t==null?void 0:t.conversation_id)&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx($,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Conversation active"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 pt-4 border-t",children:[e.jsxs(y,{variant:"outline",size:"sm",className:"flex-1",onClick:a=>{a.stopPropagation(),v(t)},children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"View Details"]}),(t==null?void 0:t.status)==="pending"&&e.jsx(y,{variant:"outline",size:"sm",disabled:f,onClick:a=>{a.stopPropagation(),n==null||n(t)},className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",children:f?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"})})]})]})}export{Qe as default};
