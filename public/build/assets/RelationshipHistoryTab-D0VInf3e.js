import{r as i,a as f,j as s}from"./app-Doi1BfNX.js";import{l as C}from"./logError-D4ezqrCx.js";import{c as b}from"./createLucideIcon-BIWf6Fgr.js";import{C as v}from"./circle-alert-DIrS-PEp.js";import{U as g}from"./users-CJk5icQ6.js";import{L as $}from"./loader-circle-D1uCPtBJ.js";import{f as h}from"./format-Dv9Rm441.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],p=b("UserCheck",k);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],o=b("UserX",I);function U({relationship:t}){const[_,m]=i.useState(!0),[j,N]=i.useState([]),[R,y]=i.useState([]);i.useEffect(()=>{t!=null&&t.id&&w()},[t==null?void 0:t.id]);const w=async()=>{m(!0);try{const a=(await f.get(`/api/v1/app/supervision/relationships/${t.id}`)).data.data;if(N(a.unbindRequests||[]),t.student_id)try{const c=await f.get("/api/v1/app/supervision/cosupervisor-invitations/my-invitations"),l=[...c.data.as_cosupervisor||[],...c.data.to_approve||[],...c.data.as_initiator||[]].filter(n=>{var x;return((x=n.relationship)==null?void 0:x.student_id)===t.student_id});y(l)}catch(c){console.log("Could not load co-supervisor events",c),y([])}}catch(e){C(e,"RelationshipHistoryTab loadActivityData")}finally{m(!1)}},d=[{id:"rel-start",title:"Relationship Started",date:t==null?void 0:t.accepted_at,status:"completed",icon:p,color:"green"}];j.forEach((e,a)=>{e.status==="pending"?d.push({id:`unbind-${a}`,title:"Unbind Request Pending",description:`Initiated by ${e.initiated_by}`,date:e.created_at,status:"pending",icon:v,color:"yellow"}):e.status==="approved"?d.push({id:`unbind-${a}`,title:"Unbind Request Approved",description:"Relationship terminated",date:e.responded_at||e.updated_at,status:"completed",icon:o,color:"red"}):e.status==="rejected"&&d.push({id:`unbind-${a}`,title:"Unbind Request Rejected",date:e.responded_at||e.updated_at,status:"completed",icon:o,color:"gray"})}),R.forEach((e,a)=>{var u,l,n;const c=((u=e.cosupervisor)==null?void 0:u.full_name)||((n=(l=e.cosupervisor)==null?void 0:l.user)==null?void 0:n.name)||"Co-Supervisor";e.completed_at?d.push({id:`cosup-${a}`,title:`Co-Supervisor Added: ${c}`,description:`Initiated by ${e.initiated_by==="student"?"Student":"Main Supervisor"}`,date:e.completed_at,status:"completed",icon:g,color:"blue"}):e.cosupervisor_status==="rejected"||e.approver_status==="rejected"?d.push({id:`cosup-${a}`,title:"Co-Supervisor Invitation Rejected",description:c,date:e.updated_at,status:"completed",icon:o,color:"gray"}):e.cancelled_at?d.push({id:`cosup-${a}`,title:"Co-Supervisor Invitation Cancelled",description:c,date:e.cancelled_at,status:"completed",icon:o,color:"gray"}):d.push({id:`cosup-${a}`,title:"Co-Supervisor Invitation Pending",description:c,date:e.created_at,status:"pending",icon:g,color:"yellow"})}),(t==null?void 0:t.status)==="active"&&!(t!=null&&t.terminated_at)&&d.push({id:"rel-active",title:"Active Supervision",date:t==null?void 0:t.accepted_at,status:"current",icon:p,color:"blue"}),t!=null&&t.terminated_at&&d.push({id:"rel-terminated",title:"Relationship Terminated",date:t.terminated_at,status:"completed",icon:o,color:"red"});const r=d.filter(e=>e.date).sort((e,a)=>new Date(a.date)-new Date(e.date)),S=e=>{switch(e){case"green":return"bg-green-100 text-green-600";case"blue":return"bg-blue-100 text-blue-600";case"yellow":return"bg-yellow-100 text-yellow-600";case"red":return"bg-red-100 text-red-600";case"gray":return"bg-slate-100 text-slate-600";default:return"bg-slate-100 text-slate-600"}};return _?s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx($,{className:"h-8 w-8 animate-spin text-indigo-600"})})}):s.jsx("div",{className:"p-6",children:s.jsxs("section",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Recent Activity (",r.length,")"]}),r.length===0?s.jsxs("div",{className:"border border-slate-200 rounded-lg p-8 bg-slate-50 text-center",children:[s.jsx(v,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-slate-500",children:"No activity recorded yet."})]}):s.jsx("div",{className:"space-y-4",children:r.map((e,a)=>{const c=e.icon||p;return s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${S(e.color)}`,children:s.jsx(c,{className:"h-5 w-5"})}),a<r.length-1&&s.jsx("div",{className:"w-0.5 flex-1 bg-slate-200 mt-2",style:{minHeight:"40px"}})]}),s.jsxs("div",{className:"flex-1 pb-6",children:[s.jsx("h4",{className:"font-medium text-slate-900",children:e.title}),e.description&&s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:e.description}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:h(new Date(e.date),"dd MMM yyyy, HH:mm")})]})]},e.id)})})]})})}const z=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{U as R,p as U,z as a};
