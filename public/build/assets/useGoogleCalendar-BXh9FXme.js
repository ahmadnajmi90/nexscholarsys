import{r as n,a as i}from"./app-Doi1BfNX.js";import{c as o}from"./index-dbiIR3J5.js";import{l as u}from"./logError-D4ezqrCx.js";function A(){const[y,p]=n.useState(!1),[G,f]=n.useState(!1),[E,C]=n.useState(!0),[b,w]=n.useState(null),c=n.useCallback(async()=>{try{C(!0);const e=await i.get(route("supervision.google-calendar.status")),{connected:s,enabled:t,token_expires_at:r}=e.data;p(s),f(t),w(r)}catch(e){u(e,"useGoogleCalendar checkStatus"),p(!1),f(!1)}finally{C(!1)}},[]),k=n.useCallback(async()=>{try{const e=await i.get(route("supervision.google-calendar.auth-url")),{auth_url:s,debug:t}=e.data;if(t&&(console.log("🔍 Google Calendar Debug Info:"),console.log("  Redirect URI:",t.redirect_uri),console.log("  App URL:",t.app_url),console.log("  Auth URL:",s)),!s)throw new Error("No authorization URL received");const r=600,d=700,g=window.screen.width/2-r/2,a=window.screen.height/2-d/2,m=window.open(s,"Google Calendar Authorization",`width=${r},height=${d},left=${g},top=${a},scrollbars=yes,resizable=yes`);if(!m){o.error("Please allow popups to connect Google Calendar");return}const h=l=>{l.origin===window.location.origin&&l.data&&l.data.type==="google-calendar-oauth-complete"&&(window.removeEventListener("message",h),l.data.status==="success"?o.success(l.data.message||"Google Calendar connected successfully!"):o.error(l.data.message||"Failed to connect Google Calendar"),c())};window.addEventListener("message",h);const L=setInterval(()=>{m.closed&&(clearInterval(L),window.removeEventListener("message",h),setTimeout(()=>{c()},500))},500);return m}catch(e){u(e,"useGoogleCalendar connect"),o.error("Failed to connect Google Calendar")}},[c]),v=n.useCallback(async()=>{try{await i.post(route("supervision.google-calendar.disconnect")),p(!1),f(!1),w(null),o.success("Google Calendar disconnected")}catch(e){u(e,"useGoogleCalendar disconnect"),o.error("Failed to disconnect Google Calendar")}},[]),x=n.useCallback(async e=>{var s,t,r,d,g;try{const a=await i.post(route("supervision.google-calendar.add-meeting",{meeting:e}));if(a.data.success)return o.success("Meeting added to Google Calendar"),{success:!0,meeting:a.data.meeting};if(a.data.needs_connection)return o.error("Please connect Google Calendar first"),{success:!1};throw new Error(a.data.message||"Failed to add meeting")}catch(a){if(((s=a.response)==null?void 0:s.status)===403)o.error("You do not have permission to add this meeting");else{if((r=(t=a.response)==null?void 0:t.data)!=null&&r.already_exists)return o("This meeting is already in your Google Calendar",{icon:"ℹ️",duration:3e3}),{success:!1,alreadyExists:!0,meeting:a.response.data.meeting};(g=(d=a.response)==null?void 0:d.data)!=null&&g.needs_connection?o.error("Please connect Google Calendar first"):(u(a,"useGoogleCalendar addMeetingToCalendar"),o.error("Failed to add meeting to Google Calendar"))}return{success:!1}}},[]),F=n.useCallback(async()=>{try{const e=await i.post(route("supervision.google-calendar.sync"));if(e.data.success){const{synced:s,updated:t,deleted:r}=e.data;return s>0?o.success(`Synced ${s} meeting(s) from Google Calendar`):o.success("No changes to sync"),{synced:s,updated:t,deleted:r}}throw new Error(e.data.message||"Sync failed")}catch(e){return u(e,"useGoogleCalendar syncFromGoogle"),o.error("Failed to sync from Google Calendar"),null}},[]);return n.useEffect(()=>{c()},[c]),{isConnected:y,isEnabled:G,isLoading:E,tokenExpiresAt:b,checkStatus:c,connect:k,disconnect:v,addMeetingToCalendar:x,syncFromGoogle:F}}export{A as u};
