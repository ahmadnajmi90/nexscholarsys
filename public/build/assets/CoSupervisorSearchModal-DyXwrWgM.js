import{q as Ce,r as m,a as j,j as e}from"./app-Ba9NEla_.js";import{B as T}from"./button-BEWen7a0.js";import{I as Se}from"./input-CVXaQnVF.js";import{T as ke,a as Ae,b as V,c as q}from"./tabs-B8_YVRTF.js";import{C as Ie,a as Ee}from"./card-CqrB6JdE.js";import{A as ie,a as ne}from"./avatar-DYCjIyUA.js";import{B as ce}from"./badge-Dn3o0qN0.js";import{t as L}from"./index-DlwQBuk_.js";import{A as Re}from"./index-DBU4d1mm.js";import{m as re}from"./proxy-Av63RA2h.js";import{U as Te}from"./user-plus-CAe95gky.js";import{X as Le}from"./x-DVH-fLs-.js";import{S as le}from"./search-FWjCe4AE.js";import{G as oe}from"./graduation-cap-CaNWWPpW.js";import{c as Pe}from"./createLucideIcon-D9Xjp5kf.js";import{U as de}from"./users-DHlOkeZx.js";import"./utils-D-KgF5mV.js";import"./index-B75IAngf.js";import"./index-CDEssc61.js";import"./index-C1WBEj0V.js";import"./index-BAWFi-Zq.js";import"./index-edx9cnCL.js";import"./index-xQoiVGlk.js";import"./index-DKkZd806.js";import"./index-C_0yBoYj.js";import"./index-CGrAONsN.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],me=Pe("Network",Fe),ls=({isOpen:P,onClose:y,relationship:h,onInvite:xe})=>{var Y,Z,O;const{auth:pe}=Ce().props,g=((Y=pe.user)==null?void 0:Y.postgraduate)!==null,[F,he]=m.useState(g?"potential":"connections"),[f,ue]=m.useState(""),[fe,E]=m.useState(!1),[ge,G]=m.useState([]),[ve,Q]=m.useState([]),[je,M]=m.useState([]),[U,X]=m.useState([]),[i,z]=m.useState(null),[N,H]=m.useState(""),[J,K]=m.useState(!1);m.useEffect(()=>{P&&(ye(),g&&Ne(),we())},[P,g]);const ye=async()=>{try{console.log("Loading excluded academicians for relationship:",h.id,"student:",h.student_id);const a=(await j.get(`/api/v1/app/supervision/relationships/${h.id}`)).data.data||{};console.log("Relationship details:",a);const r=(await j.get("/api/v1/app/supervision/cosupervisor-invitations/my-invitations")).data.as_initiator||[];console.log("My initiated invitations:",r);const c=new Set;h.academician_id&&(c.add(h.academician_id),console.log("Excluding main supervisor:",h.academician_id));const t=a.cosupervisors||[];console.log("Co-supervisors from relationship:",t),t.forEach(n=>{n.academician_id&&(c.add(n.academician_id),console.log("Excluding active co-supervisor:",n.academician_id))});const o=r.filter(n=>n.relationship_id===h.id&&!n.cancelled_at&&n.cosupervisor_status!=="rejected"&&n.approver_status!=="rejected");console.log("Pending invitations for this relationship:",o),o.forEach(n=>{c.add(n.cosupervisor_academician_id),console.log("Excluding pending invitation to:",n.cosupervisor_academician_id)});const x=Array.from(c);console.log("Final excluded academician IDs:",x),X(x)}catch(s){console.error("Error loading excluded academicians:",s),X([])}},Ne=async()=>{try{E(!0);const s=await j.get("/api/v1/app/supervision/shortlist");G(s.data.data||[])}catch(s){console.error("Error loading potential supervisors:",s),G([])}finally{E(!1)}},we=async()=>{try{const s=await j.get("/api/v1/app/supervision/recommendations/supervisor-connections");Q(s.data.data||[])}catch(s){console.error("Error loading connections:",s),Q([])}},be=async s=>{if(!s||s.length<2){M([]);return}try{E(!0);const a=await j.get("/api/v1/app/supervision/recommendations/search-academicians",{params:{q:s}});M(a.data.data||[])}catch(a){console.error("Error searching academicians:",a),M([])}finally{E(!1)}};m.useEffect(()=>{if(F==="all"&&f){const s=setTimeout(()=>{be(f)},500);return()=>clearTimeout(s)}},[f,F]);const _e=async s=>{var l,r,c;if(!N.trim()){L.error("Please add a personal message");return}const a=((l=s.academician)==null?void 0:l.academician_id)||s.id;if(!a){L.error("Invalid academician selected");return}K(!0);try{const t=await j.post(`/api/v1/app/supervision/relationships/${h.id}/cosupervisor/invite`,{cosupervisor_academician_id:a,invitation_message:N});L.success("Co-supervisor invitation sent successfully!"),z(null),H(""),xe(t.data.invitation),y()}catch(t){L.error(((c=(r=t.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to send invitation")}finally{K(!1)}},B=({academician:s,source:a})=>{var C,S,k,A,I,d,u,ee,se,ae,te;const l=((C=s.academician)==null?void 0:C.academician_id)||s.id,r=((S=s.academician)==null?void 0:S.full_name)||s.name,c=((k=s.academician)==null?void 0:k.profile_picture)||s.profile_picture,t=((A=s.academician)==null?void 0:A.department)||s.department;let o="";if(a==="potential"){const p=((I=s.academician)==null?void 0:I.research_domains)||[];o=p.length>0?p.slice(0,3).join(", "):"Research expertise not specified"}else o=s.expertise||"Research expertise not specified";const x=((d=s.academician)==null?void 0:d.verified)||s.verified;let n=[];if(a==="potential"){const p=(ee=(u=s.academician)==null?void 0:u.university)==null?void 0:ee.name,v=(ae=(se=s.academician)==null?void 0:se.faculty)==null?void 0:ae.name;p&&n.push(p),v&&n.push(v),t&&n.push(t)}else{const p=s.university,v=s.faculty;p&&n.push(p),v&&v!==t&&n.push(v),t&&n.push(t)}const w=n.join(" • "),b=i&&(((te=i.academician)==null?void 0:te.academician_id)||i.id)===l,_=c?`/storage/${c}`:null,R=r?r.split(" ").map(p=>p[0]).join("").slice(0,2).toUpperCase():"??";return e.jsx(Ie,{className:`cursor-pointer transition-all hover:shadow-md ${b?"ring-2 ring-indigo-500":""}`,onClick:()=>z(s),children:e.jsx(Ee,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"h-12 w-12 flex-shrink-0",children:_?e.jsx("img",{src:_,alt:r,className:"h-full w-full object-cover"}):e.jsx(ne,{className:"bg-indigo-100 text-indigo-700",children:R})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:r}),x&&e.jsx(ce,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 flex-shrink-0",children:"Verified"})]}),o&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:o}),w&&e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:w})]}),b&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-6 h-6 bg-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})})})},$=ge.filter(s=>{var t,o,x;const a=(t=s.academician)==null?void 0:t.academician_id;if(a&&U.includes(a))return!1;const l=((o=s.academician)==null?void 0:o.full_name)||"",r=((x=s.academician)==null?void 0:x.department)||"",c=f.toLowerCase();return l.toLowerCase().includes(c)||r.toLowerCase().includes(c)}),D=ve.filter(s=>{const a=s.id;if(a&&U.includes(a))return!1;const l=s.name||"",r=s.department||"",c=s.expertise||"",t=f.toLowerCase();return l.toLowerCase().includes(t)||r.toLowerCase().includes(t)||c.toLowerCase().includes(t)}),W=je.filter(s=>{const a=s.id;return!(a&&U.includes(a))});return e.jsx(Re,{children:P&&e.jsxs(e.Fragment,{children:[e.jsx(re.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:y}),e.jsx(re.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:y,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 sm:w-6 sm:h-6 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Add Co-Supervisor"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 truncate",children:["Search and invite a co-supervisor for ",(O=(Z=h.student)==null?void 0:Z.user)==null?void 0:O.name]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:y,className:"flex-shrink-0",children:e.jsx(Le,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:i?e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 overflow-y-auto",children:[e.jsx(T,{variant:"ghost",onClick:()=>z(null),className:"mb-2 sm:mb-4 text-sm sm:text-base",children:"← Back to Search"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 sm:p-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-3",children:"Selected Co-Supervisor:"}),e.jsx("div",{className:"flex items-start gap-3",children:(()=>{var w,b,_,R,C,S,k,A,I;const s=((w=i.academician)==null?void 0:w.full_name)||i.name,a=((b=i.academician)==null?void 0:b.profile_picture)||i.profile_picture,l=((_=i.academician)==null?void 0:_.department)||i.department,r=((R=i.academician)==null?void 0:R.verified)||i.verified;let c="";if((C=i.academician)!=null&&C.research_domains){const d=i.academician.research_domains||[];c=d.length>0?d.slice(0,3).join(", "):"Research expertise not specified"}else c=i.expertise||"Research expertise not specified";let t=[];if(i.academician){const d=(k=(S=i.academician)==null?void 0:S.university)==null?void 0:k.name,u=(I=(A=i.academician)==null?void 0:A.faculty)==null?void 0:I.name;d&&t.push(d),u&&t.push(u),l&&t.push(l)}else{const d=i.university,u=i.faculty;d&&t.push(d),u&&u!==l&&t.push(u),l&&t.push(l)}const o=t.join(" • "),x=a?`/storage/${a}`:null,n=s?s.split(" ").map(d=>d[0]).join("").slice(0,2).toUpperCase():"??";return e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-12 w-12 sm:h-14 sm:w-14 flex-shrink-0",children:x?e.jsx("img",{src:x,alt:s,className:"h-full w-full object-cover"}):e.jsx(ne,{className:"bg-indigo-100 text-indigo-700 text-base sm:text-lg",children:n})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:s}),r&&e.jsx(ce,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 flex-shrink-0",children:"Verified"})]}),c&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:c}),o&&e.jsx("p",{className:"text-xs text-gray-500",children:o})]})]})})()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:["Personal Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 min-h-[100px] sm:min-h-[120px] text-sm sm:text-base",placeholder:"Explain why you'd like this academician to be a co-supervisor...",value:N,onChange:s=>H(s.target.value),maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[N.length,"/1000 characters"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 sm:p-6 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),e.jsx(Se,{placeholder:"Search by name or email...",value:f,onChange:s=>ue(s.target.value),className:"pl-9 sm:pl-10 text-sm sm:text-base"})]})}),e.jsxs(ke,{value:F,onValueChange:he,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(Ae,{className:`mx-4 sm:mx-6 mt-4 flex-shrink-0 h-auto p-1.5 grid gap-1 ${g?"grid-cols-3":"grid-cols-2"}`,children:[g&&e.jsxs(V,{value:"potential",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(oe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Shortlist"}),e.jsx("span",{className:"xs:hidden",children:"Short"}),e.jsxs("span",{className:"hidden sm:inline",children:["(",$.length,")"]})]}),e.jsxs(V,{value:"connections",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(me,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Connections"}),e.jsx("span",{className:"xs:hidden",children:"Conn"}),e.jsxs("span",{className:"hidden sm:inline",children:["(",D.length,")"]})]}),e.jsxs(V,{value:"all",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(de,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"All"}),e.jsx("span",{className:"xs:hidden",children:"All"}),e.jsx("span",{className:"hidden sm:inline",children:"Academicians"})]})]}),g&&e.jsx(q,{value:"potential",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:$.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No potential supervisors in your shortlist"})]}):$.map(s=>{var a;return e.jsx(B,{academician:s,source:"potential"},((a=s.academician)==null?void 0:a.academician_id)||s.id)})})}),e.jsx(q,{value:"connections",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No connections found"})]}):D.map(s=>e.jsx(B,{academician:s,source:"connections"},s.id))})}),e.jsx(q,{value:"all",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:f.length<2?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Type at least 2 characters to search"})]}):fe?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Searching..."})]}):W.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No academicians found"})]}):W.map(s=>e.jsx(B,{academician:s,source:"all"},s.id))})})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 border-t bg-gray-50 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:i?e.jsx("span",{children:"Ready to send invitation"}):e.jsx("span",{children:"Select an academician to continue"})}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx(T,{variant:"outline",onClick:y,className:"flex-1 sm:flex-none",children:"Cancel"}),i&&e.jsx(T,{onClick:()=>_e(i),disabled:J||!N.trim(),className:"flex-1 sm:flex-none",children:J?"Sending...":"Send Invitation"})]})]})]})})]})})};export{ls as default};
