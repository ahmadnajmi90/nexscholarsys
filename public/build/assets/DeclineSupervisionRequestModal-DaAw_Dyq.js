import{r as l,j as e,a as K}from"./app-1xdDtbuK.js";import{D as O,a as V,b as H,c as z,d as J}from"./dialog-CoaUQ5Lc.js";import{B as $}from"./button-C8UkfpK0.js";import{L as o}from"./label-D7SG665j.js";import{T as I}from"./textarea-BFY97gm1.js";import{C as L}from"./checkbox-BmiERlrK.js";import{S as W,a as X,b as G,c as Q,d as U}from"./select-BrUbrLKR.js";import{A as Y,a as Z}from"./alert-D8v-c6Ma.js";import{S as q}from"./scroll-area-BgPQHzEc.js";import{A as ee,a as se}from"./avatar-D-oPzU4f.js";import{B as ae}from"./badge-BEOaklIL.js";import{c as F}from"./index-D0Me3U07.js";import{L as te,l as ie}from"./logError-D94OA_8l.js";import{C as re}from"./circle-x-BLf-5S40.js";import{C as le}from"./circle-alert-BFvG4bOq.js";import"./index-IKXJ_6Oa.js";import"./index-Xvo6Gjfs.js";import"./index-BwSrKXyJ.js";import"./index-B4t-rvdw.js";import"./Combination-BT52CjGs.js";import"./tslib.es6-CmEaCU22.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./x-BNVzQHji.js";import"./createLucideIcon-DrqMkvSZ.js";import"./index-Dp3B9jqt.js";import"./index-Bd0OtrUa.js";import"./check-YxhKEfI-.js";import"./index-Jh8UucBw.js";import"./index-BWav5wTl.js";import"./index-BCAsON0T.js";import"./floating-ui.dom-eiE65J5j.js";import"./chevron-down-BW-Ygft-.js";import"./chevron-up-Bha-3gke.js";const P=[{value:"capacity_full",label:"Capacity full - Not accepting new students"},{value:"research_mismatch",label:"Research interests do not align"},{value:"expertise_mismatch",label:"Outside my area of expertise"},{value:"timing",label:"Timing not suitable (sabbatical/other commitments)"},{value:"qualification",label:"Student qualifications do not meet requirements"},{value:"other",label:"Other reason (please specify)"}];function Ve({isOpen:f,request:a,onClose:n,onRejected:j}){var _;const[c,N]=l.useState(""),[p,y]=l.useState(""),[d,S]=l.useState(!1),[m,w]=l.useState([]),[u,b]=l.useState(""),[h,k]=l.useState(!1),g=((a==null?void 0:a.student)||{}).full_name||"Student",C=((_=a==null?void 0:a.postgraduate_program)==null?void 0:_.name)||"PhD Computer Science Program",D=(a==null?void 0:a.proposal_title)||"Research Topic",x=(a==null?void 0:a.research_keywords)||[];l.useEffect(()=>{f&&x.length>0&&b(x.join(", "))},[f,x]);const R=c!=="",T=s=>{w(t=>t.find(r=>r.id===s.id)?t.filter(r=>r.id!==s.id):[...t,s])},E=[{id:1,name:"Dr. Sarah Kim",expertise:"Machine Learning, NLP"},{id:2,name:"Prof. Michael Tan",expertise:"Human-Computer Interaction"},{id:3,name:"Dr. Lisa Wang",expertise:"Computer Vision, AI"}],M=()=>{var i,r;const s=((i=P.find(v=>v.value===c))==null?void 0:i.label)||"",t=m.map(v=>v.name).join(", ");return`Dear ${g},

Thank you for your interest in working with me on your ${C} research. After carefully reviewing your proposal titled "${D}", I regret to inform you that I will not be able to supervise your research at this time.

Reason: ${s}

${p?`
${p}
`:""}
${d&&m.length>0?`
I recommend reaching out to the following supervisors who might be a better fit for your research:
${t}
`:""}
${u?`
Suggested keywords for your supervisor search: ${u}
`:""}
I wish you the best of luck in finding a suitable supervisor for your research.

Best regards,
Dr. ${((r=a==null?void 0:a.academician)==null?void 0:r.full_name)||"Supervisor"}`},B=async()=>{var s,t;if(!(!R||h)){k(!0);try{const i={reason:c,feedback:p.trim()||null,recommend_alternatives:d,recommended_supervisors:d?m.map(r=>r.id):[],suggested_keywords:u.trim()||null};await K.post(route("supervision.requests.reject",a.id),i),F.success("Rejection sent to student"),j==null||j(),n==null||n()}catch(i){ie(i,"DeclineSupervisionRequestModal handleSubmit");const r=((t=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to decline supervision request";F.error(r)}finally{k(!1)}}},A=()=>{h||(N(""),y(""),S(!1),w([]),b(""),n==null||n())};return e.jsx(O,{open:f,onOpenChange:s=>s?null:A(),children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-hidden p-0",children:[e.jsxs(H,{className:"px-6 pt-6 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"h-6 w-6 text-red-600"}),e.jsx(z,{className:"text-xl font-semibold",children:"Decline Supervision Request"})]}),e.jsxs(J,{children:["Provide feedback to ",g," and optionally suggest alternative supervisors."]})]}),e.jsx(q,{className:"max-h-[calc(90vh-180px)]",children:e.jsxs("div",{className:"px-6 pb-6 space-y-6",children:[e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Request Summary"}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(ee,{className:"h-10 w-10",children:e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-sm",children:g.split(" ").map(s=>s[0]).join("").slice(0,2)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:g}),e.jsx("div",{className:"text-xs text-slate-500",children:C})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Research Topic"}),e.jsx("div",{className:"text-sm text-slate-900 mt-1",children:D})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:x.map((s,t)=>e.jsx(ae,{variant:"secondary",className:"text-xs",children:s},t))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs(o,{htmlFor:"reason",children:["Reason for Declining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(W,{value:c,onValueChange:N,children:[e.jsx(X,{id:"reason",children:e.jsx(G,{placeholder:"Select a reason"})}),e.jsx(Q,{children:P.map(s=>e.jsx(U,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx(o,{htmlFor:"feedback",children:"Additional Feedback (Optional)"}),e.jsx(I,{id:"feedback",rows:4,value:p,onChange:s=>y(s.target.value),placeholder:"Any constructive feedback about the proposal or suggestions for improvement...",className:"resize-none"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{id:"recommend",checked:d,onCheckedChange:S,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{htmlFor:"recommend",className:"text-sm font-medium cursor-pointer",children:"Recommend alternative supervisors"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Help the student by suggesting other supervisors who might be a better fit"})]})]}),d&&e.jsxs("div",{className:"space-y-4 pl-7",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Select Recommended Supervisors"}),e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${m.find(t=>t.id===s.id)?"border-indigo-300 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300"}`,onClick:()=>T(s),children:[e.jsx(L,{checked:!!m.find(t=>t.id===s.id),onCheckedChange:()=>T(s),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.expertise})]})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"keywords",children:"Suggested Keywords for Supervisor Search"}),e.jsx(I,{id:"keywords",rows:2,value:u,onChange:s=>b(s.target.value),placeholder:"e.g., Machine Learning, Natural Language Processing, Computer Vision...",className:"resize-none"})]})]})]}),c&&e.jsxs("section",{className:"space-y-3",children:[e.jsx(o,{children:"Message Preview"}),e.jsx("p",{className:"text-xs text-slate-500",children:"This message will be sent to the student:"}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsx("pre",{className:"text-xs text-slate-700 whitespace-pre-wrap font-sans",children:M()})})]}),e.jsxs(Y,{className:"bg-red-50 border-red-200",children:[e.jsx(le,{className:"h-4 w-4 text-red-600"}),e.jsxs(Z,{className:"text-sm text-red-900",children:[e.jsx("strong",{className:"font-semibold",children:"Confirm Rejection"}),e.jsx("p",{className:"mt-1",children:'This action will decline the supervision request and notify the student. The request will be moved to "Rejected" status and cannot be undone.'})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t bg-slate-50 flex items-center justify-end gap-3",children:[e.jsx($,{variant:"outline",onClick:A,disabled:h,children:"Cancel"}),e.jsxs($,{onClick:B,disabled:!R||h,className:"bg-red-600 hover:bg-red-700",children:[h&&e.jsx(te,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Rejection & Notify Student"]})]})]})})}export{Ve as default};
