import{r as o,j as e,a as v}from"./app-BrPd_5NA.js";import{c as m}from"./index-BBpOhVGp.js";import{B as x}from"./button-D_c8cCUP.js";import{I as k}from"./input-CTQwd9Zb.js";import{T as b}from"./textarea-D5wt2kvG.js";import{c as me}from"./index-BINPKaee.js";import{P as W}from"./index-CfSCNicO.js";import{c as ue}from"./utils-CBfrqCZ4.js";import{S as he}from"./scroll-area-9ivrOSrd.js";import"./separator-BkyD_kuE.js";import{l as j}from"./logError-BloCzXDJ.js";import{L as A}from"./loader-circle-DSxVtQi0.js";import{P as X}from"./plus-DuhnkOU6.js";import{T as q}from"./trash-2-DrYXxk5a.js";import{C as xe}from"./circle-check-C8NnlNDG.js";import{C as pe}from"./circle-ob-_Vdzy.js";import{C as ge}from"./calendar-g0DizSmb.js";import{c as fe}from"./createLucideIcon-BuUp2DP1.js";import{f as ve}from"./format-BOijCLBA.js";import"./index-B8zdXgNA.js";import"./index-trzRZPTl.js";import"./index-sCVn0dxs.js";import"./index-BdQq_4o_.js";import"./en-US-DIdCsyf3.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],je=fe("Save",be);var T="Progress",I=100,[Ne]=me(T),[we,ye]=Ne(T),Y=o.forwardRef((t,l)=>{const{__scopeProgress:r,value:n=null,max:i,getValueLabel:S=Ce,...N}=t;(i||i===0)&&!J(i)&&console.error(Me(`${i}`,"Progress"));const d=J(i)?i:I;n!==null&&!Q(n,d)&&console.error(ke(`${n}`,"Progress"));const c=Q(n,d)?n:null,w=_(c)?S(c,d):void 0;return e.jsx(we,{scope:r,value:c,max:d,children:e.jsx(W.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":_(c)?c:void 0,"aria-valuetext":w,role:"progressbar","data-state":O(c,d),"data-value":c??void 0,"data-max":d,...N,ref:l})})});Y.displayName=T;var Z="ProgressIndicator",U=o.forwardRef((t,l)=>{const{__scopeProgress:r,...n}=t,i=ye(Z,r);return e.jsx(W.div,{"data-state":O(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...n,ref:l})});U.displayName=Z;function Ce(t,l){return`${Math.round(t/l*100)}%`}function O(t,l){return t==null?"indeterminate":t===l?"complete":"loading"}function _(t){return typeof t=="number"}function J(t){return _(t)&&!isNaN(t)&&t>0}function Q(t,l){return _(t)&&!isNaN(t)&&t<=l&&t>=0}function Me(t,l){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${l}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${I}\`.`}function ke(t,l){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${l}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${I} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ee=Y,_e=U;const se=o.forwardRef(({className:t,value:l,...r},n)=>e.jsx(ee,{ref:n,className:ue("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...r,children:e.jsx(_e,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(l||0)}%)`}})}));se.displayName=ee.displayName;function Ue({relationship:t,onUpdated:l,isReadOnly:r=!1}){const[n,i]=o.useState(null),[S,N]=o.useState(!0),[d,c]=o.useState(!1),[w,$]=o.useState(""),[p,y]=o.useState([]),[C,R]=o.useState(0),[E,F]=o.useState(""),[D,L]=o.useState(""),[z,V]=o.useState(""),[G,B]=o.useState(""),[g,M]=o.useState([]),[te,P]=o.useState(!1),[u,f]=o.useState({title:"",description:"",due_date:""}),[H,K]=o.useState(!1);o.useEffect(()=>{ae()},[t?.id]);const ae=async()=>{if(t?.id){N(!0);try{const s=await v.get(route("supervision.relationships.research.show",t.id)),a=s.data.data,h=s.data.is_read_only||!1;i(a),$(a.title||""),y(a.objectives||[]),R(a.progress_percentage||0),F(a.key_findings||""),L(a.literature_notes||""),V(a.methodology_notes||""),B(a.free_form_content||""),M(a.milestones||[]),h&&!r&&console.log("Research is read-only: main supervisor relationship not active")}catch(s){j(s,"ResearchTab loadResearch"),m.error("Failed to load research details")}finally{N(!1)}}},re=async()=>{c(!0);try{await v.put(route("supervision.relationships.research.update",t.id),{title:w,objectives:p,progress_percentage:C,key_findings:E,literature_notes:D,methodology_notes:z,free_form_content:G}),m.success("Research details saved successfully"),l?.()}catch(s){j(s,"ResearchTab handleSaveResearch"),m.error("Failed to save research details")}finally{c(!1)}},le=()=>{y([...p,""])},oe=(s,a)=>{const h=[...p];h[s]=a,y(h)},ie=s=>{y(p.filter((a,h)=>h!==s))},ne=async()=>{if(!u.title.trim()){m.error("Milestone title is required");return}K(!0);try{const s=await v.post(route("supervision.relationships.milestones.store",t.id),u);M([...g,s.data.data]),f({title:"",description:"",due_date:""}),P(!1),m.success("Milestone added successfully"),l?.()}catch(s){j(s,"ResearchTab handleAddMilestone"),m.error("Failed to add milestone")}finally{K(!1)}},de=async s=>{try{await v.put(route("supervision.milestones.update",s.id),{completed:!s.completed}),M(g.map(a=>a.id===s.id?{...a,completed:!a.completed}:a)),m.success(`Milestone ${s.completed?"unmarked":"completed"}`),l?.()}catch(a){j(a,"ResearchTab handleToggleMilestone"),m.error("Failed to update milestone")}},ce=async s=>{if(confirm("Are you sure you want to delete this milestone?"))try{await v.delete(route("supervision.milestones.destroy",s)),M(g.filter(a=>a.id!==s)),m.success("Milestone deleted"),l?.()}catch(a){j(a,"ResearchTab handleDeleteMilestone"),m.error("Failed to delete milestone")}};return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-indigo-600"})}):e.jsx(he,{className:"h-full",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Research Management"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Track research progress, milestones, and notes collaboratively"})]})}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Research Title"}),e.jsx(k,{value:w,onChange:s=>$(s.target.value),placeholder:"Enter your research title...",className:"text-base",disabled:r})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Overall Progress"}),e.jsxs("span",{className:"text-2xl font-bold text-indigo-600",children:[C,"%"]})]}),e.jsx(se,{value:C,className:"mb-3"}),e.jsx("input",{type:"range",min:"0",max:"100",value:C,onChange:s=>R(Number(s.target.value)),className:"w-full",disabled:r})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Research Objectives"}),!r&&e.jsxs(x,{size:"sm",variant:"outline",onClick:le,children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Add Objective"]})]}),e.jsx("div",{className:"space-y-3",children:p.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:'No objectives added yet. Click "Add Objective" to get started.'}):p.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"flex-shrink-0 mt-2 text-sm font-medium text-slate-500",children:[a+1,"."]}),e.jsx(k,{value:s,onChange:h=>oe(a,h.target.value),placeholder:"Enter objective...",className:"flex-1",disabled:r}),!r&&e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>ie(a),className:"flex-shrink-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-4 w-4"})})]},a))})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Milestones"}),!r&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>P(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Add Milestone"]})]}),!r&&te&&e.jsxs("div",{className:"mb-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsx(k,{placeholder:"Milestone title",value:u.title,onChange:s=>f({...u,title:s.target.value}),className:"mb-3"}),e.jsx(b,{placeholder:"Description (optional)",value:u.description,onChange:s=>f({...u,description:s.target.value}),rows:2,className:"mb-3"}),e.jsx(k,{type:"date",value:u.due_date,onChange:s=>f({...u,due_date:s.target.value}),className:"mb-3"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>{P(!1),f({title:"",description:"",due_date:""})},children:"Cancel"}),e.jsxs(x,{size:"sm",onClick:ne,disabled:H,children:[H&&e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Add"]})]})]}),e.jsx("div",{className:"space-y-3",children:g.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No milestones yet. Add your first milestone to track progress."}):g.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg border ${s.completed?"bg-green-50 border-green-200":"bg-white border-slate-200"}`,children:[e.jsx("button",{onClick:()=>de(s),className:"flex-shrink-0 mt-1",disabled:r,children:s.completed?e.jsx(xe,{className:"h-5 w-5 text-green-600"}):e.jsx(pe,{className:"h-5 w-5 text-slate-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium ${s.completed?"text-green-900 line-through":"text-slate-900"}`,children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[s.due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),"Due: ",ve(new Date(s.due_date),"dd/MM/yyyy")]}),s.creator&&e.jsxs("span",{children:["Created by: ",s.creator.full_name]})]})]}),!r&&e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>ce(s.id),className:"flex-shrink-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(q,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Key Findings"}),e.jsx(b,{value:E,onChange:s=>F(s.target.value),placeholder:"Document your key research findings here...",rows:6,disabled:r})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Literature Review Notes"}),e.jsx(b,{value:D,onChange:s=>L(s.target.value),placeholder:"Track literature review, key papers, citations...",rows:6,disabled:r})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Methodology Notes"}),e.jsx(b,{value:z,onChange:s=>V(s.target.value),placeholder:"Document your research methodology, experiments, data collection...",rows:6,disabled:r})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"General Notes"}),e.jsx(b,{value:G,onChange:s=>B(s.target.value),placeholder:"Add any additional notes, ideas, or observations...",rows:8,disabled:r})]}),!r&&e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(x,{onClick:re,disabled:d,size:"lg",children:[d?e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(je,{className:"mr-2 h-4 w-4"}),"Save All Changes"]})})]})})}export{Ue as default};
