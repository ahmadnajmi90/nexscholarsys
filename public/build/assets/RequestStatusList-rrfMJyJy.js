import{r as x,j as e,a as F,b as y}from"./app-xmIh42KO.js";import{c as _}from"./index-DjSnSkN9.js";import{l as M}from"./logError-BloCzXDJ.js";import{g as D}from"./supervisionConstants-BuM5-H5X.js";import{B as m}from"./badge-CcdemaNu.js";import{C as L,b as P,c as B,a as E}from"./card-BIRJMEsC.js";import{B as R}from"./button-BxlM9Ynt.js";import"./separator-BK4hRb3O.js";import Y from"./UnifiedRequestDetailCard-B9fWdfic.js";import{C as O}from"./ConfirmationModal-CSMzarlS.js";import{U as A}from"./user-round-CY-SkVGZ.js";import{L as V}from"./lightbulb-dVFKQ730.js";import{C as b}from"./clock-3-CcYWgEhB.js";import{M as S}from"./message-circle-EC6aULt5.js";import{C as v}from"./circle-check-CwsGHSo8.js";import{F as k}from"./file-text--rlsk2LO.js";import{C as N}from"./circle-x-CxwFGZHM.js";import{L as $}from"./loader-circle-A6k9v_Uh.js";import{f as I}from"./format-BOijCLBA.js";import{f as z}from"./formatDistanceToNow-CZclDLe0.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-C-SKuI93.js";import"./index-CLSrQ3eM.js";import"./tabs-ydYS5gEr.js";import"./index-CfHh2K1o.js";import"./index-BADX2Att.js";import"./index-B95x1XYb.js";import"./index-Jct0HHTX.js";import"./index-DxyQ96zj.js";import"./index-Cn5-Ykwo.js";import"./index-D3U9SMCW.js";import"./avatar-Bgpg1fcL.js";import"./scroll-area-AuKSir-5.js";import"./index-BdQq_4o_.js";import"./textarea-BOMMor71.js";import"./tooltip-D_lGOzep.js";import"./index-CFWEupJ2.js";import"./index-C0RVqtAt.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-C_m7Z3So.js";import"./index-DiD6aHt-.js";import"./ThreadPane-B1UkgXx6.js";import"./Modal-9xzh__1a.js";import"./dialog-B-e007Fb.js";import"./transition-wZyx5jV7.js";import"./download-DhGNF5t8.js";import"./createLucideIcon-DVFNR6_B.js";import"./x-CqhkXXcI.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";import"./AcceptSupervisorOfferModal-MYXg6Dc6.js";import"./label-hN5Y3qJx.js";import"./checkbox-BmKJq5d-.js";import"./index-Dzi-mWu3.js";import"./check-CErv2FID.js";import"./alert-DYxlFrOY.js";import"./circle-alert-pBmeMKmm.js";import"./AcceptSupervisionRequestModal-B7JRYnYe.js";import"./select-CX3LxZxk.js";import"./index-BayBrQ5A.js";import"./chevron-down-DQCopX2H.js";import"./chevron-up-PDoxJUfE.js";import"./DeclineSupervisionRequestModal-TAW6-Yec.js";import"./input-B6OKkEAQ.js";import"./users-BZFyQrBm.js";import"./building-2-Ch3P9sYq.js";import"./search-ZOwBQLRx.js";import"./ScheduleMeetingDialog-CACyhyne.js";import"./useGoogleCalendar-U1Yy-mJz.js";import"./calendar-s4DfQJnn.js";import"./external-link--Pe2votq.js";import"./modalAnimations-CCENKliM.js";import"./supervisionHelpers-EJT0WNFw.js";import"./index-gVQqUwf4.js";import"./proxy-BAb5Dv9p.js";import"./message-square-BBXQLeGc.js";import"./video-CzwZSh9q.js";import"./briefcase-DNLVAK73.js";import"./mail-LOD_U68d.js";import"./phone-Az6DOwmg.js";import"./globe-GjV7sY5v.js";import"./graduation-cap-scGiYA0W.js";import"./sticky-note-DdzmW6Cv.js";import"./trash-2-CVirFnuR.js";import"./triangle-alert-X4etJuCF.js";import"./constructNow-6bIQB1GK.js";const T={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},G={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function Rs({requests:s=[],reload:h,onOpenDetail:f}){const[u,r]=x.useState(null),[d,o]=x.useState(null),[c,i]=x.useState(!1),[l,n]=x.useState(null),j=a=>{n(a),i(!0)},g=async()=>{if(l?.id){r(l.id),i(!1);try{await F.post(route("supervision.requests.cancel",l.id)),_.success("Proposal withdrawn"),h?.()}catch(a){M(a,"RequestStatusList handleCancel");const p=a?.response?.data?.message||"Unable to cancel your request right now";_.error(p)}finally{r(null),n(null)}}},t=!Array.isArray(s)||s.length===0,U=x.useMemo(()=>Array.isArray(s)?[...s].sort((a,p)=>{const w=["cancelled","auto_cancelled"].includes(a.status),C=["cancelled","auto_cancelled"].includes(p.status);return w&&!C?1:!w&&C?-1:0}):[],[s]);return t?e.jsxs(L,{className:"border-dashed border-slate-200",children:[e.jsx(P,{children:e.jsx(B,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),e.jsx(E,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2",children:U.map(a=>e.jsx(H,{request:a,onCancel:j,onOpenDetail:p=>o(p),isCancelling:u===a.id},a.id))}),d&&e.jsx(Y,{request:d,onClose:()=>o(null),onUpdated:h,userRole:"student"}),e.jsx(O,{show:c,onClose:()=>{i(!1),n(null)},onConfirm:g,title:"Cancel Supervision Request",message:`Are you sure you want to withdraw your supervision request${l?.academician?.full_name?` to ${l.academician.full_name}`:""}? This action cannot be undone.`,confirmButtonText:"Yes, Cancel Request"})]})}function H({request:s,onCancel:h,onOpenDetail:f,isCancelling:u}){const r=s?.academician??{},d=r.university?.name??null,o=r.full_name??"Supervisor",c=r.profile_picture?`/storage/${r.profile_picture}`:null,i=r.url||null,l=T[s?.status]??T.pending,n=G[s?.status]??"Pending supervisor response",j=s?.submitted_at?I(new Date(s.submitted_at),"dd/MM/yyyy"):"—",g=s?.submitted_at?z(new Date(s.submitted_at),{addSuffix:!0}):null;return e.jsxs("div",{className:"border rounded-xl p-4 sm:p-5 bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer min-h-[300px] sm:min-h-[320px] flex flex-col",onClick:()=>f(s),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[i?e.jsx(y,{href:route("academicians.show",i),className:"flex-shrink-0",onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden hover:ring-2 hover:ring-indigo-300 transition-all cursor-pointer",children:c?e.jsx("img",{src:c,alt:o,className:"w-full h-full object-cover rounded-full"}):e.jsx(A,{className:"w-5 h-5 text-indigo-600"})})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:c?e.jsx("img",{src:c,alt:o,className:"w-full h-full object-cover rounded-full"}):e.jsx(A,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[i?e.jsx(y,{href:route("academicians.show",i),onClick:t=>t.stopPropagation(),children:e.jsx("h3",{className:"text-sm sm:text-[1.05rem] font-semibold text-gray-900 leading-snug truncate hover:text-indigo-600 transition-colors cursor-pointer",children:o})}):e.jsx("h3",{className:"text-sm sm:text-[1.05rem] font-semibold text-gray-900 leading-snug truncate",children:o}),d&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate font-normal",children:d}),g&&e.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:g})]})]}),e.jsx(m,{className:`${l.className} flex-shrink-0 text-[10px] sm:text-xs`,children:(s?.status??"pending").split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")})]}),e.jsx("div",{className:"mt-3 sm:mt-4",children:e.jsx("h4",{className:"text-sm sm:text-base font-semibold text-slate-900 line-clamp-2 leading-snug",children:s?.proposal_title??"Supervision request"})}),e.jsxs("div",{className:"mt-2 min-h-[60px] sm:min-h-[72px] space-y-2",children:[s?.status==="rejected"&&e.jsxs(e.Fragment,{children:[s?.cancel_reason&&e.jsx("div",{className:"p-2 rounded-md bg-red-50 border border-red-100",children:e.jsxs("div",{className:"text-xs text-red-900",children:[e.jsx("span",{className:"font-semibold",children:"Reason:"})," ",D(s.cancel_reason)]})}),s?.recommended_supervisors&&s.recommended_supervisors.length>0&&e.jsxs(m,{className:"bg-indigo-100 text-indigo-700 border-indigo-200",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),s.recommended_supervisors.length," supervisor(s) recommended"]})]}),s?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-md bg-amber-50 border border-amber-100",children:e.jsxs("div",{className:"text-xs text-amber-900 flex items-center gap-1.5",children:[e.jsx(b,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:n})]})}),e.jsxs(m,{className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"You can message the supervisor while waiting"]})]}),s?.status==="pending_student_acceptance"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-md bg-blue-50 border border-blue-100",children:e.jsxs("div",{className:"text-xs text-blue-900 flex items-center gap-1.5",children:[e.jsx(v,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-medium",children:"Offer received! Review and respond to this supervisor's offer."})]})}),e.jsxs(m,{className:"bg-amber-50 text-amber-700 border-amber-200",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),"Action required - respond to offer"]})]}),s?.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-md bg-green-50 border border-green-100",children:e.jsxs("div",{className:"text-xs text-green-900 flex items-center gap-1.5",children:[e.jsx(v,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:n})]})}),e.jsxs(m,{className:"bg-indigo-50 text-indigo-700 border-indigo-200",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"View full supervision details"]})]}),s?.status==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-md bg-slate-50 border border-slate-100",children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center gap-1.5",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:n})]})}),e.jsx(m,{className:"bg-slate-100 text-slate-600 border-slate-200",children:"You can submit a new request to this supervisor"})]}),s?.status==="auto_cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-md bg-slate-50 border border-slate-100",children:e.jsxs("div",{className:"text-xs text-slate-600 flex items-center gap-1.5",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:n})]})}),e.jsx(m,{className:"bg-slate-100 text-slate-600 border-slate-200",children:"Cancelled when you accepted another supervisor"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(b,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:j})]}),s?.attachments&&s.attachments.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(k,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[s.attachments.length," file",s.attachments.length!==1?"s":""]})]}),s?.conversation_id&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(S,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Conversation active"})]})]})]}),e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 pt-3 sm:pt-4 border-t",children:[e.jsxs(R,{variant:"outline",size:"sm",className:"flex-1 text-xs sm:text-sm",onClick:t=>{t.stopPropagation(),f(s)},children:[e.jsx(v,{className:"mr-1.5 sm:mr-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),"View Details"]}),s?.status==="pending"&&e.jsx(R,{variant:"outline",size:"sm",disabled:u,onClick:t=>{t.stopPropagation(),h?.(s)},className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",children:u?e.jsx($,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}):e.jsx(N,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]})}export{Rs as default};
