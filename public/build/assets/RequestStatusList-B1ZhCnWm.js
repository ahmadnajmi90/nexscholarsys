import{r as h,j as s,a as S}from"./app-CxJcie6X.js";import{c as j}from"./index-Be4FYkdk.js";import{l as _}from"./logError-D4ezqrCx.js";import{B as g}from"./badge-D4BBvhY1.js";import{C as u,a as C,b as w,c as y,d as R}from"./card-ByErAHhm.js";import{B as v}from"./button-CilYtwya.js";import{A as k,a as T}from"./avatar-YKbl8F1K.js";import{S as M}from"./separator-Bo2uL_iz.js";import U from"./RequestDetailCard-BN7N-aCI.js";import{C as D}from"./clock-3-CEtl0IAt.js";import{F as B}from"./file-text-BiVlnGr9.js";import{M as E}from"./message-circle-BZ19CBwK.js";import{L as F}from"./loader-circle-CnV6aeYo.js";import{C as P}from"./circle-x-Dnufh_u5.js";import{C as I}from"./circle-check-Cdbk2NHU.js";import{f as L}from"./AttachmentPreviewModal-0iaj0OUZ.js";import{f as O}from"./formatDistanceToNow-GKXiLTrL.js";import"./index-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./utils-CIsb_jhR.js";import"./index-CobXwCSB.js";import"./tabs-DSS59pEI.js";import"./index-BB13cI-f.js";import"./index-BA9qgrdh.js";import"./index-CtHA97Ma.js";import"./index-DadmCbDz.js";import"./scroll-area-6TQaCY8l.js";import"./ThreadPane-BtnyjRdI.js";import"./Modal-C5ZFazPk.js";import"./dialog-DhIs0Y5j.js";import"./transition-DQVj9Kgd.js";import"./AcceptSupervisorOfferModal-C_ypgE9h.js";import"./dialog-fqnz-DfP.js";import"./index-D9NnzX5f.js";import"./Combination-C8-sQI5E.js";import"./tslib.es6-CmEaCU22.js";import"./x-nCDyO7Ch.js";import"./createLucideIcon-BZHwJ_Ns.js";import"./label-BgeW8bSG.js";import"./checkbox-QRuHANkv.js";import"./index-CO9hoYs6.js";import"./check-DzdilCLx.js";import"./alert-59ekAtxc.js";import"./circle-alert-tchS6gzS.js";import"./message-square-C9g8Qe0l.js";import"./calendar-BanFAcgy.js";import"./video-B3j6Hb4J.js";import"./calendar-clock-BIt3GpuJ.js";import"./en-US-DNUEYIb-.js";import"./constructNow-DtVD-0hX.js";const N={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},V={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function Oa({requests:a=[],reload:e,onOpenDetail:n}){const[d,o]=h.useState(null),[r,c]=h.useState(null),p=async t=>{var i,m;if(t!=null&&t.id){o(t.id);try{await S.post(route("supervision.requests.cancel",t.id)),j.success("Proposal withdrawn"),e==null||e()}catch(l){_(l,"RequestStatusList handleCancel");const A=((m=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:m.message)||"Unable to cancel your request right now";j.error(A)}finally{o(null)}}},x=!Array.isArray(a)||a.length===0,f=h.useMemo(()=>Array.isArray(a)?[...a].sort((t,i)=>{const m=["cancelled","auto_cancelled"].includes(t.status),l=["cancelled","auto_cancelled"].includes(i.status);return m&&!l?1:!m&&l?-1:0}):[],[a]);return x?s.jsxs(u,{className:"border-dashed border-slate-200",children:[s.jsx(C,{children:s.jsx(w,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),s.jsx(y,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:f.map(t=>s.jsx(Y,{request:t,onCancel:p,onOpenDetail:i=>c(i),isCancelling:d===t.id},t.id))}),r&&s.jsx(U,{request:r,onClose:()=>c(null),onUpdated:e})]})}function Y({request:a,onCancel:e,onOpenDetail:n,isCancelling:d}){const o=(a==null?void 0:a.academician)??{},r=o.full_name??"Supervisor",c=o.profile_picture?`/storage/${o.profile_picture}`:null,p=N[a==null?void 0:a.status]??N.pending,x=V[a==null?void 0:a.status]??"Pending supervisor response",f=a!=null&&a.submitted_at?L(new Date(a.submitted_at),"dd/MM/yyyy"):"—",t=a!=null&&a.submitted_at?O(new Date(a.submitted_at),{addSuffix:!0}):null;return s.jsxs(u,{className:"shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>n(a),children:[s.jsxs(C,{className:"pb-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(k,{className:"h-10 w-10",children:c?s.jsx("img",{src:c,alt:r,className:"h-full w-full object-cover"}):s.jsx(T,{className:"bg-indigo-50 text-indigo-600",children:r.slice(0,2).toUpperCase()})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-slate-800",children:r}),t&&s.jsxs("div",{className:"text-xs text-slate-500",children:["Submitted ",t]})]})]}),s.jsx(g,{className:p.className,children:((a==null?void 0:a.status)??"pending").split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")})]}),s.jsx("div",{className:"mt-3",children:s.jsx(w,{className:"text-base font-semibold text-slate-900 line-clamp-2",children:(a==null?void 0:a.proposal_title)??"Supervision request"})}),s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"text-xs text-slate-500",children:x})})]}),s.jsxs(y,{className:"space-y-4 text-sm text-slate-600",children:[s.jsx(M,{}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(b,{icon:D,label:"Submitted on",value:f}),s.jsx(b,{icon:B,label:"Motivation",value:$(a==null?void 0:a.motivation,100)})]})]}),s.jsxs(R,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[s.jsx("div",{className:"flex gap-2 text-xs text-slate-500",children:s.jsxs(g,{variant:"outline",className:"border-slate-200 text-slate-500",children:[s.jsx(E,{className:"mr-1 h-3.5 w-3.5"}),"Conversation ready"]})}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[s.jsxs(v,{variant:"outline",className:"sm:w-32",disabled:(a==null?void 0:a.status)!=="pending"||d,onClick:i=>{i.stopPropagation(),e==null||e(a)},children:[d?s.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(P,{className:"mr-2 h-4 w-4"}),"Cancel"]}),s.jsxs(v,{className:"sm:w-36",onClick:i=>{i.stopPropagation(),n(a)},children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),"View details"]})]})]})]})}function b({icon:a,label:e,value:n}){return s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(a,{className:"mt-0.5 h-4 w-4 text-slate-400"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:e}),s.jsx("div",{className:"text-sm text-slate-700",children:n||"—"})]})]})}function $(a,e){return!a||a.length<=e?a:`${a.slice(0,e)}…`}export{Oa as default};
