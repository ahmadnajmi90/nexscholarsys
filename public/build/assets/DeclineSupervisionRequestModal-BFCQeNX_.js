import{q as xe,r,a as T,j as e}from"./app-6KcAPae7.js";import{M as he}from"./Modal-CJvMaQW5.js";import{B as H}from"./button-CrdDRXAu.js";import{L as d}from"./label-CB_vtBTU.js";import{T as J}from"./textarea-BWWWuSfQ.js";import{C as Z}from"./checkbox-Dv3wG0nS.js";import{S as ue,a as pe,b as ge,c as fe,d as je}from"./select-BjYRA_id.js";import{A as ve,a as Ne}from"./alert-Bq8V-QnM.js";import{A as ee,a as se}from"./avatar-kp0-Th7A.js";import{B as v}from"./badge-Dkfwv-D6.js";import{I as be}from"./input-mPZbvcwj.js";import{T as ye,a as Se,b as O,c as W}from"./tabs-ChARdzLm.js";import{c as R}from"./index-DjCDrVl_.js";import{l as A}from"./logError-BloCzXDJ.js";import{R as X}from"./supervisionConstants-BuM5-H5X.js";import{C as we}from"./circle-x-YUNUB_km.js";import{U as G}from"./users-BAT0uBt8.js";import{B as Ce}from"./building-2-BOmvfrGU.js";import{L as $}from"./loader-circle-BGO5wi-L.js";import{S as _}from"./search-KJO1iUQT.js";import{C as ke}from"./circle-alert-BWCsOQ_7.js";import"./dialog-CwJFq24I.js";import"./transition-CSwR4vyx.js";import"./index-JAD3o4sP.js";import"./utils-CBfrqCZ4.js";import"./index-C3-aQ1HP.js";import"./index-CdJFUDDL.js";import"./index-C_9bpbuH.js";import"./index-CANaiMod.js";import"./index-BzUL8saQ.js";import"./index-CSjGVC7d.js";import"./check-yEdCv6kj.js";import"./createLucideIcon-Dg0NKHwN.js";import"./index-BdQq_4o_.js";import"./index-CkzViFFx.js";import"./index-uYzWXxXP.js";import"./index-Cxfb7wM5.js";import"./index-Kc-fmclX.js";import"./index-D5o-Dx5T.js";import"./index-4gt4wYEX.js";import"./index-CNVNpKw3.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-Bby0leWS.js";import"./chevron-down-ByZMo2lZ.js";import"./chevron-up-BOXEedZS.js";import"./index-D0Fvtqyz.js";function vs({isOpen:t,request:i,onClose:m,onRejected:u}){const{auth:N}=xe().props,[l,I]=r.useState(""),[p,M]=r.useState(""),[c,D]=r.useState(!1),[n,F]=r.useState([]),[g,b]=r.useState(""),[x,L]=r.useState(!1),[y,te]=r.useState("connections"),[S,ae]=r.useState([]),[w,q]=r.useState([]),[o,re]=r.useState(""),[ie,E]=r.useState(!1),[ne,B]=r.useState(!1),C=i?.student||{},h=C.full_name||"Student",P=C.profile_picture?`/storage/${C.profile_picture}`:null,U=i?.postgraduate_program?.name||"PhD Computer Science Program",V=i?.proposal_title||"Research Topic",f=i?.research_keywords||[],le=N?.user?.academician?.full_name||"Supervisor";r.useEffect(()=>{t&&(ce(),f.length>0&&b(f.join(", ")))},[t]),r.useEffect(()=>{if(!c||y!=="search")return;const s=setTimeout(()=>{o.trim().length>=2?oe(o):q([])},500);return()=>clearTimeout(s)},[o,c,y]);const ce=async()=>{E(!0);try{const s=await T.get(route("supervision.recommendations.supervisor-connections"));ae(s.data.data||[])}catch(s){A(s,"DeclineSupervisionRequestModal loadSupervisorConnections"),R.error("Failed to load your connections")}finally{E(!1)}},oe=async s=>{B(!0);try{const a=await T.get(route("supervision.recommendations.search-academicians"),{params:{q:s,limit:20}});q(a.data.data||[])}catch(a){A(a,"DeclineSupervisionRequestModal searchAcademicians")}finally{B(!1)}},K=l!=="",z=s=>{F(a=>a.find(k=>k.id===s.id)?a.filter(k=>k.id!==s.id):[...a,s])},de=()=>{const s=X.find(j=>j.value===l)?.label||"",a=n.map(j=>j.name).join(", ");return`Dear ${h},

Thank you for your interest in working with me on your ${U} research. After carefully reviewing your proposal titled "${V}", I regret to inform you that I will not be able to supervise your research at this time.

Reason: ${s}

${p?`
${p}
`:""}
${c&&n.length>0?`
I recommend reaching out to the following supervisors who might be a better fit for your research:
${a}
`:""}
${g?`
Suggested keywords for your supervisor search: ${g}
`:""}
I wish you the best of luck in finding a suitable supervisor for your research.

Best regards,
${le}`},me=async()=>{if(!(!K||x)){L(!0);try{const s={reason:l,feedback:p.trim()||null,recommend_alternatives:c,recommended_supervisors:c?n.map(a=>a.id):[],suggested_keywords:g.trim()||null};await T.post(route("supervision.requests.reject",i.id),s),R.success("Rejection sent to student"),u?.(),m?.()}catch(s){A(s,"DeclineSupervisionRequestModal handleSubmit");const a=s?.response?.data?.message||"Failed to decline supervision request";R.error(a)}finally{L(!1)}}},Q=()=>{x||(I(""),M(""),D(!1),F([]),b(""),m?.())};return e.jsx(he,{show:t,onClose:Q,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Decline Supervision Request"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Provide feedback to ",h," and optionally suggest alternative supervisors."]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Request Summary"}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(ee,{className:"h-10 w-10",children:P?e.jsx("img",{src:P,alt:h,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-sm",children:h.split(" ").map(s=>s[0]).join("").slice(0,2)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:h}),e.jsx("div",{className:"text-xs text-slate-500",children:U})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Research Topic"}),e.jsx("div",{className:"text-sm text-slate-900 mt-1",children:V})]}),f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:f.map((s,a)=>e.jsx(v,{variant:"secondary",className:"text-xs",children:s},a))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs(d,{htmlFor:"reason",children:["Reason for Declining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ue,{value:l,onValueChange:I,children:[e.jsx(pe,{id:"reason",children:e.jsx(ge,{placeholder:"Select a reason"})}),e.jsx(fe,{children:X.map(s=>e.jsx(je,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx(d,{htmlFor:"feedback",children:"Additional Feedback (Optional)"}),e.jsx(J,{id:"feedback",rows:4,value:p,onChange:s=>M(s.target.value),placeholder:"Any constructive feedback about the proposal or suggestions for improvement...",className:"resize-none"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{id:"recommend",checked:c,onCheckedChange:D,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:"recommend",className:"text-sm font-medium cursor-pointer",children:"Recommend alternative supervisors"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Help the student by suggesting other supervisors who might be a better fit"})]})]}),c&&e.jsxs("div",{className:"space-y-4 pl-7",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Select Recommended Supervisors"}),e.jsxs(ye,{value:y,onValueChange:te,className:"w-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-2",children:[e.jsxs(O,{value:"connections",className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"My Connections (",S.length,")"]}),e.jsxs(O,{value:"search",className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Search All"]})]}),e.jsx(W,{value:"connections",className:"space-y-2 mt-3",children:ie?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-indigo-600"})}):S.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{children:"No academician connections found."}),e.jsx("p",{className:"text-xs mt-1",children:'Try searching for supervisors in the "Search All" tab.'})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:S.map(s=>e.jsx(Y,{supervisor:s,isSelected:!!n.find(a=>a.id===s.id),onToggle:()=>z(s)},s.id))})}),e.jsxs(W,{value:"search",className:"space-y-2 mt-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(be,{type:"text",placeholder:"Search by name, department, or expertise...",value:o,onChange:s=>re(s.target.value),className:"pl-10"})]}),ne?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-indigo-600"})}):w.length===0&&o.trim().length>=2?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsxs("p",{children:['No supervisors found matching "',o,'"']})]}):w.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{children:"Start typing to search for supervisors..."})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:w.map(s=>e.jsx(Y,{supervisor:s,isSelected:!!n.find(a=>a.id===s.id),onToggle:()=>z(s)},s.id))})]})]})]}),n.length>0&&e.jsxs("div",{className:"rounded-lg bg-indigo-50 p-3 border border-indigo-200",children:[e.jsxs("div",{className:"text-xs font-medium text-indigo-900 mb-1",children:[n.length," supervisor(s) selected"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map(s=>e.jsx(v,{variant:"secondary",className:"text-xs",children:s.name},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"keywords",children:"Suggested Keywords for Supervisor Search"}),e.jsx(J,{id:"keywords",rows:2,value:g,onChange:s=>b(s.target.value),placeholder:"e.g., Machine Learning, Natural Language Processing, Computer Vision...",className:"resize-none"})]})]})]}),l&&e.jsxs("section",{className:"space-y-3",children:[e.jsx(d,{children:"Message Preview"}),e.jsx("p",{className:"text-xs text-slate-500",children:"This message will be sent to the student:"}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsx("pre",{className:"text-xs text-slate-700 whitespace-pre-wrap font-sans",children:de()})})]}),e.jsxs(ve,{className:"bg-red-50 border-red-200",children:[e.jsx(ke,{className:"h-4 w-4 text-red-600"}),e.jsxs(Ne,{className:"text-sm text-red-900",children:[e.jsx("strong",{className:"font-semibold",children:"Confirm Rejection"}),e.jsx("p",{className:"mt-1",children:'This action will decline the supervision request and notify the student. The request will be moved to "Rejected" status and cannot be undone.'})]})]})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t flex items-center justify-end gap-3",children:[e.jsx(H,{variant:"outline",onClick:Q,disabled:x,children:"Cancel"}),e.jsxs(H,{onClick:me,disabled:!K||x,className:"bg-red-600 hover:bg-red-700",children:[x&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Rejection & Notify Student"]})]})]})})}function Y({supervisor:t,isSelected:i,onToggle:m}){const u=t.profile_picture?`/storage/${t.profile_picture}`:null,N=t.name.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${i?"border-indigo-300 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300"}`,onClick:m,children:[e.jsx(Z,{checked:i,onCheckedChange:m,className:"mt-1"}),e.jsx(ee,{className:"h-10 w-10",children:u?e.jsx("img",{src:u,alt:t.name,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-xs",children:N})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 truncate",children:t.name}),t.verified&&e.jsx(v,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 border-blue-200",children:"Verified"}),t.is_connection&&e.jsx(v,{variant:"secondary",className:"text-xs bg-green-100 text-green-700 border-green-200",children:"Connected"})]}),e.jsx("div",{className:"text-xs text-slate-500 line-clamp-1",children:t.expertise}),(t.faculty||t.university)&&e.jsx("div",{className:"text-xs text-slate-400 truncate",children:t.faculty&&t.university?`${t.faculty} • ${t.university}`:t.faculty||t.university})]})]})}export{vs as default};
