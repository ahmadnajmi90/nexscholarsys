import{r as o,a as C,j as e}from"./app-CRunKGlS.js";import{c as d}from"./index-BP2IIEZc.js";import{B as n}from"./button-CvHeaofT.js";import{I as me}from"./input-DIt0dFL2.js";import{T as xe}from"./textarea-B-DGX93a.js";import{B as $}from"./badge-B1g_318y.js";import{S as ue}from"./scroll-area-CWiq0LMD.js";import{S as pe,a as he,b as fe,c as je,d as be}from"./select-D20z2INN.js";import"./tabs-BDn6vQwl.js";import{M as W}from"./Modal-B6Xe6uPJ.js";import ge from"./DocumentPreviewModal-cdtWuPn6.js";import{l as _}from"./logError-D4ezqrCx.js";import{L as K}from"./loader-circle-CA_94cJH.js";import{P as q}from"./plus-DSFtevlc.js";import{F as Z}from"./file-text-uLWXHWQR.js";import{U as J}from"./upload-CUaaAm6k.js";import{C as ve}from"./chevron-down-C_mvodIi.js";import{C as we}from"./chevron-right-CAiHk8VV.js";import{F as Ne}from"./folder-open-Cj6KDlbp.js";import{E as Q}from"./eye-BqKGE3dw.js";import{c as ye}from"./createLucideIcon-Cn5nLR87.js";import{H as De}from"./history-Dwi8J0p2.js";import{T as Ce}from"./trash-2-DrCEBPuG.js";import{f as Y}from"./format-Dv9Rm441.js";import"./utils-D-KgF5mV.js";import"./index-CGrAONsN.js";import"./index-B_k58LZM.js";import"./index-CducTqIN.js";import"./index-BRxmF7GM.js";import"./index-D23ZVUNN.js";import"./index-BdQq_4o_.js";import"./index-DDu3sMfd.js";import"./index-DLWeQ60J.js";import"./index-M0Joh_8P.js";import"./tslib.es6-CmEaCU22.js";import"./index-B9EkYX5o.js";import"./index-B6dBdtsN.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-DNbbLZqP.js";import"./index-Bpe_-bUu.js";import"./index-CNyUim9N.js";import"./index-BFjFn49E.js";import"./chevron-up-DpZpHdic.js";import"./check-DUmWpUBB.js";import"./index-BeFf3wNe.js";import"./dialog-6F-BmcU5.js";import"./transition-Bs7yPu4Z.js";import"./download-C-vGVbX9.js";import"./x-D71_YNlz.js";import"./en-US-DNUEYIb-.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Fe=ye("RotateCcw",_e),X={Drafts:"bg-yellow-50 text-yellow-700 border-yellow-200","Final Papers":"bg-green-50 text-green-700 border-green-200","Meeting Notes":"bg-blue-50 text-blue-700 border-blue-200",Literature:"bg-purple-50 text-purple-700 border-purple-200",Data:"bg-indigo-50 text-indigo-700 border-indigo-200",General:"bg-slate-50 text-slate-700 border-slate-200"};function _s({relationship:r,onUpdated:i,isReadOnly:c=!1}){var G;const[p,F]=o.useState({}),[v,l]=o.useState([]),[w,f]=o.useState(!0),[h,j]=o.useState(!1),[S,I]=o.useState({}),[b,L]=o.useState(null),[ee,k]=o.useState(!1),[se,B]=o.useState(!1),[te,R]=o.useState(null),ae=15*1024*1024,[g,H]=o.useState(null),[x,A]=o.useState(null),[N,z]=o.useState(""),[M,P]=o.useState("General"),[U,O]=o.useState("");o.useEffect(()=>{y()},[r==null?void 0:r.id]);const y=async()=>{if(r!=null&&r.id){f(!0);try{const s=await C.get(route("supervision.relationships.documents.index",r.id));F(s.data.data.documents_by_folder||{}),l(s.data.data.available_folders||[]);const a=s.data.data.is_read_only||!1,t={};Object.keys(s.data.data.documents_by_folder||{}).forEach(u=>{t[u]=!0}),I(t),a&&!c&&console.log("Documents are read-only: main supervisor relationship not active")}catch(s){_(s,"DocumentsTab loadDocuments"),d.error("Failed to load documents")}finally{f(!1)}}},le=s=>{var t;const a=(t=s.target.files)==null?void 0:t[0];if(a){if(a.size>50*1024*1024){d.error("File size must be less than 50MB");return}H(a)}},oe=async()=>{var s,a;if(!g){d.error("Please select a file to upload");return}if(!x&&!N.trim()){d.error("Please provide a document name");return}j(!0);try{const t=new FormData;t.append("file",g),t.append("folder_category",M),x?t.append("document_id",x):t.append("document_name",N),U.trim()&&t.append("notes",U),await C.post(route("supervision.relationships.documents.upload",r.id),t,{headers:{"Content-Type":"multipart/form-data"}}),d.success(x?"New version uploaded successfully":"Document uploaded successfully"),E(),y(),i==null||i()}catch(t){_(t,"DocumentsTab handleUpload");const u=((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to upload document";d.error(u)}finally{j(!1)}},E=()=>{B(!1),H(null),A(null),z(""),P("General"),O("")},D=(s=null,a="General",t="")=>{A(s),P(a),z(t),B(!0)},V=(s,a)=>{const t=a.split(".").pop().toLowerCase(),u=["jpg","jpeg","png","gif","webp","svg"].includes(t),m=t==="pdf";if((u||m)&&s.size<ae){const de=route("supervision.document-versions.preview",s.id),ce=route("supervision.document-versions.download",s.id);R({preview_url:de,download_url:ce,original_name:a,mime_type:m?"application/pdf":`image/${t}`,size:s.size,size_formatted:s.size_formatted||`${(s.size/1024).toFixed(1)} KB`,created_at:s.created_at})}else window.open(route("supervision.document-versions.download",s.id),"_blank","noopener,noreferrer")},re=async(s,a)=>{if(confirm("Are you sure you want to revert to this version?"))try{await C.post(route("supervision.documents.versions.revert",{document:s,version:a})),d.success("Reverted to selected version"),y(),k(!1),i==null||i()}catch(t){_(t,"DocumentsTab handleRevertVersion"),d.error("Failed to revert version")}},ie=async s=>{if(confirm("Are you sure you want to delete this document and all its versions?"))try{await C.delete(route("supervision.documents.destroy",s)),d.success("Document deleted"),y(),i==null||i()}catch(a){_(a,"DocumentsTab handleDeleteDocument"),d.error("Failed to delete document")}},ne=s=>{I({...S,[s]:!S[s]})};if(w)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-indigo-600"})});const T=Object.values(p).reduce((s,a)=>s+a.length,0);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-full",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Documents"}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[T," document",T!==1?"s":""," across ",Object.keys(p).length," folder",Object.keys(p).length!==1?"s":""]})]}),!c&&e.jsxs(n,{onClick:()=>D(),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Upload Document"]})]}),T===0?e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-12 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No documents yet"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:c?"No documents uploaded yet":"Upload your first document to start building your research repository"}),!c&&e.jsxs(n,{onClick:()=>D(),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Upload Document"]})]}):e.jsx("div",{className:"space-y-4",children:v.map(s=>{const a=p[s]||[];if(a.length===0)return null;const t=S[s],u=X[s]||X.General;return e.jsxs("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("button",{onClick:()=>ne(s),className:"flex items-center gap-3 flex-1 min-w-0",children:[t?e.jsx(ve,{className:"h-5 w-5 text-slate-400"}):e.jsx(we,{className:"h-5 w-5 text-slate-400"}),e.jsx(Ne,{className:"h-5 w-5 text-slate-600"}),e.jsx("span",{className:"font-semibold text-slate-900",children:s}),e.jsxs($,{variant:"outline",className:u,children:[a.length," file",a.length!==1?"s":""]})]}),!c&&e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>D(null,s),children:e.jsx(q,{className:"h-4 w-4"})})]}),t&&e.jsx("div",{className:"border-t border-slate-200 p-4 space-y-3",children:a.map(m=>e.jsx(Se,{document:m,onPreview:V,onDelete:ie,onUploadVersion:()=>D(m.id,s,m.name),onViewVersions:()=>{L(m),k(!0)},isReadOnly:c},m.id))})]},s)})})]})}),e.jsx(W,{show:se,onClose:E,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-4",children:x?"Upload New Version":"Upload Document"}),e.jsxs("div",{className:"space-y-4",children:[!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Document Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(me,{value:N,onChange:s=>z(s.target.value),placeholder:"e.g., Research Proposal Draft"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Folder ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(pe,{value:M,onValueChange:P,children:[e.jsx(he,{children:e.jsx(fe,{})}),e.jsx(je,{children:v.map(s=>e.jsx(be,{value:s,children:s},s))})]})]})]}),x&&e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:["Uploading new version for: ",e.jsx("span",{className:"font-semibold text-slate-900",children:N})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Folder: ",M]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["File ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",onChange:le,className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"}),g&&e.jsxs("p",{className:"mt-2 text-sm text-slate-600",children:["Selected: ",g.name," (",(g.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Version Notes (Optional)"}),e.jsx(xe,{value:U,onChange:s=>O(s.target.value),placeholder:"Add notes about this version...",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(n,{variant:"outline",onClick:E,disabled:h,children:"Cancel"}),e.jsxs(n,{onClick:oe,disabled:h,children:[h&&e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload"]})]})]})}),b&&e.jsx(W,{show:ee,onClose:()=>{k(!1),L(null)},maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900 mb-4",children:["Version History: ",b.name]}),e.jsx("div",{className:"space-y-3",children:(G=b.versions)==null?void 0:G.map(s=>{var t;const a=s.id===b.current_version_id;return e.jsx("div",{className:`p-4 rounded-lg border ${a?"bg-indigo-50 border-indigo-200":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:["Version ",s.version_number]}),a&&e.jsx($,{className:"bg-indigo-600 text-white",children:"Current"})]}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("p",{children:["Uploaded by: ",((t=s.uploader)==null?void 0:t.full_name)||"Unknown"]}),e.jsxs("p",{children:["Date: ",Y(new Date(s.created_at),"dd/MM/yyyy HH:mm")]}),e.jsxs("p",{children:["Size: ",s.size_formatted||`${(s.size/1024).toFixed(1)} KB`]}),s.notes&&e.jsxs("p",{className:"mt-2 text-slate-700",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>V(s,s.original_name),title:"Preview document",children:e.jsx(Q,{className:"h-4 w-4"})}),!a&&e.jsx(n,{size:"sm",variant:"outline",onClick:()=>re(b.id,s.id),title:"Revert to this version",children:e.jsx(Fe,{className:"h-4 w-4"})})]})]})},s.id)})})]})}),e.jsx(ge,{file:te,onClose:()=>R(null)})]})}function Se({document:r,onPreview:i,onDelete:c,onUploadVersion:p,onViewVersions:F,isReadOnly:v=!1}){var f,h,j;const l=r.current_version,w=((f=r.versions)==null?void 0:f.length)||0;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200 hover:border-indigo-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-white rounded-md border border-slate-200",children:e.jsx(Z,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-slate-900 truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500",children:[e.jsxs("span",{children:["v",(l==null?void 0:l.version_number)||1]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:((h=l==null?void 0:l.uploader)==null?void 0:h.full_name)||((j=l==null?void 0:l.uploader)==null?void 0:j.name)||"Unknown"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:l!=null&&l.created_at?Y(new Date(l.created_at),"dd/MM/yyyy"):"—"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>i(l,l==null?void 0:l.original_name),title:"Preview document",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs(n,{size:"sm",variant:"ghost",onClick:F,title:"View version history",children:[e.jsx(De,{className:"h-4 w-4"}),w>1&&e.jsx("span",{className:"ml-1 text-xs",children:w})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",variant:"ghost",onClick:p,title:"Upload new version",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>c(r.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete document",children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})]})}export{_s as default};
