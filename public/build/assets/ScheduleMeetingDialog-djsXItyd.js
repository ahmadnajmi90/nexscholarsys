import{r as i,j as e,a as F}from"./app-DJY3TfTO.js";import{c as g}from"./index-CFdpmu66.js";import{M as I}from"./Modal-knHAl84c.js";import{B as M}from"./button-CsZnrImN.js";import{I as x}from"./input-BrloKmuD.js";import{T as L}from"./textarea-Vf3GBiHf.js";import{A as _,a as A,L as c}from"./alert-BDBIQ2M0.js";import{L as E,l as C}from"./logError-D14vJhbw.js";import{X as O}from"./x-DMpCy62N.js";import"./dialog-CJ9IN5XZ.js";import"./transition-DfXIYEF2.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-DnsMsKTl.js";import"./index-Dp3B9jqt.js";import"./createLucideIcon-CQS0Rb_3.js";const f=()=>{const t=new Date;return t.setHours(t.getHours()+24),new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,16)};function Y({relationship:t,onClose:a,onScheduled:o}){var N;const[d,h]=i.useState("Supervision Meeting"),[m,j]=i.useState(f()),[u,v]=i.useState(""),[p,y]=i.useState(""),[r,S]=i.useState(!1),[w,n]=i.useState(null);i.useEffect(()=>{var s;t&&(h(`Meeting with ${((s=t==null?void 0:t.student)==null?void 0:s.full_name)??"student"}`),j(f()),v(""),y(t!=null&&t.meeting_cadence?`Discuss ${t.meeting_cadence.toLowerCase()}`:""),n(null))},[t]);const k=async s=>{var b,T;if(s.preventDefault(),!(!t||r)){if(!d.trim()||!m||!u.trim()){n("Please provide a title, meeting date, and meeting link/location.");return}if(!t.id){n("Cannot schedule meeting: Invalid relationship data. Please try again."),g.error("Invalid relationship data");return}S(!0),n(null);try{await F.post(route("supervision.meetings.store",t.id),{title:d,scheduled_for:new Date(m).toISOString(),location_link:u,agenda:p}),g.success("Meeting scheduled"),o==null||o(),a==null||a()}catch(l){C(l,"Supervision schedule meeting");const D=((T=(b=l==null?void 0:l.response)==null?void 0:b.data)==null?void 0:T.message)||"Failed to schedule meeting. Please try again.";n(D),g.error(D)}finally{S(!1)}}};return e.jsx(I,{show:!!t,onClose:a,maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Schedule supervision meeting"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Create a meeting invite for ",((N=t==null?void 0:t.student)==null?void 0:N.full_name)??"your student",". The student will see the meeting once scheduled."]})]}),e.jsx("button",{onClick:a,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[w&&e.jsx(_,{variant:"destructive",children:e.jsx(A,{children:w})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-title",children:"Meeting title"}),e.jsx(x,{id:"meeting-title",value:d,onChange:s=>h(s.target.value),placeholder:"e.g. Thesis direction sync",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-datetime",children:"Scheduled for"}),e.jsx(x,{id:"meeting-datetime",type:"datetime-local",value:m,onChange:s=>j(s.target.value),min:f(),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-location",children:"Meeting link / location"}),e.jsx(x,{id:"meeting-location",value:u,onChange:s=>v(s.target.value),placeholder:"Zoom / Teams link or physical venue",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-agenda",children:"Agenda / notes"}),e.jsx(L,{id:"meeting-agenda",rows:4,value:p,onChange:s=>y(s.target.value),placeholder:"Outline talking points, materials to review, or goals for this session."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{type:"button",variant:"outline",onClick:a,disabled:r,children:"Cancel"}),e.jsxs(M,{type:"submit",disabled:r,children:[r?e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Schedule meeting"]})]})]})]})})}export{Y as default};
