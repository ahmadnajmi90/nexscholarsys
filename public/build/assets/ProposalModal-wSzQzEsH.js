import{r as c,j as e,a as G}from"./app-BBTReE8F.js";import{c as T}from"./index-DETKRDWW.js";import{D as $,a as H,b as W,c as X,d as K}from"./dialog-Ck_fDMCa.js";import{B as w}from"./button-ixvmlr0Z.js";import{I as J}from"./input-DTMijApg.js";import{T as Q}from"./textarea-Ee3jY4Pd.js";import{A as V,a as Y,L as f}from"./alert-D0J6Oq3_.js";import{C as Z}from"./checkbox-CSJj9Ije.js";import{L as ee,l as se}from"./logError-oW9MzvDp.js";import{U as te}from"./user-round-UCjDNV9L.js";import{G as ae}from"./graduation-cap-BltWqpAx.js";import{B as re}from"./building-2-iZFB6Cj6.js";import{L as le}from"./lightbulb-BDbiV1fa.js";import{C as ie}from"./cloud-upload-BUo4-bvz.js";import{P as oe}from"./paperclip-BF3pmUqA.js";import"./index-DWTd9yJ3.js";import"./index-sXqQmr82.js";import"./index-C-N8N723.js";import"./index-BExHPb9S.js";import"./tslib.es6-BUas5LQb.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./x-VXtmQtm3.js";import"./createLucideIcon-CgCae70q.js";import"./index-Dp3B9jqt.js";import"./index-C6zuVUjJ.js";const R=[{key:"proposal",label:"Research proposal (PDF/DOC/DOCX)",accept:".pdf,.doc,.docx",required:!0},{key:"transcript",label:"Academic transcript (PDF)",accept:".pdf"},{key:"background",label:"Research background (PDF/DOC/DOCX)",accept:".pdf,.doc,.docx"},{key:"portfolio",label:"Portfolio or supplementary materials",accept:"*"}],ne=t=>{var s,i,n;return((i=(s=t==null?void 0:t.user)==null?void 0:s.academician)==null?void 0:i.academician_id)??((n=t==null?void 0:t.academician)==null?void 0:n.academician_id)??(t==null?void 0:t.academician_id)??""};function qe({isOpen:t,supervisor:s,onClose:i,onSubmitted:n}){var E,q;const[D,_]=c.useState(""),[k,C]=c.useState(""),[p,j]=c.useState(""),[x,b]=c.useState(""),[h,N]=c.useState({proposal:null,transcript:null,background:null,portfolio:null}),[S,y]=c.useState(null),[g,P]=c.useState(!1),[F,v]=c.useState(!1);c.useEffect(()=>{if(t&&s){const a=ne(s);console.log("ProposalModal opened",{supervisor:s,identifier:a,postgraduate_program_id:s==null?void 0:s.postgraduate_program_id}),_(a?String(a):""),C((s==null?void 0:s.postgraduate_program_id)||""),j(""),b(""),N({proposal:null,transcript:null,background:null,portfolio:null}),y(null),v(!1)}else t||(_(""),C(""),j(""),b(""),N({proposal:null,transcript:null,background:null,portfolio:null}),y(null),v(!1))},[t,s]);const I=!!(D&&(p!=null&&p.trim())&&(x!=null&&x.trim())&&(h!=null&&h.proposal)&&F),O=(a,o)=>{N(m=>({...m,[a]:o}))},U=async a=>{var m,u;if(a.preventDefault(),!I||g)return;const o=new FormData;o.append("academician_id",D),k&&o.append("postgraduate_program_id",k),o.append("proposal_title",p),o.append("motivation",x),R.forEach(({key:l})=>{const d=h[l];d&&o.append(`attachments[${l}]`,d)});try{P(!0),await G.post(route("supervision.requests.store"),o,{headers:{"Content-Type":"multipart/form-data"}}),T.success("Supervision request submitted"),n==null||n()}catch(l){se(l,"ProposalModal handleSubmit");const d=((u=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to submit your supervision request";y(d),T.error(d)}finally{P(!1)}},r=(s==null?void 0:s.academician)??s,z=(r==null?void 0:r.full_name)??"Supervisor",M=(r==null?void 0:r.current_position)??"",A=((E=r==null?void 0:r.university)==null?void 0:E.name)??((q=r==null?void 0:r.universityDetails)==null?void 0:q.full_name)??"",B=(r==null?void 0:r.research_domains)??[];return e.jsx($,{open:t,onOpenChange:a=>a?null:i==null?void 0:i(),children:e.jsxs(H,{className:"max-h-[90vh] overflow-y-auto sm:max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Submit supervision request"}),e.jsx(K,{children:"Provide a strong proposal and supporting documents to help your prospective supervisor understand your research direction and readiness."})]}),S&&e.jsx(V,{variant:"destructive",className:"mb-4",children:e.jsx(Y,{children:S})}),e.jsx("div",{className:"rounded-lg border border-indigo-200 bg-indigo-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-indigo-100 p-2",children:e.jsx(te,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:z}),M&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600 mt-1",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:M})]}),A&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600 mt-1",children:[e.jsx(re,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:A})]})]}),B.length>0&&e.jsxs("div",{className:"flex items-start gap-1.5 text-sm text-slate-700",children:[e.jsx(le,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Focus: "}),e.jsx("span",{children:B.join(", ")})]})]})]})]})}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"proposal_title",children:"Proposal title"}),e.jsx(J,{id:"proposal_title",value:p,onChange:a=>j(a.target.value),placeholder:"e.g. Exploring AI-driven multimodal learning analytics",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"motivation",children:"Motivation"}),e.jsx(Q,{id:"motivation",value:x,onChange:a=>b(a.target.value),rows:6,placeholder:"Describe your research goals, why you want to work with this supervisor, and how your background supports the project.",required:!0})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Attachments"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload the required proposal and any supporting documents. PDFs are preferred for readability."})]}),e.jsx("div",{className:"space-y-4",children:R.map(({key:a,label:o,accept:m,required:u})=>{const l=h[a];return e.jsxs("div",{className:"rounded-lg border border-dashed border-slate-200 p-4",children:[e.jsxs(f,{className:"flex items-center justify-between text-sm font-medium text-slate-700",children:[e.jsxs("span",{children:[o,u&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx(w,{type:"button",variant:"outline",size:"sm",asChild:!0,children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),l?"Replace file":"Upload file",e.jsx("input",{type:"file",accept:m,className:"sr-only",onChange:d=>{var L;return O(a,((L=d.target.files)==null?void 0:L[0])??null)}})]})})]}),l?e.jsxs("div",{className:"mt-3 flex items-center gap-2 rounded-md bg-slate-50 px-3 py-2 text-xs text-slate-600",children:[e.jsx(oe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate",title:l.name,children:l.name}),e.jsxs("span",{className:"text-slate-400",children:["(",ce(l.size),")"]})]}):e.jsx("p",{className:"mt-3 text-xs text-slate-500",children:u?"Required attachment.":"Optional â€” add if it strengthens your proposal."})]},a)})})]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{id:"original-work",checked:F,onCheckedChange:v,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(f,{htmlFor:"original-work",className:"text-sm font-medium leading-relaxed text-slate-900 cursor-pointer",children:["I confirm that this proposal is original and written by me.",e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"By checking this box, you affirm that the proposal content and attached documents represent your own work and ideas."})]})]})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[e.jsx(w,{type:"button",variant:"outline",onClick:i,disabled:g,children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:!I||g,children:[g?e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Submit request"]})]})]})]})})}function ce(t){if(!t)return"0 B";const s=["B","KB","MB","GB"],i=Math.min(Math.floor(Math.log(t)/Math.log(1024)),s.length-1),n=t/Math.pow(1024,i);return`${n.toFixed(n>100?0:1)} ${s[i]}`}export{qe as default};
