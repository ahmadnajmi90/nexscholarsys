import{q as O,r as g,j as e}from"./app-Dyc2YSa7.js";import{T as D,a as z,b as p,c as h}from"./tabs-DWPLWrOt.js";import{B as o}from"./button-DDycOZPt.js";import{B as F}from"./badge-ChYcl_sh.js";import{A as B,a as I}from"./avatar-9ag2R1Rw.js";import"./separator-D-xyQ8kT.js";import{S as j}from"./scroll-area-DeaXef57.js";import{T as R}from"./ThreadPane-BfVettG7.js";import{A as $,f as N}from"./AttachmentPreviewModal-CSnZJkT6.js";import E from"./AcceptSupervisorOfferModal-CssCZ91O.js";import{X as V}from"./x-DiT1Y4qL.js";import{M as H}from"./message-square-xskcnl5O.js";import{C as W}from"./calendar-D4jGpTBE.js";import{V as X}from"./video-BiG9lqgZ.js";import{C as J}from"./calendar-clock-BG5aN4Uh.js";import{F as K}from"./file-text-BrE0JVp-.js";import"./index-D-0X1VHc.js";import"./index-CYrMXf2H.js";import"./index-MvPCpoOY.js";import"./index-CFIxVmDG.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-Dp3B9jqt.js";import"./Modal-B-1y-mKR.js";import"./dialog-haDdWfH4.js";import"./transition-DXBASaqI.js";import"./index-Csod4yPu.js";import"./en-US-DNUEYIb-.js";import"./createLucideIcon-DgyMBRUj.js";import"./dialog-CMZECuIS.js";import"./index-Mz8iZoV8.js";import"./tslib.es6-BUas5LQb.js";import"./alert-gM37w2Qu.js";import"./checkbox-BbnGzl3U.js";import"./index-Bby_8r0G.js";import"./check-6jspxOMq.js";import"./logError-B6okArUp.js";import"./circle-check-SbfhXHPb.js";import"./circle-alert-DQS8qzDt.js";function Be({request:s,onClose:c,onUpdated:t}){var C;const{auth:i}=O().props,[l,r]=g.useState("overview"),[m,n]=g.useState(!1),[b,w]=g.useState(null),A=15*1024*1024,M=a=>{const x=a.mime_type&&a.mime_type.startsWith("image/"),P=a.mime_type==="application/pdf";(x||P)&&a.size<A?w({url:`/storage/${a.path}`,original_name:a.original_name||"Attachment",mime_type:a.mime_type,size_formatted:a.size_formatted||`${(a.size/1024).toFixed(1)} KB`,created_at:a.created_at}):window.open(`/storage/${a.path}`,"_blank","noopener,noreferrer")};if(!s)return null;const d=(s==null?void 0:s.academician)??{},f=d.full_name??"Supervisor";console.log(d),d.current_position;const u=d.profile_picture?`/storage/${d.profile_picture}`:null,y=((C=d.university)==null?void 0:C.name)??"",v=s.status??"pending",_=s==null?void 0:s.conversation_id,k=f.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,3),S=v.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "),T=a=>{switch(a){case"pending":return"bg-amber-50 text-amber-700 border-amber-200";case"accepted":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"rejected":return"bg-red-50 text-red-700 border-red-200";case"cancelled":case"auto_cancelled":return"bg-slate-50 text-slate-700 border-slate-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-end bg-black/50",onClick:c,children:[e.jsxs("div",{className:"w-full max-w-3xl h-full bg-white shadow-xl overflow-hidden flex flex-col animate-slide-in-right",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(B,{className:"h-12 w-12",children:u?e.jsx("img",{src:u,alt:f,className:"h-full w-full object-cover"}):e.jsx(I,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:k})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:f}),y&&e.jsx("span",{className:"text-sm text-slate-600",children:y}),e.jsx("div",{className:"mt-2 flex items-center gap-3 flex-wrap",children:e.jsx(F,{className:`${T(v)} border`,children:S})})]})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(V,{className:"h-5 w-5 text-slate-500"})})]})}),e.jsxs("div",{className:"px-6 py-4 border-b bg-slate-50",children:[v==="pending_student_acceptance"&&e.jsx("div",{className:"mb-3",children:e.jsxs(o,{className:"w-full bg-green-600 hover:bg-green-700 text-white",onClick:()=>n(!0),children:[e.jsx(CheckCircle2,{className:"mr-2 h-4 w-4"}),"Accept Supervisor Offer"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(o,{variant:"outline",className:"flex-1",onClick:()=>r("chat"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Chat"]}),e.jsxs(o,{variant:"outline",className:"flex-1",disabled:!0,title:"Only supervisors can schedule meetings",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Schedule"]}),e.jsxs(o,{className:"flex-1 bg-slate-900 hover:bg-slate-800",disabled:!(s!=null&&s.meetings)||s.meetings.length===0,onClick:()=>{var x;const a=(x=s==null?void 0:s.meetings)==null?void 0:x[0];a!=null&&a.location_link&&window.open(a.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Join Meeting"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(D,{value:l,onValueChange:r,className:"h-full flex flex-col",children:[e.jsxs(z,{className:"px-6 bg-gray-100 w-full justify-start rounded-none h-auto p-0 gap-0",children:[e.jsx(p,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Overview"}),e.jsx(p,{value:"proposal",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Proposal"}),e.jsx(p,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Chat"}),e.jsx(p,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(h,{value:"overview",className:"mt-0 h-full",children:e.jsx(j,{className:"h-full",children:e.jsx(L,{request:s})})}),e.jsx(h,{value:"proposal",className:"mt-0 h-full",children:e.jsx(j,{className:"h-full",children:e.jsx(Z,{request:s,onAttachmentClick:M})})}),e.jsx(h,{value:"chat",className:"mt-0 h-full",children:_?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(R,{conversationId:_,auth:i,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>t==null?void 0:t()})})}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})})}),e.jsx(h,{value:"history",className:"mt-0 h-full",children:e.jsx(j,{className:"h-full",children:e.jsx(G,{request:s})})})]})]})})]}),e.jsx(E,{isOpen:m,request:s,onClose:()=>n(!1),onAccepted:()=>{n(!1),t==null||t()}}),e.jsx($,{file:b,onClose:()=>w(null)})]})}function L({request:s}){const c=s!=null&&s.submitted_at?N(new Date(s.submitted_at),"dd/MM/yyyy"):"—",t=(s==null?void 0:s.meetings)??[],i=t.length>0;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Proposal Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-base font-semibold text-slate-900",children:s.proposal_title??"Untitled Proposal"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed whitespace-pre-line",children:["Motivation: ",s.motivation??"No motivation provided."]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Sent:"}),e.jsx("div",{className:"font-medium text-slate-900",children:c})]})})]})]}),i&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"h-5 w-5 text-slate-900"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Meeting Details"})]}),e.jsx("div",{className:"space-y-4",children:t.map((l,r)=>e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Date:"}),e.jsx("div",{className:"font-medium text-slate-900",children:l.scheduled_for?N(new Date(l.scheduled_for),"MMMM d, yyyy"):"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Type:"}),e.jsx("div",{className:"font-medium text-slate-900",children:l.type||"Online"})]})]},l.id||r))})]})]})}function Z({request:s,onAttachmentClick:c}){const t=(s==null?void 0:s.attachments)??[];return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Research Proposal"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2",children:"Title"}),e.jsx("p",{className:"text-base text-slate-900",children:s.proposal_title??"Untitled"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2",children:"Motivation"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed whitespace-pre-line",children:s.motivation??"No motivation provided."})]}),t.length>0&&e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-3",children:"Attachments"}),e.jsx("div",{className:"space-y-2",children:t.map(i=>{var l;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-indigo-50 rounded-md",children:e.jsx(K,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:i.original_name||"Attachment"}),e.jsx("p",{className:"text-xs text-slate-500 capitalize",children:((l=i.type)==null?void 0:l.replace("_"," "))||"Document"})]})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(i),children:"View File"})]},i.id)})})]})]})]})})}function G({request:s}){var i,l,r,m;const c=[{id:1,title:"Proposal Submitted",date:s==null?void 0:s.submitted_at,status:"completed"},{id:2,title:"Under Review",date:s==null?void 0:s.submitted_at,status:(s==null?void 0:s.status)==="pending"?"current":"completed"},{id:3,title:(((i=s==null?void 0:s.meetings)==null?void 0:i.length)>0,"Meeting Scheduled"),date:(r=(l=s==null?void 0:s.meetings)==null?void 0:l[0])==null?void 0:r.scheduled_for,status:((m=s==null?void 0:s.meetings)==null?void 0:m.length)>0?"completed":"pending"},{id:4,title:"Decision",date:s==null?void 0:s.decision_at,status:(s==null?void 0:s.status)!=="pending"?"completed":"pending"}],t=n=>{switch(n){case"completed":return"bg-green-500";case"current":return"bg-blue-500";case"pending":return"bg-slate-300";default:return"bg-slate-300"}};return e.jsx("div",{className:"p-6",children:e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Timeline"}),e.jsx("div",{className:"space-y-4",children:c.map((n,b)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t(n.status)}`}),b<c.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-slate-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:n.title}),e.jsx("p",{className:"text-sm text-slate-500",children:n.date?N(new Date(n.date),"dd/MM/yyyy"):"TBD"})]})]},n.id))})]})})}export{Be as default};
