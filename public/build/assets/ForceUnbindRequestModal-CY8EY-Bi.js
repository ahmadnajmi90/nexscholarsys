import{r as f,j as e,a as j}from"./app-xmIh42KO.js";import{c as d}from"./index-DjSnSkN9.js";import{B as v}from"./button-BxlM9Ynt.js";import{B as k}from"./badge-CcdemaNu.js";import{A as M,a as U}from"./avatar-Bgpg1fcL.js";import"./textarea-BOMMor71.js";import{A as _,a as Y}from"./alert-DYxlFrOY.js";import R from"./RejectUnbindModal-f4fQuiin.js";import{l as g}from"./logError-BloCzXDJ.js";import{L as N}from"./loader-circle-A6k9v_Uh.js";import{T as w}from"./triangle-alert-X4etJuCF.js";import{C as T}from"./calendar-s4DfQJnn.js";import{C as $}from"./clock-YdwyQpoI.js";import{C as I}from"./circle-x-CxwFGZHM.js";import{C as B}from"./circle-check-CwsGHSo8.js";import{f as y}from"./format-BOijCLBA.js";import"./utils-CBfrqCZ4.js";import"./index-CdJFUDDL.js";import"./createLucideIcon-DVFNR6_B.js";import"./en-US-DIdCsyf3.js";function ie({unbindRequest:t,relationship:a,onResponse:u,userRole:C="student"}){const[o,i]=f.useState(!1),[q,n]=f.useState(!1);if(!t||!a)return null;const l=t.initiated_by==="student",p=C==="supervisor",c=l?a?.student??{}:a?.academician??{},m=c.full_name??(l?"Student":"Supervisor"),h=c.profile_picture?`/storage/${c.profile_picture}`:null,b=t.attempt_count??1,s=b>=3,A=m.split(" ").map(r=>r[0]).join("").toUpperCase().slice(0,3),F=async()=>{i(!0);try{const r=p?"supervision.unbind-requests.supervisor-approve":"supervision.unbind-requests.approve";await j.post(route(r,t.id)),d.success("Unbind request accepted. Your supervision relationship has been terminated."),i(!1),u?.()}catch(r){g(r,"ForceUnbindRequestModal handleAccept"),d.error("Failed to accept unbind request"),i(!1)}},S=async r=>{i(!0);try{const x=p?"supervision.unbind-requests.supervisor-reject":"supervision.unbind-requests.reject";await j.post(route(x,t.id),{reason:r||""}),d.success("Unbind request rejected"),n(!1),i(!1),u?.()}catch(x){g(x,"ForceUnbindRequestModal handleRejectConfirm"),d.error("Failed to reject unbind request"),i(!1),n(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden mx-4 relative",children:[o&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 animate-spin text-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Processing your response..."})]})}),e.jsx("div",{className:`p-6 border-b ${s?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${s?"bg-red-100":"bg-amber-100"}`,children:e.jsx(w,{className:`h-6 w-6 ${s?"text-red-600":"text-amber-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-red-900":"text-amber-900"}`,children:s?"Final Unbind Request":"Unbind Request Received"}),e.jsx("p",{className:`text-sm mt-1 ${s?"text-red-700":"text-amber-700"}`,children:s?"This is the final attempt. You must respond to this request.":l?"Your student has requested to terminate the supervision relationship.":"Your supervisor has requested to terminate the supervision relationship."})]}),e.jsxs(k,{variant:s?"destructive":"warning",className:"flex-shrink-0",children:["Attempt ",b,"/3"]})]})}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx(M,{className:"h-12 w-12",children:h?e.jsx("img",{src:h,alt:m,className:"h-full w-full object-cover"}):e.jsx(U,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:A})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:m}),e.jsx("p",{className:"text-sm text-slate-600",children:l?c?.university?.name||"Student":a.role==="main"?"Main Supervisor":"Co-Supervisor"}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),"Started: ",a.accepted_at?y(new Date(a.accepted_at),"dd/MM/yyyy"):"—"]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Reason for Unbind Request:"}),e.jsx("div",{className:"p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:t.reason||"No reason provided."})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx($,{className:"h-3 w-3"}),e.jsxs("span",{children:["Submitted: ",t.created_at?y(new Date(t.created_at),"dd/MM/yyyy HH:mm"):"—"]})]})]}),e.jsxs(_,{variant:s?"destructive":"default",className:s?"border-red-300 bg-red-50":"border-amber-300 bg-amber-50",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx(Y,{className:s?"text-red-800":"text-amber-800",children:s?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"This is the final unbind request."})," This relationship will be terminated. You will no longer have access to ",l?"this student":"this supervisor",', but you can view the relationship history in the "Terminated" tab.']}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Important:"})," If you reject this request, ",l?"the student":"your supervisor"," will be able to submit another request after a cooldown period. If you accept, your supervision relationship will be terminated immediately."]})})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"If you accept this request:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your supervision relationship will be terminated"}),e.jsx("li",{children:"You will lose access to active collaboration features"}),e.jsx("li",{children:"You can still view the relationship history (read-only)"}),e.jsx("li",{children:"You can search for and request a new supervisor"})]})]})]}),e.jsx("div",{className:"p-6 border-t bg-slate-50",children:e.jsxs("div",{className:"flex gap-3",children:[!s&&e.jsxs(v,{variant:"outline",className:"flex-1 border-red-300 text-red-700 hover:bg-red-50",onClick:()=>n(!0),disabled:o,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Reject Request"]}),e.jsx(v,{className:`flex-1 ${s?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"} text-white`,onClick:F,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),s?"Acknowledge & Terminate":"Accept & Terminate"]})})]})})]}),e.jsx(R,{isOpen:q,onClose:()=>n(!1),onConfirm:S,isProcessing:o})]})}export{ie as default};
