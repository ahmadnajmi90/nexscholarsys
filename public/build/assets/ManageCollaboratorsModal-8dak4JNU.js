import{c as O}from"./createLucideIcon-5ChSc-b-.js";import{q as K,r as u,W as Q,j as r,e as X,a as C,y as E}from"./app-BkEYYv5s.js";import{M as Z}from"./Modal-BrvPZ8QO.js";import{I as z}from"./InputLabel-BXaPrkos.js";import{I as B}from"./InputError-Dcc_QIk8.js";import{P as T}from"./PrimaryButton-BmFJyJNw.js";import{S as D}from"./SecondaryButton-CHDb3cRZ.js";import{C as ee}from"./ConfirmationModal-DrpG6MMR.js";import{c as h}from"./index-Bk97oRuv.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=O("Info",re);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],he=O("Users",ae),ie=()=>{const[n,t]=u.useState(!1),e=u.useRef(null),i=u.useRef(null),c=()=>{if(e.current&&i.current){const v=e.current.getBoundingClientRect(),p=i.current.getBoundingClientRect();i.current.style.left=`${v.left-p.width/2+v.width/2}px`,i.current.style.top=`${v.top-p.height-10}px`}};return u.useEffect(()=>{if(n)return c(),window.addEventListener("scroll",c),window.addEventListener("resize",c),()=>{window.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[n]),{triggerProps:{ref:e,onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1)},tooltipProps:{ref:i,style:{position:"fixed",zIndex:9999,display:n?"block":"none"}},isVisible:n}},le=({children:n,isVisible:t})=>{const[e,i]=u.useState(!1);return u.useEffect(()=>(i(!0),()=>i(!1)),[]),e?X.createPortal(n,document.body):null};function ge({show:n,onClose:t,context:e,contextType:i,connections:c=[]}){var I,A,L,F,U,$;const{auth:v}=K().props,[p,k]=u.useState(null),[N,g]=u.useState(!1),[R,P]=u.useState([]),{triggerProps:_,tooltipProps:V,isVisible:q}=ie(),f=Q({user_id:"",role:"member"}),j=i==="workspace"?(e==null?void 0:e.id)||((I=e==null?void 0:e.data)==null?void 0:I.id):((A=e==null?void 0:e.data)==null?void 0:A.id)||(e==null?void 0:e.id),S=v.user.id===(i==="workspace"?((L=e==null?void 0:e.data)==null?void 0:L.owner_id)||(e==null?void 0:e.owner_id):((F=e==null?void 0:e.data)==null?void 0:F.owner_id)||(e==null?void 0:e.owner_id)),b=i==="workspace"?(U=e==null?void 0:e.data)==null?void 0:U.members:($=e==null?void 0:e.data)==null?void 0:$.members;u.useEffect(()=>{if(n&&Array.isArray(c)&&Array.isArray(b)){const s=b.map(l=>l.id),a=c.filter(l=>!s.includes(l.id));P(a)}else P([])},[n,c,e,b]);const W=s=>{s.preventDefault(),g(!0);const a=i==="workspace"?"workspaces.members.add":"projects.members.store";C.post(route(a,j),f.data).then(l=>{h.success("Member added successfully"),f.reset(),E.reload({preserveScroll:!0,onSuccess:()=>{t()},onError:()=>{t(),h.error("Member added but page refresh failed. Please reload the page.")}})}).catch(l=>{var d,m;const o=((m=(d=l.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to add member";h.error(o),g(!1)})},x=s=>{k(s)},H=(s,a)=>{g(!0);const l=i==="workspace"?"workspaces.members.update-role":"projects.members.update-role";let o;i==="workspace"?o={workspace:j,member:s.id}:o={project:j,member:s.id},C.put(route(l,o),{role:a}).then(d=>{h.success("Member role updated successfully"),E.reload({preserveScroll:!0,onSuccess:()=>{},onError:()=>{h.error("Role updated but page refresh failed. Please reload the page.")}})}).catch(d=>{var y,M;const m=((M=(y=d.response)==null?void 0:y.data)==null?void 0:M.message)||"Failed to update member role";h.error(m),console.error("Error updating member role:",d)}).finally(()=>{g(!1)})},Y=()=>{if(!p)return;g(!0);const s=i==="workspace"?"workspaces.members.remove":"projects.members.destroy";let a;i==="workspace"?a={workspace:j,member:p.id}:a={project:j,member:p.id},C.delete(route(s,a)).then(l=>{h.success("Member removed successfully"),k(null),E.reload({preserveScroll:!0,onSuccess:()=>{t()},onError:()=>{t(),h.error("Member removed but page refresh failed. Please reload the page.")}})}).catch(l=>{var d,m;const o=((m=(d=l.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to remove member";h.error(o),console.error("Error removing member:",l),g(!1)})},w=s=>{if(!s)return"Unknown User";const a=s.academician||s.postgraduate||s.undergraduate;return(a==null?void 0:a.full_name)||s.name},G=s=>{var l,o,d;if(!s)return null;const a=((l=s.academician)==null?void 0:l.profile_picture)||((o=s.postgraduate)==null?void 0:o.profile_picture)||((d=s.undergraduate)==null?void 0:d.profile_picture);return a?`/storage/${a}`:null},J=i==="workspace"?"Manage Workspace Members":"Manage Project Members";return r.jsxs(r.Fragment,{children:[r.jsx(Z,{show:n,onClose:t,maxWidth:"md",children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:J}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),b&&b.length>0?r.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-1",children:b.filter(s=>{var l,o;const a=i==="workspace"?((l=e==null?void 0:e.data)==null?void 0:l.owner_id)||(e==null?void 0:e.owner_id):((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id);return s.id!==a}).map(s=>{var o,d,m,y;const a=s.id===(i==="workspace"?((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id):((d=e==null?void 0:e.data)==null?void 0:d.owner_id)||(e==null?void 0:e.owner_id)),l=G(s);return r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 py-3 px-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:l?r.jsx("img",{src:l,alt:w(s),className:"h-full w-full object-cover"}):r.jsx("span",{className:"text-gray-500 text-sm",children:w(s).charAt(0)})}),r.jsxs("div",{className:"ml-3 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:w(s)}),r.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a?"Owner":((m=s.pivot)==null?void 0:m.role)||"Member"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0 ml-4",children:[S&&!a&&r.jsxs("select",{value:((y=s.pivot)==null?void 0:y.role)||"member",onChange:M=>H(s,M.target.value),className:"text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",disabled:N,children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),S&&!a&&r.jsx(D,{onClick:()=>x(s),disabled:N,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]})]},s.id)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),S&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),R.length>0?r.jsxs("form",{onSubmit:W,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(z,{htmlFor:"user_id",value:"Select Connection"}),r.jsxs("select",{id:"user_id",name:"user_id",value:f.data.user_id,onChange:s=>f.setData("user_id",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",required:!0,children:[r.jsx("option",{value:"",children:"Select a connection"}),R.map(s=>r.jsx("option",{value:s.id,children:w(s)},s.id))]}),r.jsx(B,{message:f.errors.user_id,className:"mt-2"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(z,{htmlFor:"role",value:"Role"}),r.jsxs("div",{className:"relative ml-2 group",children:[r.jsx(se,{className:"w-4 h-4 text-gray-400 cursor-help",ref:_.ref,onMouseEnter:_.onMouseEnter,onMouseLeave:_.onMouseLeave}),r.jsx(le,{isVisible:q,children:r.jsxs("div",{className:"bg-gray-800 text-white text-xs rounded py-2 px-3 w-64",...V,children:[r.jsx("p",{className:"font-semibold mb-1",children:"Admin:"}),r.jsx("p",{className:"mb-2",children:"Can manage members, boards, and workspace/project settings."}),r.jsx("p",{className:"font-semibold mb-1",children:"Member:"}),r.jsx("p",{children:"Can create and edit content on boards they have access to."}),r.jsx("div",{className:"absolute bottom-0 right-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})})]})]}),r.jsxs("select",{id:"role",name:"role",value:f.data.role,onChange:s=>f.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),r.jsx(B,{message:f.errors.role,className:"mt-2"})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(T,{type:"submit",disabled:N||!f.data.user_id,children:N?"Sending...":"Send Invitation"})})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:r.jsx("p",{className:"text-sm text-yellow-700",children:"You have no available connections to invite. Connect with other users first."})})]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx(D,{onClick:t,children:"Close"})})]})}),r.jsx(ee,{show:!!p,onClose:()=>k(null),onConfirm:Y,title:"Remove Member",message:p?`Are you sure you want to remove ${w(p)} from this ${i}?`:""})]})}export{ge as M,he as U};
