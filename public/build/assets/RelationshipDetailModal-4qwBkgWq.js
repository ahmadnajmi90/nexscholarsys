import{q as b,r as p,j as e}from"./app-DVhy0H9p.js";import{D as u,a as y,b as w,c as _}from"./dialog-BIN2ariu.js";import{T as k,a as T,b as S,c as o}from"./tabs-DX105Jww.js";import{B as f}from"./button-B5DH2e6v.js";import{B as C}from"./badge-BJrb6Ud6.js";import{S as P}from"./separator-D2KG_JQ5.js";import{S as x}from"./scroll-area-DrwYSPgc.js";import{T as A}from"./ThreadPane-CsMongUC.js";import{C as D}from"./clipboard-list-CCLdWrfr.js";import{F as E}from"./file-text-DgkdQnqA.js";import{C as j}from"./calendar-clock-CpKoEQUJ.js";import{c as M}from"./createLucideIcon-CXlRbZBu.js";import{f as v}from"./AttachmentPreviewModal-ZNLNsrIP.js";import"./index-qiM-PJnI.js";import"./index-BEgRjMNY.js";import"./index-BLyIJBR_.js";import"./index-B2VDO2Ow.js";import"./tslib.es6-BUas5LQb.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./x-B99PfiTq.js";import"./index-DuC5HSHe.js";import"./index-Dp3B9jqt.js";import"./Modal-BVd3zha7.js";import"./dialog-DQyUbXkk.js";import"./transition-rj58jJaf.js";import"./index-Bdu0quS4.js";import"./en-US-DNUEYIb-.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],h=M("History",B),L=["overview","proposal","chat","meetings","history"];function he({request:s,relationship:a,onClose:t,onUpdated:c}){const{auth:r}=b().props,[n,i]=p.useState(()=>(s==null?void 0:s.preferred_tab)??"overview"),d=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),m=p.useMemo(()=>L.filter(l=>l==="chat"?!!d:!0),[d]);p.useEffect(()=>{if(!(s!=null&&s.preferred_tab)&&!(a!=null&&a.preferred_tab))return;const l=(s==null?void 0:s.preferred_tab)??(a==null?void 0:a.preferred_tab);l&&l!==n&&m.includes(l)&&i(l)},[s==null?void 0:s.preferred_tab,a==null?void 0:a.preferred_tab,m,n]);const N=l=>{i(l),l==="chat"&&d&&(window==null||window.dispatchEvent(new CustomEvent("supervision:openConversation",{detail:{conversationId:d}})))};return s==null||s.attachments,e.jsx(u,{open:!!(s||a),onOpenChange:l=>l?null:t==null?void 0:t(),children:e.jsxs(y,{className:"max-h-[90vh] w-full max-w-4xl overflow-hidden p-0",children:[e.jsx(w,{className:"px-6 pb-4 pt-6",children:e.jsx(_,{className:"text-xl font-semibold",children:a?"Supervision details":"Proposal details"})}),e.jsx(P,{}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs(k,{value:n,onValueChange:N,className:"space-y-4",children:[e.jsx(T,{className:"flex w-full flex-wrap gap-2 bg-transparent p-0",children:m.map(l=>e.jsx(S,{value:l,className:"rounded-full border border-slate-200 px-4",children:I[l]??l},l))}),e.jsx(o,{value:"overview",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(H,{request:s,relationship:a})})}),e.jsx(o,{value:"proposal",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(O,{request:s})})}),d?e.jsx(o,{value:"chat",className:"m-0",children:e.jsx("div",{className:"max-h-[60vh] rounded-lg border border-slate-200",children:e.jsx(A,{conversationId:d,auth:r,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>c==null?void 0:c()})})}):null,e.jsx(o,{value:"meetings",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(W,{relationship:a})})}),e.jsx(o,{value:"history",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(F,{request:s,relationship:a})})})]})})]})})}const I={overview:"Overview",proposal:"Proposal",chat:"Conversation",meetings:"Meetings",history:"History"};function H({request:s,relationship:a}){const t=(a==null?void 0:a.academician)??(s==null?void 0:s.academician),c=(a==null?void 0:a.student)??(s==null?void 0:s.student),r=(a==null?void 0:a.status)??(s==null?void 0:s.status)??"pending",n=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),i=[{label:"Student",value:(c==null?void 0:c.full_name)??"Student details unavailable",badge:c?"Postgraduate":null},{label:"Supervisor",value:(t==null?void 0:t.full_name)??"Supervisor not assigned yet",badge:t?"Supervisor":null},{label:"Status",value:g(r)},{label:"Meeting cadence",value:(a==null?void 0:a.meeting_cadence)??"Not set"},{label:"Accepted on",value:a!=null&&a.accepted_at?v(new Date(a.accepted_at),"PPP"):"Pending acceptance"},{label:"ScholarLab",value:a!=null&&a.scholarlab_board_id?"Workspace ready":"Workspace not provisioned"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Supervision summary"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Key milestones, cadence, and workspace access."})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:i.map((d,m)=>e.jsx(R,{label:d.label,value:d.value,badge:d.badge},m))})]}),!n&&e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-700",children:"Conversation not yet active"}),e.jsx("p",{className:"mt-1",children:"Your proposal has not opened a chat thread. When a supervisor responds or you send a message, the messaging tab will appear here."})]})]})}function O({request:s}){var a;return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Proposal"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Submitted materials accompanying your request."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Motivation"}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-slate-700",children:s.motivation||"No motivation provided."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Attachments"}),(a=s.attachments)!=null&&a.length?e.jsx("div",{className:"space-y-2",children:s.attachments.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 px-4 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 capitalize",children:t.type.replace("_"," ")}),e.jsx("div",{className:"text-xs text-slate-500",children:t.original_name})]}),e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:`/storage/${t.path}`,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]},t.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No attachments were included."})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Proposal details unavailable."})}function W({relationship:s}){const a=(s==null?void 0:s.meetings)??[];return a.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Upcoming meetings"]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:v(new Date(t.scheduled_for),"PPpp")})]}),t.location_link&&e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:t.location_link,target:"_blank",rel:"noopener noreferrer",children:"Join"})})]}),t.agenda&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:t.agenda})]},t.id))})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Meetings"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"No meetings scheduled yet. Coordinate with your supervisor to agree on a first session."}),e.jsx("div",{className:"rounded-lg border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"When meetings are scheduled they will appear here with quick links and agenda details."})})]})}function F({request:s,relationship:a}){const t=p.useMemo(()=>{const c=Array.isArray(s==null?void 0:s.timeline)?s.timeline:[],r=Array.isArray(a==null?void 0:a.timeline)?a.timeline:[];return[...c,...r].sort((n,i)=>new Date(n.created_at)-new Date(i.created_at))},[s==null?void 0:s.timeline,a==null?void 0:a.timeline]);return t.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(h,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{var r;return e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-800 capitalize",children:g(c.event_type)}),c.created_at&&e.jsx("span",{className:"text-xs text-slate-500",children:v(new Date(c.created_at),"PPpp")})]}),c.metadata&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:((r=c.metadata)==null?void 0:r.description)??JSON.stringify(c.metadata)})]},c.id??`${c.event_type}-${c.created_at}`)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(h,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"Timeline events will appear here as your supervision progresses. Published milestones (submitted, meetings, decisions) will stream in once backend tracking is enabled."})})]})}function g(s){return s?s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()):"Event"}function R({label:s,value:a,badge:t}){return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:s}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-slate-700",children:a}),t&&e.jsx(C,{variant:"outline",className:"border-indigo-200 text-indigo-600 text-[11px]",children:t})]})]})}export{he as default};
