import{c as W}from"./MainLayout-C1lcLEOO.js";import{q as B,r as f,W as L,j as e,a as I}from"./app-aam1Q33N.js";import{M as $}from"./Modal-C2RkZAcu.js";import{I as R}from"./InputLabel-CAFKhheo.js";import{I as F}from"./InputError-CbNQ4k7J.js";import{P as H}from"./PrimaryButton-DMhVuL0o.js";import{S as E}from"./SecondaryButton-Di8B1lgl.js";import{C as Y}from"./ConfirmationModal-Ck_YsW_J.js";import{c as h}from"./index-CZTUFDC6.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],se=W("UserPlus",z);function re({show:g,onClose:v,context:r,contextType:l,connections:p}){var k,_,M;const{auth:P}=B().props,[n,j]=f.useState(null),[b,u]=f.useState(!1),[w,U]=f.useState([]),d=L({user_id:"",role:"member"}),y=(r==null?void 0:r.id)||l==="workspace"&&((k=r==null?void 0:r.data)==null?void 0:k.id),N=P.user.id===((r==null?void 0:r.owner_id)||l==="workspace"&&((_=r==null?void 0:r.data)==null?void 0:_.owner_id)),m=l==="workspace"?(M=r==null?void 0:r.data)==null?void 0:M.members:r==null?void 0:r.members;f.useEffect(()=>{if(g&&p&&m){const s=m.map(i=>i.id),a=p.filter(i=>!s.includes(i.id));U(a)}},[g,p,r,m]);const A=s=>{s.preventDefault(),u(!0);const a=l==="workspace"?"workspaces.members.add":"projects.members.store";I.post(route(a,y),d.data).then(i=>{h.success("Member added successfully"),d.reset(),window.location.reload()}).catch(i=>{var c,C,x,S;const o=((C=(c=i.response)==null?void 0:c.data)==null?void 0:C.message)||"Failed to add member";h.error(o),(S=(x=i.response)==null?void 0:x.data)!=null&&S.errors&&d.setError(i.response.data.errors)}).finally(()=>{u(!1)})},q=s=>{j(s)},D=()=>{if(!n)return;u(!0);const s=l==="workspace"?"workspaces.members.remove":"projects.members.destroy";I.delete(route(s,{[l]:y,member:n.id})).then(a=>{h.success("Member removed successfully"),j(null),window.location.reload()}).catch(a=>{var o,c;const i=((c=(o=a.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to remove member";h.error(i)}).finally(()=>{u(!1)})},t=s=>{if(!s)return"Unknown User";const a=s.academician||s.postgraduate||s.undergraduate;return(a==null?void 0:a.full_name)||s.name},O=l==="workspace"?"Manage Workspace Members":"Manage Project Members";return e.jsxs(e.Fragment,{children:[e.jsx($,{show:g,onClose:v,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:O}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),m&&m.length>0?e.jsx("div",{className:"space-y-3",children:m.filter(s=>{var a;return s.id!==((r==null?void 0:r.owner_id)||l==="workspace"&&((a=r==null?void 0:r.data)==null?void 0:a.owner_id))}).map(s=>{var i,o;const a=s.id===((r==null?void 0:r.owner_id)||l==="workspace"&&((i=r==null?void 0:r.data)==null?void 0:i.owner_id));return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:s.profile_photo_url?e.jsx("img",{src:s.profile_photo_url,alt:t(s),className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-gray-500 text-sm",children:t(s).charAt(0)})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t(s)}),e.jsx("p",{className:"text-xs text-gray-500",children:a?"Owner":((o=s.pivot)==null?void 0:o.role)||"Member"})]})]}),N&&!a&&e.jsx(E,{onClick:()=>q(s),disabled:b,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]},s.id)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),N&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),w.length>0?e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"user_id",value:"Select Connection"}),e.jsxs("select",{id:"user_id",name:"user_id",value:d.data.user_id,onChange:s=>d.setData("user_id",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",required:!0,children:[e.jsx("option",{value:"",children:"Select a connection"}),w.map(s=>e.jsx("option",{value:s.id,children:t(s)},s.id))]}),e.jsx(F,{message:d.errors.user_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"role",value:"Role"}),e.jsxs("select",{id:"role",name:"role",value:d.data.role,onChange:s=>d.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx(F,{message:d.errors.role,className:"mt-2"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(H,{type:"submit",disabled:b||!d.data.user_id,children:b?"Sending...":"Send Invitation"})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"You have no available connections to invite. Connect with other users first."})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(E,{onClick:v,children:"Close"})})]})}),e.jsx(Y,{show:!!n,onClose:()=>j(null),onConfirm:D,title:"Remove Member",message:n?`Are you sure you want to remove ${t(n)} from this ${l}?`:""})]})}export{re as M,se as U};
