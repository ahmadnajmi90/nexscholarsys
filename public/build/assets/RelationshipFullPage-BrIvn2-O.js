import{q as F,r as o,a as Q,j as e,Y as X,y as C}from"./app-DlrLkdql.js";import{M as Z}from"./MainLayout-CaDLPfY8.js";import{T as O,a as P,b as n,c as l}from"./tabs-BHwQVOEn.js";import{B as h}from"./button-CmAFW6Q4.js";import{B as ee}from"./badge-DOEya6TB.js";import{A as te,a as se}from"./avatar-BUsG5DLW.js";import{T as ae}from"./textarea-DkBJcOd9.js";import{S as re}from"./scroll-area-CcD72brL.js";import{T as ie,a as oe,b as ne,c as q}from"./tooltip-Y6AC5kbZ.js";import le from"./ScheduleMeetingDialog-BKfoj1m2.js";import de from"./UnbindRequestModal-Bl4t29Ww.js";import ce from"./ResearchTab-CuvVzYTL.js";import me from"./DocumentsTab-BkKBmkM8.js";import{T}from"./ThreadPane-B2-NznzI.js";import pe from"./UnifiedOverviewTab-z_VFr6AQ.js";import{R as he}from"./RelationshipHistoryTab-CC5WAQSZ.js";import{c as N}from"./index-B_EXF9H_.js";import{l as _}from"./logError-BloCzXDJ.js";import{A as xe}from"./arrow-left-BR__7spA.js";import{C as ve}from"./calendar-BUDN8Wve.js";import{V as ue}from"./video-B5xdVhqU.js";import{U as be}from"./user-minus-Di9dcZKV.js";import{S as B}from"./sticky-note-B8cEGWil.js";import{L}from"./loader-circle-BDp7_rWE.js";import{T as je}from"./trash-2-Cs_KmYcC.js";import{f as ge}from"./format-BOijCLBA.js";import"./house-DhqGzN5G.js";import"./createLucideIcon-DuVmJdM5.js";import"./zap-C5sZ12y6.js";import"./users-DIbmjsPC.js";import"./folder-open-BeKiZvsi.js";import"./settings-CYYGlRx6.js";import"./useRoles-Qm-DlQme.js";import"./chevron-left-D4CJlqlf.js";import"./proxy-9_5LvuaU.js";import"./user-round-COXXmn1M.js";import"./clipboard-list-B_J7gyqU.js";import"./dollar-sign-CfrQ8X-j.js";import"./file-text-DuT2_NhJ.js";import"./message-square-Ns6phRZt.js";import"./graduation-cap-ByJq4Rk3.js";import"./building-BnusGjoU.js";import"./Dropdown-CyPVq9Ib.js";import"./transition-CrpKBowS.js";import"./sparkles-B8I717mR.js";import"./bookmark-CHxePipJ.js";import"./folder-kanban-DrAARP9_.js";import"./building-2-BVV_ifkz.js";import"./database-BVDqe0Nq.js";import"./shield-1ZrIkVDR.js";import"./index-raKJPBbr.js";import"./analytics-BQ374C1C.js";import"./iconBase-CNX8JClf.js";import"./index-C4Dw6-hd.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-CBfrqCZ4.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";import"./constructNow-6bIQB1GK.js";import"./addDays-KHeCUDUr.js";import"./Modal-Cu2styYL.js";import"./dialog-C4T7sENw.js";import"./index-BPUO_Du-.js";import"./PrimaryButton-jNMHCCwm.js";import"./SecondaryButton-COLypBy8.js";import"./search-C39YJhqP.js";import"./circle-check-big-BEClqQUa.js";import"./x-CaP1GlTY.js";import"./chevron-right-EHi25R_G.js";import"./index-Chjiymov.js";import"./dialog-B93jKqok.js";import"./index-C46cEohh.js";import"./index-CooGWVRp.js";import"./index-_t9AzER0.js";import"./index-BiBX-aEh.js";import"./index-DliD_jgu.js";import"./index-Cua-v5t-.js";import"./index-DTEdqLdY.js";import"./index-C4hYSks0.js";import"./briefcase-BY2whaIk.js";import"./user-Dp2DubXk.js";import"./index-CxKA1-ru.js";import"./index-kmWevIUn.js";import"./index-MQT5_bdA.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./index-Fs6G4e3d.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-Ci_0jHjH.js";import"./index-6fNHbBBE.js";import"./input-BA79iiec.js";import"./label-DjtJ3Q_j.js";import"./alert-DSFFSMc8.js";import"./useGoogleCalendar-n1GyoeWI.js";import"./external-link-BbmK-hZ2.js";import"./triangle-alert-DvEsydhA.js";import"./separator--ImGmQro.js";import"./plus-BExPN_B_.js";import"./circle-check-Bi2LurQP.js";import"./circle-Axh3tJBp.js";import"./select-BZMPga_k.js";import"./index-Cska_w9K.js";import"./chevron-down-Bj2RKwEZ.js";import"./check-CFw64E0p.js";import"./chevron-up-DjVaLNXq.js";import"./DocumentPreviewModal-NugPMx4d.js";import"./download-C9BmgKLA.js";import"./upload-Di6b9BSO.js";import"./eye-CyxR34zq.js";import"./history-_pjcNf-8.js";import"./mail-BUoIwSDY.js";import"./phone-QUfO4DSt.js";import"./globe-Bq6NnCQd.js";import"./calendar-clock-C9dxkGqa.js";import"./circle-alert-BSGnPwsh.js";function Us({relationship:x,userRole:r}){const{auth:v}=F().props,t=F().props.relationship||x,[u,f]=o.useState("overview"),[w,m]=o.useState(!1),[a,y]=o.useState(!1),[E,H]=o.useState([]),[U,A]=o.useState(""),[R,M]=o.useState(!1),[k,I]=o.useState(null);o.useEffect(()=>{t?.id&&V()},[t?.id]);const V=async()=>{if(t?.id)try{const s=await Q.get(route("supervision.relationships.show",t.id));H(s.data.data?.notes||[])}catch(s){_(s,"RelationshipFullPage loadNotes")}},$=()=>{r==="supervisor"?C.visit(route("supervision.supervisor.index")):C.visit(route("supervision.student.index"))},d=()=>{C.reload({only:["relationship"]})},J=async()=>{if(!(!U.trim()||R)){M(!0);try{N.success("Note added"),A("")}catch(s){_(s,"RelationshipFullPage handleAddNote"),N.error("Failed to add note")}finally{M(!1)}}},z=async s=>{if(!k){I(s);try{N.success("Note deleted")}catch(K){_(K,"RelationshipFullPage handleDeleteNote"),N.error("Failed to delete note")}finally{I(null)}}},i=r==="supervisor",c=i?t?.student??{}:t?.academician??{},b=c.full_name??(i?"Student":"Supervisor"),D=c.profile_picture?`/storage/${c.profile_picture}`:null,j=t?.status??"active",p=t?.active_unbind_request||t?.activeUnbindRequest,S=p?"pending_unbind":j,g=j==="active"&&!p,W=b.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),Y=S==="pending_unbind"?"Pending Unbind":S.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),G=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(Z,{title:"Supervision Relationship",children:[e.jsx(X,{title:`Supervision: ${b}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(h,{variant:"outline",onClick:$,className:"mb-4",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(te,{className:"h-16 w-16",children:D?e.jsx("img",{src:D,alt:b,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:W})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b}),e.jsxs("p",{className:"text-sm text-slate-600",children:[i?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(ee,{className:`${G(S)} border`,children:Y})})]})]})})]}),g&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(h,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(h,{className:"bg-slate-900 hover:bg-slate-800",disabled:!t?.meetings||t.meetings.length===0||!t.meetings[0]?.location_link,onClick:()=>{const s=t?.meetings?.[0];s?.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsx("div",{children:e.jsxs(h,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>y(!0),disabled:p||j!=="active",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),p&&e.jsx(q,{children:e.jsx("p",{children:"Unbind request pending approval"})}),j!=="active"&&!p&&e.jsx(q,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(O,{value:u,onValueChange:f,className:"w-full",children:[e.jsxs(P,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(n,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(n,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"})]}),e.jsx(n,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),i&&e.jsx(n,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(n,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"overview",className:"mt-0 p-2",children:e.jsx(pe,{relationship:t,person:c,userRole:r,activeUnbindRequest:p})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(ce,{relationship:t,onUpdated:d,isReadOnly:!g})})}),e.jsx(l,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:d,isReadOnly:!g})})})]}),e.jsx(l,{value:"chat",className:"mt-0 p-6",children:i?e.jsxs(O,{defaultValue:"direct",className:"w-full",children:[e.jsxs(P,{className:"mb-4",children:[e.jsx(n,{value:"direct",children:"Direct Message"}),e.jsx(n,{value:"group",disabled:!c?.supervision_group_conversation_id,children:"Team Chat"})]}),e.jsx(l,{value:"direct",className:"mt-0",children:t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),e.jsx(l,{value:"group",className:"mt-0",children:c?.supervision_group_conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:c.supervision_group_conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Team chat will be available when a co-supervisor joins."})})})]}):t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),i&&e.jsx(l,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(Ne,{notesList:E,newNote:U,setNewNote:A,isAddingNote:R,isDeletingNoteId:k,onAddNote:J,onDeleteNote:z,isReadOnly:!g})})}),e.jsx(l,{value:"history",className:"mt-0 p-0",children:e.jsx(re,{className:"h-[calc(100vh-350px)]",children:e.jsx(he,{relationship:t})})})]})]})})]}),e.jsx(le,{relationship:w?t:null,onClose:()=>m(!1),onScheduled:()=>{m(!1),d()},userRole:r}),e.jsx(de,{isOpen:a,relationship:t,onClose:()=>y(!1),onUnbindInitiated:()=>{y(!1),d()},userRole:r})]})}function Ne({notesList:x,newNote:r,setNewNote:v,isAddingNote:t,isDeletingNoteId:u,onAddNote:f,onDeleteNote:w,isReadOnly:m}){return e.jsxs("div",{className:"space-y-6",children:[!m&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(ae,{rows:4,value:r,onChange:a=>v(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(h,{onClick:f,disabled:!r.trim()||t,children:[t&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",x.length,")"]}),x.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(B,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:x.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?ge(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!m&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>w(a.id),disabled:u===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:u===a.id?e.jsx(L,{className:"h-4 w-4 animate-spin"}):e.jsx(je,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{Us as default};
