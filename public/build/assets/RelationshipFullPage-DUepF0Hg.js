import{q as P,r as d,a as X,j as e,Y as Z,y as T}from"./app-Doi1BfNX.js";import{M as ee}from"./MainLayout-VD0w9tEu.js";import{T as q,a as B,b as l,c}from"./tabs-BgtJ-Aqh.js";import{B as h}from"./button-KPEq8PdI.js";import{B as te}from"./badge-Be2D36dO.js";import{A as se,a as ae}from"./avatar-D-ohjjtQ.js";import{T as re}from"./textarea-B9-sF3_G.js";import{S as ie}from"./scroll-area-Du06xGgY.js";import{T as oe,a as ne,b as de,c as L}from"./tooltip-CJCiABJO.js";import le from"./ScheduleMeetingDialog-Bg9sEkOz.js";import ce from"./UnbindRequestModal-C0DyPriN.js";import me from"./ResearchTab-DSeJee53.js";import pe from"./DocumentsTab-CRNfvpzJ.js";import{T as _}from"./ThreadPane-B5BIAZi7.js";import xe from"./UnifiedOverviewTab-DNnrDGUR.js";import{R as he}from"./RelationshipHistoryTab-D0VInf3e.js";import{c as f}from"./index-dbiIR3J5.js";import{l as U}from"./logError-D4ezqrCx.js";import{A as ve}from"./arrow-left-BXAFDvhN.js";import{C as ue}from"./calendar-CBO9yeE8.js";import{V as be}from"./video-CabzSFea.js";import{U as je}from"./user-minus-aiA-FD3x.js";import{S as E}from"./sticky-note-DvxZmfS-.js";import{L as H}from"./loader-circle-D1uCPtBJ.js";import{T as ge}from"./trash-2-DurOfiw5.js";import{f as Ne}from"./format-Dv9Rm441.js";import"./house-DG9-SKJz.js";import"./createLucideIcon-BIWf6Fgr.js";import"./zap-Jwr2WBUL.js";import"./users-CJk5icQ6.js";import"./folder-open-Dt0aD5aH.js";import"./settings-BrND01Uv.js";import"./useRoles-ZkMXyAVp.js";import"./chevron-left-B4SkBdMm.js";import"./proxy-BUFhk0Wh.js";import"./user-round-B_eanpyP.js";import"./clipboard-list-DrTWdQ-4.js";import"./dollar-sign-D4dg_IhF.js";import"./file-text-CjHuEEW2.js";import"./message-square-THXDma7t.js";import"./graduation-cap-BiSIS5Fh.js";import"./building-Blr4MO9I.js";import"./Dropdown-C3siJS7L.js";import"./transition-Dk-vnbkR.js";import"./sparkles-CoZiYbuv.js";import"./bookmark-TdMgL57n.js";import"./folder-kanban-Ci5r-Zyx.js";import"./building-2-DoFw0cmv.js";import"./database-B1qHiJEl.js";import"./shield-B9sqgGYc.js";import"./index-CvKzrQIm.js";import"./analytics-BQ374C1C.js";import"./index-Degf296b.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-D-KgF5mV.js";import"./isSameDay-Dm-A-V7S.js";import"./en-US-DNUEYIb-.js";import"./constructNow-DtVD-0hX.js";import"./addDays-CAl2nVVE.js";import"./Modal-BjJ_nX2Q.js";import"./dialog-DYcl7DcC.js";import"./PrimaryButton-DP3HZhbg.js";import"./SecondaryButton-u54usrQd.js";import"./x-DrXySrr5.js";import"./chevron-right-Dg3EFaoF.js";import"./search-FGZFllxI.js";import"./circle-check-big-BlfyvA-C.js";import"./briefcase-Cs22VvWr.js";import"./user-dLQj9SMU.js";import"./index-B_QUZuO0.js";import"./index-FRhtyj0h.js";import"./index-BGtqCWya.js";import"./index-Ct-Jk4RI.js";import"./index-Be4Hbpsc.js";import"./index-BdR5mO0l.js";import"./index-CkAoBwhz.js";import"./index-Bb94jkfk.js";import"./index-CGrAONsN.js";import"./index-BdQq_4o_.js";import"./index-CZA6k5rr.js";import"./index-BkPy3AN8.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-CJzlUPP7.js";import"./index-BvLvCl4J.js";import"./input-yCRxI6tt.js";import"./label-BYlrvoGV.js";import"./alert-DlfG3K4y.js";import"./useGoogleCalendar-BXh9FXme.js";import"./external-link-DYFIg7ks.js";import"./triangle-alert-uV-J_FuU.js";import"./separator-C2wGlHlc.js";import"./plus-C8EzUFY8.js";import"./circle-check-CXM40yk7.js";import"./circle-B6s9ZxiZ.js";import"./select-Cp2fArvv.js";import"./index-CU8Rt2qH.js";import"./tslib.es6-CmEaCU22.js";import"./index-B-eZM3ov.js";import"./chevron-down-CmfXf0xW.js";import"./chevron-up-CiTpBnra.js";import"./check-C48ewYru.js";import"./DocumentPreviewModal-BhfBa8rV.js";import"./download-Xk6ccwe6.js";import"./upload-BslSFXeA.js";import"./eye-DZOo496r.js";import"./history-CYjZsRfK.js";import"./mail-7f1JiwhA.js";import"./phone-CDfQ_U-X.js";import"./globe-CO-0Byd6.js";import"./calendar-clock-DWMtvC7-.js";import"./circle-alert-DIrS-PEp.js";function Cs({relationship:v,userRole:i}){var O;const{auth:u}=P().props,t=P().props.relationship||v,[b,w]=d.useState("overview"),[y,p]=d.useState(!1),[a,S]=d.useState(!1),[V,$]=d.useState([]),[A,R]=d.useState(""),[k,M]=d.useState(!1),[I,D]=d.useState(null);d.useEffect(()=>{t!=null&&t.id&&J()},[t==null?void 0:t.id]);const J=async()=>{var s;if(t!=null&&t.id)try{const n=await X.get(route("supervision.relationships.show",t.id));$(((s=n.data.data)==null?void 0:s.notes)||[])}catch(n){U(n,"RelationshipFullPage loadNotes")}},z=()=>{i==="supervisor"?T.visit(route("supervision.supervisor.index")):T.visit(route("supervision.student.index"))},m=()=>{T.reload({only:["relationship"]})},W=async()=>{if(!(!A.trim()||k)){M(!0);try{f.success("Note added"),R("")}catch(s){U(s,"RelationshipFullPage handleAddNote"),f.error("Failed to add note")}finally{M(!1)}}},Y=async s=>{if(!I){D(s);try{f.success("Note deleted")}catch(n){U(n,"RelationshipFullPage handleDeleteNote"),f.error("Failed to delete note")}finally{D(null)}}},o=i==="supervisor",r=o?(t==null?void 0:t.student)??{}:(t==null?void 0:t.academician)??{},j=r.full_name??(o?"Student":"Supervisor"),F=r.profile_picture?`/storage/${r.profile_picture}`:null,g=(t==null?void 0:t.status)??"active",x=(t==null?void 0:t.active_unbind_request)||(t==null?void 0:t.activeUnbindRequest),C=x?"pending_unbind":g,N=g==="active"&&!x,G=j.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),K=C==="pending_unbind"?"Pending Unbind":C.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),Q=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(ee,{title:"Supervision Relationship",children:[e.jsx(Z,{title:`Supervision: ${j}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(h,{variant:"outline",onClick:z,className:"mb-4",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(se,{className:"h-16 w-16",children:F?e.jsx("img",{src:F,alt:j,className:"h-full w-full object-cover"}):e.jsx(ae,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:G})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:j}),e.jsxs("p",{className:"text-sm text-slate-600",children:[o?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(te,{className:`${Q(C)} border`,children:K})})]})]})})]}),N&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(h,{variant:"outline",onClick:()=>p(!0),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(h,{className:"bg-slate-900 hover:bg-slate-800",disabled:!(t!=null&&t.meetings)||t.meetings.length===0||!((O=t.meetings[0])!=null&&O.location_link),onClick:()=>{var n;const s=(n=t==null?void 0:t.meetings)==null?void 0:n[0];s!=null&&s.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(oe,{children:e.jsxs(ne,{children:[e.jsx(de,{asChild:!0,children:e.jsx("div",{children:e.jsxs(h,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>S(!0),disabled:x||g!=="active",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),x&&e.jsx(L,{children:e.jsx("p",{children:"Unbind request pending approval"})}),g!=="active"&&!x&&e.jsx(L,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(q,{value:b,onValueChange:w,className:"w-full",children:[e.jsxs(B,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(l,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(l,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"})]}),e.jsx(l,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),o&&e.jsx(l,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(l,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"overview",className:"mt-0 p-2",children:e.jsx(xe,{relationship:t,person:r,userRole:i,activeUnbindRequest:x})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(c,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:m,isReadOnly:!N})})}),e.jsx(c,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(pe,{relationship:t,onUpdated:m,isReadOnly:!N})})})]}),e.jsx(c,{value:"chat",className:"mt-0 p-6",children:o?e.jsxs(q,{defaultValue:"direct",className:"w-full",children:[e.jsxs(B,{className:"mb-4",children:[e.jsx(l,{value:"direct",children:"Direct Message"}),e.jsx(l,{value:"group",disabled:!(r!=null&&r.supervision_group_conversation_id),children:"Team Chat"})]}),e.jsx(c,{value:"direct",className:"mt-0",children:t!=null&&t.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(_,{conversationId:t.conversation_id,auth:u,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>m()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),e.jsx(c,{value:"group",className:"mt-0",children:r!=null&&r.supervision_group_conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(_,{conversationId:r.supervision_group_conversation_id,auth:u,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>m()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Team chat will be available when a co-supervisor joins."})})})]}):t!=null&&t.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(_,{conversationId:t.conversation_id,auth:u,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>m()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),o&&e.jsx(c,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(fe,{notesList:V,newNote:A,setNewNote:R,isAddingNote:k,isDeletingNoteId:I,onAddNote:W,onDeleteNote:Y,isReadOnly:!N})})}),e.jsx(c,{value:"history",className:"mt-0 p-0",children:e.jsx(ie,{className:"h-[calc(100vh-350px)]",children:e.jsx(he,{relationship:t})})})]})]})})]}),e.jsx(le,{relationship:y?t:null,onClose:()=>p(!1),onScheduled:()=>{p(!1),m()},userRole:i}),e.jsx(ce,{isOpen:a,relationship:t,onClose:()=>S(!1),onUnbindInitiated:()=>{S(!1),m()},userRole:i})]})}function fe({notesList:v,newNote:i,setNewNote:u,isAddingNote:t,isDeletingNoteId:b,onAddNote:w,onDeleteNote:y,isReadOnly:p}){return e.jsxs("div",{className:"space-y-6",children:[!p&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(re,{rows:4,value:i,onChange:a=>u(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(h,{onClick:w,disabled:!i.trim()||t,children:[t&&e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",v.length,")"]}),v.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(E,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:v.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?Ne(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!p&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>y(a.id),disabled:b===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:b===a.id?e.jsx(H,{className:"h-4 w-4 animate-spin"}):e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{Cs as default};
