import{j as e,r as o,a as X}from"./app-BodExSbw.js";import{c}from"./index-mDeC9k3u.js";import{M as Z}from"./Modal-BAfxSvqC.js";import{B as x}from"./button-DBoeCbAi.js";import{I as T}from"./input-C2RNHGC9.js";import{T as J}from"./textarea-BOIQB42l.js";import{L as S}from"./label-BPOuFRJU.js";import{A as K,a as Q}from"./alert-CvPXVyA9.js";import{l as V}from"./logError-D4ezqrCx.js";import{u as q}from"./useGoogleCalendar-Dt-LBfk8.js";import{C as H}from"./calendar-B_CZibmO.js";import{E as ee}from"./external-link-D_semteh.js";import{X as _}from"./x-hDgAYzkQ.js";import{f as te}from"./format-Dv9Rm441.js";import{L as se}from"./loader-circle-Cw7Nqhid.js";import"./dialog-yB7Y4Mvq.js";import"./transition-DOpmeePd.js";import"./utils-D-KgF5mV.js";import"./index-CuEpCwL6.js";import"./index-CGrAONsN.js";import"./createLucideIcon-plmRflaj.js";import"./en-US-DNUEYIb-.js";function ae({meeting:t,promptData:s,onYes:r,onNo:n,visible:g=!0}){if(!g)return null;const{supervisor_connected:l,student_connected:h}=s||{},d=l||h,p=l&&h;return e.jsx("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 max-w-md w-full",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Add to Google Calendar?"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3 space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500",children:t.scheduled_for?te(new Date(t.scheduled_for),"PPp"):"No date set"})]}),d?p?e.jsx("div",{className:"mb-3 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:e.jsx("p",{children:"âœ“ Both participants have Google Calendar connected"})}):e.jsx("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-700",children:e.jsx("p",{children:"You have Google Calendar connected. The other participant can add this meeting from their side."})}):e.jsxs("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Google Calendar not connected"}),e.jsx("p",{children:"Connect your Google Calendar in Profile Settings to enable sync."})]}),e.jsx("div",{className:"flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsxs(x,{size:"sm",onClick:r,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(H,{className:"w-3.5 h-3.5 mr-1.5"}),"Add to Calendar"]}),e.jsx(x,{size:"sm",variant:"outline",onClick:n,className:"flex-1",children:"Not Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"sm",asChild:!0,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:e.jsxs("a",{href:"/profile#calendar",onClick:j=>{n()},children:[e.jsx(ee,{className:"w-3.5 h-3.5 mr-1.5"}),"Connect Calendar"]})}),e.jsx(x,{size:"sm",variant:"outline",onClick:n,children:e.jsx(_,{className:"w-3.5 h-3.5"})})]})})]}),e.jsx("button",{onClick:n,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(_,{className:"w-4 h-4"})})]})})}const M=()=>{const t=new Date;t.setHours(t.getHours()+24);const s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),g=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`${s}-${r}-${n}T${g}:${l}`};function ke({relationship:t=null,request:s=null,onClose:r,onScheduled:n,userRole:g="supervisor"}){var L,$,I,z;const[l,h]=o.useState("Supervision Meeting"),[d,p]=o.useState(M()),[j,F]=o.useState(""),[D,P]=o.useState(""),[v,E]=o.useState(!1),[G,m]=o.useState(null),{addMeetingToCalendar:O}=q(),R=s&&!t,f=t||s,A=g==="supervisor",k=A?((L=t==null?void 0:t.student)==null?void 0:L.full_name)||(($=s==null?void 0:s.student)==null?void 0:$.full_name)||"student":((I=t==null?void 0:t.academician)==null?void 0:I.full_name)||((z=s==null?void 0:s.academician)==null?void 0:z.full_name)||"supervisor";o.useEffect(()=>{f&&(h(`Meeting with ${k}`),p(M()),F(""),P(t!=null&&t.meeting_cadence?`Discuss ${t.meeting_cadence.toLowerCase()}`:""),m(null))},[f,k,t==null?void 0:t.meeting_cadence]);const U=(a,b)=>{c.custom(u=>e.jsx(ae,{meeting:a,promptData:b,onYes:async()=>{c.dismiss(u.id),await O(a.id)},onNo:()=>c.dismiss(u.id),visible:u.visible}),{duration:1e4,position:"top-center"})},W=async a=>{var b,u,B,Y;if(a.preventDefault(),!(!f||v)){if(!l.trim()||!d||!j.trim()){m("Please provide a title, meeting date, and meeting link/location.");return}if(!f.id){m("Cannot schedule meeting: Invalid data. Please try again."),c.error("Invalid data");return}E(!0),m(null);try{const i=R?route("supervision.requests.meetings.store",s.id):route("supervision.meetings.store",t.id),N=d.replace("T"," ")+":00",y=await X.post(i,{title:l,scheduled_for:N,location_link:j,agenda:D}),{meeting:w,google_calendar_prompt:C}=y.data;c.success("Meeting scheduled"),C!=null&&C.show_prompt&&U(w,C),n==null||n(),r==null||r()}catch(i){V(i,"Supervision schedule meeting");const N=((u=(b=i==null?void 0:i.response)==null?void 0:b.data)==null?void 0:u.message)||"Failed to schedule meeting. Please try again.",y=(Y=(B=i==null?void 0:i.response)==null?void 0:B.data)==null?void 0:Y.errors;if(y){const w=Object.values(y).flat().join(", ");m(w),c.error(w)}else m(N),c.error(N)}finally{E(!1)}}};return e.jsx(Z,{show:!!f,onClose:r,maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Schedule supervision meeting"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Create a meeting invite for ",k,". ",A?"The student":"Your supervisor"," will see the meeting once scheduled."]})]}),e.jsx("button",{onClick:r,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[G&&e.jsx(K,{variant:"destructive",children:e.jsx(Q,{children:G})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"meeting-title",children:"Meeting title"}),e.jsx(T,{id:"meeting-title",value:l,onChange:a=>h(a.target.value),placeholder:"e.g. Thesis direction sync",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"meeting-datetime",children:"Scheduled for"}),e.jsx(T,{id:"meeting-datetime",type:"datetime-local",value:d,onChange:a=>p(a.target.value),min:M(),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"meeting-location",children:"Meeting link / location"}),e.jsx(T,{id:"meeting-location",value:j,onChange:a=>F(a.target.value),placeholder:"Zoom / Teams link or physical venue",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"meeting-agenda",children:"Agenda / notes"}),e.jsx(J,{id:"meeting-agenda",rows:4,value:D,onChange:a=>P(a.target.value),placeholder:"Outline talking points, materials to review, or goals for this session."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:r,disabled:v,children:"Cancel"}),e.jsxs(x,{type:"submit",disabled:v,children:[v?e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Schedule meeting"]})]})]})]})})}export{ke as default};
