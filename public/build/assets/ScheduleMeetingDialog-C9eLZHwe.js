import{r as i,j as e,b as P}from"./app-A8xQkvSk.js";import{c as l}from"./index-Km-vM6Jb.js";import{M as q}from"./Modal-D_n_zj3N.js";import{B as E}from"./button-Dz_rydmG.js";import{I as f}from"./input-D2p8biwd.js";import{T as B}from"./textarea-DGdKxzUN.js";import{L as c}from"./label-BcrT7TVM.js";import{A as H,a as $}from"./alert-BBFXwXFc.js";import{l as z}from"./logError-D4ezqrCx.js";import{X as R}from"./x-vL7g-LuD.js";import{L as W}from"./loader-circle-DkpR38mE.js";import"./dialog-BkDQGxoj.js";import"./transition-Bvb6H6Z4.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-7Qlnuq3l.js";import"./index-Dp3B9jqt.js";import"./createLucideIcon-DPzobtnR.js";const v=()=>{const t=new Date;return t.setHours(t.getHours()+24),new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,16)};function ce({relationship:t,onClose:a,onScheduled:m,userRole:O="supervisor"}){var M,T;const[d,h]=i.useState("Supervision Meeting"),[u,p]=i.useState(v()),[g,j]=i.useState(""),[y,S]=i.useState(""),[o,b]=i.useState(!1),[w,n]=i.useState(null),N=O==="supervisor",x=N?((M=t==null?void 0:t.student)==null?void 0:M.full_name)??"student":((T=t==null?void 0:t.academician)==null?void 0:T.full_name)??"supervisor";i.useEffect(()=>{t&&(h(`Meeting with ${x}`),p(v()),j(""),S(t!=null&&t.meeting_cadence?`Discuss ${t.meeting_cadence.toLowerCase()}`:""),n(null))},[t,x]);const C=async s=>{var D,k,F,I;if(s.preventDefault(),!(!t||o)){if(!d.trim()||!u||!g.trim()){n("Please provide a title, meeting date, and meeting link/location.");return}if(!t.id){n("Cannot schedule meeting: Invalid relationship data. Please try again."),l.error("Invalid relationship data");return}b(!0),n(null);try{await P.post(route("supervision.meetings.store",t.id),{title:d,scheduled_for:new Date(u).toISOString(),location_link:g,agenda:y}),l.success("Meeting scheduled"),m==null||m(),a==null||a()}catch(r){z(r,"Supervision schedule meeting");const L=((k=(D=r==null?void 0:r.response)==null?void 0:D.data)==null?void 0:k.message)||"Failed to schedule meeting. Please try again.",_=(I=(F=r==null?void 0:r.response)==null?void 0:F.data)==null?void 0:I.errors;if(_){const A=Object.values(_).flat().join(", ");n(A),l.error(A)}else n(L),l.error(L)}finally{b(!1)}}};return e.jsx(q,{show:!!t,onClose:a,maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Schedule supervision meeting"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Create a meeting invite for ",x,". ",N?"The student":"Your supervisor"," will see the meeting once scheduled."]})]}),e.jsx("button",{onClick:a,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[w&&e.jsx(H,{variant:"destructive",children:e.jsx($,{children:w})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-title",children:"Meeting title"}),e.jsx(f,{id:"meeting-title",value:d,onChange:s=>h(s.target.value),placeholder:"e.g. Thesis direction sync",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-datetime",children:"Scheduled for"}),e.jsx(f,{id:"meeting-datetime",type:"datetime-local",value:u,onChange:s=>p(s.target.value),min:v(),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-location",children:"Meeting link / location"}),e.jsx(f,{id:"meeting-location",value:g,onChange:s=>j(s.target.value),placeholder:"Zoom / Teams link or physical venue",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"meeting-agenda",children:"Agenda / notes"}),e.jsx(B,{id:"meeting-agenda",rows:4,value:y,onChange:s=>S(s.target.value),placeholder:"Outline talking points, materials to review, or goals for this session."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:a,disabled:o,children:"Cancel"}),e.jsxs(E,{type:"submit",disabled:o,children:[o?e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Schedule meeting"]})]})]})]})})}export{ce as default};
