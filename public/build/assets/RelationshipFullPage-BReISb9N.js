import{q as F,r as o,a as Q,j as e,Y as X,y as C}from"./app-C9aRItHR.js";import{M as Z}from"./MainLayout-Bl5NjS0P.js";import{T as O,a as P,b as n,c as l}from"./tabs-CFEHTnnM.js";import{B as h}from"./button-CSPEol7l.js";import{B as ee}from"./badge-DncnOgy3.js";import{A as te,a as se}from"./avatar-CxvIrRZY.js";import{T as ae}from"./textarea-DFpeILRG.js";import{S as re}from"./scroll-area-BASTW5Mn.js";import{T as ie,a as oe,b as ne,c as q}from"./tooltip-Bumx2StD.js";import le from"./ScheduleMeetingDialog-tNScvPE1.js";import de from"./UnbindRequestModal-BdqK_7bW.js";import ce from"./ResearchTab-BdKs4vG-.js";import me from"./DocumentsTab-DpKMgeYD.js";import{T}from"./ThreadPane-DwcafS7d.js";import pe from"./UnifiedOverviewTab-DnnO0UKB.js";import{R as he}from"./RelationshipHistoryTab-fmGdNK1b.js";import{c as N}from"./index-XngfYQdO.js";import{l as _}from"./logError-BloCzXDJ.js";import{A as xe}from"./arrow-left-DF5iCzrg.js";import{C as ve}from"./calendar-DOmFwYBu.js";import{V as ue}from"./video-Oj1cMx8w.js";import{U as be}from"./user-minus-DXCLUFtO.js";import{S as B}from"./sticky-note-D3BkVtci.js";import{L}from"./loader-circle-gYcNYlpl.js";import{T as je}from"./trash-2-BfSX7cDD.js";import{f as ge}from"./format-BOijCLBA.js";import"./house-iIzYry7D.js";import"./createLucideIcon-BKESxhZR.js";import"./zap-BO9SNPWd.js";import"./users-7wE4kwZt.js";import"./folder-open-BMedN5wh.js";import"./settings-CD-0zKD9.js";import"./useRoles-BMgrdTWk.js";import"./chevron-left-CXvSSDf-.js";import"./proxy-oGTuy5le.js";import"./user-round-B6zt5dYE.js";import"./clipboard-list-D9RZIGl3.js";import"./dollar-sign-CTMVi4zP.js";import"./file-text-Dda2OPaZ.js";import"./message-square-s9PQcdgL.js";import"./graduation-cap-CUV5l_Ya.js";import"./building-BKwJ3Rui.js";import"./Dropdown-DGvLC90N.js";import"./transition-BcdIoExo.js";import"./sparkles-DW7Sg1pI.js";import"./bookmark-ZSjg04_i.js";import"./folder-kanban-CYtcX4dA.js";import"./building-2-leVI2yfI.js";import"./database-DSHZfPnC.js";import"./shield-BFWgtyat.js";import"./index-BXuOt4X-.js";import"./analytics-BQ374C1C.js";import"./iconBase-BnDH7fxV.js";import"./index-DWLkSDCh.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-CBfrqCZ4.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";import"./constructNow-6bIQB1GK.js";import"./addDays-KHeCUDUr.js";import"./Modal-Du6oGZ4g.js";import"./dialog-vzj-go99.js";import"./index-CCAZcmHJ.js";import"./PrimaryButton-DJiSt9ES.js";import"./SecondaryButton-DlgSMzLL.js";import"./search-4BAlCTpi.js";import"./circle-check-big-D9q7hdhw.js";import"./x-CwXSr9E4.js";import"./chevron-right-D08KHBfF.js";import"./index-Chjiymov.js";import"./dialog-D6CAw3_0.js";import"./index-hob4XtTs.js";import"./index-CrClJLlY.js";import"./index-CC4PcrzS.js";import"./index-COgthb8O.js";import"./index-eZvGyRKK.js";import"./index-DFuKqaZl.js";import"./index-D5McE1bZ.js";import"./index-CPPgYV_S.js";import"./briefcase-Drgw6UyA.js";import"./user-gcgZPnph.js";import"./index-h1-N4bqM.js";import"./index-BqNwAq_Q.js";import"./index-DQC-i451.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./index-KT7cPyEo.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-0pjh7AqE.js";import"./index-DJhbDaIo.js";import"./input-BRl5cfeF.js";import"./label-BDDULwdX.js";import"./alert-CP91AL0h.js";import"./useGoogleCalendar-BAd-iop4.js";import"./external-link-DzWtQSK0.js";import"./triangle-alert-CHajfL9r.js";import"./separator-CSyLe3k7.js";import"./plus-sqvzTBRi.js";import"./circle-check-BCZCNkWW.js";import"./circle-BMgTtHy9.js";import"./select-BZ_YVDv9.js";import"./index-Ty945MNA.js";import"./chevron-down-CZ68gouy.js";import"./check-CeJ8h2aY.js";import"./chevron-up-CqJJqoMZ.js";import"./DocumentPreviewModal-BbmO631w.js";import"./download-DQFhyGLE.js";import"./upload-CuF1lPos.js";import"./eye-BQYQL8tl.js";import"./history-BiHZMQAt.js";import"./mail-CFmvCR9a.js";import"./phone-DiFqFudg.js";import"./globe-OH7N1fpf.js";import"./calendar-clock-BwFdVJIm.js";import"./circle-alert-DnDjM5GH.js";function Us({relationship:x,userRole:r}){const{auth:v}=F().props,t=F().props.relationship||x,[u,f]=o.useState("overview"),[w,m]=o.useState(!1),[a,y]=o.useState(!1),[E,H]=o.useState([]),[U,A]=o.useState(""),[R,M]=o.useState(!1),[k,I]=o.useState(null);o.useEffect(()=>{t?.id&&V()},[t?.id]);const V=async()=>{if(t?.id)try{const s=await Q.get(route("supervision.relationships.show",t.id));H(s.data.data?.notes||[])}catch(s){_(s,"RelationshipFullPage loadNotes")}},$=()=>{r==="supervisor"?C.visit(route("supervision.supervisor.index")):C.visit(route("supervision.student.index"))},d=()=>{C.reload({only:["relationship"]})},J=async()=>{if(!(!U.trim()||R)){M(!0);try{N.success("Note added"),A("")}catch(s){_(s,"RelationshipFullPage handleAddNote"),N.error("Failed to add note")}finally{M(!1)}}},z=async s=>{if(!k){I(s);try{N.success("Note deleted")}catch(K){_(K,"RelationshipFullPage handleDeleteNote"),N.error("Failed to delete note")}finally{I(null)}}},i=r==="supervisor",c=i?t?.student??{}:t?.academician??{},b=c.full_name??(i?"Student":"Supervisor"),D=c.profile_picture?`/storage/${c.profile_picture}`:null,j=t?.status??"active",p=t?.active_unbind_request||t?.activeUnbindRequest,S=p?"pending_unbind":j,g=j==="active"&&!p,W=b.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),Y=S==="pending_unbind"?"Pending Unbind":S.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),G=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(Z,{title:"Supervision Relationship",children:[e.jsx(X,{title:`Supervision: ${b}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(h,{variant:"outline",onClick:$,className:"mb-4",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(te,{className:"h-16 w-16",children:D?e.jsx("img",{src:D,alt:b,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:W})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b}),e.jsxs("p",{className:"text-sm text-slate-600",children:[i?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(ee,{className:`${G(S)} border`,children:Y})})]})]})})]}),g&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(h,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(h,{className:"bg-slate-900 hover:bg-slate-800",disabled:!t?.meetings||t.meetings.length===0||!t.meetings[0]?.location_link,onClick:()=>{const s=t?.meetings?.[0];s?.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsx("div",{children:e.jsxs(h,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>y(!0),disabled:p||j!=="active",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),p&&e.jsx(q,{children:e.jsx("p",{children:"Unbind request pending approval"})}),j!=="active"&&!p&&e.jsx(q,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(O,{value:u,onValueChange:f,className:"w-full",children:[e.jsxs(P,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(n,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(n,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"})]}),e.jsx(n,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),i&&e.jsx(n,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(n,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"overview",className:"mt-0 p-2",children:e.jsx(pe,{relationship:t,person:c,userRole:r,activeUnbindRequest:p})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(ce,{relationship:t,onUpdated:d,isReadOnly:!g})})}),e.jsx(l,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:d,isReadOnly:!g})})})]}),e.jsx(l,{value:"chat",className:"mt-0 p-6",children:i?e.jsxs(O,{defaultValue:"direct",className:"w-full",children:[e.jsxs(P,{className:"mb-4",children:[e.jsx(n,{value:"direct",children:"Direct Message"}),e.jsx(n,{value:"group",disabled:!c?.supervision_group_conversation_id,children:"Team Chat"})]}),e.jsx(l,{value:"direct",className:"mt-0",children:t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),e.jsx(l,{value:"group",className:"mt-0",children:c?.supervision_group_conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:c.supervision_group_conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Team chat will be available when a co-supervisor joins."})})})]}):t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),i&&e.jsx(l,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(Ne,{notesList:E,newNote:U,setNewNote:A,isAddingNote:R,isDeletingNoteId:k,onAddNote:J,onDeleteNote:z,isReadOnly:!g})})}),e.jsx(l,{value:"history",className:"mt-0 p-0",children:e.jsx(re,{className:"h-[calc(100vh-350px)]",children:e.jsx(he,{relationship:t})})})]})]})})]}),e.jsx(le,{relationship:w?t:null,onClose:()=>m(!1),onScheduled:()=>{m(!1),d()},userRole:r}),e.jsx(de,{isOpen:a,relationship:t,onClose:()=>y(!1),onUnbindInitiated:()=>{y(!1),d()},userRole:r})]})}function Ne({notesList:x,newNote:r,setNewNote:v,isAddingNote:t,isDeletingNoteId:u,onAddNote:f,onDeleteNote:w,isReadOnly:m}){return e.jsxs("div",{className:"space-y-6",children:[!m&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(ae,{rows:4,value:r,onChange:a=>v(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(h,{onClick:f,disabled:!r.trim()||t,children:[t&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",x.length,")"]}),x.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(B,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:x.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?ge(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!m&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>w(a.id),disabled:u===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:u===a.id?e.jsx(L,{className:"h-4 w-4 animate-spin"}):e.jsx(je,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{Us as default};
