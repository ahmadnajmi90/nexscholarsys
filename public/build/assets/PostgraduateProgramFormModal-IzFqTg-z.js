import{r as t,a as c,j as e}from"./app-rYbU358d.js";import{V as n}from"./index-BKxsboN1.js";import q from"./NationalityForm-Dwb_ysAs.js";import{y as R,D as U,j as z}from"./dialog-CaSIdBKT.js";import{z as F}from"./transition-B_nYpjLS.js";import"./InputLabel-DxNQ7dvI.js";import"./react-select.esm-T6UhNCit.js";import"./InputError-CBrnfU_C.js";function K({isOpen:p,onClose:x,mode:D="create",currentProgram:r=null,onSuccess:o}){const[b,h]=t.useState("manual"),[S,I]=t.useState([]),[E,N]=t.useState([]),[s,l]=t.useState({name:"",program_type:"Master",university_id:"",faculty_id:"",description:"",duration_years:"",funding_info:"",application_url:"",country:""}),[_,w]=t.useState(null),[k,v]=t.useState("upload"),[u,C]=t.useState([]),[y,f]=t.useState(!1),m=D==="edit"&&r;t.useEffect(()=>{p&&c.get("/api/v1/app/universities",{params:{per_page:200}}).then(a=>I(a.data.data)).catch(()=>n.error("Failed to load universities"))},[p]),t.useEffect(()=>{if(!p){h("manual"),w(null),C([]),v("upload");return}l(m?{name:r.name||"",program_type:r.program_type||"Master",university_id:r.university_id||"",faculty_id:r.faculty_id||"",description:r.description||"",duration_years:r.duration_years||"",funding_info:r.funding_info||"",application_url:r.application_url||"",country:r.country||""}:{name:"",program_type:"Master",university_id:"",faculty_id:"",description:"",duration_years:"",funding_info:"",application_url:"",country:""})},[p,m,r]),t.useEffect(()=>{if(!s.university_id){N([]);return}c.get("/api/v1/app/faculties",{params:{university_id:s.university_id,per_page:200}}).then(a=>N(a.data.data)).catch(()=>N([]))},[s.university_id]);const M=async a=>{a.preventDefault();try{m?(await c.post(`/admin/data-management/postgraduate-programs/${r.id}`,s),n.success("Program updated")):(await c.post("/admin/data-management/postgraduate-programs",s),n.success("Program created")),o==null||o()}catch(i){console.error(i),n.error("Save failed")}},P=async a=>{var d,j;if(a.preventDefault(),!_){n.error("Please select a file to preview.");return}f(!0);const i=new FormData;i.append("file",_);try{const g=await c.post("/api/v1/app/postgraduate-programs/import/preview",i,{headers:{"Content-Type":"multipart/form-data"}});C(g.data||[]),v("preview")}catch(g){console.error(g),n.error(((j=(d=g.response)==null?void 0:d.data)==null?void 0:j.message)||"Failed to parse file.")}finally{f(!1)}},T=async()=>{var a,i;f(!0);try{await c.post("/api/v1/app/postgraduate-programs/import",{programs:u}),n.success("Programs imported successfully!"),w(null),C([]),v("upload"),h("manual"),o==null||o()}catch(d){console.error(d),n.error(((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save data.")}finally{f(!1)}};return e.jsx(F,{appear:!0,show:p,as:t.Fragment,children:e.jsxs(R,{as:"div",className:"relative z-50",onClose:x,children:[e.jsx(F.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(U,{className:"fixed inset-0 bg-black/30"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(F.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(z,{className:"w-full max-w-2xl transform overflow-hidden rounded-lg bg-white p-0 text-left align-middle shadow-xl transition-all",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:m?"Edit Postgraduate Program":"Add Postgraduate Program"}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsx("div",{className:"px-6 pt-4 border-b",children:e.jsxs("nav",{className:"-mb-px flex space-x-6",children:[e.jsx("button",{onClick:()=>h("manual"),className:`pb-2 border-b-2 ${b==="manual"?"border-blue-600 text-blue-600":"border-transparent text-gray-500"}`,children:"Manual Entry"}),e.jsx("button",{onClick:()=>h("import"),className:`pb-2 border-b-2 ${b==="import"?"border-blue-600 text-blue-600":"border-transparent text-gray-500"}`,children:"Import from File"})]})}),e.jsx("div",{className:"p-6",children:b==="manual"?e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Name ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.name,onChange:a=>l({...s,name:a.target.value}),className:"w-full rounded px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Program Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.program_type,onChange:a=>l({...s,program_type:a.target.value}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"Master",children:"Master"}),e.jsx("option",{value:"PhD",children:"PhD"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["University ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.university_id,onChange:a=>l({...s,university_id:a.target.value,faculty_id:""}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select university"}),S.map(a=>e.jsx("option",{value:a.id,children:a.full_name},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Faculty ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.faculty_id,onChange:a=>l({...s,faculty_id:a.target.value}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select faculty"}),E.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Description ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{value:s.description,onChange:a=>l({...s,description:a.target.value}),className:"w-full rounded px-3 py-2",rows:4,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Duration (e.g., 3 until 8) ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.duration_years,onChange:a=>l({...s,duration_years:a.target.value}),className:"w-full rounded px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Funding Info ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.funding_info,onChange:a=>l({...s,funding_info:a.target.value}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select funding type"}),e.jsx("option",{value:"Full scholarship + stipend available",children:"Full scholarship + stipend available"}),e.jsx("option",{value:"Research assistantship with full tuition waiver",children:"Research assistantship with full tuition waiver"}),e.jsx("option",{value:"Research training program scholarship",children:"Research training program scholarship"}),e.jsx("option",{value:"Self-funded or external scholarships",children:"Self-funded or external scholarships"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Application URL ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.application_url,onChange:a=>l({...s,application_url:a.target.value}),className:"w-full rounded px-3 py-2"})]}),e.jsx("div",{children:e.jsx(q,{title:"Country",value:s.country,onChange:a=>l({...s,country:a}),errors:!1})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:m?"Update":"Create"})]})]}):e.jsxs("div",{className:"space-y-4",children:[k==="upload"&&e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"Instructions"}),e.jsxs("p",{children:["Upload a .xlsx or .csv file with a header row containing these columns: ",e.jsx("strong",{children:"name, program_type, university_id, faculty_id, description, duration_years, funding_info, application_url, country"}),"."]}),e.jsx("a",{href:"/storage/templates/postgraduate_programs_template.csv",className:"text-blue-700 underline",target:"_blank",rel:"noreferrer",children:"Download template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Select file (.xlsx or .csv)"}),e.jsx("input",{type:"file",accept:".xlsx,.csv",onChange:a=>{var i;return w(((i=a.target.files)==null?void 0:i[0])||null)}})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y||!_,className:"px-4 py-2 bg-blue-600 text-white rounded",children:y?"Processing...":"Preview Data"})]})]}),k==="preview"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Preview Data (",u.length," records found)"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please review the extracted data before saving to the database."}),e.jsx("div",{className:"max-h-96 overflow-y-auto border rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:u.length>0&&Object.keys(u[0]).map(a=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:a.replace("_"," ")},a))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((a,i)=>e.jsx("tr",{children:Object.values(a).map((d,j)=>e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700 whitespace-nowrap truncate max-w-xs",children:String(d)},j))},i))})]})}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>v("upload"),className:"px-4 py-2 border rounded",children:"Back"}),e.jsx("button",{type:"button",onClick:T,disabled:y,className:"px-4 py-2 bg-green-600 text-white rounded",children:y?"Saving...":"Confirm & Save"})]})]})]})})]})})})})]})})}export{K as default};
