import{r as i,j as e,y as k,a as A}from"./app-Doi1BfNX.js";import{q as v,x as D,y as E,z as $,A as X,B as Z,C as I,D as w}from"./index-Degf296b.js";import{P as ee}from"./Pagination-DRXd3z_6.js";import"./chevron-left-B4SkBdMm.js";import"./createLucideIcon-BIWf6Fgr.js";import"./chevron-right-Dg3EFaoF.js";const le=({academics:l,researchOptions:B,onSendReminder:T,onSendBatchReminder:U,pagination:u,currentTab:P,loading:R})=>{const[c,x]=i.useState({}),[n,h]=i.useState([]),[g,m]=i.useState(!1),[f,p]=i.useState(!1),[z,O]=i.useState({}),[d,j]=i.useState({}),[q,S]=i.useState(null),[o,J]=i.useState("send_reminder"),[Q,_]=i.useState(!1),Y=async s=>{x(t=>({...t,[s]:"sending"}));try{await T(s,"academician"),x(t=>({...t,[s]:"sent"})),setTimeout(()=>{x(t=>{const a={...t};return delete a[s],a})},3e3)}catch{x(a=>({...a,[s]:"error"})),setTimeout(()=>{x(a=>{const r={...a};return delete r[s],r})},3e3)}},L=s=>{if(s.target.checked){const t=l.map(a=>a.id);h(t)}else h([])},M=s=>{h(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},W=async()=>{if(n.length!==0){m(!0);try{await U(n,"academician"),m(!1),p(!0),setTimeout(()=>{h([]),p(!1)},3e3)}catch{m(!1)}}},G=async()=>{if(n.length!==0){_(!1),m(!0);try{await A.post(route("admin.profiles.batch-deactivate"),{userIds:n,role:"academician"}),m(!1),p(!0),setTimeout(()=>{k.reload({only:["academicians"]}),h([]),p(!1)},2e3)}catch(s){console.error("Error batch deactivating users:",s),m(!1)}}},H=()=>{o==="send_reminder"?W():o==="deactivate"&&_(!0)},K=s=>{O(t=>({...t,[s]:!t[s]}))},V=async s=>{j(t=>({...t,[s]:"deactivating"})),S(null);try{await A.post(route("admin.profiles.deactivate"),{userId:s}),j(t=>({...t,[s]:"deactivated"})),setTimeout(()=>{k.reload({only:["academicians"]})},2e3)}catch(t){console.error("Error deactivating user:",t),j(a=>({...a,[s]:"error"})),setTimeout(()=>{j(a=>{const r={...a};return delete r[s],r})},3e3)}};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"mb-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500",children:n.length>0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-md bg-blue-50 text-blue-700",children:[n.length," academician",n.length!==1?"s":""," selected"]}):e.jsx("span",{children:"No academicians selected"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:o,onChange:s=>J(s.target.value),className:"block py-2 pl-3 pr-10 text-sm border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:n.length===0,children:[e.jsx("option",{value:"send_reminder",children:"Send Reminder"}),e.jsx("option",{value:"deactivate",children:"Deactivate Accounts"})]}),e.jsxs("button",{onClick:H,disabled:n.length===0||g||f,className:`inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium shadow-sm transition-colors ${n.length===0||g||f?"bg-gray-100 text-gray-400 cursor-not-allowed":o==="deactivate"?"bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500":"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}`,children:[g&&e.jsx(v,{className:"animate-spin -ml-0.5 mr-2 h-4 w-4"}),f&&e.jsx(D,{className:"-ml-0.5 mr-2 h-4 w-4"}),!g&&!f?e.jsx(e.Fragment,{children:o==="send_reminder"?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Send to Selected"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Deactivate Selected"]})}):g?o==="send_reminder"?"Sending...":"Deactivating...":o==="send_reminder"?"Sent!":"Deactivated!"]})]})]}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-red-600"})}),e.jsx("div",{className:"ml-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Batch Deactivation"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["You are about to deactivate ",e.jsx("span",{className:"font-bold text-red-600",children:n.length})," academician account",n.length!==1?"s":"","."]}),e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3",children:[e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Warning:"})," This action will:"]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"Delete all role profiles"}),e.jsx("li",{children:"Remove embeddings from Qdrant"}),e.jsx("li",{children:"Reset unique IDs to null"}),e.jsx("li",{children:"Mark profiles as incomplete"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["This is a ",e.jsx("strong",{children:"destructive action"}),". Are you sure you want to continue?"]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsxs("button",{onClick:G,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:["Yes, Deactivate ",n.length," Account",n.length!==1?"s":""]})]})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{scope:"col",className:"relative w-12 px-4 sm:w-16 sm:px-6",children:e.jsx("input",{type:"checkbox",className:"absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 sm:left-6",checked:l&&l.length>0&&n.length===l.length,onChange:L})}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Academician"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"University & Faculty"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Department & Position"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Research Expertise"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Profile Status"}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:l&&l.length>0?l.map(s=>{var r,F;const t=s.academician,a=z[s.id]||!1;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"relative w-12 px-4 sm:w-16 sm:px-6",children:e.jsx("input",{type:"checkbox",className:"absolute left-4 top-1/2 -mt-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 sm:left-6",checked:n.includes(s.id),onChange:()=>M(s.id)})}),e.jsx("td",{className:"whitespace-nowrap py-4 pl-3 pr-3 text-sm",children:e.jsx("div",{className:"flex items-start space-x-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:(t==null?void 0:t.full_name)||s.name||"N/A"}),e.jsx("div",{className:"text-gray-500 mt-1",children:s.email})]})})}),e.jsx("td",{className:"px-3 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((r=t==null?void 0:t.university_details)==null?void 0:r.full_name)||"Not specified"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:((F=t==null?void 0:t.faculty)==null?void 0:F.name)||"Faculty not specified"})]})}),e.jsx("td",{className:"px-3 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(t==null?void 0:t.current_position)||"Position not specified"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:(t==null?void 0:t.department)||"Department not specified"})]})}),e.jsx("td",{className:"px-3 py-4",children:t!=null&&t.research_expertise?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>K(s.id),className:"flex items-center justify-between w-full text-left text-sm font-medium text-blue-600 hover:text-blue-800",children:[e.jsx("span",{children:Array.isArray(t.research_expertise)?`${t.research_expertise.length} area${t.research_expertise.length!==1?"s":""}`:"Research expertise"}),a?e.jsx(Z,{className:"h-4 w-4 ml-1"}):e.jsx(I,{className:"h-4 w-4 ml-1"})]}),a&&e.jsx("div",{className:"mt-2 bg-gray-50 p-2 rounded max-h-40 overflow-y-auto",children:e.jsx("div",{className:"space-y-1 text-sm",children:Array.isArray(t.research_expertise)?t.research_expertise.map((y,b)=>{const N=B.find(C=>`${C.field_of_research_id}-${C.research_area_id}-${C.niche_domain_id}`===y);return N?e.jsxs("div",{className:"text-gray-700 flex",children:[e.jsxs("span",{className:"text-gray-400 mr-1.5",children:[b+1,"."]}),e.jsxs("span",{children:[N.field_of_research_name," - ",N.research_area_name," - ",N.niche_domain_name]})]},b):e.jsxs("div",{className:"text-gray-700 flex",children:[e.jsxs("span",{className:"text-gray-400 mr-1.5",children:[b+1,"."]}),e.jsx("span",{children:typeof y=="string"?y:JSON.stringify(y)})]},b)}):e.jsx("div",{className:"text-gray-700",children:typeof t.research_expertise=="string"?t.research_expertise:JSON.stringify(t.research_expertise)})})})]}):e.jsxs("div",{className:"flex items-center text-gray-500 italic",children:[e.jsx(w,{className:"text-yellow-500 mr-1.5 h-4 w-4"}),e.jsx("span",{children:"Not specified"})]})}),e.jsx("td",{className:"px-3 py-4",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(t==null?void 0:t.profile_status)==="Complete"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:(t==null?void 0:t.profile_status)||"Needs Update"})})}),e.jsx("td",{className:"whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>Y(s.id),disabled:c[s.id]==="sending"||c[s.id]==="sent",className:`inline-flex items-center rounded-md px-3 py-2 text-sm font-medium shadow-sm ${c[s.id]==="sending"||c[s.id]==="sent"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-blue-600 hover:bg-blue-50 border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}`,children:c[s.id]==="sending"?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"animate-spin mr-1.5 -ml-0.5 h-4 w-4"}),"Sending..."]}):c[s.id]==="sent"?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-1.5 -ml-0.5 h-4 w-4 text-green-500"}),"Sent"]}):c[s.id]==="error"?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-1.5 -ml-0.5 h-4 w-4 text-red-500"}),"Error"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-1.5 -ml-0.5 h-4 w-4"}),"Send"]})}),q===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>V(s.id),className:"inline-flex items-center rounded-md px-3 py-2 text-sm font-medium shadow-sm bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"Confirm"}),e.jsx("button",{onClick:()=>S(null),className:"inline-flex items-center rounded-md px-3 py-2 text-sm font-medium shadow-sm bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Cancel"})]}):e.jsx("button",{onClick:()=>S(s.id),disabled:d[s.id]==="deactivating"||d[s.id]==="deactivated",className:`inline-flex items-center rounded-md px-3 py-2 text-sm font-medium shadow-sm ${d[s.id]==="deactivating"||d[s.id]==="deactivated"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-red-600 hover:bg-red-50 border border-red-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"}`,title:"Deactivate user account and remove from Qdrant",children:d[s.id]==="deactivating"?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"animate-spin mr-1.5 -ml-0.5 h-4 w-4"}),"Deactivating..."]}):d[s.id]==="deactivated"?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-1.5 -ml-0.5 h-4 w-4 text-green-500"}),"Deactivated"]}):d[s.id]==="error"?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-1.5 -ml-0.5 h-4 w-4 text-red-500"}),"Error"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-1.5 -ml-0.5 h-4 w-4"}),"Deactivate"]})})]})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[e.jsx(w,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{children:"No academicians found"})]})})})})]})})}),R&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"animate-spin text-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"Loading..."})]})}),u&&u.last_page>1&&e.jsx("div",{className:"mt-6",children:e.jsx(ee,{currentPage:u.current_page||1,totalPages:u.last_page||1,onPageChange:s=>{k.get(`${window.location.pathname}?academicians_page=${s}&tab=${P}`,{preserveState:!0,replace:!0})}})})]})};export{le as default};
