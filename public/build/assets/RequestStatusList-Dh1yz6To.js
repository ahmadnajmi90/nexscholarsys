import{r as g,j as s,a as T,b as R}from"./app-BodExSbw.js";import{c as A}from"./index-mDeC9k3u.js";import{l as D}from"./logError-D4ezqrCx.js";import{g as L}from"./supervisionConstants-BuM5-H5X.js";import{B as d}from"./badge-DjhgJA26.js";import{C as P,b as B,c as E,a as Y}from"./card-DlB-Racq.js";import{B as S}from"./button-DBoeCbAi.js";import"./separator-Dmz1NQC9.js";import O from"./UnifiedRequestDetailCard-ebINJ2Fq.js";import{C as V}from"./ConfirmationModal-BQlKgQba.js";import{U as k}from"./user-round-ujBW7jHx.js";import{L as $}from"./lightbulb-9R2fYqeX.js";import{C as w}from"./clock-3-BbTirI7S.js";import{M as U}from"./message-circle-Bvos9TQ_.js";import{C}from"./circle-check-C3TcVouP.js";import{F}from"./file-text-CbeunphJ.js";import{C as y}from"./circle-x-Dc5lA-k5.js";import{L as I}from"./loader-circle-Cw7Nqhid.js";import{f as z}from"./format-Dv9Rm441.js";import{f as G}from"./formatDistanceToNow-GKXiLTrL.js";import"./index-CGrAONsN.js";import"./utils-D-KgF5mV.js";import"./index-CuEpCwL6.js";import"./tabs-f_7yQiVN.js";import"./index-BNbWxI0H.js";import"./index-B08zmKDA.js";import"./index-D4c9OpUc.js";import"./index-BBnFLmbe.js";import"./index-CtmDxyuO.js";import"./index-D7Nzv7pr.js";import"./index-DVO2p-KC.js";import"./avatar-DwsKaBC2.js";import"./scroll-area-Ce2gizj4.js";import"./index-BdQq_4o_.js";import"./textarea-BOIQB42l.js";import"./tooltip-B0O2cJGD.js";import"./index-BJkGQNDv.js";import"./index-C0YnOByL.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-BbHqW-rW.js";import"./index-CbELOpWX.js";import"./ThreadPane-BcUCYjUT.js";import"./Modal-BAfxSvqC.js";import"./dialog-yB7Y4Mvq.js";import"./transition-DOpmeePd.js";import"./AttachmentPreviewModal-CfDD-tdx.js";import"./download-Dwu8Gboh.js";import"./createLucideIcon-plmRflaj.js";import"./x-hDgAYzkQ.js";import"./isSameDay-Dm-A-V7S.js";import"./en-US-DNUEYIb-.js";import"./AcceptSupervisorOfferModal-DFcQrHwz.js";import"./label-BPOuFRJU.js";import"./checkbox-BbFk3kcJ.js";import"./index-BU_vkww_.js";import"./check-CzANbjxc.js";import"./alert-CvPXVyA9.js";import"./circle-alert-CQJiC0Ry.js";import"./AcceptSupervisionRequestModal-DUeVX9pZ.js";import"./select-DL2Hhu2C.js";import"./index---8uu-Q5.js";import"./tslib.es6-CmEaCU22.js";import"./chevron-down-nQDcq6tx.js";import"./chevron-up-D-sgdM5K.js";import"./DeclineSupervisionRequestModal-BljR9heU.js";import"./input-C2RNHGC9.js";import"./users-DczRUbjv.js";import"./building-2-KMWe0qjh.js";import"./search-CcfjS-o3.js";import"./ScheduleMeetingDialog-B8Sdqh5k.js";import"./useGoogleCalendar-Dt-LBfk8.js";import"./calendar-B_CZibmO.js";import"./external-link-D_semteh.js";import"./modalAnimations-CCENKliM.js";import"./supervisionHelpers-EJT0WNFw.js";import"./index-DwEPtsR4.js";import"./proxy-Bi0KVEdU.js";import"./message-square-D6KZh6aw.js";import"./video-M2uVkNtU.js";import"./briefcase-BpSSXkaq.js";import"./mail-DW8LOIRf.js";import"./phone-BmAt8SOh.js";import"./globe-BnhB8Pc-.js";import"./graduation-cap-DVTjW2kl.js";import"./sticky-note-Cj-lYcYe.js";import"./trash-2-CDTv5Cmp.js";import"./triangle-alert-CMd7VCYq.js";import"./constructNow-DtVD-0hX.js";const M={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},H={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function Se({requests:e=[],reload:r,onOpenDetail:N}){var _;const[f,n]=g.useState(null),[h,m]=g.useState(null),[p,o]=g.useState(!1),[t,l]=g.useState(null),u=i=>{l(i),o(!0)},j=async()=>{var i,x;if(t!=null&&t.id){n(t.id),o(!1);try{await T.post(route("supervision.requests.cancel",t.id)),A.success("Proposal withdrawn"),r==null||r()}catch(c){D(c,"RequestStatusList handleCancel");const v=((x=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:x.message)||"Unable to cancel your request right now";A.error(v)}finally{n(null),l(null)}}},b=!Array.isArray(e)||e.length===0,a=g.useMemo(()=>Array.isArray(e)?[...e].sort((i,x)=>{const c=["cancelled","auto_cancelled"].includes(i.status),v=["cancelled","auto_cancelled"].includes(x.status);return c&&!v?1:!c&&v?-1:0}):[],[e]);return b?s.jsxs(P,{className:"border-dashed border-slate-200",children:[s.jsx(B,{children:s.jsx(E,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),s.jsx(Y,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2",children:a.map(i=>s.jsx(X,{request:i,onCancel:u,onOpenDetail:x=>m(x),isCancelling:f===i.id},i.id))}),h&&s.jsx(O,{request:h,onClose:()=>m(null),onUpdated:r,userRole:"student"}),s.jsx(V,{show:p,onClose:()=>{o(!1),l(null)},onConfirm:j,title:"Cancel Supervision Request",message:`Are you sure you want to withdraw your supervision request${(_=t==null?void 0:t.academician)!=null&&_.full_name?` to ${t.academician.full_name}`:""}? This action cannot be undone.`,confirmButtonText:"Yes, Cancel Request"})]})}function X({request:e,onCancel:r,onOpenDetail:N,isCancelling:f}){var b;const n=(e==null?void 0:e.academician)??{},h=((b=n.university)==null?void 0:b.name)??null,m=n.full_name??"Supervisor",p=n.profile_picture?`/storage/${n.profile_picture}`:null,o=n.url||null,t=M[e==null?void 0:e.status]??M.pending,l=H[e==null?void 0:e.status]??"Pending supervisor response",u=e!=null&&e.submitted_at?z(new Date(e.submitted_at),"dd/MM/yyyy"):"—",j=e!=null&&e.submitted_at?G(new Date(e.submitted_at),{addSuffix:!0}):null;return s.jsxs("div",{className:"border rounded-xl p-4 sm:p-5 bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer min-h-[300px] sm:min-h-[320px] flex flex-col",onClick:()=>N(e),children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[s.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[o?s.jsx(R,{href:route("academicians.show",o),className:"flex-shrink-0",onClick:a=>a.stopPropagation(),children:s.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden hover:ring-2 hover:ring-indigo-300 transition-all cursor-pointer",children:p?s.jsx("img",{src:p,alt:m,className:"w-full h-full object-cover rounded-full"}):s.jsx(k,{className:"w-5 h-5 text-indigo-600"})})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 border border-indigo-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:p?s.jsx("img",{src:p,alt:m,className:"w-full h-full object-cover rounded-full"}):s.jsx(k,{className:"w-5 h-5 text-indigo-600"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[o?s.jsx(R,{href:route("academicians.show",o),onClick:a=>a.stopPropagation(),children:s.jsx("h3",{className:"text-sm sm:text-[1.05rem] font-semibold text-gray-900 leading-snug truncate hover:text-indigo-600 transition-colors cursor-pointer",children:m})}):s.jsx("h3",{className:"text-sm sm:text-[1.05rem] font-semibold text-gray-900 leading-snug truncate",children:m}),h&&s.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate font-normal",children:h}),j&&s.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 mt-0.5",children:j})]})]}),s.jsx(d,{className:`${t.className} flex-shrink-0 text-[10px] sm:text-xs`,children:((e==null?void 0:e.status)??"pending").split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")})]}),s.jsx("div",{className:"mt-3 sm:mt-4",children:s.jsx("h4",{className:"text-sm sm:text-base font-semibold text-slate-900 line-clamp-2 leading-snug",children:(e==null?void 0:e.proposal_title)??"Supervision request"})}),s.jsxs("div",{className:"mt-2 min-h-[60px] sm:min-h-[72px] space-y-2",children:[(e==null?void 0:e.status)==="rejected"&&s.jsxs(s.Fragment,{children:[(e==null?void 0:e.cancel_reason)&&s.jsx("div",{className:"p-2 rounded-md bg-red-50 border border-red-100",children:s.jsxs("div",{className:"text-xs text-red-900",children:[s.jsx("span",{className:"font-semibold",children:"Reason:"})," ",L(e.cancel_reason)]})}),(e==null?void 0:e.recommended_supervisors)&&e.recommended_supervisors.length>0&&s.jsxs(d,{className:"bg-indigo-100 text-indigo-700 border-indigo-200",children:[s.jsx($,{className:"h-3 w-3 mr-1"}),e.recommended_supervisors.length," supervisor(s) recommended"]})]}),(e==null?void 0:e.status)==="pending"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-2 rounded-md bg-amber-50 border border-amber-100",children:s.jsxs("div",{className:"text-xs text-amber-900 flex items-center gap-1.5",children:[s.jsx(w,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:l})]})}),s.jsxs(d,{className:"bg-blue-50 text-blue-700 border-blue-200",children:[s.jsx(U,{className:"h-3 w-3 mr-1"}),"You can message the supervisor while waiting"]})]}),(e==null?void 0:e.status)==="pending_student_acceptance"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-2 rounded-md bg-blue-50 border border-blue-100",children:s.jsxs("div",{className:"text-xs text-blue-900 flex items-center gap-1.5",children:[s.jsx(C,{className:"w-3.5 h-3.5"}),s.jsx("span",{className:"font-medium",children:"Offer received! Review and respond to this supervisor's offer."})]})}),s.jsxs(d,{className:"bg-amber-50 text-amber-700 border-amber-200",children:[s.jsx(w,{className:"h-3 w-3 mr-1"}),"Action required - respond to offer"]})]}),(e==null?void 0:e.status)==="accepted"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-2 rounded-md bg-green-50 border border-green-100",children:s.jsxs("div",{className:"text-xs text-green-900 flex items-center gap-1.5",children:[s.jsx(C,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:l})]})}),s.jsxs(d,{className:"bg-indigo-50 text-indigo-700 border-indigo-200",children:[s.jsx(F,{className:"h-3 w-3 mr-1"}),"View full supervision details"]})]}),(e==null?void 0:e.status)==="cancelled"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-2 rounded-md bg-slate-50 border border-slate-100",children:s.jsxs("div",{className:"text-xs text-slate-600 flex items-center gap-1.5",children:[s.jsx(y,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:l})]})}),s.jsx(d,{className:"bg-slate-100 text-slate-600 border-slate-200",children:"You can submit a new request to this supervisor"})]}),(e==null?void 0:e.status)==="auto_cancelled"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-2 rounded-md bg-slate-50 border border-slate-100",children:s.jsxs("div",{className:"text-xs text-slate-600 flex items-center gap-1.5",children:[s.jsx(y,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:l})]})}),s.jsx(d,{className:"bg-slate-100 text-slate-600 border-slate-200",children:"Cancelled when you accepted another supervisor"})]})]}),s.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(w,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:u})]}),(e==null?void 0:e.attachments)&&e.attachments.length>0&&s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(F,{className:"w-3.5 h-3.5"}),s.jsxs("span",{children:[e.attachments.length," file",e.attachments.length!==1?"s":""]})]}),(e==null?void 0:e.conversation_id)&&s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(U,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"Conversation active"})]})]})]}),s.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 pt-3 sm:pt-4 border-t",children:[s.jsxs(S,{variant:"outline",size:"sm",className:"flex-1 text-xs sm:text-sm",onClick:a=>{a.stopPropagation(),N(e)},children:[s.jsx(C,{className:"mr-1.5 sm:mr-2 h-3.5 w-3.5 sm:h-4 sm:w-4"}),"View Details"]}),(e==null?void 0:e.status)==="pending"&&s.jsx(S,{variant:"outline",size:"sm",disabled:f,onClick:a=>{a.stopPropagation(),r==null||r(e)},className:"text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",children:f?s.jsx(I,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}):s.jsx(y,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]})}export{Se as default};
