import{q as me,r as n,a as G,j as e,y as xe}from"./app-DycluJDi.js";import{c as _}from"./index-CRoFkAwq.js";import{O as ue,S as ve}from"./modalAnimations-CCENKliM.js";import{g as he,f as pe,a as fe}from"./supervisionHelpers-EJT0WNFw.js";import{T as H,a as $,b as d,c as m}from"./tabs--JuXotzZ.js";import{B as b}from"./button-DrpbBg5w.js";import{B as X}from"./badge-7bhQenKW.js";import{A as K,a as Q}from"./avatar-DLxWZnV0.js";import{S as T}from"./scroll-area-DStNuix4.js";import{T as be}from"./textarea-CSq6H5gP.js";import{T as je,a as Ne,b as ge,c as z}from"./tooltip-Bjh7jqzi.js";import we from"./ScheduleMeetingDialog-DxmMlWVk.js";import ye from"./UnbindRequestModal-Dh6S40t4.js";import Se from"./ResearchTab-DgcBBqsq.js";import _e from"./DocumentsTab-BPlP3H6g.js";import{T as J}from"./ThreadPane-B59ibpsg.js";import Te from"./UnifiedOverviewTab-Hu8ps4s-.js";import{R as Re}from"./RelationshipHistoryTab-BiwPbhVH.js";import{l as R}from"./logError-D4ezqrCx.js";import{A as Ce}from"./index-D2lR-Ixd.js";import{m as U}from"./proxy-BQWTDGOX.js";import{X as Ae}from"./x-DMdqOVgw.js";import{C as Z}from"./calendar-B99WzEhS.js";import{V as Me}from"./video-BDzp7SjL.js";import{U as ke}from"./user-minus-Dy6Dt6Xk.js";import{E as Ie}from"./external-link-C7oBCvIe.js";import{L as k}from"./loader-circle-DBMiS7kS.js";import{U as Y}from"./user-round-D0HJxKcP.js";import{G as De}from"./graduation-cap-D5C30QRj.js";import{G as Oe}from"./globe-VmxN95cK.js";import{S as W}from"./sticky-note-O8t9pa_K.js";import{T as qe}from"./trash-2-B8Zt6fdt.js";import{f as ee}from"./format-Dv9Rm441.js";import"./index-CQUljECt.js";import"./index-Cyyfgiou.js";import"./index-0qH_eg9b.js";import"./index-3QGgbkx-.js";import"./index-DhTYVmtt.js";import"./index-TfP-1Own.js";import"./index-C_G9iF1W.js";import"./index-D7eWovwz.js";import"./utils-D-KgF5mV.js";import"./index-CGrAONsN.js";import"./index-BdQq_4o_.js";import"./index-CjkJyM6P.js";import"./index-MS7JGIS8.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-DygBQkXJ.js";import"./index-Bf3MYqwD.js";import"./Modal-B5RxEfWL.js";import"./dialog-BhLoydV6.js";import"./transition-CPF_n0Aj.js";import"./input-DGTuyCNK.js";import"./label-DymNAe9a.js";import"./alert-DSLdBZdj.js";import"./useGoogleCalendar-B8hZgA0d.js";import"./createLucideIcon-D0KJwFBT.js";import"./en-US-DNUEYIb-.js";import"./triangle-alert-CJCKiVvc.js";import"./separator-VuB0UWa5.js";import"./plus-DH2wwcTw.js";import"./circle-check-DBw7ke1n.js";import"./circle-Cf-nDHgh.js";import"./select-CATK_wLT.js";import"./index-BsSxmoif.js";import"./tslib.es6-CmEaCU22.js";import"./index-DbGR7Odn.js";import"./chevron-down-CWxqwc3h.js";import"./chevron-up-Ba7z8PNf.js";import"./check-B8VjmKe5.js";import"./DocumentPreviewModal-BpVXpdNe.js";import"./file-text-CM_fgsBl.js";import"./download-BSCvsIuy.js";import"./upload-CkFes5p6.js";import"./chevron-right-Ccsl5LyU.js";import"./folder-open-Bgm5Yl-Q.js";import"./eye-Dwc4GoVS.js";import"./history-C-nHJ_-o.js";import"./AttachmentPreviewModal-o5AETYTO.js";import"./isSameDay-Dm-A-V7S.js";import"./briefcase-B4GBZk0m.js";import"./mail-vd1JXS-x.js";import"./phone-Cz2eoHVX.js";import"./calendar-clock-CmwHfodY.js";import"./circle-alert-C0Kb6UEK.js";import"./users-B5watpD6.js";function pt({relationship:s,onClose:c,onUpdated:t}){var V;const{auth:i}=me().props,x=(s==null?void 0:s.preferred_tab)||"overview",[u,v]=n.useState(x),[h,a]=n.useState(!1),[N,p]=n.useState(!1);n.useEffect(()=>{s!=null&&s.preferred_tab&&v(s.preferred_tab)},[s==null?void 0:s.preferred_tab]);const[g,w]=n.useState([]),[y,I]=n.useState(""),[D,O]=n.useState(!1),[q,E]=n.useState(null),[se,P]=n.useState([]),[te,L]=n.useState(!0);n.useEffect(()=>{s!=null&&s.id&&(ae(),re())},[s==null?void 0:s.id]);const ae=async()=>{var r;if(s!=null&&s.id)try{const o=await G.get(route("supervision.relationships.show",s.id));w(((r=o.data.data)==null?void 0:r.notes)||[])}catch(o){R(o,"SupervisorRelationshipDetailModal loadNotes")}},re=async()=>{if(s!=null&&s.student_id){L(!0);try{const o=(await G.get("/api/v1/app/supervision/relationships",{params:{student_id:s.student_id}})).data.data||[],B=o.find(j=>j.role==="main"&&j.status==="active"),de=o.filter(j=>j.role==="co"&&j.status==="active"),M=[];B&&M.push(B),M.push(...de),P(M)}catch(r){R(r,"SupervisorRelationshipDetailModal loadSupervisors"),P([])}finally{L(!1)}}},ie=async()=>{if(!(!y.trim()||D)){O(!0);try{_.success("Note added"),I("")}catch(r){R(r,"SupervisorRelationshipDetailModal handleAddNote"),_.error("Failed to add note")}finally{O(!1)}}},le=async r=>{if(!q){E(r);try{_.success("Note deleted")}catch(o){R(o,"SupervisorRelationshipDetailModal handleDeleteNote"),_.error("Failed to delete note")}finally{E(null)}}},oe=()=>{xe.visit(route("supervision.relationships.show",s.id))};if(!s)return null;const l=(s==null?void 0:s.student)??{},C=l.full_name??"Student",F=l.profile_picture?`/storage/${l.profile_picture}`:null,S=s.status??"active",A=s.activeUnbindRequest?"pending_unbind":S,f=S==="active"&&!s.activeUnbindRequest,ne=he(C),ce=A==="pending_unbind"?"Pending Unbind":pe(A);return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{children:e.jsx(U.div,{...ue,className:"fixed inset-0 z-40 flex items-center justify-end bg-black/50",onClick:c,children:e.jsxs(U.div,{...ve,className:"w-full max-w-3xl h-full bg-white shadow-xl overflow-hidden flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(K,{className:"h-12 w-12",children:F?e.jsx("img",{src:F,alt:C,className:"h-full w-full object-cover"}):e.jsx(Q,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:ne})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:C}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Student Â· ",s.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-2",children:e.jsx(X,{className:`${fe(A)} border`,children:ce})})]})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(Ae,{className:"h-5 w-5 text-slate-500"})})]})}),e.jsxs("div",{className:"px-6 py-4 border-b bg-slate-50",children:[f&&e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs(b,{variant:"outline",className:"flex-1",onClick:()=>a(!0),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(b,{className:"flex-1 bg-slate-900 hover:bg-slate-800",disabled:!(s!=null&&s.meetings)||s.meetings.length===0||!((V=s.meetings[0])!=null&&V.location_link),onClick:()=>{var o;const r=(o=s==null?void 0:s.meetings)==null?void 0:o[0];r!=null&&r.location_link&&window.open(r.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Join Meeting"]})]}),e.jsxs("div",{className:"flex gap-3",children:[f&&e.jsx(je,{children:e.jsxs(Ne,{children:[e.jsx(ge,{asChild:!0,children:e.jsx("div",{className:"flex-1",children:e.jsxs(b,{variant:"outline",className:"w-full border-red-300 text-red-700 hover:bg-red-50",onClick:()=>p(!0),disabled:s.activeUnbindRequest||S!=="active",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),s.activeUnbindRequest&&e.jsx(z,{children:e.jsx("p",{children:"Unbind request pending student approval"})}),S!=="active"&&!s.activeUnbindRequest&&e.jsx(z,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})}),e.jsxs(b,{variant:"outline",className:f?"flex-1":"w-full",onClick:oe,children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Show Full Page"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(H,{value:u,onValueChange:v,className:"h-full flex flex-col",children:[e.jsxs($,{className:"px-6 bg-gray-100 w-full justify-start rounded-none h-auto p-0 gap-0",children:[e.jsx(d,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Overview"}),e.jsx(d,{value:"supervisors",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Supervisors"}),e.jsx(d,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Research"}),e.jsx(d,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Documents"}),e.jsx(d,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Chat"}),e.jsx(d,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Notes"}),e.jsx(d,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(m,{value:"overview",className:"mt-0 h-full",children:e.jsx(T,{className:"h-full",children:e.jsx(Te,{relationship:s,person:l,userRole:"supervisor",activeUnbindRequest:s.activeUnbindRequest})})}),e.jsx(m,{value:"supervisors",className:"mt-0 h-full",children:e.jsx(T,{className:"h-full",children:e.jsx(Ee,{supervisors:se,loading:te})})}),e.jsx(m,{value:"research",className:"mt-0 h-full",children:e.jsx(Se,{relationship:s,onUpdated:t,isReadOnly:!f})}),e.jsx(m,{value:"documents",className:"mt-0 h-full",children:e.jsx(_e,{relationship:s,onUpdated:t,isReadOnly:!f})}),e.jsx(m,{value:"chat",className:"mt-0 h-full",children:e.jsxs(H,{defaultValue:"direct",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 py-2 border-b bg-slate-50",children:e.jsxs($,{className:"bg-white border border-slate-200",children:[e.jsx(d,{value:"direct",className:"flex-1",children:"Direct Message"}),e.jsx(d,{value:"group",className:"flex-1",disabled:!(l!=null&&l.supervision_group_conversation_id),children:"Team Chat"})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(m,{value:"direct",className:"mt-0 h-full",children:s!=null&&s.conversation_id?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(J,{conversationId:s.conversation_id,auth:i,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>t==null?void 0:t()})})}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No direct conversation available yet."})})})}),e.jsx(m,{value:"group",className:"mt-0 h-full",children:l!=null&&l.supervision_group_conversation_id?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(J,{conversationId:l.supervision_group_conversation_id,auth:i,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>t==null?void 0:t()})})}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:"No Team Chat Yet"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Team chat will be created when the first co-supervisor joins"})]})})})]})]})}),e.jsx(m,{value:"notes",className:"mt-0 h-full",children:e.jsx(T,{className:"h-full",children:e.jsx(Pe,{notesList:g,newNote:y,setNewNote:I,isAddingNote:D,isDeletingNoteId:q,onAddNote:ie,onDeleteNote:le,isReadOnly:!f})})}),e.jsx(m,{value:"history",className:"mt-0 h-full",children:e.jsx(T,{className:"h-full",children:e.jsx(Re,{relationship:s})})})]})]})})]})})}),e.jsx(we,{relationship:h?s:null,onClose:()=>a(!1),onScheduled:()=>{a(!1),t==null||t()},userRole:"supervisor"}),e.jsx(ye,{isOpen:N,relationship:s,onClose:()=>p(!1),onUnbindInitiated:()=>{p(!1),c==null||c(),t==null||t()},userRole:"supervisor"})]})}function Ee({supervisors:s,loading:c}){return c?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-indigo-600"})})}):s.length===0?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"border border-slate-200 rounded-lg p-8 bg-slate-50 text-center",children:[e.jsx(Y,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No Supervisors"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No supervisors assigned to this student yet."})]})}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Supervisors (",s.length,")"]})}),e.jsx("div",{className:"grid gap-4",children:s.map(t=>{var g,w;const i=t.academician||{},x=i.full_name||"Supervisor",u=i.profile_picture?`/storage/${i.profile_picture}`:null,v=x.split(" ").map(y=>y[0]).join("").toUpperCase().slice(0,2),h=t.role==="main"?"Main Supervisor":"Co-Supervisor",a=((g=i.university)==null?void 0:g.name)||((w=i.university)==null?void 0:w.full_name)||"",N=i.department||"",p=i.current_position||"";return e.jsx("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(K,{className:"h-14 w-14 flex-shrink-0",children:u?e.jsx("img",{src:u,alt:x,className:"h-full w-full object-cover"}):e.jsx(Q,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:v})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-base font-semibold text-slate-900 truncate",children:x}),e.jsx(X,{className:t.role==="main"?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-slate-100 text-slate-700 border-slate-200",children:h})]})}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[p&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(De,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:p})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Oe,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:a})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Y,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:N})]}),t.accepted_at&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs mt-2",children:[e.jsx(Z,{className:"h-3.5 w-3.5 flex-shrink-0"}),e.jsxs("span",{children:["Since ",ee(new Date(t.accepted_at),"dd MMM yyyy")]})]})]})]})]})},t.id)})})]})}function Pe({notesList:s,newNote:c,setNewNote:t,isAddingNote:i,isDeletingNoteId:x,onAddNote:u,onDeleteNote:v,isReadOnly:h}){return e.jsxs("div",{className:"p-6 space-y-6",children:[!h&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(be,{rows:4,value:c,onChange:a=>t(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(b,{onClick:u,disabled:!c.trim()||i,children:[i&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",s.length,")"]}),s.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(W,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?ee(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!h&&e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>v(a.id),disabled:x===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:x===a.id?e.jsx(k,{className:"h-4 w-4 animate-spin"}):e.jsx(qe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{pt as default};
