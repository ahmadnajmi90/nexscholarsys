import{j as e,r as i,a as T,b as O,Y as X}from"./app-BEZ7ddVX.js";import{M as Z}from"./MainLayout-BSRh9N1z.js";import{F as Y}from"./FilterDropdown-DlNNe3De.js";import{J as V,r as ee,s as se,t as te,F as ae,u as re,q as le,G as ie,U as ne,V as H,w as J,a as ce}from"./index-mEQB_1VX.js";import"./index-Dco1qhq7.js";import{R as oe}from"./RecommendationModal-Comb4ao8.js";import{R as de}from"./RecommendationDisplay-BEWKzyf3.js";import{B as me}from"./BookmarkButton-B55UPydJ.js";import{u as he}from"./useRoles-XJXTLU8u.js";import"./analytics-B60H_cQS.js";import"./react-select.esm-CcI930mO.js";const ue=({score:s,showDetails:S=!1})=>{const u=parseFloat(s),y=!isNaN(u)&&u>=0&&u<=1?u:.5,o=Math.round(y*100),j=d=>d<.3?"bg-red-500":d<.5?"bg-orange-500":d<.7?"bg-yellow-500":d<.9?"bg-green-500":"bg-emerald-500",b=d=>d<.3?"Poor Match":d<.5?"Fair Match":d<.7?"Good Match":d<.9?"Great Match":"Excellent Match";return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs",children:[e.jsx("span",{className:"font-medium text-gray-700",children:b(y)}),e.jsxs("span",{className:"font-bold",children:[o,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-1",children:e.jsx("div",{className:`h-2.5 rounded-full ${j(y)}`,style:{width:`${o}%`}})}),S&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Query match:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(y*.6*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Profile match:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(y*.4*100),"%"]})]})]})]})},xe=({profile:s,universitiesList:S,faculties:u,users:y,researchOptions:o,aiInsights:j,searchQuery:b})=>{var D,L,Q;const[d,h]=i.useState(!1),[w,p]=i.useState(!1),[r,x]=i.useState(null),[v,l]=i.useState(!1),[t,c]=i.useState(j),[g,n]=i.useState(!1),[f,M]=i.useState(!1),z=()=>{p(!0),O.get(route("academicians.quick-info",s.academician_id)).then(a=>{a.data&&a.data.academician?(x({...s,...a.data.academician,projects_count:a.data.projects_count||0,grants_count:a.data.grants_count||0,publications_count:a.data.publications_count||0}),h(!0),b&&I()):(x(s),h(!0)),p(!1)}).catch(a=>{console.error("Error fetching academician detail:",a),x(s),h(!0),p(!1)})},I=()=>{n(!0),O.post(route("supervisor.insights"),{academician_id:s.academician_id,query:b}).then(a=>{a.data&&a.data.insight&&c(a.data.insight),n(!1)}).catch(a=>{console.error("Error fetching detailed insights:",a),n(!1)})},G=a=>{a.preventDefault(),l(!0)},R=()=>{l(!1)},W=()=>(r==null?void 0:r.grants_count)||0,U=()=>(r==null?void 0:r.projects_count)||0,q=()=>(r==null?void 0:r.publications_count)||0;return console.log("Supervisor Profile Data:",s),e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-[10px] font-semibold px-2.5 py-0.5 rounded-full",children:((D=S.find(a=>a.id===s.university))==null?void 0:D.short_name)||"Unknown University"}),s.match_score&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("div",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold",children:[Math.round(s.match_score*100),"% Match"]})}),e.jsx("div",{className:"h-32",children:e.jsx("img",{src:s.background_image!==null?`/storage/${s.background_image}`:"/storage/profile_background_images/default.jpg",alt:"Banner",className:"object-cover w-full h-full"})}),e.jsx("div",{className:"flex justify-center -mt-12",children:e.jsxs("div",{className:"relative w-24 h-24",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg",children:e.jsx("img",{src:s.profile_picture!==null?`/storage/${s.profile_picture}`:"/storage/profile_pictures/default.jpg",alt:"Profile",className:"w-full h-full object-cover"})}),s.verified===1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-white p-1 rounded-full group cursor-pointer shadow-md",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-blue-500 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute bottom-8 right-0 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 shadow-lg z-10 w-48",children:["This account is verified by ",((L=S.find(a=>a.id===s.university))==null?void 0:L.full_name)||"Unknown University"]})]})]})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h2",{className:"text-lg font-semibold truncate px-6",children:s.full_name}),e.jsx("p",{className:"text-gray-500 text-sm px-6",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",minHeight:"2.5rem"},children:Array.isArray(s.research_expertise)&&s.research_expertise.length>0?(()=>{const a=s.research_expertise[0],k=o.find(F=>`${F.field_of_research_id}-${F.research_area_id}-${F.niche_domain_id}`===a);return k?`${k.field_of_research_name} - ${k.research_area_name} - ${k.niche_domain_name}`:"Unknown"})():"No Field of Research or Expertise"}),e.jsx("p",{className:"text-gray-500 text-sm",children:s.current_position?s.current_position:"No Position"}),s.match_score&&e.jsx("div",{className:"mt-3 px-4",children:e.jsx(ue,{score:s.match_score,showDetails:!1})}),j&&e.jsxs("div",{className:"mt-3 px-4 py-2 bg-blue-50 mx-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-1 justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-blue-700 flex items-center",children:[e.jsx(V,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),e.jsx("button",{onClick:()=>M(!f),className:"text-blue-600 text-xs hover:underline",children:f?"Show less":"Show more"})]}),e.jsx("p",{className:`text-xs text-gray-700 text-left ${f?"h-auto":"h-16 overflow-y-auto"} pr-1`,children:j})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx("button",{onClick:z,className:"bg-blue-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-blue-600",children:"Quick Info"}),e.jsx(T,{href:route("academicians.show",s.url),className:"bg-green-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-green-600",children:"Full Profile"})]})]}),e.jsxs("div",{className:"flex justify-around items-center mt-6 py-4 border-t px-10",children:[e.jsx("a",{href:"#",className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Add Friend",children:e.jsx(ee,{className:"text-lg"})}),e.jsx(T,{href:route("email.compose",{to:(Q=y.find(a=>a.unique_id===s.academician_id))==null?void 0:Q.email}),className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Send Email",children:e.jsx(se,{className:"text-lg"})}),e.jsx("a",{href:"#",onClick:a=>G(s),className:"text-gray-500 text-lg hover:text-yellow-500",title:"Recommend",children:e.jsx(te,{className:"text-lg"})}),e.jsx(me,{bookmarkableType:"academician",bookmarkableId:s.id,category:"Academicians",iconSize:"text-lg",tooltipPosition:"top"})]}),d&&r&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>h(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-lg relative max-h-[80vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[w?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Loading academician information..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-800 ",children:r.full_name}),e.jsx("hr",{className:"border-t border-gray-800 mb-4"}),b&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-800 mb-2 flex items-center",children:[e.jsx(V,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),g?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Generating detailed insights..."})]}):e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:t})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Short Bio"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:r.bio||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Research Expertise"}),e.jsx("div",{className:"",children:(()=>{let a=r.research_expertise||[];return Array.isArray(a)&&a.length>0?e.jsx("div",{className:"space-y-2",children:a.map((k,F)=>{const B=o.find($=>`${$.field_of_research_id}-${$.research_area_id}-${$.niche_domain_id}`===k);return B?e.jsxs("p",{className:"text-gray-600",children:[F+1,". ",B.field_of_research_name," - ",B.research_area_name," - ",B.niche_domain_name]},F):null})}):e.jsx("p",{className:"text-gray-600",children:"Not Provided"})})()})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Style of Supervision"}),e.jsx("div",{className:"space-y-2",children:Array.isArray(r.style_of_supervision)&&r.style_of_supervision.length>0?e.jsx("div",{className:"mt-2 text-normal text-gray-600",children:r.style_of_supervision.map((a,k)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"font-medium",children:[k+1,". ",a]}),e.jsxs("div",{className:"ml-4 text-sm",children:[a==="Directive Supervision"&&"Structured approach with active guidance and regular monitoring",a==="Facilitative Supervision"&&"Supportive approach encouraging student independence",a==="Coaching Supervision"&&"Focuses on personal development and academic growth",a==="Adaptive Supervision"&&"Flexible support based on student's changing needs",a==="Participatory Supervision"&&"Collaborative approach with shared decision-making"]})]},k))}):e.jsx("p",{className:"text-gray-600",children:"Not Specified"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Supervised Student"}),e.jsx("p",{className:"text-gray-600",children:r.supervised_students_count||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Available Grant and Project"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[W()+U()," Projects/Grants"]}),e.jsxs(T,{href:route("academicians.projects",r.url),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Projects"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Publication"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[q()," Publications"]}),e.jsxs(T,{href:route("academicians.publications",r.url),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Publications"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Recommendation by Others"}),e.jsx(de,{academicianId:r.academician_id})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Connect via"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("a",{href:r.google_scholar,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-red-700",title:"Google Scholar",children:e.jsx(ae,{})}),e.jsx("a",{href:r.website,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-green-700",title:"Website",children:e.jsx(re,{})}),e.jsx("a",{href:r.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-blue-800",title:"LinkedIn",children:e.jsx(le,{})})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>h(!1),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:"Close"})})]})}),v&&e.jsx(oe,{academician:s,onClose:()=>l(!1),onSuccess:R})]})},ge=({onQueryChange:s,initialQuery:S="",researchOptions:u,placeholder:y="e.g., Artificial Intelligence in Healthcare, Design Science Research...",onEnterPress:o=null})=>{const[j,b]=i.useState(S),[d,h]=i.useState(!1),[w,p]=i.useState([]),r=i.useRef(null);i.useEffect(()=>{function t(c){r.current&&!r.current.contains(c.target)&&h(!1)}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[r]),i.useEffect(()=>{if(u&&u.length>0){const t=new Set;u.forEach(g=>{g.field_of_research_name&&t.add(g.field_of_research_name),g.research_area_name&&t.add(g.research_area_name),g.niche_domain_name&&t.add(g.niche_domain_name)});const c=Array.from(t).slice(0,15);p(c)}},[u]);const x=t=>{const c=t.target.value;b(c),s(c)},v=t=>{t.key==="Enter"&&o&&(t.preventDefault(),o())},l=t=>{const c=j?`${j}, ${t}`:t;b(c),s(c),h(!1)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:j,onChange:x,onKeyDown:v,placeholder:y,className:"w-full px-4 py-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>h(!0)}),j&&e.jsx("button",{className:"absolute right-10 top-4 text-gray-400 hover:text-gray-600",onClick:()=>{b(""),s("")},children:e.jsx(ie,{})})]}),d&&w.length>0&&e.jsxs("div",{ref:r,className:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 absolute z-20 w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(V,{className:"text-yellow-500 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Suggested research terms"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((t,c)=>e.jsxs("button",{className:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center",onClick:()=>l(t),children:[e.jsx(ne,{className:"mr-1 text-xs text-gray-500"}),t]},c))}),e.jsx("button",{className:"mt-2 text-xs text-gray-500 hover:text-gray-700",onClick:()=>h(!1),children:"Close suggestions"})]})]})},fe=({onSearch:s,researchOptions:S,isSearching:u=!1,initialQuery:y=""})=>{const[o,j]=i.useState(y),[b,d]=i.useState([]),[h,w]=i.useState(!1),[p,r]=i.useState(null),x=i.useRef(null);i.useEffect(()=>{function n(f){x.current&&!x.current.contains(f.target)&&w(!1)}return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[x]),i.useEffect(()=>{try{const n=localStorage.getItem("supervisor_recent_searches");if(n){const f=JSON.parse(n);Array.isArray(f)&&d(f.slice(0,5))}}catch(n){console.error("Error loading recent searches:",n)}},[]);const v=n=>{try{if(n&&n.trim().length>0){const f=[n,...b.filter(M=>M!==n)].slice(0,5);d(f),localStorage.setItem("supervisor_recent_searches",JSON.stringify(f))}}catch(f){console.error("Error saving recent search:",f)}},l=n=>{if(n.preventDefault(),o.trim().length<3){r("Please enter at least 3 characters to search");return}r(null),v(o),s(o)},t=n=>{j(n),r(null)},c=n=>{j(n),s(n),w(!1)},g=()=>{if(o.trim().length<3){r("Please enter at least 3 characters to search");return}r(null),v(o),s(o)};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Find Your Perfect Research Supervisor"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Enter your research interest, topic, or field of study below and we'll match you with supervisors who have relevant expertise."})]}),e.jsxs("form",{onSubmit:l,className:"mb-8",children:[e.jsxs("div",{className:"relative flex",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(ge,{onQueryChange:t,initialQuery:o,researchOptions:S,onEnterPress:g,placeholder:"e.g., Artificial Intelligence in Healthcare, Design Science Research..."})}),e.jsx("div",{className:"absolute right-20 top-4 z-10",children:e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700",onClick:()=>w(!h),title:"Recent searches",children:e.jsx(H,{})})}),e.jsx("button",{type:"submit",className:`bg-blue-600 text-white px-6 py-3 rounded-r-lg flex items-center justify-center ${u?"opacity-70 cursor-not-allowed":"hover:bg-blue-700"}`,disabled:u,children:u?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx(J,{})}),h&&b.length>0&&e.jsx("div",{ref:x,className:"absolute top-12 right-0 mt-2 w-full md:w-72 bg-white border border-gray-200 rounded-md shadow-lg z-30",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(H,{className:"mr-2 text-gray-500"})," Recent Searches"]}),e.jsx("ul",{className:"space-y-1",children:b.map((n,f)=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded",onClick:()=>c(n),children:n})},f))})]})})]}),p&&e.jsx("p",{className:"text-red-500 mt-2 text-center",children:p})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 pt-10",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(V,{className:"text-yellow-500 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Tips for finding the right supervisor"})]}),e.jsxs("ol",{className:"space-y-3 text-gray-600 list-decimal list-inside",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5 flex-shrink-0",children:"1"}),e.jsx("span",{children:'Be specific about your research area (e.g., "Machine Learning for Medical Imaging" rather than just "AI")'})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5 flex-shrink-0",children:"2"}),e.jsx("span",{children:'You can also use vague queries like "recommend supervisors for me" to get results based on your profile'})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5 flex-shrink-0",children:"3"}),e.jsx("span",{children:"Click on suggested research terms to quickly add them to your search"})]})]})]})]})},je=({searchResults:s,universitiesList:S,faculties:u,users:y,researchOptions:o,searchQuery:j,isSearching:b,isLoadingMore:d=!1,onLoadMore:h=()=>{}})=>{const[w,p]=i.useState([]),[r,x]=i.useState(!1),v=i.useRef(null);i.useEffect(()=>{if(s&&s.matches){p([]);const t=s.matches.slice(0,6);if(p(t),s.matches.slice(6).length>0){const g=setTimeout(()=>{p(s.matches)},300);return()=>clearTimeout(g)}}},[s]),i.useEffect(()=>{const t=new IntersectionObserver(([c])=>{x(c.isIntersecting)},{threshold:.1});return v.current&&t.observe(v.current),()=>{v.current&&t.unobserve(v.current)}},[v]),i.useEffect(()=>{r&&!d&&s&&s.has_more&&w.length>0&&h()},[r,d,s,h]);const l=t=>Array(t).fill(null).map((c,g)=>e.jsx(be,{},`skeleton-${g}`));return b&&(!s||!s.matches)?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6",children:l(6)}):s&&s.matches?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:['Supervisor Matches for "',s.query,'"']}),e.jsxs("span",{className:"text-gray-500",children:[s.total," match",s.total!==1?"es":""," found"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6",children:[w.map((t,c)=>e.jsx(xe,{profile:{...t.academician,ai_insight:t.ai_insights,research_expertise:Array.isArray(t.academician.research_expertise)?t.academician.research_expertise:[],availability_as_supervisor:t.academician.availability_as_supervisor||0,match_score:t.score},universitiesList:S,faculties:u,users:y,researchOptions:o,aiInsights:t.ai_insights,searchQuery:j},`${t.academician.id}-${c}`)),w.length<s.matches.length&&l(Math.min(3,s.matches.length-w.length))]}),s.has_more&&e.jsx("div",{ref:v,className:"mt-8 text-center py-4",children:d?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Loading more results..."]}):e.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md",onClick:h,children:"Load more results"})}),s.total===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(J,{className:"text-gray-400 text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"No matching supervisors found"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"Try broadening your search terms or exploring different research areas."})]})]}):null},be=()=>e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden relative animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200"}),e.jsx("div",{className:"flex justify-center -mt-12",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-300 border-4 border-white"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mx-auto mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6 mx-auto mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/6 mx-auto mb-4"}),e.jsxs("div",{className:"mt-3 bg-gray-100 p-3 rounded-md",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-5/6 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-100 p-4 flex justify-around",children:[e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"})]})]});function Me({auth:s,universities:S,faculties:u,users:y,researchOptions:o}){const{isAdmin:j,isPostgraduate:b,isUndergraduate:d,isFacultyAdmin:h,isAcademician:w}=he(),[p,r]=i.useState(""),[x,v]=i.useState(!1),[l,t]=i.useState(null),[c,g]=i.useState(null),[n,f]=i.useState(1),[M,z]=i.useState(!1),[I,G]=i.useState([]),[R,W]=i.useState([]),[U,q]=i.useState(""),[D,L]=i.useState(!1),Q=async _=>{if(!(x||!_||_.trim()==="")){r(_),v(!0),g(null),f(1);try{const m=await O.post(route("supervisor.search"),{query:_});if(m.data&&m.data.matches){console.log("Search results:",m.data);const P={...m.data,matches:m.data.matches.map(E=>({...E,score:E.score||.5}))};t(P)}else g("Received invalid search results")}catch(m){console.error("Search error:",m),g("Failed to perform search. Please try again later.")}finally{v(!1)}}},a=async()=>{if(M||!l||!l.has_more)return;z(!0);const _=n+1;try{const m=await O.post(route("supervisor.search"),{query:p,page:_});m.data&&m.data.matches&&(t(P=>({...m.data,matches:[...P.matches,...m.data.matches]})),f(_))}catch(m){console.error("Error loading more results:",m)}finally{z(!1)}},k=()=>!l||!l.matches?[]:l.matches.filter(_=>{const m=_.academician,P=I.length===0||Array.isArray(m.research_expertise)&&m.research_expertise.some(A=>I.includes(A)),E=m.university?m.university.toString():"",N=R.length===0||R.includes(E);let C=!0;if(U!==""){const A=m.availability_as_supervisor;C=(A===!0||A==="1"||A===1?"1":"0")===U}return P&&N&&C}),F=()=>!j&&!h||!l?null:e.jsx("div",{className:"mt-2 p-2 text-xs bg-gray-100 dark:bg-gray-800 rounded",children:e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer",children:"Search Debug Info"}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Search Method:"})," ",l.search_method==="qdrant"?"Qdrant Vector DB":"MySQL"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Total Results:"})," ",l.total]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Profile Used:"})," ",l.profile_used?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Page:"})," ",l.current_page," of ",Math.ceil(l.total/l.per_page)]}),e.jsxs("div",{className:"text-xs mt-2",children:[e.jsx("a",{href:`${window.location.pathname}?${new URLSearchParams({...Object.fromEntries(new URLSearchParams(window.location.search)),nocache:"true"})}`,className:"text-blue-500 hover:text-blue-700",children:"Clear Cache"})," | ",e.jsx("a",{href:`${window.location.pathname}?${new URLSearchParams({...Object.fromEntries(new URLSearchParams(window.location.search)),use_qdrant:"true"})}`,className:"text-blue-500 hover:text-blue-700",children:"Force Qdrant"})," | ",e.jsx("a",{href:`${window.location.pathname}?${new URLSearchParams({...Object.fromEntries(new URLSearchParams(window.location.search)),use_qdrant:"false"})}`,className:"text-blue-500 hover:text-blue-700",children:"Force MySQL"})]})]})]})}),$=(()=>{if(!l||!l.matches)return{researchAreas:[],universities:[]};const _=new Set;l.matches.forEach(N=>{Array.isArray(N.academician.research_expertise)&&N.academician.research_expertise.forEach(C=>{_.add(C)})});const m=Array.from(_).map(N=>{const C=o.find(A=>`${A.field_of_research_id}-${A.research_area_id}-${A.niche_domain_id}`===N);return C?{value:N,label:`${C.field_of_research_name} - ${C.research_area_name} - ${C.niche_domain_name}`}:{value:N,label:`${N}`}}),P=new Set;l.matches.forEach(N=>{N.academician.university&&P.add(N.academician.university.toString())});const E=Array.from(P).map(N=>{const C=S.find(A=>A.id.toString()===N);return{value:N,label:C?C.short_name:"Unknown University"}});return{researchAreas:m,universities:E}})(),K=l?{...l,matches:k(),total:k().length}:null;return e.jsxs(Z,{title:"Find a Supervisor",isPostgraduate:b,isUndergraduate:d,isFacultyAdmin:h,children:[e.jsxs(X,{children:[e.jsx("title",{children:"Find a Supervisor - Nexscholar"}),e.jsx("meta",{name:"description",content:"Search for academic supervisors based on your research interests"})]}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg",children:e.jsxs("div",{className:"p-6 pb-16",children:[e.jsx(fe,{onSearch:Q,researchOptions:o,isSearching:x,initialQuery:p}),l&&l.total>0&&e.jsx("button",{onClick:()=>L(!D),className:"fixed bottom-8 right-4 z-50 bg-blue-600 text-white p-3 rounded-full shadow-lg lg:hidden",children:e.jsx(ce,{className:"text-xl"})}),(l||x)&&e.jsxs("div",{className:"mt-10 flex flex-col lg:flex-row gap-6",children:[l&&l.total>0&&e.jsxs("div",{className:`lg:block lg:w-1/4 bg-gray-50 p-4 rounded-lg shadow-sm ${D?"block fixed inset-0 z-50 bg-white overflow-auto p-6":"hidden"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Refine Results"}),e.jsx("button",{onClick:()=>L(!1),className:"text-gray-500 hover:text-gray-700 lg:hidden",children:"✕"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{label:"Field of Research",options:$.researchAreas,selectedValues:I,setSelectedValues:G}),e.jsx(Y,{label:"University",options:$.universities,selectedValues:R,setSelectedValues:W}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mt-4 mb-2",children:"Available As Supervisor"}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 rounded",value:U,onChange:_=>q(_.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"1",children:"Yes"}),e.jsx("option",{value:"0",children:"No"})]})]}),e.jsx("div",{className:"pt-4 lg:hidden",children:e.jsx("button",{onClick:()=>L(!1),className:"w-full bg-blue-600 text-white py-2 rounded-lg",children:"Apply Filters"})})]})]}),e.jsx("div",{className:`${l&&l.total>0?"lg:w-3/4":"w-full"}`,children:e.jsx(je,{searchResults:K||l,universitiesList:S,faculties:u,users:y,researchOptions:o,searchQuery:p,isSearching:x,isLoadingMore:M,onLoadMore:a})})]}),c&&!x&&e.jsx("div",{className:"mt-6 bg-red-50 border-l-4 border-red-500 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:c})})]})}),F()]})})]})}export{Me as default};
