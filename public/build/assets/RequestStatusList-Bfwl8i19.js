import{r as h,j as s,a as S}from"./app-BBTReE8F.js";import{c as j}from"./index-DETKRDWW.js";import{l as _,L as R}from"./logError-oW9MzvDp.js";import{B as g}from"./badge-DkwRIEoU.js";import{C as u,a as C,b as w,c as y,d as k}from"./card-B1hSJJ41.js";import{B as v}from"./button-ixvmlr0Z.js";import{A as T,a as M}from"./avatar-CYqZ2d7M.js";import{S as U}from"./separator-vdhwbspH.js";import D from"./RequestDetailCard-DQacL6H8.js";import{C as B}from"./clock-3-29ZRI1oR.js";import{F as E}from"./file-text-BXRikO-E.js";import{M as F}from"./message-circle-pdK5ARC4.js";import{C as P}from"./circle-x-Bp7Z4eUP.js";import{C as I}from"./circle-check-f0pMbVnF.js";import{f as L}from"./AttachmentPreviewModal-Pt7uLtbe.js";import{f as O}from"./formatDistanceToNow-GKXiLTrL.js";import"./createLucideIcon-CgCae70q.js";import"./index-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./utils-CIsb_jhR.js";import"./index-sXqQmr82.js";import"./tabs-UJnkekSu.js";import"./index-DWTd9yJ3.js";import"./index-DWcIMZg4.js";import"./index-C-N8N723.js";import"./scroll-area-Diug1yNH.js";import"./ThreadPane-klQrrHYa.js";import"./Modal-hS6k07SS.js";import"./dialog-DznrIIDa.js";import"./transition-gNGh2Rv2.js";import"./AcceptSupervisorOfferModal-CRY2LKHM.js";import"./dialog-Ck_fDMCa.js";import"./index-BExHPb9S.js";import"./tslib.es6-BUas5LQb.js";import"./x-VXtmQtm3.js";import"./alert-D0J6Oq3_.js";import"./checkbox-CSJj9Ije.js";import"./index-C6zuVUjJ.js";import"./circle-alert-BDjs3ebC.js";import"./message-square-4cUIdegB.js";import"./calendar-BSUFKyh6.js";import"./video-BCiVphoP.js";import"./calendar-clock-CqwD-XQb.js";import"./en-US-DNUEYIb-.js";import"./constructNow-DtVD-0hX.js";const N={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},V={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function Ea({requests:a=[],reload:e,onOpenDetail:r}){const[d,n]=h.useState(null),[o,c]=h.useState(null),p=async t=>{var i,m;if(t!=null&&t.id){n(t.id);try{await S.post(route("supervision.requests.cancel",t.id)),j.success("Proposal withdrawn"),e==null||e()}catch(l){_(l,"RequestStatusList handleCancel");const A=((m=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:m.message)||"Unable to cancel your request right now";j.error(A)}finally{n(null)}}},x=!Array.isArray(a)||a.length===0,f=h.useMemo(()=>Array.isArray(a)?[...a].sort((t,i)=>{const m=["cancelled","auto_cancelled"].includes(t.status),l=["cancelled","auto_cancelled"].includes(i.status);return m&&!l?1:!m&&l?-1:0}):[],[a]);return x?s.jsxs(u,{className:"border-dashed border-slate-200",children:[s.jsx(C,{children:s.jsx(w,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),s.jsx(y,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:f.map(t=>s.jsx(Y,{request:t,onCancel:p,onOpenDetail:i=>c(i),isCancelling:d===t.id},t.id))}),o&&s.jsx(D,{request:o,onClose:()=>c(null),onUpdated:e})]})}function Y({request:a,onCancel:e,onOpenDetail:r,isCancelling:d}){const n=(a==null?void 0:a.academician)??{},o=n.full_name??"Supervisor",c=n.profile_picture?`/storage/${n.profile_picture}`:null,p=N[a==null?void 0:a.status]??N.pending,x=V[a==null?void 0:a.status]??"Pending supervisor response",f=a!=null&&a.submitted_at?L(new Date(a.submitted_at),"dd/MM/yyyy"):"—",t=a!=null&&a.submitted_at?O(new Date(a.submitted_at),{addSuffix:!0}):null;return s.jsxs(u,{className:"shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>r(a),children:[s.jsxs(C,{className:"pb-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(T,{className:"h-10 w-10",children:c?s.jsx("img",{src:c,alt:o,className:"h-full w-full object-cover"}):s.jsx(M,{className:"bg-indigo-50 text-indigo-600",children:o.slice(0,2).toUpperCase()})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-slate-800",children:o}),t&&s.jsxs("div",{className:"text-xs text-slate-500",children:["Submitted ",t]})]})]}),s.jsx(g,{className:p.className,children:((a==null?void 0:a.status)??"pending").split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")})]}),s.jsx("div",{className:"mt-3",children:s.jsx(w,{className:"text-base font-semibold text-slate-900 line-clamp-2",children:(a==null?void 0:a.proposal_title)??"Supervision request"})}),s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"text-xs text-slate-500",children:x})})]}),s.jsxs(y,{className:"space-y-4 text-sm text-slate-600",children:[s.jsx(U,{}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(b,{icon:B,label:"Submitted on",value:f}),s.jsx(b,{icon:E,label:"Motivation",value:$(a==null?void 0:a.motivation,100)})]})]}),s.jsxs(k,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[s.jsx("div",{className:"flex gap-2 text-xs text-slate-500",children:s.jsxs(g,{variant:"outline",className:"border-slate-200 text-slate-500",children:[s.jsx(F,{className:"mr-1 h-3.5 w-3.5"}),"Conversation ready"]})}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[s.jsxs(v,{variant:"outline",className:"sm:w-32",disabled:(a==null?void 0:a.status)!=="pending"||d,onClick:i=>{i.stopPropagation(),e==null||e(a)},children:[d?s.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(P,{className:"mr-2 h-4 w-4"}),"Cancel"]}),s.jsxs(v,{className:"sm:w-36",onClick:i=>{i.stopPropagation(),r(a)},children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),"View details"]})]})]})]})}function b({icon:a,label:e,value:r}){return s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(a,{className:"mt-0.5 h-4 w-4 text-slate-400"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:e}),s.jsx("div",{className:"text-sm text-slate-700",children:r||"—"})]})]})}function $(a,e){return!a||a.length<=e?a:`${a.slice(0,e)}…`}export{Ea as default};
