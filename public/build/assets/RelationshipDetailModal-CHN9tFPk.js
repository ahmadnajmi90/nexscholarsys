import{q as b,r as h,j as e}from"./app-iMgHp_eS.js";import{D as y,a as w,b as _,c as T}from"./dialog-CvesY_b2.js";import{T as k,a as C,b as S,c as x}from"./tabs-CLeBf672.js";import{B as g}from"./button-Ct11kXcH.js";import{B as A}from"./badge-DuxLTqMY.js";import{S as P}from"./separator-DqkAodAi.js";import{S as p}from"./scroll-area-Q_LSXepR.js";import{T as D}from"./ThreadPane-CINILE3j.js";import{m as o}from"./proxy-C4MdbyQL.js";import{C as E}from"./clipboard-list-DdyUkn_-.js";import{F as B}from"./file-text-C4_We7ct.js";import{C as v}from"./calendar-clock-Cu_uFgIh.js";import{H as j}from"./history-B_uv49Ly.js";import{f as u}from"./format-BOijCLBA.js";import"./index-CUVil98b.js";import"./index-ZtdpDmOR.js";import"./index-CBiZf16v.js";import"./index-CPRTWrZv.js";import"./index-CrTPggVb.js";import"./index-BF2RFu8G.js";import"./index-B_K2CkPG.js";import"./index-DGrGDkv0.js";import"./index-TSyOZiO6.js";import"./utils-CBfrqCZ4.js";import"./x-ZEpUl_jb.js";import"./createLucideIcon-BXdi-pyk.js";import"./index-Cezbbkwz.js";import"./index-DKGZNE_Q.js";import"./index-BRZqG0or.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./Modal-CtrNcR4a.js";import"./dialog-tgbUGkxp.js";import"./transition-GCCCemnQ.js";import"./download-DxUHOtTV.js";import"./index---wvTow-.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";const M=["overview","proposal","chat","meetings","history"];function Te({request:a,relationship:s,onClose:t,onUpdated:i}){const{auth:d}=b().props,[l,c]=h.useState(()=>a?.preferred_tab??"overview"),n=a?.conversation_id||s?.conversation_id,m=h.useMemo(()=>M.filter(r=>r==="chat"?!!n:!0),[n]);h.useEffect(()=>{if(!a?.preferred_tab&&!s?.preferred_tab)return;const r=a?.preferred_tab??s?.preferred_tab;r&&r!==l&&m.includes(r)&&c(r)},[a?.preferred_tab,s?.preferred_tab,m,l]);const N=r=>{c(r),r==="chat"&&n&&window?.dispatchEvent(new CustomEvent("supervision:openConversation",{detail:{conversationId:n}}))};return a?.attachments,e.jsx(y,{open:!!(a||s),onOpenChange:r=>r?null:t?.(),children:e.jsxs(w,{className:"max-h-[90vh] w-full max-w-4xl overflow-hidden p-0",children:[e.jsx(_,{className:"px-6 pb-4 pt-6",children:e.jsx(T,{className:"text-xl font-semibold",children:s?"Supervision details":"Proposal details"})}),e.jsx(P,{}),e.jsx(o.div,{className:"px-6 py-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.3},children:e.jsxs(k,{value:l,onValueChange:N,className:"space-y-4",children:[e.jsx(C,{className:"flex w-full flex-wrap gap-2 bg-transparent p-0",children:m.map(r=>e.jsx(S,{value:r,className:"rounded-full border border-slate-200 px-4",children:L[r]??r},r))}),e.jsx(x,{value:"overview",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(H,{request:a,relationship:s})})})}),e.jsx(x,{value:"proposal",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(I,{request:a})})})}),n?e.jsx(x,{value:"chat",className:"m-0",children:e.jsx(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},className:"max-h-[60vh] rounded-lg border border-slate-200",children:e.jsx(D,{conversationId:n,auth:d,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>i?.()})})}):null,e.jsx(x,{value:"meetings",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(O,{relationship:s})})})}),e.jsx(x,{value:"history",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(U,{request:a,relationship:s})})})})]})})]})})}const L={overview:"Overview",proposal:"Proposal",chat:"Conversation",meetings:"Meetings",history:"History"};function H({request:a,relationship:s}){const t=s?.academician??a?.academician,i=s?.student??a?.student,d=s?.status??a?.status??"pending",l=a?.conversation_id||s?.conversation_id,c=[{label:"Student",value:i?.full_name??"Student details unavailable",badge:i?"Postgraduate":null},{label:"Supervisor",value:t?.full_name??"Supervisor not assigned yet",badge:t?"Supervisor":null},{label:"Status",value:f(d)},{label:"Meeting cadence",value:s?.meeting_cadence?s.meeting_cadence.charAt(0).toUpperCase()+s.meeting_cadence.slice(1):"Not set"},{label:"Accepted on",value:s?.accepted_at?u(new Date(s.accepted_at),"PPP"):"Pending acceptance"},{label:"NexLab",value:s?.scholarlab_board_id?"Workspace ready":"Workspace not provisioned"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Supervision summary"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Key milestones, cadence, and workspace access."})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:c.map((n,m)=>e.jsx(W,{label:n.label,value:n.value,badge:n.badge},m))})]}),!l&&e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-700",children:"Conversation not yet active"}),e.jsx("p",{className:"mt-1",children:"Your proposal has not opened a chat thread. When a supervisor responds or you send a message, the messaging tab will appear here."})]})]})}function I({request:a}){return a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Proposal"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Submitted materials accompanying your request."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Motivation"}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-slate-700",children:a.motivation||"No motivation provided."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Attachments"}),a.attachments?.length?e.jsx("div",{className:"space-y-2",children:a.attachments.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 px-4 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 capitalize",children:s.type.replace("_"," ")}),e.jsx("div",{className:"text-xs text-slate-500",children:s.original_name})]}),e.jsx(g,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:`/storage/${s.path}`,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]},s.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No attachments were included."})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Proposal details unavailable."})}function O({relationship:a}){const s=a?.meetings??[];return s.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(v,{className:"h-4 w-4 text-indigo-500"}),"Upcoming meetings"]}),e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:u(new Date(t.scheduled_for),"PPpp")})]}),t.location_link&&e.jsx(g,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:t.location_link,target:"_blank",rel:"noopener noreferrer",children:"Join"})})]}),t.agenda&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:t.agenda})]},t.id))})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(v,{className:"h-4 w-4 text-indigo-500"}),"Meetings"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"No meetings scheduled yet. Coordinate with your supervisor to agree on a first session."}),e.jsx("div",{className:"rounded-lg border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"When meetings are scheduled they will appear here with quick links and agenda details."})})]})}function U({request:a,relationship:s}){const t=h.useMemo(()=>{const i=Array.isArray(a?.timeline)?a.timeline:[],d=Array.isArray(s?.timeline)?s.timeline:[];return[...i,...d].sort((l,c)=>new Date(l.created_at)-new Date(c.created_at))},[a?.timeline,s?.timeline]);return t.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"space-y-3",children:t.map(i=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-800 capitalize",children:f(i.event_type)}),i.created_at&&e.jsx("span",{className:"text-xs text-slate-500",children:u(new Date(i.created_at),"PPpp")})]}),i.metadata&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:i.metadata?.description??JSON.stringify(i.metadata)})]},i.id??`${i.event_type}-${i.created_at}`))})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"Timeline events will appear here as your supervision progresses. Published milestones (submitted, meetings, decisions) will stream in once backend tracking is enabled."})})]})}function f(a){return a?a.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):"Event"}function W({label:a,value:s,badge:t}){return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:a}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-slate-700",children:s}),t&&e.jsx(A,{variant:"outline",className:"border-indigo-200 text-indigo-600 text-[11px]",children:t})]})]})}export{Te as default};
