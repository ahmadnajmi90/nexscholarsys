import{q as S,r as n,W as D,y as s,j as e,b}from"./app-6KcAPae7.js";import{M as E}from"./MainLayout--yDNTBjU.js";import{C as L}from"./ConfirmationModal-B03nOwCE.js";import{M as P}from"./ManageCollaboratorsModal-DneM9edZ.js";import{L as k,M as $}from"./ManageBoardMembersModal-YUMccGyy.js";import{I as F}from"./InlineEdit-Bkq3Fzkf.js";import{p as I}from"./purify.es-9JUW7zMc.js";import{V as d}from"./index-DjCDrVl_.js";import{C as T}from"./chevron-left-Dg3HzLsn.js";import{U}from"./user-plus-DJ7EsC7u.js";import{C as _}from"./chevron-up-BOXEedZS.js";import{C as O}from"./chevron-down-ByZMo2lZ.js";import{P as A}from"./plus-TSWFZJVg.js";import{U as G}from"./users-BAT0uBt8.js";import{T as R}from"./trash-2-B4CrugC8.js";import"./house-MPKGRuPU.js";import"./createLucideIcon-Dg0NKHwN.js";import"./zap-Dc37O7Yf.js";import"./folder-open-BOmTEEi1.js";import"./settings-nBn8_I0z.js";import"./useRoles-TTN5TAPq.js";import"./proxy-6rU6RlCr.js";import"./user-round-Gn5hLxMS.js";import"./clipboard-list-CkK1RN7u.js";import"./dollar-sign-DG-1hJGs.js";import"./calendar-CKvWh2Fc.js";import"./file-text-CldtH22C.js";import"./message-square-DOAr_Oao.js";import"./graduation-cap-DsZZvawH.js";import"./building-BAo4hBJ-.js";import"./Dropdown-D9Vn_Uo-.js";import"./transition-CSwR4vyx.js";import"./sparkles-CxsEXFgy.js";import"./bookmark-CKOvIcZS.js";import"./folder-kanban-WJg5ri3Z.js";import"./building-2-BOmvfrGU.js";import"./database-CHeJJryD.js";import"./shield-Di9h5Q6c.js";import"./index-DaBARm37.js";import"./analytics-BQ374C1C.js";import"./iconBase-n0Q-2a7D.js";import"./index-Ce5Il87X.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-CBfrqCZ4.js";import"./ThreadPane-DyCNvQZd.js";import"./Modal-CJvMaQW5.js";import"./dialog-CwJFq24I.js";import"./index-JAD3o4sP.js";import"./scroll-area-CgKTi-4v.js";import"./index-C3-aQ1HP.js";import"./index-C_9bpbuH.js";import"./index-Kc-fmclX.js";import"./index-uYzWXxXP.js";import"./index-BdQq_4o_.js";import"./format-BOijCLBA.js";import"./en-US-DIdCsyf3.js";import"./button-CrdDRXAu.js";import"./download-BwAogcNS.js";import"./x-RVcZvC1Z.js";import"./isSameDay-BHs4V-zU.js";import"./constructNow-6bIQB1GK.js";import"./addDays-KHeCUDUr.js";import"./PrimaryButton-BDNKdwtj.js";import"./SecondaryButton-BMSD-Ano.js";import"./search-KJO1iUQT.js";import"./circle-check-big-DONTGj_Q.js";import"./chevron-right-BAu-tXgn.js";import"./tooltip-B6pzDCUw.js";import"./index-Cxfb7wM5.js";import"./index-4gt4wYEX.js";import"./index-CNVNpKw3.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-CSjGVC7d.js";import"./index-CANaiMod.js";import"./index-Bby0leWS.js";import"./index-Chjiymov.js";import"./dialog-RPNwQkV0.js";import"./index-BT3GCukP.js";import"./index-D5o-Dx5T.js";import"./briefcase-SOOxWO71.js";import"./user-CAcetcbZ.js";import"./triangle-alert-BSO9t9M4.js";import"./InputError-C6goN80O.js";import"./react-select.esm-Caq7p8aY.js";import"./info-DJHCwYQy.js";import"./check-yEdCv6kj.js";function V({project:r,connections:h}){const{auth:f}=S().props,[j,m]=n.useState(!1),[i,l]=n.useState(null),[y,x]=n.useState(!1),[c,w]=n.useState(!1),[p,u]=n.useState(null),a=D({name:""}),v=t=>{if(t.preventDefault(),!r||!r.data||!r.data.id){console.error("Project ID is missing, cannot create board.");return}a.post(route("project-hub.projects.boards.store",r.data.id),{onSuccess:()=>{d.success(`Board "${a.data.name}" created successfully.`),m(!1),a.reset()},onError:o=>{console.error("Error creating board:",o),d.error("Failed to create board. Please check the form for errors.")}})},N=(t,o)=>{t.preventDefault(),t.stopPropagation(),l(o)},C=()=>{i&&s.delete(route("project-hub.boards.destroy",i.id),{onSuccess:()=>{d.success(`Board "${i.name}" deleted successfully.`),l(null)},onError:t=>{console.error("Error deleting board:",t),d.error("Failed to delete board. Please try again.")}})},M=(t,o)=>{t.preventDefault(),t.stopPropagation(),u(o)},g=f.user.id===r.data.owner_id;n.useEffect(()=>{if(!r.data.id)return;console.log(`Subscribing to project channel: projects.${r.data.id}`);const t=window.Echo.private(`projects.${r.data.id}`);return t.listen(".project.updated",o=>{console.log("project.updated:",o),(o.project.name!==r.data.name||o.project.description!==r.data.description)&&s.reload({only:["project"]})}),t.listen(".project.member.added",o=>{console.log("project.member.added:",o),s.reload({only:["project"]})}),t.listen(".project.member.removed",o=>{console.log("project.member.removed:",o),s.reload({only:["project"]})}),t.listen(".board.created",o=>{console.log("board.created:",o),s.reload({only:["project"]})}),t.listen(".board.deleted",o=>{console.log("board.deleted:",o),s.reload({only:["project"]})}),t.listen(".board.member.added",o=>{console.log("board.member.added:",o),s.reload({only:["project"]})}),t.listen(".board.member.removed",o=>{console.log("board.member.removed:",o),s.reload({only:["project"]})}),()=>{console.log(`Unsubscribing from project channel: projects.${r.data.id}`),t.stopListening(".project.updated"),t.stopListening(".project.member.added"),t.stopListening(".project.member.removed"),t.stopListening(".board.created"),t.stopListening(".board.deleted"),t.stopListening(".board.member.added"),t.stopListening(".board.member.removed"),window.Echo.leave(`projects.${r.data.id}`)}},[r.data.id]);const B=t=>{s.put(route("project-hub.projects.update",r.data.id),{name:t,description:r.data.description},{preserveScroll:!0,onSuccess:()=>{d.success("Project renamed successfully.")},onError:o=>{d.error("Failed to rename project."),console.error(o)}})};return e.jsxs("div",{className:"w-full md:max-w-8xl md:mx-auto px-4 md:px-4 lg:px-2 py-4 md:py-6 lg:mt-2 mt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(b,{href:route("project-hub.index"),className:"flex items-center text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"Back to projects"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{value:r.data.name,onSave:B,canEdit:r.data.can.update,className:"text-2xl font-bold text-gray-900 truncate max-w-3xl",placeholder:"Project name"}),g&&e.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Manage Members"]})]}),r.data.description&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`mt-1 text-gray-500 max-w-3xl ${c?"":"line-clamp-2"}`,dangerouslySetInnerHTML:{__html:I.sanitize(r.data.description)}}),e.jsx("button",{onClick:()=>w(!c),className:"mt-1 text-indigo-600 hover:text-indigo-800 text-sm flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Show More"]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Boards"})}),r.data.can.create_board&&(j?e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-3",children:"Create a new board"}),e.jsxs("form",{onSubmit:v,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",value:a.data.name,onChange:t=>a.setData("name",t.target.value),className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm text-sm",placeholder:"Board name",disabled:a.processing,autoFocus:!0}),a.errors.name&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:a.errors.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),a.reset()},className:"inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-700 bg-white hover:bg-gray-50",disabled:a.processing,children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex items-center px-3 py-1.5 border border-transparent rounded-md text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-700",disabled:a.processing||!a.data.name.trim(),children:a.processing?"Creating...":"Create Board"})]})]})]}):e.jsxs("button",{type:"button",onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 mb-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Create new board"]})),r.data.boards&&r.data.boards.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.data.boards.map(t=>e.jsxs("div",{className:"relative bg-white shadow rounded-lg hover:shadow-md transition-shadow duration-200",children:[e.jsxs(b,{href:route("project-hub.boards.show",t.id),className:"block p-5",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(k,{className:"w-5 h-5 text-indigo-500 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:t.name})]}),e.jsx("div",{className:"flex items-center text-sm text-gray-500 mt-3",children:e.jsxs("span",{children:["Created ",new Date(t.created_at).toLocaleDateString("en-GB")]})})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1",children:[g&&e.jsx("button",{onClick:o=>M(o,t),className:"p-1.5 text-gray-400 hover:text-indigo-500 hover:bg-gray-100 rounded-full",title:"Manage board access",children:e.jsx(G,{className:"w-4 h-4"})}),t.can&&t.can.delete&&e.jsx("button",{onClick:o=>N(o,t),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-gray-100 rounded-full",title:"Delete board",children:e.jsx(R,{className:"w-4 h-4"})})]})]},t.id))}):e.jsx("div",{className:"bg-white shadow rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-gray-500 mb-4",children:"No boards available. Create a board to get started."})})]}),e.jsx(L,{show:!!i,onClose:()=>l(null),onConfirm:C,title:"Delete Board",message:i?`Are you sure you want to delete the board "${i.name}"? This action cannot be undone and will delete all lists and tasks within this board.`:""}),e.jsx(P,{show:y,onClose:()=>x(!1),context:r,contextType:"project",connections:h||[]}),p&&e.jsx($,{show:!!p,onClose:()=>u(null),board:p,workspaceMembers:r.data.members||[]})]})}V.layout=r=>e.jsx(E,{title:"Project Boards",children:r,TopMenuOpen:!1});export{V as default};
