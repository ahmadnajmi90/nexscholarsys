import{q as D,r as d,W as B,j as e,y}from"./app-6KcAPae7.js";import{M as V}from"./Modal-CJvMaQW5.js";import{I as C,a as P}from"./InputError-C6goN80O.js";import{P as W}from"./PrimaryButton-BDNKdwtj.js";import{S as R}from"./SecondaryButton-BMSD-Ano.js";import{C as q}from"./ConfirmationModal-B03nOwCE.js";import{c as f}from"./index-DjCDrVl_.js";import{R as Y}from"./index-JAD3o4sP.js";import{S as G}from"./react-select.esm-Caq7p8aY.js";import{I as H}from"./info-DJHCwYQy.js";const J=()=>{const[i,u]=d.useState(!1),t=d.useRef(null),o=d.useRef(null),c=()=>{if(t.current&&o.current){const g=t.current.getBoundingClientRect(),m=o.current.getBoundingClientRect();o.current.style.left=`${g.left-m.width/2+g.width/2}px`,o.current.style.top=`${g.top-m.height-10}px`}};return d.useEffect(()=>{if(i)return c(),window.addEventListener("scroll",c),window.addEventListener("resize",c),()=>{window.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[i]),{triggerProps:{ref:t,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1)},tooltipProps:{ref:o,style:{position:"fixed",zIndex:9999,display:i?"block":"none"}},isVisible:i}},K=({children:i,isVisible:u})=>{const[t,o]=d.useState(!1);return d.useEffect(()=>(o(!0),()=>o(!1)),[]),t?Y.createPortal(i,document.body):null};function ne({show:i,onClose:u,context:t,contextType:o,connections:c=[]}){const{auth:g}=D().props,[m,b]=d.useState(null),[M,v]=d.useState(!1),[k,_]=d.useState([]),{triggerProps:w,tooltipProps:E,isVisible:I}=J(),n=B({user_id:"",role:"member"}),h=o==="workspace"?t?.id||t?.data?.id:t?.data?.id||t?.id,N=g.user.id===(t?.data?.owner_id||t?.owner_id),p=t?.data?.members;d.useEffect(()=>{if(i&&Array.isArray(c)&&Array.isArray(p)){const r=p.map(s=>s.id),a=c.filter(s=>!r.includes(s.id));_(a)}else _([])},[i,c,t,p]);const A=r=>{r.preventDefault();const a=o==="workspace"?"project-hub.workspaces.members.add":"project-hub.projects.members.store";n.post(route(a,h),{preserveScroll:!0,onSuccess:()=>{f.success("Member added successfully!"),n.reset()},onError:s=>{const l=s.user_id||s.role||"Failed to add member.";f.error(l)}})},S=r=>{if(!r)return{role:"User",fullName:"Unknown"};const a=r.academician||r.postgraduate||r.undergraduate;return{role:r.academician?"Academician":r.postgraduate?"Postgraduate":r.undergraduate?"Undergraduate":"User",fullName:a?.full_name||r.name}},F=r=>{b(r)},L=(r,a)=>{v(!0);const s=o==="workspace"?"project-hub.workspaces.members.update-role":"project-hub.projects.members.update-role";let l;o==="workspace"?l={workspace:h,member:r.id}:l={project:h,member:r.id},y.put(route(s,l),{role:a},{preserveScroll:!0,onSuccess:()=>{f.success("Member role updated successfully")},onError:j=>{const z=Object.values(j).flat()[0]||"Failed to update member role";f.error(z),console.error("Error updating member role:",j)},onFinish:()=>{v(!1)}})},O=()=>{if(!m)return;v(!0);const r=o==="workspace"?"project-hub.workspaces.members.remove":"project-hub.projects.members.destroy";let a;o==="workspace"?a={workspace:h,member:m.id}:a={project:h,member:m.id},y.delete(route(r,a),{preserveScroll:!0,onSuccess:()=>{f.success("Member removed successfully"),b(null),y.reload({preserveState:!0})},onError:s=>{const l=Object.values(s).flat()[0]||"Failed to remove member";f.error(l)},onFinish:()=>{v(!1),b(null)}})},x=r=>r?(r.academician||r.postgraduate||r.undergraduate)?.full_name||r.name:"Unknown User",U=r=>{if(!r)return null;const a=r.academician?.profile_picture||r.postgraduate?.profile_picture||r.undergraduate?.profile_picture;return a?`/storage/${a}`:null},$=o==="workspace"?"Manage Workspace Members":"Manage Project Members";return e.jsxs(e.Fragment,{children:[e.jsx(V,{show:i,onClose:u,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:$}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),p&&p.length>0?e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-1",children:p.filter(r=>{const a=t?.data?.owner_id||t?.owner_id;return r.id!==a}).map(r=>{const a=r.id===(t?.data?.owner_id||t?.owner_id),s=U(r);return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 py-3 px-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:s?e.jsx("img",{src:s,alt:x(r),className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-gray-500 text-sm",children:x(r).charAt(0)})}),e.jsxs("div",{className:"ml-3 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:x(r)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a?"Owner":r.pivot?.role||"Member"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0 ml-4",children:[N&&!a&&e.jsxs("select",{value:r.pivot?.role||"member",onChange:l=>L(r,l.target.value),className:"text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",disabled:M,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]}),N&&!a&&e.jsx(R,{onClick:()=>F(r),disabled:M,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]})]},r.id)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),N&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),k.length>0?e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"user_id",value:"Select Connection"}),(()=>{const r=k.map(s=>({value:s.id,label:S(s).fullName,...s})),a=r.find(s=>s.value===n.data.user_id)||null;return e.jsx(G,{inputId:"user_id",name:"user_id",options:r,value:a,onChange:s=>n.setData("user_id",s?s.value:""),menuPortalTarget:document.body,formatOptionLabel:s=>{const{role:l,fullName:j}=S(s);return e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:j}),e.jsx("div",{className:"text-xs text-gray-500",children:l})]})})},styles:{menuPortal:s=>({...s,zIndex:9999})},className:"mt-1 block w-full",classNamePrefix:"select",placeholder:"Select a connection to invite..."})})(),e.jsx(P,{message:n.errors.user_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{htmlFor:"role",value:"Role"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(H,{className:"w-4 h-4 text-gray-400 cursor-help",ref:w.ref,onMouseEnter:w.onMouseEnter,onMouseLeave:w.onMouseLeave}),e.jsx(K,{isVisible:I,children:e.jsxs("div",{className:"bg-gray-800 text-white text-xs rounded py-2 px-3 w-64",...E,children:[e.jsx("p",{className:"font-semibold mb-1",children:"Admin:"}),e.jsx("p",{className:"mb-2",children:"Can manage members, boards, and workspace/project settings."}),e.jsx("p",{className:"font-semibold mb-1",children:"Member:"}),e.jsx("p",{children:"Can create and edit content on boards they have access to."}),e.jsx("div",{className:"absolute bottom-0 right-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})})]})]}),e.jsxs("select",{id:"role",name:"role",value:n.data.role,onChange:r=>n.setData("role",r.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx(P,{message:n.errors.role,className:"mt-2"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{type:"submit",disabled:n.processing||!n.data.user_id,children:n.processing?"Sending...":"Send Invitation"})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:["You have no available connections to invite. Add connections and ",e.jsx("span",{className:"font-bold underline",children:"tag them as collaborators"})," to enable invitations."]})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(R,{onClick:u,children:"Close"})})]})}),e.jsx(q,{show:!!m,onClose:()=>b(null),onConfirm:O,title:"Remove Member",message:m?`Are you sure you want to remove ${x(m)} from this ${o}?`:""})]})}export{ne as M};
