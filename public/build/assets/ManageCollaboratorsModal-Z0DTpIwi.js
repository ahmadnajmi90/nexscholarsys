import{q as J,r as m,W as K,j as r,f as Q,y as k}from"./app-D6vboJOS.js";import{M as X}from"./Modal-ByYeH_bH.js";import{I as O}from"./InputLabel-BEQFCO88.js";import{I as U}from"./InputError-DcdTzZe6.js";import{P as Z}from"./PrimaryButton-DhoRhbwk.js";import{S as $}from"./SecondaryButton-DAzvtCLI.js";import{C as T}from"./ConfirmationModal-CWa3wBE9.js";import{c as g}from"./index-C_aMOZz5.js";import{S as ee}from"./react-select.esm-DslfQ0lS.js";import{I as re}from"./info-yKNGxBDS.js";const se=()=>{const[n,p]=m.useState(!1),e=m.useRef(null),i=m.useRef(null),u=()=>{if(e.current&&i.current){const h=e.current.getBoundingClientRect(),c=i.current.getBoundingClientRect();i.current.style.left=`${h.left-c.width/2+h.width/2}px`,i.current.style.top=`${h.top-c.height-10}px`}};return m.useEffect(()=>{if(n)return u(),window.addEventListener("scroll",u),window.addEventListener("resize",u),()=>{window.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[n]),{triggerProps:{ref:e,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)},tooltipProps:{ref:i,style:{position:"fixed",zIndex:9999,display:n?"block":"none"}},isVisible:n}},ae=({children:n,isVisible:p})=>{const[e,i]=m.useState(!1);return m.useEffect(()=>(i(!0),()=>i(!1)),[]),e?Q.createPortal(n,document.body):null};function fe({show:n,onClose:p,context:e,contextType:i,connections:u=[]}){var E,R,I,A,x,F;const{auth:h}=J().props,[c,v]=m.useState(null),[_,j]=m.useState(!1),[S,C]=m.useState([]),{triggerProps:y,tooltipProps:z,isVisible:D}=se(),d=K({user_id:"",role:"member"}),b=i==="workspace"?(e==null?void 0:e.id)||((E=e==null?void 0:e.data)==null?void 0:E.id):((R=e==null?void 0:e.data)==null?void 0:R.id)||(e==null?void 0:e.id),M=h.user.id===(i==="workspace"?((I=e==null?void 0:e.data)==null?void 0:I.owner_id)||(e==null?void 0:e.owner_id):((A=e==null?void 0:e.data)==null?void 0:A.owner_id)||(e==null?void 0:e.owner_id)),f=i==="workspace"?(x=e==null?void 0:e.data)==null?void 0:x.members:(F=e==null?void 0:e.data)==null?void 0:F.members;m.useEffect(()=>{if(n&&Array.isArray(u)&&Array.isArray(f)){const s=f.map(a=>a.id),l=u.filter(a=>!s.includes(a.id));C(l)}else C([])},[n,u,e,f]);const B=s=>{s.preventDefault();const l=i==="workspace"?"project-hub.workspaces.members.add":"project-hub.projects.members.store";d.post(route(l,b),{preserveScroll:!0,onSuccess:()=>{g.success("Member added successfully!"),d.reset()},onError:a=>{const o=a.user_id||a.role||"Failed to add member.";g.error(o)}})},P=s=>{if(!s)return{role:"User",fullName:"Unknown"};const l=s.academician||s.postgraduate||s.undergraduate;return{role:s.academician?"Academician":s.postgraduate?"Postgraduate":s.undergraduate?"Undergraduate":"User",fullName:(l==null?void 0:l.full_name)||s.name}},V=s=>{v(s)},W=(s,l)=>{j(!0);const a=i==="workspace"?"project-hub.workspaces.members.update-role":"project-hub.projects.members.update-role";let o;i==="workspace"?o={workspace:b,member:s.id}:o={project:b,member:s.id},k.put(route(a,o),{role:l},{preserveScroll:!0,onSuccess:()=>{g.success("Member role updated successfully")},onError:t=>{const N=Object.values(t).flat()[0]||"Failed to update member role";g.error(N),console.error("Error updating member role:",t)},onFinish:()=>{j(!1)}})},q=()=>{if(!c)return;j(!0);const s=i==="workspace"?"project-hub.workspaces.members.remove":"project-hub.projects.members.destroy";let l;i==="workspace"?l={workspace:b,member:c.id}:l={project:b,member:c.id},k.delete(route(s,l),{preserveScroll:!0,onSuccess:()=>{g.success("Member removed successfully"),v(null),k.reload({preserveState:!0})},onError:a=>{const o=Object.values(a).flat()[0]||"Failed to remove member";g.error(o)},onFinish:()=>{j(!1),v(null)}})},w=s=>{if(!s)return"Unknown User";const l=s.academician||s.postgraduate||s.undergraduate;return(l==null?void 0:l.full_name)||s.name},Y=s=>{var a,o,t;if(!s)return null;const l=((a=s.academician)==null?void 0:a.profile_picture)||((o=s.postgraduate)==null?void 0:o.profile_picture)||((t=s.undergraduate)==null?void 0:t.profile_picture);return l?`/storage/${l}`:null},G=i==="workspace"?"Manage Workspace Members":"Manage Project Members";return r.jsxs(r.Fragment,{children:[r.jsx(X,{show:n,onClose:p,maxWidth:"md",children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:G}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),f&&f.length>0?r.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-1",children:f.filter(s=>{var a,o;const l=i==="workspace"?((a=e==null?void 0:e.data)==null?void 0:a.owner_id)||(e==null?void 0:e.owner_id):((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id);return s.id!==l}).map(s=>{var o,t,N,L;const l=s.id===(i==="workspace"?((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id):((t=e==null?void 0:e.data)==null?void 0:t.owner_id)||(e==null?void 0:e.owner_id)),a=Y(s);return r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 py-3 px-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:a?r.jsx("img",{src:a,alt:w(s),className:"h-full w-full object-cover"}):r.jsx("span",{className:"text-gray-500 text-sm",children:w(s).charAt(0)})}),r.jsxs("div",{className:"ml-3 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:w(s)}),r.jsx("p",{className:"text-xs text-gray-500 capitalize",children:l?"Owner":((N=s.pivot)==null?void 0:N.role)||"Member"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0 ml-4",children:[M&&!l&&r.jsxs("select",{value:((L=s.pivot)==null?void 0:L.role)||"member",onChange:H=>W(s,H.target.value),className:"text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",disabled:_,children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),M&&!l&&r.jsx($,{onClick:()=>V(s),disabled:_,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]})]},s.id)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),M&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),S.length>0?r.jsxs("form",{onSubmit:B,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(O,{htmlFor:"user_id",value:"Select Connection"}),(()=>{const s=S.map(a=>({value:a.id,label:P(a).fullName,...a})),l=s.find(a=>a.value===d.data.user_id)||null;return r.jsx(ee,{inputId:"user_id",name:"user_id",options:s,value:l,onChange:a=>d.setData("user_id",a?a.value:""),menuPortalTarget:document.body,formatOptionLabel:a=>{const{role:o,fullName:t}=P(a);return r.jsx("div",{className:"flex items-center",children:r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium",children:t}),r.jsx("div",{className:"text-xs text-gray-500",children:o})]})})},styles:{menuPortal:a=>({...a,zIndex:9999})},className:"mt-1 block w-full",classNamePrefix:"select",placeholder:"Select a connection to invite..."})})(),r.jsx(U,{message:d.errors.user_id,className:"mt-2"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(O,{htmlFor:"role",value:"Role"}),r.jsxs("div",{className:"relative ml-2 group",children:[r.jsx(re,{className:"w-4 h-4 text-gray-400 cursor-help",ref:y.ref,onMouseEnter:y.onMouseEnter,onMouseLeave:y.onMouseLeave}),r.jsx(ae,{isVisible:D,children:r.jsxs("div",{className:"bg-gray-800 text-white text-xs rounded py-2 px-3 w-64",...z,children:[r.jsx("p",{className:"font-semibold mb-1",children:"Admin:"}),r.jsx("p",{className:"mb-2",children:"Can manage members, boards, and workspace/project settings."}),r.jsx("p",{className:"font-semibold mb-1",children:"Member:"}),r.jsx("p",{children:"Can create and edit content on boards they have access to."}),r.jsx("div",{className:"absolute bottom-0 right-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})})]})]}),r.jsxs("select",{id:"role",name:"role",value:d.data.role,onChange:s=>d.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),r.jsx(U,{message:d.errors.role,className:"mt-2"})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(Z,{type:"submit",disabled:d.processing||!d.data.user_id,children:d.processing?"Sending...":"Send Invitation"})})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:r.jsxs("p",{className:"text-sm text-yellow-700",children:["You have no available connections to invite. Add connections and ",r.jsx("span",{className:"font-bold underline",children:"tag them as collaborators"})," to enable invitations."]})})]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx($,{onClick:p,children:"Close"})})]})}),r.jsx(T,{show:!!c,onClose:()=>v(null),onConfirm:q,title:"Remove Member",message:c?`Are you sure you want to remove ${w(c)} from this ${i}?`:""})]})}export{fe as M};
