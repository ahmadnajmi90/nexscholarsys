import{q as b,r as p,j as e}from"./app-CxJcie6X.js";import{D as u,a as w,b as y,c as _}from"./dialog-fqnz-DfP.js";import{T,a as k,b as S,c as o}from"./tabs-DSS59pEI.js";import{B as f}from"./button-CilYtwya.js";import{B as C}from"./badge-D4BBvhY1.js";import{S as P}from"./separator-Bo2uL_iz.js";import{S as x}from"./scroll-area-6TQaCY8l.js";import{T as A}from"./ThreadPane-BtnyjRdI.js";import{C as D}from"./clipboard-list-CJnnxR_k.js";import{F as E}from"./file-text-BiVlnGr9.js";import{C as j}from"./calendar-clock-BIt3GpuJ.js";import{H as g}from"./history-rKLgR74C.js";import{f as v}from"./AttachmentPreviewModal-0iaj0OUZ.js";import"./index-BB13cI-f.js";import"./index-CobXwCSB.js";import"./index-CtHA97Ma.js";import"./index-D9NnzX5f.js";import"./Combination-C8-sQI5E.js";import"./tslib.es6-CmEaCU22.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./x-nCDyO7Ch.js";import"./createLucideIcon-BZHwJ_Ns.js";import"./index-BA9qgrdh.js";import"./index-DadmCbDz.js";import"./index-Dp3B9jqt.js";import"./Modal-C5ZFazPk.js";import"./dialog-DhIs0Y5j.js";import"./transition-DQVj9Kgd.js";import"./index-Be4FYkdk.js";import"./en-US-DNUEYIb-.js";const B=["overview","proposal","chat","meetings","history"];function fe({request:s,relationship:a,onClose:t,onUpdated:c}){const{auth:d}=b().props,[n,i]=p.useState(()=>(s==null?void 0:s.preferred_tab)??"overview"),r=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),m=p.useMemo(()=>B.filter(l=>l==="chat"?!!r:!0),[r]);p.useEffect(()=>{if(!(s!=null&&s.preferred_tab)&&!(a!=null&&a.preferred_tab))return;const l=(s==null?void 0:s.preferred_tab)??(a==null?void 0:a.preferred_tab);l&&l!==n&&m.includes(l)&&i(l)},[s==null?void 0:s.preferred_tab,a==null?void 0:a.preferred_tab,m,n]);const N=l=>{i(l),l==="chat"&&r&&(window==null||window.dispatchEvent(new CustomEvent("supervision:openConversation",{detail:{conversationId:r}})))};return s==null||s.attachments,e.jsx(u,{open:!!(s||a),onOpenChange:l=>l?null:t==null?void 0:t(),children:e.jsxs(w,{className:"max-h-[90vh] w-full max-w-4xl overflow-hidden p-0",children:[e.jsx(y,{className:"px-6 pb-4 pt-6",children:e.jsx(_,{className:"text-xl font-semibold",children:a?"Supervision details":"Proposal details"})}),e.jsx(P,{}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs(T,{value:n,onValueChange:N,className:"space-y-4",children:[e.jsx(k,{className:"flex w-full flex-wrap gap-2 bg-transparent p-0",children:m.map(l=>e.jsx(S,{value:l,className:"rounded-full border border-slate-200 px-4",children:M[l]??l},l))}),e.jsx(o,{value:"overview",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(L,{request:s,relationship:a})})}),e.jsx(o,{value:"proposal",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(H,{request:s})})}),r?e.jsx(o,{value:"chat",className:"m-0",children:e.jsx("div",{className:"max-h-[60vh] rounded-lg border border-slate-200",children:e.jsx(A,{conversationId:r,auth:d,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>c==null?void 0:c()})})}):null,e.jsx(o,{value:"meetings",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(I,{relationship:a})})}),e.jsx(o,{value:"history",className:"m-0",children:e.jsx(x,{className:"max-h-[60vh] pr-4",children:e.jsx(O,{request:s,relationship:a})})})]})})]})})}const M={overview:"Overview",proposal:"Proposal",chat:"Conversation",meetings:"Meetings",history:"History"};function L({request:s,relationship:a}){const t=(a==null?void 0:a.academician)??(s==null?void 0:s.academician),c=(a==null?void 0:a.student)??(s==null?void 0:s.student),d=(a==null?void 0:a.status)??(s==null?void 0:s.status)??"pending",n=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),i=[{label:"Student",value:(c==null?void 0:c.full_name)??"Student details unavailable",badge:c?"Postgraduate":null},{label:"Supervisor",value:(t==null?void 0:t.full_name)??"Supervisor not assigned yet",badge:t?"Supervisor":null},{label:"Status",value:h(d)},{label:"Meeting cadence",value:(a==null?void 0:a.meeting_cadence)??"Not set"},{label:"Accepted on",value:a!=null&&a.accepted_at?v(new Date(a.accepted_at),"PPP"):"Pending acceptance"},{label:"ScholarLab",value:a!=null&&a.scholarlab_board_id?"Workspace ready":"Workspace not provisioned"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Supervision summary"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Key milestones, cadence, and workspace access."})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:i.map((r,m)=>e.jsx(W,{label:r.label,value:r.value,badge:r.badge},m))})]}),!n&&e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-700",children:"Conversation not yet active"}),e.jsx("p",{className:"mt-1",children:"Your proposal has not opened a chat thread. When a supervisor responds or you send a message, the messaging tab will appear here."})]})]})}function H({request:s}){var a;return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Proposal"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Submitted materials accompanying your request."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Motivation"}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-slate-700",children:s.motivation||"No motivation provided."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Attachments"}),(a=s.attachments)!=null&&a.length?e.jsx("div",{className:"space-y-2",children:s.attachments.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 px-4 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 capitalize",children:t.type.replace("_"," ")}),e.jsx("div",{className:"text-xs text-slate-500",children:t.original_name})]}),e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:`/storage/${t.path}`,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]},t.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No attachments were included."})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Proposal details unavailable."})}function I({relationship:s}){const a=(s==null?void 0:s.meetings)??[];return a.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Upcoming meetings"]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:v(new Date(t.scheduled_for),"PPpp")})]}),t.location_link&&e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:t.location_link,target:"_blank",rel:"noopener noreferrer",children:"Join"})})]}),t.agenda&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:t.agenda})]},t.id))})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(j,{className:"h-4 w-4 text-indigo-500"}),"Meetings"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"No meetings scheduled yet. Coordinate with your supervisor to agree on a first session."}),e.jsx("div",{className:"rounded-lg border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"When meetings are scheduled they will appear here with quick links and agenda details."})})]})}function O({request:s,relationship:a}){const t=p.useMemo(()=>{const c=Array.isArray(s==null?void 0:s.timeline)?s.timeline:[],d=Array.isArray(a==null?void 0:a.timeline)?a.timeline:[];return[...c,...d].sort((n,i)=>new Date(n.created_at)-new Date(i.created_at))},[s==null?void 0:s.timeline,a==null?void 0:a.timeline]);return t.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(g,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{var d;return e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-800 capitalize",children:h(c.event_type)}),c.created_at&&e.jsx("span",{className:"text-xs text-slate-500",children:v(new Date(c.created_at),"PPpp")})]}),c.metadata&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:((d=c.metadata)==null?void 0:d.description)??JSON.stringify(c.metadata)})]},c.id??`${c.event_type}-${c.created_at}`)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(g,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"Timeline events will appear here as your supervision progresses. Published milestones (submitted, meetings, decisions) will stream in once backend tracking is enabled."})})]})}function h(s){return s?s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()):"Event"}function W({label:s,value:a,badge:t}){return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:s}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-slate-700",children:a}),t&&e.jsx(C,{variant:"outline",className:"border-indigo-200 text-indigo-600 text-[11px]",children:t})]})]})}export{fe as default};
