import{q as F,r as o,a as Q,j as e,Y as X,y as C}from"./app-xmIh42KO.js";import{M as Z}from"./MainLayout-CPl0HUIu.js";import{T as O,a as P,b as n,c as l}from"./tabs-ydYS5gEr.js";import{B as h}from"./button-BxlM9Ynt.js";import{B as ee}from"./badge-CcdemaNu.js";import{A as te,a as se}from"./avatar-Bgpg1fcL.js";import{T as ae}from"./textarea-BOMMor71.js";import{S as re}from"./scroll-area-AuKSir-5.js";import{T as ie,a as oe,b as ne,c as q}from"./tooltip-D_lGOzep.js";import le from"./ScheduleMeetingDialog-CACyhyne.js";import de from"./UnbindRequestModal-D3gIjIIs.js";import ce from"./ResearchTab-D4Tyip4B.js";import me from"./DocumentsTab-BzCwyqVK.js";import{T}from"./ThreadPane-B1UkgXx6.js";import pe from"./UnifiedOverviewTab-BWQc-hhp.js";import{R as he}from"./RelationshipHistoryTab-BAmYbNDU.js";import{c as N}from"./index-DjSnSkN9.js";import{l as _}from"./logError-BloCzXDJ.js";import{A as xe}from"./arrow-left-D3IbPUQw.js";import{C as ve}from"./calendar-s4DfQJnn.js";import{V as ue}from"./video-CzwZSh9q.js";import{U as be}from"./user-minus-DDW20_K2.js";import{S as B}from"./sticky-note-DdzmW6Cv.js";import{L}from"./loader-circle-A6k9v_Uh.js";import{T as je}from"./trash-2-CVirFnuR.js";import{f as ge}from"./format-BOijCLBA.js";import"./house-B_klPfw3.js";import"./createLucideIcon-DVFNR6_B.js";import"./zap-Bw3u2y3o.js";import"./users-BZFyQrBm.js";import"./folder-open-oQe88qJA.js";import"./settings-P6EtBnQ_.js";import"./useRoles-PJeD2Kzi.js";import"./chevron-left-CugAg8G6.js";import"./proxy-BAb5Dv9p.js";import"./user-round-CY-SkVGZ.js";import"./clipboard-list-ClXo_Dhd.js";import"./dollar-sign-Bn4bobhp.js";import"./file-text--rlsk2LO.js";import"./message-square-BBXQLeGc.js";import"./graduation-cap-scGiYA0W.js";import"./building-BY7nxrbx.js";import"./Dropdown-DwtwI7E_.js";import"./transition-wZyx5jV7.js";import"./sparkles-oh8aEPVE.js";import"./bookmark-BdJwoyC4.js";import"./folder-kanban-CN2KbaLX.js";import"./building-2-Ch3P9sYq.js";import"./database-Bq9LZVHr.js";import"./shield-CE5hrWmU.js";import"./index-gVQqUwf4.js";import"./analytics-BQ374C1C.js";import"./iconBase-CmbK3yE2.js";import"./index-D9eridZg.js";import"./supervisionConstants-BuM5-H5X.js";import"./utils-CBfrqCZ4.js";import"./isSameDay-BHs4V-zU.js";import"./en-US-DIdCsyf3.js";import"./constructNow-6bIQB1GK.js";import"./addDays-KHeCUDUr.js";import"./Modal-9xzh__1a.js";import"./dialog-B-e007Fb.js";import"./index-CLSrQ3eM.js";import"./PrimaryButton-gsFALqdO.js";import"./SecondaryButton-sarh4spo.js";import"./search-ZOwBQLRx.js";import"./circle-check-big-DJvx1MoU.js";import"./x-CqhkXXcI.js";import"./chevron-right-W86pD0Cb.js";import"./index-Chjiymov.js";import"./dialog-Cc-SgjeX.js";import"./index-aBJ4ZnJk.js";import"./index-CfHh2K1o.js";import"./index-C-SKuI93.js";import"./index-Jct0HHTX.js";import"./index-Cn5-Ykwo.js";import"./index-CFWEupJ2.js";import"./index-DxyQ96zj.js";import"./index-BayBrQ5A.js";import"./briefcase-DNLVAK73.js";import"./user-DqDDY9eD.js";import"./index-BADX2Att.js";import"./index-B95x1XYb.js";import"./index-D3U9SMCW.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./index-C0RVqtAt.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-C_m7Z3So.js";import"./index-DiD6aHt-.js";import"./input-B6OKkEAQ.js";import"./label-hN5Y3qJx.js";import"./alert-DYxlFrOY.js";import"./useGoogleCalendar-U1Yy-mJz.js";import"./external-link--Pe2votq.js";import"./triangle-alert-X4etJuCF.js";import"./separator-BK4hRb3O.js";import"./plus-DGWlOha5.js";import"./circle-check-CwsGHSo8.js";import"./circle-BLJ0wM-L.js";import"./select-CX3LxZxk.js";import"./index-Dzi-mWu3.js";import"./chevron-down-DQCopX2H.js";import"./check-CErv2FID.js";import"./chevron-up-PDoxJUfE.js";import"./DocumentPreviewModal-BXDvradQ.js";import"./download-DhGNF5t8.js";import"./upload-CSH8xK5m.js";import"./eye-CF532UA4.js";import"./history-DjHglOSJ.js";import"./mail-LOD_U68d.js";import"./phone-Az6DOwmg.js";import"./globe-GjV7sY5v.js";import"./calendar-clock-hjkVfYDr.js";import"./circle-alert-pBmeMKmm.js";function Us({relationship:x,userRole:r}){const{auth:v}=F().props,t=F().props.relationship||x,[u,f]=o.useState("overview"),[w,m]=o.useState(!1),[a,y]=o.useState(!1),[E,H]=o.useState([]),[U,A]=o.useState(""),[R,M]=o.useState(!1),[k,I]=o.useState(null);o.useEffect(()=>{t?.id&&V()},[t?.id]);const V=async()=>{if(t?.id)try{const s=await Q.get(route("supervision.relationships.show",t.id));H(s.data.data?.notes||[])}catch(s){_(s,"RelationshipFullPage loadNotes")}},$=()=>{r==="supervisor"?C.visit(route("supervision.supervisor.index")):C.visit(route("supervision.student.index"))},d=()=>{C.reload({only:["relationship"]})},J=async()=>{if(!(!U.trim()||R)){M(!0);try{N.success("Note added"),A("")}catch(s){_(s,"RelationshipFullPage handleAddNote"),N.error("Failed to add note")}finally{M(!1)}}},z=async s=>{if(!k){I(s);try{N.success("Note deleted")}catch(K){_(K,"RelationshipFullPage handleDeleteNote"),N.error("Failed to delete note")}finally{I(null)}}},i=r==="supervisor",c=i?t?.student??{}:t?.academician??{},b=c.full_name??(i?"Student":"Supervisor"),D=c.profile_picture?`/storage/${c.profile_picture}`:null,j=t?.status??"active",p=t?.active_unbind_request||t?.activeUnbindRequest,S=p?"pending_unbind":j,g=j==="active"&&!p,W=b.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),Y=S==="pending_unbind"?"Pending Unbind":S.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),G=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(Z,{title:"Supervision Relationship",children:[e.jsx(X,{title:`Supervision: ${b}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(h,{variant:"outline",onClick:$,className:"mb-4",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(te,{className:"h-16 w-16",children:D?e.jsx("img",{src:D,alt:b,className:"h-full w-full object-cover"}):e.jsx(se,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:W})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b}),e.jsxs("p",{className:"text-sm text-slate-600",children:[i?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(ee,{className:`${G(S)} border`,children:Y})})]})]})})]}),g&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(h,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(h,{className:"bg-slate-900 hover:bg-slate-800",disabled:!t?.meetings||t.meetings.length===0||!t.meetings[0]?.location_link,onClick:()=>{const s=t?.meetings?.[0];s?.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsx("div",{children:e.jsxs(h,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>y(!0),disabled:p||j!=="active",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),p&&e.jsx(q,{children:e.jsx("p",{children:"Unbind request pending approval"})}),j!=="active"&&!p&&e.jsx(q,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(O,{value:u,onValueChange:f,className:"w-full",children:[e.jsxs(P,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(n,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(n,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"})]}),e.jsx(n,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),i&&e.jsx(n,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(n,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"overview",className:"mt-0 p-2",children:e.jsx(pe,{relationship:t,person:c,userRole:r,activeUnbindRequest:p})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(l,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(ce,{relationship:t,onUpdated:d,isReadOnly:!g})})}),e.jsx(l,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:d,isReadOnly:!g})})})]}),e.jsx(l,{value:"chat",className:"mt-0 p-6",children:i?e.jsxs(O,{defaultValue:"direct",className:"w-full",children:[e.jsxs(P,{className:"mb-4",children:[e.jsx(n,{value:"direct",children:"Direct Message"}),e.jsx(n,{value:"group",disabled:!c?.supervision_group_conversation_id,children:"Team Chat"})]}),e.jsx(l,{value:"direct",className:"mt-0",children:t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),e.jsx(l,{value:"group",className:"mt-0",children:c?.supervision_group_conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:c.supervision_group_conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm text-center",children:e.jsx("p",{className:"text-sm text-slate-500",children:"Team chat will be available when a co-supervisor joins."})})})]}):t?.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(T,{conversationId:t.conversation_id,auth:v,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>d()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),i&&e.jsx(l,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(Ne,{notesList:E,newNote:U,setNewNote:A,isAddingNote:R,isDeletingNoteId:k,onAddNote:J,onDeleteNote:z,isReadOnly:!g})})}),e.jsx(l,{value:"history",className:"mt-0 p-0",children:e.jsx(re,{className:"h-[calc(100vh-350px)]",children:e.jsx(he,{relationship:t})})})]})]})})]}),e.jsx(le,{relationship:w?t:null,onClose:()=>m(!1),onScheduled:()=>{m(!1),d()},userRole:r}),e.jsx(de,{isOpen:a,relationship:t,onClose:()=>y(!1),onUnbindInitiated:()=>{y(!1),d()},userRole:r})]})}function Ne({notesList:x,newNote:r,setNewNote:v,isAddingNote:t,isDeletingNoteId:u,onAddNote:f,onDeleteNote:w,isReadOnly:m}){return e.jsxs("div",{className:"space-y-6",children:[!m&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(ae,{rows:4,value:r,onChange:a=>v(a.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(h,{onClick:f,disabled:!r.trim()||t,children:[t&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",x.length,")"]}),x.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(B,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:x.map(a=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:a.created_at?ge(new Date(a.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!m&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>w(a.id),disabled:u===a.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:u===a.id?e.jsx(L,{className:"h-4 w-4 animate-spin"}):e.jsx(je,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:a.note})]},a.id))})]})]})}export{Us as default};
