import{q as F,r as g,j as e}from"./app-A8xQkvSk.js";import{T as I,a as R,b as h,c as b}from"./tabs-Cbyzn-fX.js";import{B as x}from"./button-Dz_rydmG.js";import{B as z}from"./badge-CFoP9Krf.js";import{A as E,a as $}from"./avatar-CbIr_OjG.js";import"./separator-B59s4oDI.js";import{S as N}from"./scroll-area-COMlVIOb.js";import{T as V}from"./ThreadPane-CPpSuURI.js";import{A as G}from"./AttachmentPreviewModal-CXErbNPv.js";import H from"./AcceptSupervisorOfferModal-CGntPWdr.js";import{X as W}from"./x-vL7g-LuD.js";import{C as X}from"./circle-check-ddCD_g9w.js";import{M as J}from"./message-square-C9nAneZj.js";import{C as K}from"./calendar-EpaZ4Aad.js";import{V as L}from"./video-DL3IJgDp.js";import{U}from"./user-round-CEZUuFcg.js";import{B as Z}from"./briefcase-CfUq1pnR.js";import{M as Q}from"./mail-Dtimj1fp.js";import{P as Y}from"./phone-D1xIudn-.js";import{G as q}from"./graduation-cap-the7C-yQ.js";import{C as ee}from"./calendar-clock-BwBj7N73.js";import{F as se}from"./file-text-BfC4OSQU.js";import{f as u}from"./format-hTuirObu.js";import"./index-BEzQHz4a.js";import"./index-7Qlnuq3l.js";import"./index-CG1gsK_f.js";import"./index-DwuY8lh1.js";import"./index-OrEFxIKi.js";import"./index-DMPy21CI.js";import"./index-B0SlzLk6.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-Dp3B9jqt.js";import"./Modal-D_n_zj3N.js";import"./dialog-BkDQGxoj.js";import"./transition-Bvb6H6Z4.js";import"./index-Km-vM6Jb.js";import"./en-US-DNUEYIb-.js";import"./download-CMnE0euH.js";import"./createLucideIcon-DPzobtnR.js";import"./label-BcrT7TVM.js";import"./checkbox-DDgIuOJc.js";import"./index-rTP0VXgG.js";import"./index-Db3xrL5F.js";import"./check-BeDd_wJ7.js";import"./alert-BBFXwXFc.js";import"./logError-D4ezqrCx.js";import"./circle-alert-CPnO62Yc.js";import"./loader-circle-DkpR38mE.js";function ss({request:s,onClose:n,onUpdated:l}){var A,M;const{auth:r}=F().props,[a,i]=g.useState("overview"),[d,c]=g.useState(!1),[j,w]=g.useState(null),S=15*1024*1024,P=t=>{const p=t.mime_type&&t.mime_type.startsWith("image/"),B=t.mime_type==="application/pdf";(p||B)&&t.size<S?w({url:`/storage/${t.path}`,original_name:t.original_name||"Attachment",mime_type:t.mime_type,size_formatted:t.size_formatted||`${(t.size/1024).toFixed(1)} KB`,created_at:t.created_at}):window.open(`/storage/${t.path}`,"_blank","noopener,noreferrer")};if(!s)return null;const o=(s==null?void 0:s.academician)??{},v=o.full_name??"Supervisor";o.current_position;const y=o.profile_picture?`/storage/${o.profile_picture}`:null,_=((A=o.university)==null?void 0:A.name)??"",m=s.status??"pending",C=s==null?void 0:s.conversation_id,k=m==="pending"||m==="pending_student_acceptance",T=v.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,3),O=m.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),D=t=>{switch(t){case"pending":return"bg-amber-50 text-amber-700 border-amber-200";case"accepted":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"rejected":return"bg-red-50 text-red-700 border-red-200";case"cancelled":case"auto_cancelled":return"bg-slate-50 text-slate-700 border-slate-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-end bg-black/50",onClick:n,children:[e.jsxs("div",{className:"w-full max-w-3xl h-full bg-white shadow-xl overflow-hidden flex flex-col animate-slide-in-right",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(E,{className:"h-12 w-12",children:y?e.jsx("img",{src:y,alt:v,className:"h-full w-full object-cover"}):e.jsx($,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:T})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:v}),_&&e.jsx("span",{className:"text-sm text-slate-600",children:_}),e.jsx("div",{className:"mt-2 flex items-center gap-3 flex-wrap",children:e.jsx(z,{className:`${D(m)} border`,children:O})})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(W,{className:"h-5 w-5 text-slate-500"})})]})}),e.jsxs("div",{className:"px-6 py-4 border-b bg-slate-50",children:[m==="pending_student_acceptance"&&e.jsx("div",{className:"mb-3",children:e.jsxs(x,{className:"w-full bg-green-600 hover:bg-green-700 text-white",onClick:()=>c(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Accept Supervisor Offer"]})}),k&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(x,{variant:"outline",className:"flex-1",onClick:()=>i("chat"),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Chat"]}),e.jsxs(x,{variant:"outline",className:"flex-1",disabled:!0,title:"Only supervisors can schedule meetings",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Schedule"]}),e.jsxs(x,{className:"flex-1 bg-slate-900 hover:bg-slate-800",disabled:!(s!=null&&s.meetings)||s.meetings.length===0||!((M=s.meetings[0])!=null&&M.location_link),onClick:()=>{var p;const t=(p=s==null?void 0:s.meetings)==null?void 0:p[0];t!=null&&t.location_link&&window.open(t.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Join Meeting"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(I,{value:a,onValueChange:i,className:"h-full flex flex-col",children:[e.jsxs(R,{className:"px-6 bg-gray-100 w-full justify-start rounded-none h-auto p-0 gap-0",children:[e.jsx(h,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Overview"}),e.jsx(h,{value:"proposal",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Proposal"}),k&&e.jsx(h,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Chat"}),e.jsx(h,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(b,{value:"overview",className:"mt-0 h-full",children:e.jsx(N,{className:"h-full",children:e.jsx(ae,{request:s})})}),e.jsx(b,{value:"proposal",className:"mt-0 h-full",children:e.jsx(N,{className:"h-full",children:e.jsx(te,{request:s,onAttachmentClick:P})})}),e.jsx(b,{value:"chat",className:"mt-0 h-full",children:C?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(V,{conversationId:C,auth:r,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>l==null?void 0:l()})})}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})})}),e.jsx(b,{value:"history",className:"mt-0 h-full",children:e.jsx(N,{className:"h-full",children:e.jsx(le,{request:s})})})]})]})})]}),e.jsx(H,{isOpen:d,request:s,onClose:()=>c(!1),onAccepted:()=>{c(!1),l==null||l()}}),e.jsx(G,{file:j,onClose:()=>w(null)})]})}function ae({request:s}){const n=s!=null&&s.submitted_at?u(new Date(s.submitted_at),"dd/MM/yyyy"):"—",l=(s==null?void 0:s.meetings)??[],r=l.length>0,a=(s==null?void 0:s.academician)??{};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Supervisor Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(f,{icon:U,label:"Full Name",value:a.full_name||"—"}),e.jsx(f,{icon:Z,label:"Position",value:a.current_position||"—"}),e.jsx(f,{icon:Q,label:"Email",value:a.email||"—"}),e.jsx(f,{icon:Y,label:"Phone",value:a.phone_number||"—"})]}),(a.university||a.faculty||a.department)&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-slate-500"}),"Institution"]}),e.jsxs("div",{className:"space-y-2",children:[a.university&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"University: "}),e.jsx("span",{className:"text-slate-600",children:a.university.name||a.university.full_name||"—"})]}),a.faculty&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Faculty: "}),e.jsx("span",{className:"text-slate-600",children:a.faculty.name||"—"})]}),a.department&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Department: "}),e.jsx("span",{className:"text-slate-600",children:a.department})]})]})]}),a.research_areas&&Array.isArray(a.research_areas)&&a.research_areas.length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Research Expertise"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.research_areas.slice(0,3).map((i,d)=>e.jsx("span",{className:"px-2.5 py-1 text-xs rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200",children:i},d)),a.research_areas.length>3&&e.jsxs("span",{className:"px-2.5 py-1 text-xs rounded-full bg-slate-100 text-slate-600",children:["+",a.research_areas.length-3," more"]})]})]}),a.bio&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Bio"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed line-clamp-3",children:a.bio})]})]})]}),e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Proposal Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-base font-semibold text-slate-900",children:s.proposal_title??"Untitled Proposal"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed whitespace-pre-line",children:["Motivation: ",s.motivation??"No motivation provided."]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Sent:"}),e.jsx("div",{className:"font-medium text-slate-900",children:n})]})})]})]}),r&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ee,{className:"h-5 w-5 text-slate-900"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Meeting Details"})]}),e.jsx("div",{className:"space-y-4",children:l.map((i,d)=>e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Date:"}),e.jsx("div",{className:"font-medium text-slate-900",children:i.scheduled_for?u(new Date(i.scheduled_for),"MMMM d, yyyy"):"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"Type:"}),e.jsx("div",{className:"font-medium text-slate-900",children:i.type||"Online"})]})]},i.id||d))})]})]})}function f({icon:s,label:n,value:l}){return e.jsxs("div",{className:"flex items-start gap-2",children:[s&&e.jsx(s,{className:"mt-0.5 h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:n}),e.jsx("div",{className:"text-sm text-slate-700 break-words",children:l||"—"})]})]})}function te({request:s,onAttachmentClick:n}){const l=(s==null?void 0:s.attachments)??[];return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Research Proposal"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2",children:"Title"}),e.jsx("p",{className:"text-base text-slate-900",children:s.proposal_title??"Untitled"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2",children:"Motivation"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed whitespace-pre-line",children:s.motivation??"No motivation provided."})]}),l.length>0&&e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wide mb-3",children:"Attachments"}),e.jsx("div",{className:"space-y-2",children:l.map(r=>{var a;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-indigo-50 rounded-md",children:e.jsx(se,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:r.original_name||"Attachment"}),e.jsx("p",{className:"text-xs text-slate-500 capitalize",children:((a=r.type)==null?void 0:a.replace("_"," "))||"Document"})]})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>n(r),children:"View File"})]},r.id)})})]})]})]})})}function le({request:s}){var r,a,i,d;const n=[{id:1,title:"Proposal Submitted",date:s==null?void 0:s.submitted_at,status:"completed"},{id:2,title:"Under Review",date:s==null?void 0:s.submitted_at,status:(s==null?void 0:s.status)==="pending"?"current":"completed"},{id:3,title:(((r=s==null?void 0:s.meetings)==null?void 0:r.length)>0,"Meeting Scheduled"),date:(i=(a=s==null?void 0:s.meetings)==null?void 0:a[0])==null?void 0:i.scheduled_for,status:((d=s==null?void 0:s.meetings)==null?void 0:d.length)>0?"completed":"pending"},{id:4,title:"Decision",date:s==null?void 0:s.decision_at,status:(s==null?void 0:s.status)!=="pending"?"completed":"pending"}],l=c=>{switch(c){case"completed":return"bg-green-500";case"current":return"bg-blue-500";case"pending":return"bg-slate-300";default:return"bg-slate-300"}};return e.jsx("div",{className:"p-6",children:e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Timeline"}),e.jsx("div",{className:"space-y-4",children:n.map((c,j)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l(c.status)}`}),j<n.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-slate-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:c.title}),e.jsx("p",{className:"text-sm text-slate-500",children:c.date?u(new Date(c.date),"dd/MM/yyyy"):"TBD"})]})]},c.id))})]})})}export{ss as default};
