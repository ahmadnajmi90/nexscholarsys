import{q as P,r as d,b as K,j as e,Y as Q,y as C}from"./app-A8xQkvSk.js";import{M as X}from"./MainLayout-CjLgp52Q.js";import{T as Z,a as ee,b as p,c as x}from"./tabs-Cbyzn-fX.js";import{B as u}from"./button-Dz_rydmG.js";import{B as te}from"./badge-CFoP9Krf.js";import{A as se,a as ae}from"./avatar-CbIr_OjG.js";import{T as re}from"./textarea-DGdKxzUN.js";import"./scroll-area-COMlVIOb.js";import{T as ie,a as oe,b as de,c as B}from"./tooltip-Oo0Wz_lE.js";import le from"./ScheduleMeetingDialog-C9eLZHwe.js";import{U as ne,a as ce}from"./UnbindRequestModal-2eYhJEIj.js";import me from"./ResearchTab-B4EYMRFM.js";import pe from"./DocumentsTab-B11iV4A2.js";import{T as xe}from"./ThreadPane-CPpSuURI.js";import ue from"./SupervisorOverviewTab-1AlCwSvt.js";import he from"./StudentOverviewTab-B7N66E49.js";import{c as g}from"./index-Km-vM6Jb.js";import{l as _}from"./logError-D4ezqrCx.js";import{A as ve}from"./arrow-left-DZv5Syj6.js";import{C as be}from"./calendar-EpaZ4Aad.js";import{V as je}from"./video-DL3IJgDp.js";import{S as F}from"./sticky-note-C4sRMRSo.js";import{L as q}from"./loader-circle-DkpR38mE.js";import{T as Ne}from"./trash-2-XEAf-v5f.js";import{f as H}from"./format-hTuirObu.js";import"./house-DIYSl52k.js";import"./createLucideIcon-DPzobtnR.js";import"./zap-Dak04NKO.js";import"./users-BaMPipud.js";import"./folder-open-Bj-Qb-PO.js";import"./settings-CbyQhbcQ.js";import"./useRoles-DnA4fsnD.js";import"./chevron-left-BruLJFfn.js";import"./proxy-CKd5URLT.js";import"./user-round-CEZUuFcg.js";import"./clipboard-list-BtJRjBIa.js";import"./log-out-BebSIB5g.js";import"./dollar-sign-Bq2kjMHF.js";import"./file-text-BfC4OSQU.js";import"./message-square-C9nAneZj.js";import"./graduation-cap-the7C-yQ.js";import"./building-NTAK_MKf.js";import"./sparkles-CGG6vdsp.js";import"./building-2-BCJzFzaK.js";import"./database-DpVHQPSB.js";import"./shield-D8lNzSRy.js";import"./index-B4VpFx6V.js";import"./Dropdown-DkOdv60-.js";import"./transition-Bvb6H6Z4.js";import"./analytics-BQ374C1C.js";import"./Modal-D_n_zj3N.js";import"./dialog-BkDQGxoj.js";import"./PrimaryButton-Dxc_ynbL.js";import"./SecondaryButton-BW8D4TTl.js";import"./x-vL7g-LuD.js";import"./briefcase-CfUq1pnR.js";import"./user-yqODNyIj.js";import"./index-BEzQHz4a.js";import"./index-7Qlnuq3l.js";import"./index-CG1gsK_f.js";import"./index-DwuY8lh1.js";import"./index-OrEFxIKi.js";import"./index-DMPy21CI.js";import"./index-B0SlzLk6.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-Dp3B9jqt.js";import"./index-BlKfbGK4.js";import"./index-Cp2nhW7C.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-Db3xrL5F.js";import"./input-D2p8biwd.js";import"./label-BcrT7TVM.js";import"./alert-BBFXwXFc.js";import"./triangle-alert-BND9SWEh.js";import"./separator-B59s4oDI.js";import"./plus-BqbQZKPX.js";import"./circle-check-ddCD_g9w.js";import"./circle-eov79Dsa.js";import"./en-US-DNUEYIb-.js";import"./select-BBDf1Ygo.js";import"./Combination-Bf5eV4ml.js";import"./tslib.es6-CmEaCU22.js";import"./index-rTP0VXgG.js";import"./chevron-down-qnEAqpL2.js";import"./chevron-up-hxgrcUwj.js";import"./check-BeDd_wJ7.js";import"./DocumentPreviewModal-CPJtZlTY.js";import"./download-CMnE0euH.js";import"./upload-DLfp_NaM.js";import"./chevron-right-Mpml_Nmb.js";import"./eye-B05lsJ9f.js";import"./history-BxBz3cCN.js";import"./AttachmentPreviewModal-CXErbNPv.js";import"./mail-Dtimj1fp.js";import"./phone-D1xIudn-.js";import"./globe-B7ftxdKm.js";import"./calendar-clock-BwBj7N73.js";function ps({relationship:s,userRole:r}){var I;const{auth:h}=P().props,t=P().props.relationship||s,[n,f]=d.useState("overview"),[w,c]=d.useState(!1),[i,y]=d.useState(!1),[L,E]=d.useState([]),[A,U]=d.useState(""),[R,M]=d.useState(!1),[k,D]=d.useState(null);d.useEffect(()=>{t!=null&&t.id&&$()},[t==null?void 0:t.id]);const $=async()=>{var a;if(t!=null&&t.id)try{const o=await K.get(route("supervision.relationships.show",t.id));E(((a=o.data.data)==null?void 0:a.notes)||[])}catch(o){_(o,"RelationshipFullPage loadNotes")}},V=()=>{r==="supervisor"?C.visit(route("supervision.supervisor.index")):C.visit(route("supervision.student.index"))},v=()=>{C.reload({only:["relationship"]})},J=async()=>{if(!(!A.trim()||R)){M(!0);try{g.success("Note added"),U("")}catch(a){_(a,"RelationshipFullPage handleAddNote"),g.error("Failed to add note")}finally{M(!1)}}},z=async a=>{if(!k){D(a);try{g.success("Note deleted")}catch(o){_(o,"RelationshipFullPage handleDeleteNote"),g.error("Failed to delete note")}finally{D(null)}}},m=r==="supervisor",S=m?(t==null?void 0:t.student)??{}:(t==null?void 0:t.academician)??{},b=S.full_name??(m?"Student":"Supervisor"),O=S.profile_picture?`/storage/${S.profile_picture}`:null,j=(t==null?void 0:t.status)??"active",l=(t==null?void 0:t.active_unbind_request)||(t==null?void 0:t.activeUnbindRequest),T=l?"pending_unbind":j,N=j==="active"&&!l,W=b.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,3),Y=T==="pending_unbind"?"Pending Unbind":T.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "),G=a=>{switch(a){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(X,{title:"Supervision Relationship",children:[e.jsx(Q,{title:`Supervision: ${b}`}),e.jsxs("div",{className:"max-w-7xl mx-auto pb-6",children:[e.jsxs("div",{className:"mb-6 bg-white border-b pb-6",children:[e.jsxs("div",{children:[e.jsxs(u,{variant:"outline",onClick:V,className:"mb-4",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(se,{className:"h-16 w-16",children:O?e.jsx("img",{src:O,alt:b,className:"h-full w-full object-cover"}):e.jsx(ae,{className:"bg-indigo-100 text-indigo-700 text-lg font-semibold",children:W})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b}),e.jsxs("p",{className:"text-sm text-slate-600",children:[m?"Student":"Supervisor"," Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-3",children:e.jsx(te,{className:`${G(T)} border`,children:Y})})]})]})})]}),N&&e.jsx("div",{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(u,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(u,{className:"bg-slate-900 hover:bg-slate-800",disabled:!(t!=null&&t.meetings)||t.meetings.length===0||!((I=t.meetings[0])!=null&&I.location_link),onClick:()=>{var o;const a=(o=t==null?void 0:t.meetings)==null?void 0:o[0];a!=null&&a.location_link&&window.open(a.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Join Meeting"]}),e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(de,{asChild:!0,children:e.jsx("div",{children:e.jsxs(u,{variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",onClick:()=>y(!0),disabled:l||j!=="active",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),l&&e.jsx(B,{children:e.jsx("p",{children:"Unbind request pending approval"})}),j!=="active"&&!l&&e.jsx(B,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs(Z,{value:n,onValueChange:f,className:"w-full",children:[e.jsxs(ee,{className:"w-full justify-start rounded-none border-b bg-slate-50 p-0 h-auto",children:[e.jsx(p,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Overview"}),e.jsx(p,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Research"}),e.jsx(p,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Documents"}),e.jsx(p,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Chat"}),m&&e.jsx(p,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"Notes"}),e.jsx(p,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{children:[e.jsx(x,{value:"overview",className:"mt-0 p-2",children:m?e.jsx(ue,{relationship:t,student:(t==null?void 0:t.student)??{},activeUnbindRequest:l}):e.jsx(he,{relationship:t,academician:(t==null?void 0:t.academician)??{},activeUnbindRequest:l})}),e.jsx(x,{value:"research",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(me,{relationship:t,onUpdated:v,isReadOnly:!N})})}),e.jsx(x,{value:"documents",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(pe,{relationship:t,onUpdated:v,isReadOnly:!N})})}),e.jsx(x,{value:"chat",className:"mt-0 p-6",children:t!=null&&t.conversation_id?e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-[calc(100vh-400px)] overflow-hidden",children:e.jsx(xe,{conversationId:t.conversation_id,auth:h,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>v()})}):e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})}),m&&e.jsx(x,{value:"notes",className:"mt-0 p-2",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-auto",children:e.jsx(ge,{notesList:L,newNote:A,setNewNote:U,isAddingNote:R,isDeletingNoteId:k,onAddNote:J,onDeleteNote:z,isReadOnly:!N})})}),e.jsx(x,{value:"history",className:"mt-0 p-6",children:e.jsx(fe,{relationship:t})})]})]})})]}),e.jsx(le,{relationship:w?t:null,onClose:()=>c(!1),onScheduled:()=>{c(!1),v()},userRole:r}),e.jsx(ce,{isOpen:i,relationship:t,onClose:()=>y(!1),onUnbindInitiated:()=>{y(!1),v()},userRole:r})]})}function ge({notesList:s,newNote:r,setNewNote:h,isAddingNote:t,isDeletingNoteId:n,onAddNote:f,onDeleteNote:w,isReadOnly:c}){return e.jsxs("div",{className:"space-y-6",children:[!c&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(F,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(re,{rows:4,value:r,onChange:i=>h(i.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(u,{onClick:f,disabled:!r.trim()||t,children:[t&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",s.length,")"]}),s.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(F,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:s.map(i=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:i.created_at?H(new Date(i.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!c&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>w(i.id),disabled:n===i.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:n===i.id?e.jsx(q,{className:"h-4 w-4 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:i.note})]},i.id))})]})]})}function fe({relationship:s}){const r=[{id:1,title:"Relationship Started",date:s==null?void 0:s.accepted_at,status:"completed"},{id:2,title:"Active Supervision",date:s==null?void 0:s.accepted_at,status:(s==null?void 0:s.status)==="active"?"current":"completed"}];s!=null&&s.terminated_at&&r.push({id:3,title:"Relationship Terminated",date:s.terminated_at,status:"completed"});const h=t=>{switch(t){case"completed":return"bg-green-500";case"current":return"bg-blue-500";case"pending":return"bg-slate-300";default:return"bg-slate-300"}};return e.jsxs("div",{className:"max-w-2xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Timeline"}),e.jsx("div",{className:"space-y-4",children:r.map((t,n)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${h(t.status)}`}),n<r.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-slate-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:t.date?H(new Date(t.date),"dd/MM/yyyy HH:mm"):"TBD"})]})]},t.id))})]})}export{ps as default};
