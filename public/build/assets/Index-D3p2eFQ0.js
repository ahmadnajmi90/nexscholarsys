import{r as s,j as e,a as F,Y as de}from"./app-Dgk83mfN.js";import{M as ue}from"./MainLayout-1MjtipZ6.js";import{c as he,a as K,d as me,e as G,F as J,f as fe,g as ge,h as xe}from"./index-NWgfnp5I.js";import pe from"./ResultsGrid-CaRkOaTp.js";import ye from"./SearchTypeSelector-CpAqqsJb.js";import H from"./FilterPanel-BP0Mo9Jt.js";import{u as be}from"./useRoles-DMzBv00q.js";import{S as O}from"./sparkles-gPtW5blb.js";import"./createLucideIcon-CqU2OdoG.js";import"./analytics-BQ374C1C.js";import"./index-C_fCizXd.js";import"./ConnectionButton-CETDLmL-.js";import"./RecommendationDisplay-BxLKlE-v.js";import"./BookmarkButton-D8yqq1gG.js";import"./index-BbpzzmMj.js";import"./BookmarkHandler-Doj_00yy.js";import"./react-select.esm-yxywD6IY.js";const je=({onQueryChange:n,initialQuery:h="",researchOptions:l,placeholder:g="e.g., Artificial Intelligence in Healthcare, Design Science Research...",onEnterPress:f=null})=>{const[b,j]=s.useState(h),[k,w]=s.useState(!1),[N,x]=s.useState([]),y=s.useRef(null);s.useEffect(()=>{function r(d){y.current&&!y.current.contains(d.target)&&w(!1)}return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[y]),s.useEffect(()=>{if(l&&l.length>0){const r=new Set;l.forEach(c=>{c.field_of_research_name&&r.add(c.field_of_research_name),c.research_area_name&&r.add(c.research_area_name),c.niche_domain_name&&r.add(c.niche_domain_name)});const d=Array.from(r).slice(0,15);x(d)}},[l]);const S=r=>{const d=r.target.value;j(d),n(d)},a=r=>{r.key==="Enter"&&f&&(r.preventDefault(),f())},I=r=>{const d=b?`${b}, ${r}`:r;j(d),n(d),w(!1)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b,onChange:S,onKeyDown:a,placeholder:g,className:"w-full px-4 pr-14 py-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm md:text-base",onFocus:()=>w(!0)}),b&&e.jsx("button",{className:"absolute right-10 top-4 text-gray-400 hover:text-gray-600",onClick:()=>{j(""),n("")},children:e.jsx(he,{})})]}),k&&N.length>0&&e.jsxs("div",{ref:y,className:"mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 absolute z-20 w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Suggested research terms"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map((r,d)=>e.jsxs("button",{className:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm flex items-center",onClick:()=>I(r),children:[e.jsx(me,{className:"mr-1 text-xs text-gray-500"}),r]},d))}),e.jsx("button",{className:"mt-2 text-xs text-gray-500 hover:text-gray-700",onClick:()=>w(!1),children:"Close suggestions"})]})]})},we=({onSearch:n,researchOptions:h,isSearching:l=!1,initialQuery:g="",pageTitle:f="Find Your Perfect Research Supervisor",searchDescription:b="Enter your research interest, topic, or field of study below and we'll match you with supervisors who have relevant expertise.",placeholder:j="e.g., Artificial Intelligence in Healthcare, Design Science Research...",tips:k=[],error:w=null,children:N})=>{const[x,y]=s.useState(g),[S,a]=s.useState([]),[I,r]=s.useState(!1),[d,c]=s.useState(null),v=s.useRef(null);s.useEffect(()=>{function t(o){v.current&&!v.current.contains(o.target)&&r(!1)}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[v]),s.useEffect(()=>{try{const t=localStorage.getItem("supervisor_recent_searches");if(t){const o=JSON.parse(t);Array.isArray(o)&&a(o.slice(0,5))}}catch(t){console.error("Error loading recent searches:",t)}},[]);const A=t=>{try{if(t&&t.trim().length>0){const o=[t,...S.filter(R=>R!==t)].slice(0,5);a(o),localStorage.setItem("supervisor_recent_searches",JSON.stringify(o))}}catch(o){console.error("Error saving recent search:",o)}},p=t=>{t.preventDefault(),c(null),A(x),n(x)},T=t=>{y(t),c(null)},E=t=>{y(t),n(t),r(!1)},P=()=>{if(x.trim().length<3){c("Please enter at least 3 characters to search");return}c(null),A(x),n(x)};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:f}),e.jsx("p",{className:"text-gray-600 mb-6",children:b})]}),e.jsxs("form",{onSubmit:p,className:"mb-8",children:[e.jsxs("div",{className:"relative flex",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(je,{onQueryChange:T,initialQuery:x,researchOptions:h,onEnterPress:P,placeholder:j})}),e.jsx("div",{className:"absolute right-20 top-4 z-10",children:e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700",onClick:()=>r(!I),title:"Recent searches",children:e.jsx(G,{})})}),e.jsx("button",{type:"submit",className:`bg-blue-600 text-white px-6 py-3 rounded-r-lg flex items-center justify-center ${l?"opacity-70 cursor-not-allowed":"hover:bg-blue-700"}`,disabled:l,children:l?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx(J,{})}),I&&S.length>0&&e.jsx("div",{ref:v,className:"absolute top-12 right-0 mt-2 w-full md:w-72 bg-white border border-gray-200 rounded-md shadow-lg z-30",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(G,{className:"mr-2 text-gray-500"})," Recent Searches"]}),e.jsx("ul",{className:"space-y-1",children:S.map((t,o)=>e.jsx("li",{children:e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded",onClick:()=>E(t),children:t})},o))})]})})]}),(d||w)&&e.jsx("p",{className:"text-red-500 mt-2 text-center",children:d||w}),e.jsx("div",{className:"mt-4 text-center",children:N})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 pt-10",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Tips for better searching"})]}),e.jsx("ol",{className:"space-y-3 text-gray-600 list-decimal list-inside",children:k.map((t,o)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5 flex-shrink-0",children:o+1}),e.jsx("span",{children:t})]},o))})]})]})},Q=n=>{var h;return n!=null&&n.isSessionExpired?!0:((h=n==null?void 0:n.response)==null?void 0:h.status)===419},ve=async()=>{try{const h=await F.create().get("/csrf/refresh");if(h.data.csrfToken){const l=h.data.csrfToken;F.defaults.headers.common["X-CSRF-TOKEN"]=l;const g=document.querySelector('meta[name="csrf-token"]');return g&&g.setAttribute("content",l),!0}return!1}catch(n){return console.error("Failed to refresh CSRF token:",n),!1}},U=async(n,h=1)=>{let l=0;const g=async()=>{try{return await n()}catch(f){if(Q(f)&&l<h){if(l++,console.log(`CSRF token mismatch detected. Manual retry attempt ${l}`),await ve())return console.log("Token refreshed, retrying request..."),g();{const j=new Error("Your session has expired. Please refresh the page and try again.");throw j.isSessionExpired=!0,j}}throw f}};return g()};function Ye({auth:n,universities:h,faculties:l,users:g,researchOptions:f,skills:b}){const{isAdmin:j,isPostgraduate:k,isUndergraduate:w,isFacultyAdmin:N,isAcademician:x}=be(),[y,S]=s.useState(""),[a,I]=s.useState("supervisor"),[r,d]=s.useState(!1),[c,v]=s.useState(null),[A,p]=s.useState(null),[T,E]=s.useState(1),[P,t]=s.useState(!1),[o,R]=s.useState(0),C=s.useRef(null),[V,z]=s.useState(!1),[W,X]=s.useState(""),[D,Y]=s.useState(!1),[M,q]=s.useState([]),[_,B]=s.useState([]),[L,$]=s.useState(""),[Z,ee]=s.useState(!1),se=u=>{if(u==="students"&&!x){p("You need to be an academician to search for students.");return}I(u),v(null),p(null)},te=async u=>{if(r||!u||u.trim()==="")return;S(u),d(!0),p(null),E(1),t(!0),R(0);const m=["Analyzing your query...","Converting to semantic vectors...","Searching database for potential matches...","Generating personalized insights with AI...","Finalizing results..."];C.current=setInterval(()=>{R(i=>i>=m.length-1?i:i+1)},2e3);try{const i=await U(()=>F.post(route("ai.matching.search"),{query:u,searchType:a}));i.data&&i.data.matches?v(i.data):p("Received invalid search results")}catch(i){console.error("Search error:",i),Q(i)?p("Your session has expired. Please refresh the page and try again."):i.response&&i.response.data&&i.response.data.error?p(i.response.data.error):p(i.message||"Failed to perform search. Please try again later.")}finally{C.current&&(clearInterval(C.current),C.current=null),t(!1),d(!1)}},re=async()=>{if(D||!c||!c.has_more)return;Y(!0);const u=T+1;try{const m=await U(()=>F.post(route("ai.matching.search"),{query:y,searchType:a,page:u}));m.data&&m.data.matches&&(v(i=>({...m.data,matches:[...i.matches,...m.data.matches]})),E(u))}catch(m){console.error("Error loading more results:",m),Q(m)?p("Your session has expired. Please refresh the page and try again."):p(m.message||"Failed to load more results. Please try again later.")}finally{Y(!1)}},ae=()=>a==="supervisor"?['Be specific about your research area (e.g., "Machine Learning for Medical Imaging" rather than just "AI")','You can use vague queries like "recommend supervisors for me" to get results based on your profile',"Click on suggested research terms to quickly add them to your search"]:a==="students"?["Search for specific research topics to find students interested in those areas","Be specific about methodologies or techniques you're looking for","You can search for broader fields to get a wider range of potential students"]:a==="collaborators"?["Search for research topics that complement your expertise","Look for interdisciplinary opportunities by searching for topics outside your direct field","Use specific methodologies or techniques to find experts in those areas"]:[],ne=()=>a==="supervisor"?"e.g., Artificial Intelligence in Healthcare, Design Science Research...":a==="students"?"e.g., Machine Learning, Quantum Computing, Climate Science...":a==="collaborators"?"e.g., Interdisciplinary AI, Sustainable Development, Data Science...":"Enter your search query...",ie=()=>a==="supervisor"?"Find Your Perfect Research Supervisor":a==="students"?"Find Students for Your Research Projects":a==="collaborators"?"Find Research Collaborators":"AI Matching",le=()=>a==="supervisor"?"Enter your research interest, topic, or field of study below and we'll match you with supervisors who have relevant expertise.":a==="students"?"Enter research topics or methods you're interested in to find students who may be suitable for your research projects.":a==="collaborators"?"Enter research areas or methodologies to find potential academician collaborators for joint research projects.":"Enter your search query below to find matches.",ce=()=>{const u=[{text:"Analyzing your query...",icon:e.jsx(J,{className:"text-blue-500"})},{text:"Converting to semantic vectors...",icon:e.jsx(fe,{className:"text-purple-500"})},{text:"Searching database for potential matches...",icon:e.jsx(ge,{className:"text-green-500"})},{text:"Generating personalized insights with AI...",icon:e.jsx(O,{className:"w-4 h-4 mr-2"})},{text:"Finalizing results...",icon:e.jsx(xe,{className:"text-red-500"})}];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"w-20 h-20 mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u[o].icon}),e.jsx("div",{className:"absolute inset-0 border-t-4 border-blue-500 rounded-full animate-spin opacity-25"})]}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-gray-800",children:"AI Processing"}),e.jsx("p",{className:"text-gray-600 text-center mb-4 min-h-[24px]",children:u[o].text}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-6",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-in-out",style:{width:`${(o+1)*20}%`}})}),e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Our AI is working to find the best matches for your query..."})]})})})},oe=({insight:u,onClose:m})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:i=>{i.target===i.currentTarget&&m()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"AI Match Insight"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:u})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:"Close"})})]})});return e.jsxs(ue,{title:"AI Matching",isPostgraduate:k,isUndergraduate:w,isFacultyAdmin:N,children:[e.jsxs(de,{children:[e.jsx("title",{children:"AI Matching - Nexscholar"}),e.jsx("meta",{name:"description",content:"Find academic matches using AI-powered semantic search"})]}),P&&e.jsx(ce,{}),V&&e.jsx(oe,{insight:W,onClose:()=>z(!1)}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg",children:e.jsxs("div",{className:"p-6 pb-16",children:[e.jsx(we,{onSearch:te,researchOptions:f,isSearching:r,initialQuery:y,pageTitle:ie(),searchDescription:le(),placeholder:ne(),tips:ae(),error:A,children:e.jsx(ye,{currentType:a,onTypeChange:se,isAcademician:x})}),c&&c.matches&&e.jsxs("div",{className:"mt-8 flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"hidden lg:block w-full lg:w-1/4 xl:w-1/5",children:e.jsx(H,{searchType:a,searchResults:c,universities:h,faculties:l,researchOptions:f,selectedArea:M,setSelectedArea:q,selectedUniversity:_,setSelectedUniversity:B,selectedAvailability:L,setSelectedAvailability:$})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(H,{searchType:a,searchResults:c,universities:h,faculties:l,researchOptions:f,selectedArea:M,setSelectedArea:q,selectedUniversity:_,setSelectedUniversity:B,selectedAvailability:L,setSelectedAvailability:$,isOpen:Z,toggleOpen:ee})}),e.jsx("div",{className:"w-full lg:w-3/4 xl:w-4/5",children:e.jsx(pe,{searchType:a,searchResults:c,selectedArea:M,selectedUniversity:_,selectedAvailability:L,onLoadMore:re,isLoadingMore:D,universitiesList:h,faculties:l,researchOptions:f,users:g,skills:b,onShowInsight:u=>{X(u),z(!0)}})})]})]})})]})}export{Ye as default};
