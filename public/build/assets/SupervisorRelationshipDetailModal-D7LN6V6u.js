import{q as ce,r as l,a as F,j as e,y as me}from"./app-iMgHp_eS.js";import{c as w}from"./index---wvTow-.js";import{O as xe,S as pe}from"./modalAnimations-CCENKliM.js";import{g as ue,f as he,a as ve}from"./supervisionHelpers-EJT0WNFw.js";import{T as V,a as B,b as n,c as o}from"./tabs-CLeBf672.js";import{B as f}from"./button-Ct11kXcH.js";import{B as Y}from"./badge-DuxLTqMY.js";import{A as W,a as X}from"./avatar-DEvYxArN.js";import{S as y}from"./scroll-area-Q_LSXepR.js";import{T as fe}from"./textarea-C-VaV38D.js";import{T as be,a as je,b as Ne,c as G}from"./tooltip-D0CFLqml.js";import ge from"./ScheduleMeetingDialog-DJiToYPb.js";import we from"./UnbindRequestModal-CYK_Sg6h.js";import ye from"./ResearchTab-C4H_BnYz.js";import Se from"./DocumentsTab-dCWzE-xi.js";import{T as H}from"./ThreadPane-CINILE3j.js";import _e from"./UnifiedOverviewTab-P7wgwP4w.js";import{R as Te}from"./RelationshipHistoryTab-CbJ_LIZX.js";import{l as S}from"./logError-BloCzXDJ.js";import{A as Re}from"./index-BQ_UROI9.js";import{m as $}from"./proxy-C4MdbyQL.js";import{X as Ce}from"./x-ZEpUl_jb.js";import{C as K}from"./calendar-D8qiMF9A.js";import{V as Me}from"./video-DbcRWLes.js";import{U as Ae}from"./user-minus-DcLlawfv.js";import{E as ke}from"./external-link-CY84SH5d.js";import{L as M}from"./loader-circle-F27clpTW.js";import{U as z}from"./user-round-4L2MoMDj.js";import{G as Ue}from"./graduation-cap-Cm3VtJAw.js";import{G as Ie}from"./globe-Lxab78cb.js";import{S as J}from"./sticky-note-BV0kmiPW.js";import{T as De}from"./trash-2-aKutZ3MS.js";import{f as Q}from"./format-BOijCLBA.js";import"./index-ZtdpDmOR.js";import"./index-CBiZf16v.js";import"./index-CPRTWrZv.js";import"./index-Cezbbkwz.js";import"./index-DKGZNE_Q.js";import"./index-CrTPggVb.js";import"./index-DGrGDkv0.js";import"./index-BF2RFu8G.js";import"./index-BRZqG0or.js";import"./utils-CBfrqCZ4.js";import"./index-CdJFUDDL.js";import"./index-BdQq_4o_.js";import"./index-B_K2CkPG.js";import"./index-BFoK7Kyw.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-Bgv0hvvi.js";import"./index-BJzUWGlx.js";import"./Modal-CtrNcR4a.js";import"./dialog-tgbUGkxp.js";import"./transition-GCCCemnQ.js";import"./input-CdYr2Bcx.js";import"./label-DMRicobw.js";import"./alert-6lJ_2Thn.js";import"./useGoogleCalendar-Dnzaf31b.js";import"./createLucideIcon-BXdi-pyk.js";import"./en-US-DIdCsyf3.js";import"./triangle-alert-tP59DIQ0.js";import"./separator-DqkAodAi.js";import"./plus-DMt_FYHM.js";import"./circle-check-B-nP5cAP.js";import"./circle-DWThn6Qj.js";import"./select-BXNqCCbm.js";import"./index-TSyOZiO6.js";import"./index-vpnpucSR.js";import"./chevron-down-LlZn8pLr.js";import"./check-D26Fs7Uc.js";import"./chevron-up-LkcO-j5k.js";import"./DocumentPreviewModal-CvyHAvcq.js";import"./file-text-C4_We7ct.js";import"./download-DxUHOtTV.js";import"./upload-jrhjc-Cq.js";import"./chevron-right-I-HzKVbz.js";import"./folder-open-ChjFwgTU.js";import"./eye-ZibFgNRD.js";import"./history-B_uv49Ly.js";import"./isSameDay-BHs4V-zU.js";import"./briefcase-DV5twO-B.js";import"./mail-DPmc860V.js";import"./phone-BoFYr4RO.js";import"./calendar-clock-Cu_uFgIh.js";import"./circle-alert-Br8bwMRQ.js";import"./users-B-SRuXWr.js";function ut({relationship:s,onClose:d,onUpdated:a}){const{auth:i}=ce().props,c=s?.preferred_tab||"overview",[x,p]=l.useState(c),[u,t]=l.useState(!1),[j,h]=l.useState(!1);l.useEffect(()=>{s?.preferred_tab&&p(s.preferred_tab)},[s?.preferred_tab]);const[_,Z]=l.useState([]),[A,k]=l.useState(""),[U,I]=l.useState(!1),[D,O]=l.useState(null),[ee,q]=l.useState([]),[se,E]=l.useState(!0);l.useEffect(()=>{s?.id&&(te(),ae())},[s?.id]);const te=async()=>{if(s?.id)try{const r=await F.get(route("supervision.relationships.show",s.id));Z(r.data.data?.notes||[])}catch(r){S(r,"SupervisorRelationshipDetailModal loadNotes")}},ae=async()=>{if(s?.student_id){E(!0);try{const g=(await F.get("/api/v1/app/supervision/relationships",{params:{student_id:s.student_id}})).data.data||[],L=g.find(b=>b.role==="main"&&b.status==="active"),de=g.filter(b=>b.role==="co"&&b.status==="active"),C=[];L&&C.push(L),C.push(...de),q(C)}catch(r){S(r,"SupervisorRelationshipDetailModal loadSupervisors"),q([])}finally{E(!1)}}},re=async()=>{if(!(!A.trim()||U)){I(!0);try{w.success("Note added"),k("")}catch(r){S(r,"SupervisorRelationshipDetailModal handleAddNote"),w.error("Failed to add note")}finally{I(!1)}}},ie=async r=>{if(!D){O(r);try{w.success("Note deleted")}catch(g){S(g,"SupervisorRelationshipDetailModal handleDeleteNote"),w.error("Failed to delete note")}finally{O(null)}}},le=()=>{me.visit(route("supervision.relationships.show",s.id))};if(!s)return null;const m=s?.student??{},T=m.full_name??"Student",P=m.profile_picture?`/storage/${m.profile_picture}`:null,N=s.status??"active",R=s.activeUnbindRequest?"pending_unbind":N,v=N==="active"&&!s.activeUnbindRequest,ne=ue(T),oe=R==="pending_unbind"?"Pending Unbind":he(R);return e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:e.jsx($.div,{...xe,className:"fixed inset-0 z-40 flex items-center justify-end bg-black/50",onClick:d,children:e.jsxs($.div,{...pe,className:"w-full max-w-3xl h-full bg-white shadow-xl overflow-hidden flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(W,{className:"h-12 w-12",children:P?e.jsx("img",{src:P,alt:T,className:"h-full w-full object-cover"}):e.jsx(X,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:ne})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:T}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Student Â· ",s.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-2",children:e.jsx(Y,{className:`${ve(R)} border`,children:oe})})]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(Ce,{className:"h-5 w-5 text-slate-500"})})]})}),e.jsxs("div",{className:"px-6 py-4 border-b bg-slate-50",children:[v&&e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs(f,{variant:"outline",className:"flex-1",onClick:()=>t(!0),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(f,{className:"flex-1 bg-slate-900 hover:bg-slate-800",disabled:!s?.meetings||s.meetings.length===0||!s.meetings[0]?.location_link,onClick:()=>{const r=s?.meetings?.[0];r?.location_link&&window.open(r.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Join Meeting"]})]}),e.jsxs("div",{className:"flex gap-3",children:[v&&e.jsx(be,{children:e.jsxs(je,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx("div",{className:"flex-1",children:e.jsxs(f,{variant:"outline",className:"w-full border-red-300 text-red-700 hover:bg-red-50",onClick:()=>h(!0),disabled:s.activeUnbindRequest||N!=="active",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),s.activeUnbindRequest&&e.jsx(G,{children:e.jsx("p",{children:"Unbind request pending student approval"})}),N!=="active"&&!s.activeUnbindRequest&&e.jsx(G,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})}),e.jsxs(f,{variant:"outline",className:v?"flex-1":"w-full",onClick:le,children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Show Full Page"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(V,{value:x,onValueChange:p,className:"h-full flex flex-col",children:[e.jsxs(B,{className:"px-6 bg-gray-100 w-full justify-start rounded-none h-auto p-0 gap-0",children:[e.jsx(n,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Overview"}),e.jsx(n,{value:"supervisors",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Supervisors"}),e.jsx(n,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Research"}),e.jsx(n,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Documents"}),e.jsx(n,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Chat"}),e.jsx(n,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Notes"}),e.jsx(n,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(o,{value:"overview",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(_e,{relationship:s,person:m,userRole:"supervisor",activeUnbindRequest:s.activeUnbindRequest})})}),e.jsx(o,{value:"supervisors",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(Oe,{supervisors:ee,loading:se})})}),e.jsx(o,{value:"research",className:"mt-0 h-full",children:e.jsx(ye,{relationship:s,onUpdated:a,isReadOnly:!v})}),e.jsx(o,{value:"documents",className:"mt-0 h-full",children:e.jsx(Se,{relationship:s,onUpdated:a,isReadOnly:!v})}),e.jsx(o,{value:"chat",className:"mt-0 h-full",children:e.jsxs(V,{defaultValue:"direct",className:"h-full flex flex-col",children:[e.jsx("div",{className:"px-6 py-2 border-b bg-slate-50",children:e.jsxs(B,{className:"bg-white border border-slate-200",children:[e.jsx(n,{value:"direct",className:"flex-1",children:"Direct Message"}),e.jsx(n,{value:"group",className:"flex-1",disabled:!m?.supervision_group_conversation_id,children:"Team Chat"})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(o,{value:"direct",className:"mt-0 h-full",children:s?.conversation_id?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(H,{conversationId:s.conversation_id,auth:i,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>a?.()})})}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No direct conversation available yet."})})})}),e.jsx(o,{value:"group",className:"mt-0 h-full",children:m?.supervision_group_conversation_id?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(H,{conversationId:m.supervision_group_conversation_id,auth:i,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>a?.()})})}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:"No Team Chat Yet"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Team chat will be created when the first co-supervisor joins"})]})})})]})]})}),e.jsx(o,{value:"notes",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(qe,{notesList:_,newNote:A,setNewNote:k,isAddingNote:U,isDeletingNoteId:D,onAddNote:re,onDeleteNote:ie,isReadOnly:!v})})}),e.jsx(o,{value:"history",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(Te,{relationship:s})})})]})]})})]})})}),e.jsx(ge,{relationship:u?s:null,onClose:()=>t(!1),onScheduled:()=>{t(!1),a?.()},userRole:"supervisor"}),e.jsx(we,{isOpen:j,relationship:s,onClose:()=>h(!1),onUnbindInitiated:()=>{h(!1),d?.(),a?.()},userRole:"supervisor"})]})}function Oe({supervisors:s,loading:d}){return d?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-indigo-600"})})}):s.length===0?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"border border-slate-200 rounded-lg p-8 bg-slate-50 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No Supervisors"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No supervisors assigned to this student yet."})]})}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Supervisors (",s.length,")"]})}),e.jsx("div",{className:"grid gap-4",children:s.map(a=>{const i=a.academician||{},c=i.full_name||"Supervisor",x=i.profile_picture?`/storage/${i.profile_picture}`:null,p=c.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2),u=a.role==="main"?"Main Supervisor":"Co-Supervisor",t=i.university?.name||i.university?.full_name||"",j=i.department||"",h=i.current_position||"";return e.jsx("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(W,{className:"h-14 w-14 flex-shrink-0",children:x?e.jsx("img",{src:x,alt:c,className:"h-full w-full object-cover"}):e.jsx(X,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:p})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-base font-semibold text-slate-900 truncate",children:c}),e.jsx(Y,{className:a.role==="main"?"bg-indigo-100 text-indigo-700 border-indigo-200":"bg-slate-100 text-slate-700 border-slate-200",children:u})]})}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[h&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Ue,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:h})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Ie,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t})]}),j&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(z,{className:"h-4 w-4 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:j})]}),a.accepted_at&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs mt-2",children:[e.jsx(K,{className:"h-3.5 w-3.5 flex-shrink-0"}),e.jsxs("span",{children:["Since ",Q(new Date(a.accepted_at),"dd MMM yyyy")]})]})]})]})]})},a.id)})})]})}function qe({notesList:s,newNote:d,setNewNote:a,isAddingNote:i,isDeletingNoteId:c,onAddNote:x,onDeleteNote:p,isReadOnly:u}){return e.jsxs("div",{className:"p-6 space-y-6",children:[!u&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(fe,{rows:4,value:d,onChange:t=>a(t.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(f,{onClick:x,disabled:!d.trim()||i,children:[i&&e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",s.length,")"]}),s.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(J,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:t.created_at?Q(new Date(t.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!u&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>p(t.id),disabled:c===t.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:c===t.id?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(De,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:t.note})]},t.id))})]})]})}export{ut as default};
