import{r as a,a as N,j as e}from"./app-C9aRItHR.js";import{c as r}from"./index-XngfYQdO.js";import{B as o}from"./button-CSPEol7l.js";import{I as ce}from"./input-BRl5cfeF.js";import{T as me}from"./textarea-DFpeILRG.js";import{B as G}from"./badge-DncnOgy3.js";import{S as xe}from"./scroll-area-BASTW5Mn.js";import{S as ue,a as pe,b as he,c as fe,d as je}from"./select-BZ_YVDv9.js";import"./tabs-CFEHTnnM.js";import{M as $}from"./Modal-Du6oGZ4g.js";import be from"./DocumentPreviewModal-BbmO631w.js";import{l as y}from"./logError-BloCzXDJ.js";import{L as W}from"./loader-circle-gYcNYlpl.js";import{P as K}from"./plus-sqvzTBRi.js";import{F as X}from"./file-text-Dda2OPaZ.js";import{U as Z}from"./upload-CuF1lPos.js";import{C as ge}from"./chevron-down-CZ68gouy.js";import{C as ve}from"./chevron-right-D08KHBfF.js";import{F as we}from"./folder-open-BMedN5wh.js";import{E as J}from"./eye-BQYQL8tl.js";import{c as Ne}from"./createLucideIcon-BKESxhZR.js";import{H as ye}from"./history-BiHZMQAt.js";import{T as De}from"./trash-2-BfSX7cDD.js";import{f as Q}from"./format-BOijCLBA.js";import"./utils-CBfrqCZ4.js";import"./index-CdJFUDDL.js";import"./index-CC4PcrzS.js";import"./index-CCAZcmHJ.js";import"./index-CrClJLlY.js";import"./index-D5McE1bZ.js";import"./index-DQC-i451.js";import"./index-BdQq_4o_.js";import"./index-BqNwAq_Q.js";import"./index-DFuKqaZl.js";import"./index-CPPgYV_S.js";import"./index-COgthb8O.js";import"./index-KT7cPyEo.js";import"./floating-ui.dom-D5EC_49c.js";import"./index-0pjh7AqE.js";import"./index-eZvGyRKK.js";import"./index-Ty945MNA.js";import"./index-DJhbDaIo.js";import"./check-CeJ8h2aY.js";import"./chevron-up-CqJJqoMZ.js";import"./index-h1-N4bqM.js";import"./dialog-vzj-go99.js";import"./transition-BcdIoExo.js";import"./download-DQFhyGLE.js";import"./x-CwXSr9E4.js";import"./en-US-DIdCsyf3.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],_e=Ne("RotateCcw",Ce),q={Drafts:"bg-yellow-50 text-yellow-700 border-yellow-200","Final Papers":"bg-green-50 text-green-700 border-green-200","Meeting Notes":"bg-blue-50 text-blue-700 border-blue-200",Literature:"bg-purple-50 text-purple-700 border-purple-200",Data:"bg-indigo-50 text-indigo-700 border-indigo-200",General:"bg-slate-50 text-slate-700 border-slate-200"};function Cs({relationship:n,onUpdated:u,isReadOnly:d=!1}){const[x,D]=a.useState({}),[j,i]=a.useState([]),[b,V]=a.useState(!0),[C,E]=a.useState(!1),[_,T]=a.useState({}),[p,I]=a.useState(null),[Y,F]=a.useState(!1),[ee,L]=a.useState(!1),[se,B]=a.useState(null),te=15*1024*1024,[h,R]=a.useState(null),[m,H]=a.useState(null),[g,S]=a.useState(""),[U,k]=a.useState("General"),[z,A]=a.useState("");a.useEffect(()=>{v()},[n?.id]);const v=async()=>{if(n?.id){V(!0);try{const s=await N.get(route("supervision.relationships.documents.index",n.id));D(s.data.data.documents_by_folder||{}),i(s.data.data.available_folders||[]);const t=s.data.data.is_read_only||!1,l={};Object.keys(s.data.data.documents_by_folder||{}).forEach(f=>{l[f]=!0}),T(l),t&&!d&&console.log("Documents are read-only: main supervisor relationship not active")}catch(s){y(s,"DocumentsTab loadDocuments"),r.error("Failed to load documents")}finally{V(!1)}}},ae=s=>{const t=s.target.files?.[0];if(t){if(t.size>50*1024*1024){r.error("File size must be less than 50MB");return}R(t)}},le=async()=>{if(!h){r.error("Please select a file to upload");return}if(!m&&!g.trim()){r.error("Please provide a document name");return}E(!0);try{const s=new FormData;s.append("file",h),s.append("folder_category",U),m?s.append("document_id",m):s.append("document_name",g),z.trim()&&s.append("notes",z),await N.post(route("supervision.relationships.documents.upload",n.id),s,{headers:{"Content-Type":"multipart/form-data"}}),r.success(m?"New version uploaded successfully":"Document uploaded successfully"),M(),v(),u?.()}catch(s){y(s,"DocumentsTab handleUpload");const t=s?.response?.data?.message||"Failed to upload document";r.error(t)}finally{E(!1)}},M=()=>{L(!1),R(null),H(null),S(""),k("General"),A("")},w=(s=null,t="General",l="")=>{H(s),k(t),S(l),L(!0)},O=(s,t)=>{const l=t.split(".").pop().toLowerCase(),f=["jpg","jpeg","png","gif","webp","svg"].includes(l),c=l==="pdf";if((f||c)&&s.size<te){const ie=route("supervision.document-versions.preview",s.id),de=route("supervision.document-versions.download",s.id);B({preview_url:ie,download_url:de,original_name:t,mime_type:c?"application/pdf":`image/${l}`,size:s.size,size_formatted:s.size_formatted||`${(s.size/1024).toFixed(1)} KB`,created_at:s.created_at})}else window.open(route("supervision.document-versions.download",s.id),"_blank","noopener,noreferrer")},oe=async(s,t)=>{if(confirm("Are you sure you want to revert to this version?"))try{await N.post(route("supervision.documents.versions.revert",{document:s,version:t})),r.success("Reverted to selected version"),v(),F(!1),u?.()}catch(l){y(l,"DocumentsTab handleRevertVersion"),r.error("Failed to revert version")}},re=async s=>{if(confirm("Are you sure you want to delete this document and all its versions?"))try{await N.delete(route("supervision.documents.destroy",s)),r.success("Document deleted"),v(),u?.()}catch(t){y(t,"DocumentsTab handleDeleteDocument"),r.error("Failed to delete document")}},ne=s=>{T({..._,[s]:!_[s]})};if(b)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(W,{className:"h-8 w-8 animate-spin text-indigo-600"})});const P=Object.values(x).reduce((s,t)=>s+t.length,0);return e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-full",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Documents"}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[P," document",P!==1?"s":""," across ",Object.keys(x).length," folder",Object.keys(x).length!==1?"s":""]})]}),!d&&e.jsxs(o,{onClick:()=>w(),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Upload Document"]})]}),P===0?e.jsxs("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-12 text-center",children:[e.jsx(X,{className:"h-12 w-12 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No documents yet"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:d?"No documents uploaded yet":"Upload your first document to start building your research repository"}),!d&&e.jsxs(o,{onClick:()=>w(),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Upload Document"]})]}):e.jsx("div",{className:"space-y-4",children:j.map(s=>{const t=x[s]||[];if(t.length===0)return null;const l=_[s],f=q[s]||q.General;return e.jsxs("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("button",{onClick:()=>ne(s),className:"flex items-center gap-3 flex-1 min-w-0",children:[l?e.jsx(ge,{className:"h-5 w-5 text-slate-400"}):e.jsx(ve,{className:"h-5 w-5 text-slate-400"}),e.jsx(we,{className:"h-5 w-5 text-slate-600"}),e.jsx("span",{className:"font-semibold text-slate-900",children:s}),e.jsxs(G,{variant:"outline",className:f,children:[t.length," file",t.length!==1?"s":""]})]}),!d&&e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>w(null,s),children:e.jsx(K,{className:"h-4 w-4"})})]}),l&&e.jsx("div",{className:"border-t border-slate-200 p-4 space-y-3",children:t.map(c=>e.jsx(Fe,{document:c,onPreview:O,onDelete:re,onUploadVersion:()=>w(c.id,s,c.name),onViewVersions:()=>{I(c),F(!0)},isReadOnly:d},c.id))})]},s)})})]})}),e.jsx($,{show:ee,onClose:M,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-4",children:m?"Upload New Version":"Upload Document"}),e.jsxs("div",{className:"space-y-4",children:[!m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Document Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{value:g,onChange:s=>S(s.target.value),placeholder:"e.g., Research Proposal Draft"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Folder ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ue,{value:U,onValueChange:k,children:[e.jsx(pe,{children:e.jsx(he,{})}),e.jsx(fe,{children:j.map(s=>e.jsx(je,{value:s,children:s},s))})]})]})]}),m&&e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:["Uploading new version for: ",e.jsx("span",{className:"font-semibold text-slate-900",children:g})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Folder: ",U]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["File ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",onChange:ae,className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"}),h&&e.jsxs("p",{className:"mt-2 text-sm text-slate-600",children:["Selected: ",h.name," (",(h.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Version Notes (Optional)"}),e.jsx(me,{value:z,onChange:s=>A(s.target.value),placeholder:"Add notes about this version...",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(o,{variant:"outline",onClick:M,disabled:C,children:"Cancel"}),e.jsxs(o,{onClick:le,disabled:C,children:[C&&e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload"]})]})]})}),p&&e.jsx($,{show:Y,onClose:()=>{F(!1),I(null)},maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900 mb-4",children:["Version History: ",p.name]}),e.jsx("div",{className:"space-y-3",children:p.versions?.map(s=>{const t=s.id===p.current_version_id;return e.jsx("div",{className:`p-4 rounded-lg border ${t?"bg-indigo-50 border-indigo-200":"bg-white border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:["Version ",s.version_number]}),t&&e.jsx(G,{className:"bg-indigo-600 text-white",children:"Current"})]}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("p",{children:["Uploaded by: ",s.uploader?.full_name||"Unknown"]}),e.jsxs("p",{children:["Date: ",Q(new Date(s.created_at),"dd/MM/yyyy HH:mm")]}),e.jsxs("p",{children:["Size: ",s.size_formatted||`${(s.size/1024).toFixed(1)} KB`]}),s.notes&&e.jsxs("p",{className:"mt-2 text-slate-700",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>O(s,s.original_name),title:"Preview document",children:e.jsx(J,{className:"h-4 w-4"})}),!t&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>oe(p.id,s.id),title:"Revert to this version",children:e.jsx(_e,{className:"h-4 w-4"})})]})]})},s.id)})})]})}),e.jsx(be,{file:se,onClose:()=>B(null)})]})}function Fe({document:n,onPreview:u,onDelete:d,onUploadVersion:x,onViewVersions:D,isReadOnly:j=!1}){const i=n.current_version,b=n.versions?.length||0;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200 hover:border-indigo-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-white rounded-md border border-slate-200",children:e.jsx(X,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-slate-900 truncate",children:n.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500",children:[e.jsxs("span",{children:["v",i?.version_number||1]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i?.uploader?.full_name||i?.uploader?.name||"Unknown"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i?.created_at?Q(new Date(i.created_at),"dd/MM/yyyy"):"—"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>u(i,i?.original_name),title:"Preview document",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsxs(o,{size:"sm",variant:"ghost",onClick:D,title:"View version history",children:[e.jsx(ye,{className:"h-4 w-4"}),b>1&&e.jsx("span",{className:"ml-1 text-xs",children:b})]}),!j&&e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",variant:"ghost",onClick:x,title:"Upload new version",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>d(n.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete document",children:e.jsx(De,{className:"h-4 w-4"})})]})]})]})}export{Cs as default};
