import{c as z}from"./createLucideIcon-CDRXeg4x.js";import{q as J,r as t,W as K,j as r,e as Q,a as X,y as _}from"./app-O3Za6ZI8.js";import{M as Z}from"./Modal-CrwJvZIV.js";import{I as U}from"./InputLabel-CJldWEHo.js";import{I as O}from"./InputError-f0ugWV8F.js";import{P as T}from"./PrimaryButton-ZmKGNhsy.js";import{S as $}from"./SecondaryButton-BufK10Lc.js";import{C as ee}from"./ConfirmationModal-huFfmhrB.js";import{c as g}from"./index-vsb0BAG8.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=z("Info",re);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],he=z("Users",ae),ie=()=>{const[n,m]=t.useState(!1),e=t.useRef(null),i=t.useRef(null),u=()=>{if(e.current&&i.current){const v=e.current.getBoundingClientRect(),c=i.current.getBoundingClientRect();i.current.style.left=`${v.left-c.width/2+v.width/2}px`,i.current.style.top=`${v.top-c.height-10}px`}};return t.useEffect(()=>{if(n)return u(),window.addEventListener("scroll",u),window.addEventListener("resize",u),()=>{window.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[n]),{triggerProps:{ref:e,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1)},tooltipProps:{ref:i,style:{position:"fixed",zIndex:9999,display:n?"block":"none"}},isVisible:n}},le=({children:n,isVisible:m})=>{const[e,i]=t.useState(!1);return t.useEffect(()=>(i(!0),()=>i(!1)),[]),e?Q.createPortal(n,document.body):null};function ge({show:n,onClose:m,context:e,contextType:i,connections:u=[]}){var E,R,I,P,A,F;const{auth:v}=J().props,[c,N]=t.useState(null),[y,f]=t.useState(!1),[C,S]=t.useState([]),{triggerProps:k,tooltipProps:B,isVisible:D}=ie(),p=K({user_id:"",role:"member"}),j=i==="workspace"?(e==null?void 0:e.id)||((E=e==null?void 0:e.data)==null?void 0:E.id):((R=e==null?void 0:e.data)==null?void 0:R.id)||(e==null?void 0:e.id),M=v.user.id===(i==="workspace"?((I=e==null?void 0:e.data)==null?void 0:I.owner_id)||(e==null?void 0:e.owner_id):((P=e==null?void 0:e.data)==null?void 0:P.owner_id)||(e==null?void 0:e.owner_id)),b=i==="workspace"?(A=e==null?void 0:e.data)==null?void 0:A.members:(F=e==null?void 0:e.data)==null?void 0:F.members;t.useEffect(()=>{if(n&&Array.isArray(u)&&Array.isArray(b)){const s=b.map(l=>l.id),a=u.filter(l=>!s.includes(l.id));S(a)}else S([])},[n,u,e,b]);const V=s=>{s.preventDefault(),f(!0);const a=i==="workspace"?"project-hub.workspaces.members.add":"project-hub.projects.members.store";X.post(route(a,j),p.data).then(l=>{g.success("Member added successfully"),p.reset(),_.reload({preserveScroll:!0,onSuccess:()=>{m()},onError:()=>{m(),g.error("Member added but page refresh failed. Please reload the page.")}})}).catch(l=>{var d,h;const o=((h=(d=l.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to add member";g.error(o),f(!1)})},q=s=>{N(s)},W=(s,a)=>{f(!0);const l=i==="workspace"?"project-hub.workspaces.members.update-role":"project-hub.projects.members.update-role";let o;i==="workspace"?o={workspace:j,member:s.id}:o={project:j,member:s.id},_.put(route(l,o),{role:a},{preserveScroll:!0,onSuccess:()=>{g.success("Member role updated successfully")},onError:d=>{const h=Object.values(d).flat()[0]||"Failed to update member role";g.error(h),console.error("Error updating member role:",d)},onFinish:()=>{f(!1)}})},x=()=>{if(!c)return;f(!0);const s=i==="workspace"?"project-hub.workspaces.members.remove":"project-hub.projects.members.destroy";let a;i==="workspace"?a={workspace:j,member:c.id}:a={project:j,member:c.id},_.delete(route(s,a),{},{preserveScroll:!0,onSuccess:()=>{g.success("Member removed successfully"),N(null),m()},onError:l=>{const o=Object.values(l).flat()[0]||"Failed to remove member";g.error(o),console.error("Error removing member:",l),f(!1)},onFinish:()=>{f(!1)}})},w=s=>{if(!s)return"Unknown User";const a=s.academician||s.postgraduate||s.undergraduate;return(a==null?void 0:a.full_name)||s.name},H=s=>{var l,o,d;if(!s)return null;const a=((l=s.academician)==null?void 0:l.profile_picture)||((o=s.postgraduate)==null?void 0:o.profile_picture)||((d=s.undergraduate)==null?void 0:d.profile_picture);return a?`/storage/${a}`:null},Y=i==="workspace"?"Manage Workspace Members":"Manage Project Members";return r.jsxs(r.Fragment,{children:[r.jsx(Z,{show:n,onClose:m,maxWidth:"md",children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:Y}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),b&&b.length>0?r.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-1",children:b.filter(s=>{var l,o;const a=i==="workspace"?((l=e==null?void 0:e.data)==null?void 0:l.owner_id)||(e==null?void 0:e.owner_id):((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id);return s.id!==a}).map(s=>{var o,d,h,L;const a=s.id===(i==="workspace"?((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id):((d=e==null?void 0:e.data)==null?void 0:d.owner_id)||(e==null?void 0:e.owner_id)),l=H(s);return r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 py-3 px-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:l?r.jsx("img",{src:l,alt:w(s),className:"h-full w-full object-cover"}):r.jsx("span",{className:"text-gray-500 text-sm",children:w(s).charAt(0)})}),r.jsxs("div",{className:"ml-3 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:w(s)}),r.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a?"Owner":((h=s.pivot)==null?void 0:h.role)||"Member"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0 ml-4",children:[M&&!a&&r.jsxs("select",{value:((L=s.pivot)==null?void 0:L.role)||"member",onChange:G=>W(s,G.target.value),className:"text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",disabled:y,children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),M&&!a&&r.jsx($,{onClick:()=>q(s),disabled:y,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]})]},s.id)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),M&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),C.length>0?r.jsxs("form",{onSubmit:V,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(U,{htmlFor:"user_id",value:"Select Connection"}),r.jsxs("select",{id:"user_id",name:"user_id",value:p.data.user_id,onChange:s=>p.setData("user_id",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",required:!0,children:[r.jsx("option",{value:"",children:"Select a connection"}),C.map(s=>r.jsx("option",{value:s.id,children:w(s)},s.id))]}),r.jsx(O,{message:p.errors.user_id,className:"mt-2"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(U,{htmlFor:"role",value:"Role"}),r.jsxs("div",{className:"relative ml-2 group",children:[r.jsx(se,{className:"w-4 h-4 text-gray-400 cursor-help",ref:k.ref,onMouseEnter:k.onMouseEnter,onMouseLeave:k.onMouseLeave}),r.jsx(le,{isVisible:D,children:r.jsxs("div",{className:"bg-gray-800 text-white text-xs rounded py-2 px-3 w-64",...B,children:[r.jsx("p",{className:"font-semibold mb-1",children:"Admin:"}),r.jsx("p",{className:"mb-2",children:"Can manage members, boards, and workspace/project settings."}),r.jsx("p",{className:"font-semibold mb-1",children:"Member:"}),r.jsx("p",{children:"Can create and edit content on boards they have access to."}),r.jsx("div",{className:"absolute bottom-0 right-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})})]})]}),r.jsxs("select",{id:"role",name:"role",value:p.data.role,onChange:s=>p.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),r.jsx(O,{message:p.errors.role,className:"mt-2"})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(T,{type:"submit",disabled:y||!p.data.user_id,children:y?"Sending...":"Send Invitation"})})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:r.jsx("p",{className:"text-sm text-yellow-700",children:"You have no available connections to invite. Connect with other users first."})})]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx($,{onClick:m,children:"Close"})})]})}),r.jsx(ee,{show:!!c,onClose:()=>N(null),onConfirm:x,title:"Remove Member",message:c?`Are you sure you want to remove ${w(c)} from this ${i}?`:""})]})}export{ge as M,he as U};
