import{q as y,r as v,j as e}from"./app-Doi1BfNX.js";import{D as u,a as w,b as _,c as T}from"./dialog-C8864PzU.js";import{T as k,a as S,b as C,c as x}from"./tabs-BgtJ-Aqh.js";import{B as f}from"./button-KPEq8PdI.js";import{B as A}from"./badge-Be2D36dO.js";import{S as P}from"./separator-C2wGlHlc.js";import{S as p}from"./scroll-area-Du06xGgY.js";import{T as D}from"./ThreadPane-B5BIAZi7.js";import{m}from"./proxy-BUFhk0Wh.js";import{C as E}from"./clipboard-list-DrTWdQ-4.js";import{F as B}from"./file-text-CjHuEEW2.js";import{C as g}from"./calendar-clock-DWMtvC7-.js";import{H as h}from"./history-CYjZsRfK.js";import{f as j}from"./format-Dv9Rm441.js";import"./index-DGcNwIW4.js";import"./index-B_QUZuO0.js";import"./index-FRhtyj0h.js";import"./index-Be4Hbpsc.js";import"./index-CkAoBwhz.js";import"./index-CZA6k5rr.js";import"./index-BdR5mO0l.js";import"./index-CU8Rt2qH.js";import"./tslib.es6-CmEaCU22.js";import"./utils-D-KgF5mV.js";import"./x-DrXySrr5.js";import"./createLucideIcon-BIWf6Fgr.js";import"./index-BGtqCWya.js";import"./index-Ct-Jk4RI.js";import"./index-Bb94jkfk.js";import"./index-CGrAONsN.js";import"./index-BdQq_4o_.js";import"./Modal-BjJ_nX2Q.js";import"./dialog-DYcl7DcC.js";import"./transition-Dk-vnbkR.js";import"./download-Xk6ccwe6.js";import"./index-dbiIR3J5.js";import"./isSameDay-Dm-A-V7S.js";import"./en-US-DNUEYIb-.js";const M=["overview","proposal","chat","meetings","history"];function Te({request:s,relationship:a,onClose:t,onUpdated:c}){const{auth:l}=y().props,[r,d]=v.useState(()=>(s==null?void 0:s.preferred_tab)??"overview"),n=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),o=v.useMemo(()=>M.filter(i=>i==="chat"?!!n:!0),[n]);v.useEffect(()=>{if(!(s!=null&&s.preferred_tab)&&!(a!=null&&a.preferred_tab))return;const i=(s==null?void 0:s.preferred_tab)??(a==null?void 0:a.preferred_tab);i&&i!==r&&o.includes(i)&&d(i)},[s==null?void 0:s.preferred_tab,a==null?void 0:a.preferred_tab,o,r]);const b=i=>{d(i),i==="chat"&&n&&(window==null||window.dispatchEvent(new CustomEvent("supervision:openConversation",{detail:{conversationId:n}})))};return s==null||s.attachments,e.jsx(u,{open:!!(s||a),onOpenChange:i=>i?null:t==null?void 0:t(),children:e.jsxs(w,{className:"max-h-[90vh] w-full max-w-4xl overflow-hidden p-0",children:[e.jsx(_,{className:"px-6 pb-4 pt-6",children:e.jsx(T,{className:"text-xl font-semibold",children:a?"Supervision details":"Proposal details"})}),e.jsx(P,{}),e.jsx(m.div,{className:"px-6 py-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.3},children:e.jsxs(k,{value:r,onValueChange:b,className:"space-y-4",children:[e.jsx(S,{className:"flex w-full flex-wrap gap-2 bg-transparent p-0",children:o.map(i=>e.jsx(C,{value:i,className:"rounded-full border border-slate-200 px-4",children:L[i]??i},i))}),e.jsx(x,{value:"overview",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(m.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(H,{request:s,relationship:a})})})}),e.jsx(x,{value:"proposal",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(m.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(I,{request:s})})})}),n?e.jsx(x,{value:"chat",className:"m-0",children:e.jsx(m.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},className:"max-h-[60vh] rounded-lg border border-slate-200",children:e.jsx(D,{conversationId:n,auth:l,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>c==null?void 0:c()})})}):null,e.jsx(x,{value:"meetings",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(m.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(O,{relationship:a})})})}),e.jsx(x,{value:"history",className:"m-0",children:e.jsx(p,{className:"max-h-[60vh] pr-4",children:e.jsx(m.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:e.jsx(W,{request:s,relationship:a})})})})]})})]})})}const L={overview:"Overview",proposal:"Proposal",chat:"Conversation",meetings:"Meetings",history:"History"};function H({request:s,relationship:a}){const t=(a==null?void 0:a.academician)??(s==null?void 0:s.academician),c=(a==null?void 0:a.student)??(s==null?void 0:s.student),l=(a==null?void 0:a.status)??(s==null?void 0:s.status)??"pending",r=(s==null?void 0:s.conversation_id)||(a==null?void 0:a.conversation_id),d=[{label:"Student",value:(c==null?void 0:c.full_name)??"Student details unavailable",badge:c?"Postgraduate":null},{label:"Supervisor",value:(t==null?void 0:t.full_name)??"Supervisor not assigned yet",badge:t?"Supervisor":null},{label:"Status",value:N(l)},{label:"Meeting cadence",value:a!=null&&a.meeting_cadence?a.meeting_cadence.charAt(0).toUpperCase()+a.meeting_cadence.slice(1):"Not set"},{label:"Accepted on",value:a!=null&&a.accepted_at?j(new Date(a.accepted_at),"PPP"):"Pending acceptance"},{label:"NexLab",value:a!=null&&a.scholarlab_board_id?"Workspace ready":"Workspace not provisioned"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Supervision summary"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Key milestones, cadence, and workspace access."})]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:d.map((n,o)=>e.jsx(F,{label:n.label,value:n.value,badge:n.badge},o))})]}),!r&&e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-700",children:"Conversation not yet active"}),e.jsx("p",{className:"mt-1",children:"Your proposal has not opened a chat thread. When a supervisor responds or you send a message, the messaging tab will appear here."})]})]})}function I({request:s}){var a;return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-800",children:"Proposal"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Submitted materials accompanying your request."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Motivation"}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-slate-700",children:s.motivation||"No motivation provided."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wide text-slate-500",children:"Attachments"}),(a=s.attachments)!=null&&a.length?e.jsx("div",{className:"space-y-2",children:s.attachments.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 px-4 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 capitalize",children:t.type.replace("_"," ")}),e.jsx("div",{className:"text-xs text-slate-500",children:t.original_name})]}),e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:`/storage/${t.path}`,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]},t.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No attachments were included."})]})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Proposal details unavailable."})}function O({relationship:s}){const a=(s==null?void 0:s.meetings)??[];return a.length?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(g,{className:"h-4 w-4 text-indigo-500"}),"Upcoming meetings"]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.title}),e.jsx("div",{className:"text-xs text-slate-500",children:j(new Date(t.scheduled_for),"PPpp")})]}),t.location_link&&e.jsx(f,{variant:"link",className:"text-indigo-600",asChild:!0,children:e.jsx("a",{href:t.location_link,target:"_blank",rel:"noopener noreferrer",children:"Join"})})]}),t.agenda&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:t.agenda})]},t.id))})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(g,{className:"h-4 w-4 text-indigo-500"}),"Meetings"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"No meetings scheduled yet. Coordinate with your supervisor to agree on a first session."}),e.jsx("div",{className:"rounded-lg border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"When meetings are scheduled they will appear here with quick links and agenda details."})})]})}function W({request:s,relationship:a}){const t=v.useMemo(()=>{const c=Array.isArray(s==null?void 0:s.timeline)?s.timeline:[],l=Array.isArray(a==null?void 0:a.timeline)?a.timeline:[];return[...c,...l].sort((r,d)=>new Date(r.created_at)-new Date(d.created_at))},[s==null?void 0:s.timeline,a==null?void 0:a.timeline]);return t.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(h,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{var l;return e.jsxs("div",{className:"rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-800 capitalize",children:N(c.event_type)}),c.created_at&&e.jsx("span",{className:"text-xs text-slate-500",children:j(new Date(c.created_at),"PPpp")})]}),c.metadata&&e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:((l=c.metadata)==null?void 0:l.description)??JSON.stringify(c.metadata)})]},c.id??`${c.event_type}-${c.created_at}`)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("header",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx(h,{className:"h-4 w-4 text-indigo-500"}),"Activity history"]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:e.jsx("p",{children:"Timeline events will appear here as your supervision progresses. Published milestones (submitted, meetings, decisions) will stream in once backend tracking is enabled."})})]})}function N(s){return s?s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()):"Event"}function F({label:s,value:a,badge:t}){return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:s}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-slate-700",children:a}),t&&e.jsx(A,{variant:"outline",className:"border-indigo-200 text-indigo-600 text-[11px]",children:t})]})]})}export{Te as default};
