import{r as n,j as e,a as x}from"./app-BodExSbw.js";import{M as je}from"./MainLayout-Bp1_OxBa.js";import ke from"./GuidedSearchInterface-jviLOp5S.js";import{R as Ne}from"./ProgressiveLoadingResults-HuV_VohA.js";import{f as Ie}from"./index-B0mazbmy.js";import{u as Re}from"./useRoles-DYep_ysd.js";import Ce from"./FilterPanel-D9RIMemM.js";import Me from"./TopMatchesPreview-D_vJ8xXr.js";import{c as w}from"./utils-D-KgF5mV.js";import{A as Te}from"./index-DwEPtsR4.js";import{m as H}from"./proxy-Bi0KVEdU.js";import{S as Ae}from"./sparkles-DIqdAKHq.js";import"./house-BQSV5ZRq.js";import"./createLucideIcon-plmRflaj.js";import"./zap-QL5-gQuF.js";import"./users-DczRUbjv.js";import"./folder-open-b1dfqSPu.js";import"./settings-Ct90E523.js";import"./chevron-left-CSuVH0pe.js";import"./user-round-ujBW7jHx.js";import"./clipboard-list-c3a65Mss.js";import"./dollar-sign-CyGQni_w.js";import"./calendar-B_CZibmO.js";import"./file-text-CbeunphJ.js";import"./message-square-D6KZh6aw.js";import"./graduation-cap-DVTjW2kl.js";import"./building-Dyn5e6Ca.js";import"./Dropdown-CU0gINjP.js";import"./transition-DOpmeePd.js";import"./bookmark-DSAXiPoX.js";import"./folder-kanban-Cx39SczI.js";import"./building-2-KMWe0qjh.js";import"./database-E5SqIg4b.js";import"./shield-Czp8r-vJ.js";import"./analytics-BQ374C1C.js";import"./index-mDeC9k3u.js";import"./supervisionConstants-BuM5-H5X.js";import"./button-DBoeCbAi.js";import"./Modal-BAfxSvqC.js";import"./dialog-yB7Y4Mvq.js";import"./PrimaryButton-C1d_gtIH.js";import"./SecondaryButton-DbXFhniO.js";import"./x-hDgAYzkQ.js";import"./chevron-right-R9vm_i8s.js";import"./search-CcfjS-o3.js";import"./circle-check-big-DTR_eKry.js";import"./tooltip-B0O2cJGD.js";import"./index-BNbWxI0H.js";import"./index-CuEpCwL6.js";import"./index-BJkGQNDv.js";import"./index-CtmDxyuO.js";import"./index-BBnFLmbe.js";import"./index-C0YnOByL.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-BbHqW-rW.js";import"./index-D7Nzv7pr.js";import"./index-CbELOpWX.js";import"./briefcase-BpSSXkaq.js";import"./user-Dsu1AnUj.js";import"./chevron-down-nQDcq6tx.js";import"./history-DoNeWKAs.js";import"./RecommendationModal-Dn5Wa79_.js";import"./RecommendationDisplay-BV6S_JNF.js";import"./ProfileCard-DHJnY2Og.js";import"./BookmarkButton-D2z9wsPj.js";import"./BookmarkHandler-B5ffAgMt.js";import"./ConnectionButton-97c5xjd1.js";import"./ProposalModal-IsOkCrZe.js";import"./dialog-DSf4Hw3_.js";import"./index-UyMSTuQx.js";import"./index---8uu-Q5.js";import"./tslib.es6-CmEaCU22.js";import"./input-C2RNHGC9.js";import"./textarea-BOIQB42l.js";import"./label-BPOuFRJU.js";import"./index-CGrAONsN.js";import"./alert-CvPXVyA9.js";import"./checkbox-BbFk3kcJ.js";import"./index-BU_vkww_.js";import"./check-CzANbjxc.js";import"./logError-D4ezqrCx.js";import"./lightbulb-9R2fYqeX.js";import"./cloud-upload-BaLKszi4.js";import"./paperclip-11Oey-PP.js";import"./loader-circle-Cw7Nqhid.js";import"./dropdown-menu-Cro64dXV.js";import"./index-D4c9OpUc.js";import"./index-DVO2p-KC.js";import"./index-B08zmKDA.js";import"./circle-BPjIECXT.js";import"./ellipsis-vertical-C16tpVvO.js";import"./mail-DW8LOIRf.js";import"./star-CKG_Xh-5.js";import"./bookmark-plus-DTNRCtfx.js";import"./circle-check-C3TcVouP.js";import"./eye-B653hH95.js";import"./send--guiEmGs.js";import"./react-select.esm-DvMGohvK.js";import"./createReactComponent-3i9aWfov.js";const Ee=({className:o})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:w("w-6 h-6 ",o),children:e.jsx("path",{d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),qe=({className:o})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:w("w-6 h-6 ",o),children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"})}),_e=({loadingStates:o,value:i=0})=>e.jsx("div",{className:"flex relative justify-start max-w-xl mx-auto flex-col mt-40",children:o.map((p,l)=>{const u=Math.abs(l-i),d=Math.max(1-u*.2,0);return e.jsxs(H.div,{className:w("text-left flex gap-2 mb-4"),initial:{opacity:0,y:-(i*40)},animate:{opacity:d,y:-(i*40)},transition:{duration:.5},children:[e.jsxs("div",{children:[l>i&&e.jsx(Ee,{className:"text-black dark:text-white"}),l<=i&&e.jsx(qe,{className:w("text-black dark:text-white",i===l&&"text-black dark:text-lime-500 opacity-100")})]}),e.jsx("span",{className:w("text-black dark:text-white",i===l&&"text-black dark:text-lime-500 opacity-100"),children:p.text})]},l)})}),Le=({loadingStates:o,loading:i,duration:p=2e3,loop:l=!0})=>{const[u,d]=n.useState(0);return n.useEffect(()=>{if(!i){d(0);return}const y=setTimeout(()=>{d(f=>l?f===o.length-1?0:f+1:Math.min(f+1,o.length-1))},p);return()=>clearTimeout(y)},[u,i,l,o.length,p]),e.jsx(Te,{mode:"wait",children:i&&e.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"w-full h-full fixed inset-0 z-[100] flex items-center justify-center backdrop-blur-2xl",children:[e.jsx("div",{className:"h-96  relative",children:e.jsx(_e,{value:u,loadingStates:o})}),e.jsx("div",{className:"bg-gradient-to-t inset-x-0 z-20 bottom-0 bg-white dark:bg-black h-full absolute [mask-image:radial-gradient(900px_at_center,transparent_30%,white)]"})]})})},D=o=>{var i;return o!=null&&o.isSessionExpired?!0:((i=o==null?void 0:o.response)==null?void 0:i.status)===419},Pe=async()=>{try{const i=await x.create().get("/csrf/refresh");if(i.data.csrfToken){const p=i.data.csrfToken;x.defaults.headers.common["X-CSRF-TOKEN"]=p;const l=document.querySelector('meta[name="csrf-token"]');return l&&l.setAttribute("content",p),!0}return!1}catch(o){return console.error("Failed to refresh CSRF token:",o),!1}},Z=async(o,i=1)=>{let p=0;const l=async()=>{try{return await o()}catch(u){if(D(u)&&p<i){if(p++,console.log(`CSRF token mismatch detected. Manual retry attempt ${p}`),await Pe())return console.log("Token refreshed, retrying request..."),l();{const y=new Error("Your session has expired. Please refresh the page and try again.");throw y.isSessionExpired=!0,y}}throw u}};return l()};function Es({auth:o,universities:i,faculties:p,users:l,researchOptions:u,skills:d}){const{isAdmin:y,isPostgraduate:f,isUndergraduate:Fe,isFacultyAdmin:De,isAcademician:b}=Re(),j=(s,r="supervisor")=>`${s}_${o.user.id}_${r}`,k=(s,r,t)=>{try{const c=j(s,r),A=sessionStorage.getItem(c);return A?JSON.parse(A):t}catch(c){return console.error("Error reading from sessionStorage",c),t}},E=b?"students":"supervisor",[a,X]=n.useState(E),[v,N]=n.useState(()=>k("ai_search_query",E,"")),[B,O]=n.useState(!1),[m,I]=n.useState(()=>k("ai_search_results",E,null)),[ee,h]=n.useState(null),[te,Q]=n.useState(1),[se,Y]=n.useState(!1),[re,q]=n.useState(!1),[ae,z]=n.useState(""),[K,U]=n.useState(!1),[_,g]=n.useState("search"),[R,oe]=n.useState([]),[C,ie]=n.useState([]),[M,ne]=n.useState(""),[T,le]=n.useState([]),[$,L]=n.useState([]),[G,P]=n.useState(null),[Oe,J]=n.useState(!1),[ce,V]=n.useState(!1);n.useEffect(()=>()=>{try{const s=j("ai_search_query",a),r=j("ai_search_results",a);sessionStorage.setItem(s,JSON.stringify(v)),sessionStorage.setItem(r,JSON.stringify(m))}catch(s){console.error("Error saving to sessionStorage",s)}},[v,m,a,o.user.id]);const me=s=>{var c;if(console.log("🔄 Search type changing:",{from:a,to:s,isAcademician:b}),s==="students"&&!b){console.warn("⚠️ Access denied: Only academicians can search for students"),h("You need to be an academician to search for students.");return}const r=k("ai_search_query",s,""),t=k("ai_search_results",s,null);console.log("💾 Loading saved state for new search type:",{searchType:s,hasSavedQuery:!!r,hasSavedResults:!!t,savedResultsCount:((c=t==null?void 0:t.matches)==null?void 0:c.length)||0}),X(s),N(r),I(t),h(null),t&&t.matches&&t.matches.length>0?(console.log("✅ Showing preview with cached results"),g("preview")):(console.log("✅ Showing search interface"),g("search"))};n.useEffect(()=>{(async()=>{var r,t;if(!f||a!=="supervisor"){L([]),P(null);return}J(!0);try{const c=await x.get(route("supervision.requests.index"));L(((r=c.data)==null?void 0:r.data)||[]);const F=(((t=(await x.get(route("supervision.relationships.index"))).data)==null?void 0:t.data)||[]).find(S=>S.status==="active"&&S.role==="main");P(F||null)}catch(c){console.error("Error fetching supervision data:",c)}finally{J(!1)}})()},[f,a]);const W=()=>{f&&a==="supervisor"&&(async()=>{var r,t;try{const c=await x.get(route("supervision.requests.index"));L(((r=c.data)==null?void 0:r.data)||[]);const F=(((t=(await x.get(route("supervision.relationships.index"))).data)==null?void 0:t.data)||[]).find(S=>S.status==="active"&&S.role==="main");P(F||null)}catch(c){console.error("Error refreshing supervision data:",c)}})()},pe=async s=>{if(B||!s||s.trim()==="")return;const r=j("ai_search_results",a);sessionStorage.removeItem(r),N(s),O(!0),h(null),Q(1),Y(!0);try{console.log("📤 Sending search request:",{query:s,searchType:a,currentSearchTypeState:a,timestamp:new Date().toISOString()});const t=await Z(()=>x.post(route("ai.matching.search"),{query:s,searchType:a}));t.data&&t.data.matches?(console.log("📥 Received response:",{searchType:t.data.searchType,totalMatches:t.data.total,matchTypes:t.data.matches.map(c=>c.result_type),firstMatch:t.data.matches[0]}),I(t.data),g("preview")):(console.error("❌ Invalid search results:",t.data),h("Received invalid search results"))}catch(t){console.error("Search error:",t),D(t)?h("Your session has expired. Please refresh the page and try again."):t.response&&t.response.data&&t.response.data.error?h(t.response.data.error):h(t.message||"Failed to perform search. Please try again later.")}finally{Y(!1),O(!1)}},ue=()=>{g("full"),window.scrollTo({top:0,behavior:"smooth"})},he=()=>{g("search"),I(null),N(""),h(null)},de=()=>{g("preview"),window.scrollTo({top:0,behavior:"smooth"})},xe=async()=>{if(K||!m||!m.has_more)return;U(!0);const s=te+1;try{const r=await Z(()=>x.post(route("ai.matching.search"),{query:v,searchType:a,page:s}));r.data&&r.data.matches&&(I(t=>!t||!t.matches?r.data:{...r.data,matches:[...t.matches,...r.data.matches]}),Q(s))}catch(r){console.error("Error loading more results:",r),D(r)?h("Your session has expired. Please refresh the page and try again."):h(r.message||"Failed to load more results. Please try again later.")}finally{U(!1)}},fe=()=>a==="supervisor"?['Be specific about your research area (e.g., "Machine Learning for Medical Imaging" rather than just "AI")','You can use vague queries like "recommend supervisors for me" to get results based on your profile',"Click on suggested research terms to quickly add them to your search"]:a==="students"?["Search for specific research topics to find students interested in those areas","Be specific about methodologies or techniques you're looking for","You can search for broader fields to get a wider range of potential students"]:a==="collaborators"?["Search for research topics that complement your expertise","Look for interdisciplinary opportunities by searching for topics outside your direct field","Use specific methodologies or techniques to find experts in those areas"]:[],ge=()=>a==="supervisor"?"e.g., Artificial Intelligence in Healthcare, Design Science Research...":a==="students"?"e.g., Machine Learning, Quantum Computing, Climate Science...":a==="collaborators"?"e.g., Interdisciplinary AI, Sustainable Development, Data Science...":"Enter your search query...",ye=()=>a==="supervisor"?"Find Your Perfect Research Supervisor":a==="students"?"Find Students for Your Research Projects":a==="collaborators"?"Find Research Collaborators":"AI Matching",ve=()=>a==="supervisor"?"Enter your research interest, topic, or field of study below and we'll match you with supervisors who have relevant expertise.":a==="students"?"Enter research topics or methods you're interested in to find students who may be suitable for your research projects.":a==="collaborators"?"Enter research areas or methodologies to find potential academician collaborators for joint research projects.":"Enter your search query below to find matches.",Se=[{text:"Analyzing your query..."},{text:"Converting to semantic vectors..."},{text:"Searching database for potential matches..."},{text:"Generating personalized insights with AI..."},{text:"Finalizing results..."}],we=({insight:s,onClose:r})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:t=>{t.target===t.currentTarget&&r()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"AI Match Insight"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:s})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:"Close"})})]})});return e.jsxs(je,{title:"AI Matching",children:[e.jsx(Le,{loadingStates:Se,loading:se,duration:2e3,loop:!1}),re&&e.jsx(we,{insight:ae,onClose:()=>q(!1)}),e.jsxs("div",{className:"w-full",children:[_==="search"&&e.jsx("div",{className:"h-[calc(100vh-100px)] sm:h-[calc(100vh-110px)] bg-white overflow-hidden flex items-start justify-center pt-[calc(50vh-180px)] sm:pt-[calc(50vh-200px)]",children:e.jsx(ke,{onSearch:pe,researchOptions:u,isSearching:B,initialQuery:v,pageTitle:ye(),searchDescription:ve(),placeholder:ge(),tips:fe(),error:ee,searchQuery:v,onSearchQueryChange:N,searchType:a,onSearchTypeChange:me,isAcademician:b,userId:o.user.id})}),_==="preview"&&m&&m.matches&&e.jsxs("div",{className:"min-h-screen bg-white py-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-0 md:px-6 lg:px-8 xl:px-0 mb-6",children:e.jsxs("button",{onClick:he,className:"flex items-center text-gray-600 hover:text-gray-900 font-medium transition-colors group",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Search"]})}),e.jsx(Me,{searchResults:m,universitiesList:i,researchOptions:u,users:l,searchType:a,supervisionRequests:$,activeRelationship:G,onRequestSubmitted:W,onViewAllResults:ue,onQuickInfoClick:()=>{},onRecommendClick:()=>{},onShowInsight:s=>{z(s),q(!0)}})]}),_==="full"&&m&&m.matches&&e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 pt-4 sm:pt-6 md:pt-8 pb-4 sm:pb-6 md:pb-8",children:e.jsxs("div",{className:"space-y-4 sm:space-y-0 sm:grid sm:grid-cols-12 sm:gap-4 sm:items-center",children:[e.jsx("div",{className:"sm:col-span-3 lg:col-span-2",children:e.jsxs("button",{onClick:de,className:`inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 font-medium 
                               transition-all duration-300 group text-sm sm:text-base`,children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 group-hover:-translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden xs:inline",children:"Back to Top 5"}),e.jsx("span",{className:"xs:hidden",children:"Back"})]})}),e.jsxs("div",{className:"sm:col-span-6 lg:col-span-8 text-center",children:[e.jsxs("div",{className:"flex flex-col xs:flex-row items-center justify-center gap-2 mb-2",children:[e.jsx("h2",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900",children:"All Results"}),e.jsx("span",{className:`inline-flex items-center px-2.5 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-semibold 
                                     bg-gradient-to-r from-blue-500 to-purple-500 text-white`,children:m.total_count||m.total||m.matches.length})]}),e.jsx("div",{className:"h-0.5 sm:h-1 w-12 sm:w-16 md:w-24 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mx-auto"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 mt-2 px-2 sm:px-4 line-clamp-1",children:['Matches for "',m.query,'"']})]}),e.jsx("div",{className:"sm:col-span-3 lg:col-span-2 flex justify-end",children:e.jsxs("button",{onClick:()=>V(!0),className:`w-full sm:w-auto inline-flex items-center justify-center gap-2 
                               px-4 sm:px-5 py-2.5 sm:py-3 
                               bg-gradient-to-r from-blue-600 to-purple-600 
                               hover:from-blue-700 hover:to-purple-700 
                               active:scale-95 sm:active:scale-100
                               text-white font-semibold rounded-xl 
                               shadow-lg hover:shadow-xl 
                               transition-all duration-300 sm:hover:scale-105 
                               group relative touch-manipulation`,children:[e.jsx(Ie,{className:"text-base sm:text-lg group-hover:rotate-12 transition-transform"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Filters"}),(R.length>0||C.length>0||T.length>0||M)&&e.jsx("span",{className:`absolute -top-1.5 sm:-top-2 -right-1.5 sm:-right-2 
                                       bg-red-500 text-white text-xs font-bold rounded-full 
                                       h-5 w-5 sm:h-6 sm:w-6 
                                       flex items-center justify-center animate-pulse`,children:R.length+C.length+T.length+(M?1:0)})]})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 pb-12 sm:pb-16",children:e.jsx(Ne,{searchType:a,searchResults:m,selectedArea:R,selectedUniversity:C,selectedAvailability:M,selectedSkills:T,onLoadMore:xe,isLoadingMore:K,universitiesList:i,faculties:p,researchOptions:u,users:l,skills:d,supervisionRequests:$,activeRelationship:G,onRequestSubmitted:W,onShowInsight:s=>{z(s),q(!0)}})}),e.jsx(Ce,{searchType:a,searchResults:m,universities:i,faculties:p,researchOptions:u,skills:d,selectedArea:R,setSelectedArea:oe,selectedUniversity:C,setSelectedUniversity:ie,selectedAvailability:M,setSelectedAvailability:ne,selectedSkills:T,setSelectedSkills:le,isOpen:ce,onClose:()=>V(!1)})]})]})]})}export{Es as default};
