import{r as j,j as e,b as v}from"./app-A8xQkvSk.js";import{c as m}from"./index-Km-vM6Jb.js";import{B as g}from"./button-Dz_rydmG.js";import{B as M}from"./badge-CFoP9Krf.js";import{A as U,a as _}from"./avatar-CbIr_OjG.js";import"./textarea-DGdKxzUN.js";import{A as Y,a as T}from"./alert-BBFXwXFc.js";import $ from"./RejectUnbindModal-DQez5DeH.js";import{l as N}from"./logError-D4ezqrCx.js";import{L as w}from"./loader-circle-DkpR38mE.js";import{T as y}from"./triangle-alert-BND9SWEh.js";import{C as I}from"./calendar-EpaZ4Aad.js";import{C as B}from"./clock-CrVAeSun.js";import{C as P}from"./circle-x-R0AwPcda.js";import{C as D}from"./circle-check-ddCD_g9w.js";import{f as C}from"./format-hTuirObu.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-Dp3B9jqt.js";import"./createLucideIcon-DPzobtnR.js";import"./en-US-DNUEYIb-.js";function ce({unbindRequest:r,relationship:t,onResponse:i,userRole:q="student"}){var f;const[n,l]=j.useState(!1),[A,d]=j.useState(!1);if(!r||!t)return null;const c=r.initiated_by==="student",h=q==="supervisor",o=c?(t==null?void 0:t.student)??{}:(t==null?void 0:t.academician)??{},x=o.full_name??(c?"Student":"Supervisor"),p=o.profile_picture?`/storage/${o.profile_picture}`:null,b=r.attempt_count??1,s=b>=3,F=x.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,3),S=async()=>{l(!0);try{const a=h?"supervision.unbind-requests.supervisor-approve":"supervision.unbind-requests.approve";await v.post(route(a,r.id)),m.success("Unbind request accepted. Your supervision relationship has been terminated."),l(!1),i==null||i()}catch(a){N(a,"ForceUnbindRequestModal handleAccept"),m.error("Failed to accept unbind request"),l(!1)}},k=async a=>{l(!0);try{const u=h?"supervision.unbind-requests.supervisor-reject":"supervision.unbind-requests.reject";await v.post(route(u,r.id),{reason:a||""}),m.success("Unbind request rejected"),d(!1),l(!1),i==null||i()}catch(u){N(u,"ForceUnbindRequestModal handleRejectConfirm"),m.error("Failed to reject unbind request"),l(!1),d(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden mx-4 relative",children:[n&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-8 w-8 animate-spin text-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Processing your response..."})]})}),e.jsx("div",{className:`p-6 border-b ${s?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${s?"bg-red-100":"bg-amber-100"}`,children:e.jsx(y,{className:`h-6 w-6 ${s?"text-red-600":"text-amber-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-red-900":"text-amber-900"}`,children:s?"Final Unbind Request":"Unbind Request Received"}),e.jsx("p",{className:`text-sm mt-1 ${s?"text-red-700":"text-amber-700"}`,children:s?"This is the final attempt. You must respond to this request.":c?"Your student has requested to terminate the supervision relationship.":"Your supervisor has requested to terminate the supervision relationship."})]}),e.jsxs(M,{variant:s?"destructive":"warning",className:"flex-shrink-0",children:["Attempt ",b,"/3"]})]})}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx(U,{className:"h-12 w-12",children:p?e.jsx("img",{src:p,alt:x,className:"h-full w-full object-cover"}):e.jsx(_,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:F})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:x}),e.jsx("p",{className:"text-sm text-slate-600",children:c?((f=o==null?void 0:o.university)==null?void 0:f.name)||"Student":t.role==="main"?"Main Supervisor":"Co-Supervisor"}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Started: ",t.accepted_at?C(new Date(t.accepted_at),"dd/MM/yyyy"):"—"]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Reason for Unbind Request:"}),e.jsx("div",{className:"p-4 bg-slate-50 rounded-lg border border-slate-200",children:e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:r.reason||"No reason provided."})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(B,{className:"h-3 w-3"}),e.jsxs("span",{children:["Submitted: ",r.created_at?C(new Date(r.created_at),"dd/MM/yyyy HH:mm"):"—"]})]})]}),e.jsxs(Y,{variant:s?"destructive":"default",className:s?"border-red-300 bg-red-50":"border-amber-300 bg-amber-50",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx(T,{className:s?"text-red-800":"text-amber-800",children:s?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"This is the final unbind request."})," This relationship will be terminated. You will no longer have access to ",c?"this student":"this supervisor",', but you can view the relationship history in the "Terminated" tab.']}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Important:"})," If you reject this request, ",c?"the student":"your supervisor"," will be able to submit another request after a cooldown period. If you accept, your supervision relationship will be terminated immediately."]})})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"If you accept this request:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your supervision relationship will be terminated"}),e.jsx("li",{children:"You will lose access to active collaboration features"}),e.jsx("li",{children:"You can still view the relationship history (read-only)"}),e.jsx("li",{children:"You can search for and request a new supervisor"})]})]})]}),e.jsx("div",{className:"p-6 border-t bg-slate-50",children:e.jsxs("div",{className:"flex gap-3",children:[!s&&e.jsxs(g,{variant:"outline",className:"flex-1 border-red-300 text-red-700 hover:bg-red-50",onClick:()=>d(!0),disabled:n,children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Reject Request"]}),e.jsx(g,{className:`flex-1 ${s?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"} text-white`,onClick:S,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),s?"Acknowledge & Terminate":"Accept & Terminate"]})})]})})]}),e.jsx($,{isOpen:A,onClose:()=>d(!1),onConfirm:k,isProcessing:n})]})}export{ce as default};
