import{r as t,a as o,j as e}from"./app-D4sU-mOt.js";import{V as n}from"./index-DCM_u3Zp.js";import R from"./NationalityForm-CAMk3Ekh.js";import{z as N}from"./transition-B1xQIFFX.js";import{y as U,D as z,j as A}from"./dialog-Bopl8OE-.js";import"./InputLabel-BtDVmO34.js";import"./react-select.esm-BQbATOgU.js";import"./InputError-CEho5qFp.js";function K({isOpen:p,onClose:x,mode:F="create",currentProgram:r=null,onSuccess:c}){const[b,w]=t.useState("manual"),[k,D]=t.useState([]),[S,j]=t.useState([]),[s,l]=t.useState({name:"",university_id:"",faculty_id:"",description:"",duration_years:"",funding_info:"",application_url:"",country:""}),[g,I]=t.useState(null),[_,C]=t.useState("upload"),[u,E]=t.useState([]),[h,v]=t.useState(!1),m=F==="edit"&&r;t.useEffect(()=>{p&&o.get("/api/v1/universities",{params:{per_page:200}}).then(a=>D(a.data.data)).catch(()=>n.error("Failed to load universities"))},[p]),t.useEffect(()=>{p&&l(m?{name:r.name||"",university_id:r.university_id||"",faculty_id:r.faculty_id||"",description:r.description||"",duration_years:r.duration_years||"",funding_info:r.funding_info||"",application_url:r.application_url||"",country:r.country||""}:{name:"",university_id:"",faculty_id:"",description:"",duration_years:"",funding_info:"",application_url:"",country:""})},[p,m,r]),t.useEffect(()=>{if(!s.university_id){j([]);return}o.get("/api/v1/faculties",{params:{university_id:s.university_id,per_page:200}}).then(a=>j(a.data.data)).catch(()=>j([]))},[s.university_id]);const T=async a=>{a.preventDefault();try{m?(await o.post(`/api/v1/phd-programs/${r.id}`,s),n.success("Program updated")):(await o.post("/api/v1/phd-programs",s),n.success("Program created")),c==null||c()}catch(i){console.error(i),n.error("Save failed")}},q=async a=>{var d,f;if(a.preventDefault(),!g){n.error("Please select a file to preview.");return}v(!0);const i=new FormData;i.append("file",g);try{const y=await o.post("/api/v1/phd-programs/import/preview",i,{headers:{"Content-Type":"multipart/form-data"}});E(y.data||[]),C("preview")}catch(y){console.error(y),n.error(((f=(d=y.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to parse file.")}finally{v(!1)}},P=async()=>{var a,i;v(!0);try{await o.post("/api/v1/phd-programs/import",{programs:u}),n.success("Programs imported successfully!"),c==null||c()}catch(d){console.error(d),n.error(((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save data.")}finally{v(!1)}};return e.jsx(N,{appear:!0,show:p,as:t.Fragment,children:e.jsxs(U,{as:"div",className:"relative z-50",onClose:x,children:[e.jsx(N.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(z,{className:"fixed inset-0 bg-black/30"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(N.Child,{as:t.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(A,{className:"w-full max-w-2xl transform overflow-hidden rounded-lg bg-white p-0 text-left align-middle shadow-xl transition-all",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:m?"Edit PhD Program":"Add PhD Program"}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsx("div",{className:"px-6 pt-4 border-b",children:e.jsxs("nav",{className:"-mb-px flex space-x-6",children:[e.jsx("button",{onClick:()=>w("manual"),className:`pb-2 border-b-2 ${b==="manual"?"border-blue-600 text-blue-600":"border-transparent text-gray-500"}`,children:"Manual Entry"}),e.jsx("button",{onClick:()=>w("import"),className:`pb-2 border-b-2 ${b==="import"?"border-blue-600 text-blue-600":"border-transparent text-gray-500"}`,children:"Import from File"})]})}),e.jsx("div",{className:"p-6",children:b==="manual"?e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Name ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.name,onChange:a=>l({...s,name:a.target.value}),className:"w-full rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["University ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.university_id,onChange:a=>l({...s,university_id:a.target.value,faculty_id:""}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select university"}),k.map(a=>e.jsx("option",{value:a.id,children:a.full_name},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Faculty ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.faculty_id,onChange:a=>l({...s,faculty_id:a.target.value}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select faculty"}),S.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Description ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{value:s.description,onChange:a=>l({...s,description:a.target.value}),className:"w-full rounded px-3 py-2",rows:4,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Duration (e.g., 3 until 8) ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.duration_years,onChange:a=>l({...s,duration_years:a.target.value}),className:"w-full rounded px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Funding Info ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:s.funding_info,onChange:a=>l({...s,funding_info:a.target.value}),className:"w-full rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select funding type"}),e.jsx("option",{value:"Full scholarship + stipend available",children:"Full scholarship + stipend available"}),e.jsx("option",{value:"Research assistantship with full tuition waiver",children:"Research assistantship with full tuition waiver"}),e.jsx("option",{value:"Research training program scholarship",children:"Research training program scholarship"}),e.jsx("option",{value:"Self-funded or external scholarships",children:"Self-funded or external scholarships"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Application URL ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:s.application_url,onChange:a=>l({...s,application_url:a.target.value}),className:"w-full rounded px-3 py-2"})]}),e.jsx("div",{children:e.jsx(R,{title:"Country",value:s.country,onChange:a=>l({...s,country:a}),errors:!1})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:m?"Update":"Create"})]})]}):e.jsxs("div",{className:"space-y-4",children:[_==="upload"&&e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"Instructions"}),e.jsxs("p",{children:["Upload a .xlsx or .csv file with a header row containing these columns: ",e.jsx("strong",{children:"name, university_id, faculty_id, description, duration_years, funding_info, application_url, country"}),"."]}),e.jsx("a",{href:"/storage/templates/phd_programs_template.csv",className:"text-blue-700 underline",target:"_blank",rel:"noreferrer",children:"Download template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Select file (.xlsx or .csv)"}),e.jsx("input",{type:"file",accept:".xlsx,.csv",onChange:a=>{var i;return I(((i=a.target.files)==null?void 0:i[0])||null)}})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||!g,className:"px-4 py-2 bg-blue-600 text-white rounded",children:h?"Processing...":"Preview Data"})]})]}),_==="preview"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Preview Data (",u.length," records found)"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please review the extracted data before saving to the database."}),e.jsx("div",{className:"max-h-96 overflow-y-auto border rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:u.length>0&&Object.keys(u[0]).map(a=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:a.replace("_"," ")},a))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((a,i)=>e.jsx("tr",{children:Object.values(a).map((d,f)=>e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700 whitespace-nowrap truncate max-w-xs",children:String(d)},f))},i))})]})}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>C("upload"),className:"px-4 py-2 border rounded",children:"Back"}),e.jsx("button",{type:"button",onClick:P,disabled:h,className:"px-4 py-2 bg-green-600 text-white rounded",children:h?"Saving...":"Confirm & Save"})]})]})]})})]})})})})]})})}export{K as default};
