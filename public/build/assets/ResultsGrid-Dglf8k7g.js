import{j as e,r as o,b as B,a as ee}from"./app-BQLnL5QZ.js";import{a as K,g as ae,h as ie,i as re,j as ne,k as le,l as ce,m as oe,F as de}from"./index-CWNALKTa.js";import{R as me}from"./RecommendationModal-B7_FwJSw.js";import{R as xe}from"./RecommendationDisplay-CXzOXiYC.js";import{B as he}from"./BookmarkButton-BUbQ2SD8.js";import"./index-DNG2Oa4E.js";const ue=({score:a,showDetails:n=!1})=>{const v=parseFloat(a),y=!isNaN(v)&&v>=0&&v<=1?v:.5,f=Math.round(y*100),N=x=>x<.3?"bg-red-500":x<.5?"bg-orange-500":x<.7?"bg-yellow-500":x<.9?"bg-green-500":"bg-emerald-500",I=x=>x<.3?"Poor Match":x<.5?"Fair Match":x<.7?"Good Match":x<.9?"Great Match":"Excellent Match";return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs",children:[e.jsx("span",{className:"font-medium text-gray-700",children:I(y)}),e.jsxs("span",{className:"font-bold",children:[f,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-1",children:e.jsx("div",{className:`h-2.5 rounded-full ${N(y)}`,style:{width:`${f}%`}})}),n&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Query match:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(y*.6*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Profile match:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(y*.4*100),"%"]})]})]})]})},ye=({profile:a,universitiesList:n,faculties:v,users:y,researchOptions:f,aiInsights:N,searchQuery:I})=>{var G,T,q;const[x,j]=o.useState(!1),[D,E]=o.useState(!1),[l,M]=o.useState(null),[C,W]=o.useState(!1),[b,i]=o.useState(N),[m,_]=o.useState(!1),[w,se]=o.useState(!1),X=()=>{E(!0),ee.get(route("academicians.quick-info",a.academician_id)).then(r=>{r.data&&r.data.academician?(M({...a,...r.data.academician,projects_count:r.data.projects_count||0,grants_count:r.data.grants_count||0,publications_count:r.data.publications_count||0}),j(!0),I&&Y()):(M(a),j(!0)),E(!1)}).catch(r=>{console.error("Error fetching academician detail:",r),M(a),j(!0),E(!1)})},Y=()=>{_(!0),ee.post(route("supervisor.insights"),{academician_id:a.academician_id,query:I}).then(r=>{r.data&&r.data.insight&&i(r.data.insight),_(!1)}).catch(r=>{console.error("Error fetching detailed insights:",r),_(!1)})},z=r=>{r.preventDefault(),W(!0)},V=()=>{W(!1)},Z=()=>(l==null?void 0:l.grants_count)||0,H=()=>(l==null?void 0:l.projects_count)||0,R=()=>(l==null?void 0:l.publications_count)||0;return console.log("Supervisor Profile Data:",a),e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-[10px] font-semibold px-2.5 py-0.5 rounded-full",children:((G=n.find(r=>r.id===a.university))==null?void 0:G.short_name)||"Unknown University"}),a.match_score&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("div",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold",children:[Math.round(a.match_score*100),"% Match"]})}),e.jsx("div",{className:"h-32",children:e.jsx("img",{src:a.background_image!==null?`/storage/${a.background_image}`:"/storage/profile_background_images/default.jpg",alt:"Banner",className:"object-cover w-full h-full"})}),e.jsx("div",{className:"flex justify-center -mt-12",children:e.jsxs("div",{className:"relative w-24 h-24",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg",children:e.jsx("img",{src:a.profile_picture!==null?`/storage/${a.profile_picture}`:"/storage/profile_pictures/default.jpg",alt:"Profile",className:"w-full h-full object-cover"})}),a.verified===1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-white p-1 rounded-full group cursor-pointer shadow-md",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-blue-500 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute bottom-8 right-0 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 shadow-lg z-10 w-48",children:["This account is verified by ",((T=n.find(r=>r.id===a.university))==null?void 0:T.full_name)||"Unknown University"]})]})]})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h2",{className:"text-lg font-semibold truncate px-6",children:a.full_name}),e.jsx("p",{className:"text-gray-500 text-sm px-6",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",minHeight:"2.5rem"},children:Array.isArray(a.research_expertise)&&a.research_expertise.length>0?(()=>{const r=a.research_expertise[0],p=f.find(F=>`${F.field_of_research_id}-${F.research_area_id}-${F.niche_domain_id}`===r);return p?`${p.field_of_research_name} - ${p.research_area_name} - ${p.niche_domain_name}`:"Unknown"})():"No Field of Research or Expertise"}),e.jsx("p",{className:"text-gray-500 text-sm",children:a.current_position?a.current_position:"No Position"}),a.match_score&&e.jsx("div",{className:"mt-3 px-4",children:e.jsx(ue,{score:a.match_score,showDetails:!1})}),N&&e.jsxs("div",{className:"mt-3 px-4 py-2 bg-blue-50 mx-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-1 justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-blue-700 flex items-center",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),e.jsx("button",{onClick:()=>se(!w),className:"text-blue-600 text-xs hover:underline",children:w?"Show less":"Show more"})]}),e.jsx("p",{className:`text-xs text-gray-700 text-left ${w?"h-auto":"h-16 overflow-y-auto"} pr-1`,children:N})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx("button",{onClick:X,className:"bg-blue-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-blue-600",children:"Quick Info"}),e.jsx(B,{href:route("academicians.show",a.url),className:"bg-green-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-green-600",children:"Full Profile"})]})]}),e.jsxs("div",{className:"flex justify-around items-center mt-6 py-4 border-t px-10",children:[e.jsx("a",{href:"#",className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Add Friend",children:e.jsx(ae,{className:"text-lg"})}),e.jsx(B,{href:route("email.compose",{to:(q=y.find(r=>r.unique_id===a.academician_id))==null?void 0:q.email}),className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Send Email",children:e.jsx(ie,{className:"text-lg"})}),e.jsx("a",{href:"#",onClick:r=>z(a),className:"text-gray-500 text-lg hover:text-yellow-500",title:"Recommend",children:e.jsx(re,{className:"text-lg"})}),e.jsx(he,{bookmarkableType:"academician",bookmarkableId:a.id,category:"Academicians",iconSize:"text-lg",tooltipPosition:"top"})]}),x&&l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>j(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-lg relative max-h-[80vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Loading academician information..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-800 ",children:l.full_name}),e.jsx("hr",{className:"border-t border-gray-800 mb-4"}),I&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-800 mb-2 flex items-center",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),m?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Generating detailed insights..."})]}):e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:b})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Short Bio"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:l.bio||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Research Expertise"}),e.jsx("div",{className:"",children:(()=>{let r=l.research_expertise||[];return Array.isArray(r)&&r.length>0?e.jsx("div",{className:"space-y-2",children:r.map((p,F)=>{const k=f.find(S=>`${S.field_of_research_id}-${S.research_area_id}-${S.niche_domain_id}`===p);return k?e.jsxs("p",{className:"text-gray-600",children:[F+1,". ",k.field_of_research_name," - ",k.research_area_name," - ",k.niche_domain_name]},F):null})}):e.jsx("p",{className:"text-gray-600",children:"Not Provided"})})()})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Style of Supervision"}),e.jsx("div",{className:"space-y-2",children:Array.isArray(l.style_of_supervision)&&l.style_of_supervision.length>0?e.jsx("div",{className:"mt-2 text-normal text-gray-600",children:l.style_of_supervision.map((r,p)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"font-medium",children:[p+1,". ",r]}),e.jsxs("div",{className:"ml-4 text-sm",children:[r==="Directive Supervision"&&"Structured approach with active guidance and regular monitoring",r==="Facilitative Supervision"&&"Supportive approach encouraging student independence",r==="Coaching Supervision"&&"Focuses on personal development and academic growth",r==="Adaptive Supervision"&&"Flexible support based on student's changing needs",r==="Participatory Supervision"&&"Collaborative approach with shared decision-making"]})]},p))}):e.jsx("p",{className:"text-gray-600",children:"Not Specified"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Supervised Student"}),e.jsx("p",{className:"text-gray-600",children:l.supervised_students_count||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Available Grant and Project"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[Z()+H()," Projects/Grants"]}),e.jsxs(B,{href:route("academicians.projects",l.url),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Projects"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Publication"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[R()," Publications"]}),e.jsxs(B,{href:route("academicians.publications",l.url),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Publications"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Recommendation by Others"}),e.jsx(xe,{academicianId:l.academician_id})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Connect via"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("a",{href:l.google_scholar,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-red-700",title:"Google Scholar",children:e.jsx(ne,{})}),l.personal_website&&e.jsx("a",{href:l.personal_website,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-green-700",title:"Personal Website",children:e.jsx(le,{})}),l.institution_website&&e.jsx("a",{href:l.institution_website,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-blue-700",title:"Institutional Website",children:e.jsx(ce,{})}),e.jsx("a",{href:l.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-blue-800",title:"LinkedIn",children:e.jsx(oe,{})})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>j(!1),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:"Close"})})]})}),C&&e.jsx(me,{academician:a,onClose:()=>W(!1),onSuccess:V})]})},te=({searchResults:a,universitiesList:n,faculties:v,users:y,researchOptions:f,searchQuery:N,isSearching:I,isLoadingMore:x=!1,onLoadMore:j=()=>{},showHeader:D=!0,visibleCount:E=6})=>{const[l,M]=o.useState([]),[C,W]=o.useState(!1),b=o.useRef(null);o.useEffect(()=>{if(a&&a.matches){M([]);const m=a.matches.slice(0,6);if(M(m),a.matches.slice(6).length>0){const w=setTimeout(()=>{M(a.matches)},300);return()=>clearTimeout(w)}}},[a]),o.useEffect(()=>{const m=new IntersectionObserver(([_])=>{W(_.isIntersecting)},{threshold:.1});return b.current&&m.observe(b.current),()=>{b.current&&m.unobserve(b.current)}},[b]),o.useEffect(()=>{C&&!x&&a&&a.has_more&&l.length>0&&j()},[C,x,a,j]);const i=m=>Array(m).fill(null).map((_,w)=>e.jsx(Ne,{},`skeleton-${w}`));return I&&(!a||!a.matches)?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6",children:i(E)}):a&&a.matches?e.jsxs("div",{children:[D&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:['Supervisor Matches for "',a.query,'"']}),e.jsxs("span",{className:"text-gray-500",children:[a.total," match",a.total!==1?"es":""," found"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6",children:[l.map((m,_)=>e.jsx(ye,{profile:{...m.academician,ai_insight:m.ai_insights,research_expertise:Array.isArray(m.academician.research_expertise)?m.academician.research_expertise:[],availability_as_supervisor:m.academician.availability_as_supervisor||0,match_score:m.score},universitiesList:n,faculties:v,users:y,researchOptions:f,aiInsights:m.ai_insights,searchQuery:N},`${m.academician.id}-${_}`)),l.length<a.matches.length&&i(Math.min(3,a.matches.length-l.length))]}),a.has_more&&e.jsx("div",{ref:b,className:"mt-8 text-center py-4",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Loading more results..."]}):e.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md",onClick:j,children:"Load more results"})}),a.total===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(de,{className:"text-gray-400 text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"No matching supervisors found"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"Try broadening your search terms or exploring different research areas."})]})]}):null},Ne=()=>e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden relative animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200"}),e.jsx("div",{className:"flex justify-center -mt-12",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-300 border-4 border-white"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mx-auto mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6 mx-auto mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/6 mx-auto mb-4"}),e.jsxs("div",{className:"mt-3 bg-gray-100 p-3 rounded-md",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-5/6 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})]})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-100 p-4 flex justify-around",children:[e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-6 w-6 bg-gray-200 rounded-full"})]})]});function Pe({searchType:a,searchResults:n,universitiesList:v,faculties:y,researchOptions:f,users:N,skills:I,selectedArea:x,selectedUniversity:j,selectedAvailability:D,onLoadMore:E,isLoadingMore:l}){const[M,C]=o.useState(!1),[W,b]=o.useState(!1),[i,m]=o.useState(null),[_,w]=o.useState(!1),[se,X]=o.useState(""),[Y,z]=o.useState(!1),[V,Z]=o.useState(!1),[H,R]=o.useState(null),[G,T]=o.useState([]),[q,r]=o.useState(!1),[p,F]=o.useState(!1),k=o.useRef(null);if(o.useEffect(()=>{F(!n)},[n]),o.useEffect(()=>{if(n&&n.matches){console.log("Search results structure:",n),console.log("First match example:",n.matches[0]),T([]);const t=n.matches.slice(0,6);if(T(t),n.matches.slice(6).length>0){const s=setTimeout(()=>{T(n.matches)},300);return()=>clearTimeout(s)}}},[n]),o.useEffect(()=>{const t=new IntersectionObserver(([c])=>{r(c.isIntersecting)},{threshold:.1});return k.current&&t.observe(k.current),()=>{k.current&&t.unobserve(k.current)}},[k]),o.useEffect(()=>{q&&!l&&n&&n.has_more&&S.length>0&&E()},[q,l,n]),!n||!n.matches||n.matches.length===0)return null;console.log("Match object structure:",n.matches[0]);const S=n.matches.filter(t=>{const c=t.academician||t.student||{};if(x&&x.length>0){const s=a==="supervisor"||a==="collaborators"&&t.result_type==="academician"?c.research_expertise:c.student_type==="postgraduate"?c.field_of_research:c.research_preference;if(!s||!Array.isArray(s)||!s.some(h=>x.includes(h)))return!1}if(j&&j.length>0&&(!c.university||!j.includes(c.university.toString())))return!1;if(D){let s;a==="supervisor"?s="availability_as_supervisor":a==="students"?s="supervisorAvailability":a==="collaborators"&&(s=t.result_type==="academician"?"availability_as_supervisor":"supervisorAvailability");const h=c[s];if(h===void 0||h.toString()!==D)return!1}return!0}),ge=t=>{b(!0),z(!0);let c=t.ai_insights||"";if(!c){console.log("No ai_insights in profile, searching in matches...");const u=n.matches.find(A=>{const P=A.academician||A.student||{};return(P.id||P.academician_id||P.postgraduate_id||P.undergraduate_id)===(t.academician_id||t.postgraduate_id||t.undergraduate_id||t.id)});c=(u==null?void 0:u.ai_insights)||"",console.log("Match object found:",u)}console.log("AI Insights to use:",c);let s=c;if(c){const u=/\b(\d+-\d+-\d+)\b/g;(c.match(u)||[]).forEach(P=>{const d=f.find($=>`${$.field_of_research_id}-${$.research_area_id}-${$.niche_domain_id}`===P);if(d){const $=`${d.field_of_research_name} - ${d.research_area_name} - ${d.niche_domain_name}`;s=s.replace(new RegExp(P,"g"),$)}})}const h={...t,ai_insights:c,processedInsights:s};console.log("Enhanced profile with insights:",h),m(h),X(s);const g=t.academician_id||t.result_type==="academician",L=t.academician_id||t.postgraduate_id||t.undergraduate_id||t.id;g?ee.get(route("academicians.quick-info",L)).then(u=>{if(u.data&&u.data.academician){const A={...h,...u.data.academician,ai_insights:c,processedInsights:s,projects_count:u.data.projects_count||0,grants_count:u.data.grants_count||0,publications_count:u.data.publications_count||0};console.log("Final updatedProfile with insights preserved:",A),m(A)}C(!0),b(!1),z(!1)}).catch(u=>{console.error("Error fetching academician detail:",u),C(!0),b(!1),z(!1)}):(C(!0),b(!1),z(!1))},fe=(t,c)=>{c.preventDefault(),R(t),w(!0)},pe=()=>{w(!1)},je=()=>(i==null?void 0:i.grants_count)||0,be=()=>(i==null?void 0:i.projects_count)||0,ve=()=>(i==null?void 0:i.publications_count)||0;return e.jsxs("div",{className:"space-y-8",children:[p&&e.jsx(te,{isSearching:!0,searchQuery:(n==null?void 0:n.query)||"",showHeader:!0,visibleCount:6,universitiesList:v,faculties:y,users:N,researchOptions:f}),!p&&n&&n.matches&&S.length===0&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No results match your filters. Try adjusting your filter criteria."})}),!p&&n&&n.matches&&S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-lg font-semibold",children:["Found ",S.length,' matching results for "',n.query,'"']})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[S.slice(0,G.length).map((t,c)=>{var u,A,P;const s=t.academician||t.student||{},h=s.id||s.academician_id||s.postgraduate_id||s.undergraduate_id||c,g=!!t.academician||t.result_type==="academician",L=t.ai_insights||"";return s.ai_insights=L,console.log(`Match ${c} structure:`,t),console.log(`Match ${c} ai_insights:`,t.ai_insights),console.log("Profile with ai_insights added:",s),e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-[10px] font-semibold px-2.5 py-0.5 rounded-full",children:((u=v.find(d=>d.id===s.university))==null?void 0:u.short_name)||s.university_name||s.university_short_name||"Unknown University"}),t.score&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs("div",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold",children:[Math.round(t.score*100),"% Match"]})}),e.jsx("div",{className:"h-32",children:e.jsx("img",{src:s.background_image!==null?`/storage/${s.background_image}`:"/storage/profile_background_images/default.jpg",alt:"Banner",className:"object-cover w-full h-full"})}),e.jsx("div",{className:"flex justify-center -mt-12",children:e.jsxs("div",{className:"relative w-24 h-24",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg",children:e.jsx("img",{src:s.profile_picture!==null?`/storage/${s.profile_picture}`:"/storage/profile_pictures/default.jpg",alt:"Profile",className:"w-full h-full object-cover"})}),s.verified===1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-white p-1 rounded-full group cursor-pointer shadow-md",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-blue-500 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute bottom-8 right-0 hidden group-hover:block bg-gray-800 text-white text-xs rounded px-3 py-2 shadow-lg z-10 w-48",children:["This account is verified by ",((A=v.find(d=>d.id===s.university))==null?void 0:A.full_name)||"their institution"]})]})]})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h2",{className:"text-lg font-semibold truncate px-6",children:s.full_name}),e.jsx("p",{className:"text-gray-500 text-sm px-6",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",minHeight:"2.5rem"},children:(()=>{let d=[];if(g?d=s.research_expertise||[]:t.result_type==="postgraduate"||s.student_type==="postgraduate"?d=s.field_of_research||[]:d=s.research_preference||[],Array.isArray(d)&&d.length>0){const $=d[0],U=f.find(O=>`${O.field_of_research_id}-${O.research_area_id}-${O.niche_domain_id}`===$);return U?`${U.field_of_research_name} - ${U.research_area_name} - ${U.niche_domain_name}`:$}return s.current_position||"No Field of Research or Expertise"})()}),e.jsx("p",{className:"text-gray-500 text-sm",children:g?s.current_position||"No Position":t.result_type==="postgraduate"||s.student_type==="postgraduate"?"Postgraduate":"Undergraduate"}),t.score&&e.jsx("div",{className:"mt-3 px-4",children:e.jsx(ue,{score:t.score,showDetails:!1})}),L&&e.jsxs("div",{className:"mt-3 px-4 py-2 bg-blue-50 mx-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-1 justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-blue-700 flex items-center",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),e.jsx("button",{onClick:()=>Z(!V),className:"text-blue-600 text-xs hover:underline",children:V?"Show less":"Show more"})]}),e.jsx("p",{className:`text-xs text-gray-700 text-left ${V?"h-auto":"h-16 overflow-y-auto"} pr-1`,children:(()=>{let d=L;const $=/\b(\d+-\d+-\d+)\b/g;return(L.match($)||[]).forEach(O=>{const J=f.find(Q=>`${Q.field_of_research_id}-${Q.research_area_id}-${Q.niche_domain_id}`===O);if(J){const Q=`${J.field_of_research_name} - ${J.research_area_name} - ${J.niche_domain_name}`;d=d.replace(new RegExp(O,"g"),Q)}}),d})()})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>{console.log("Quick Info clicked for profile:",s),console.log("Profile has ai_insights:",s.ai_insights),ge(s)},className:"bg-blue-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-blue-600",children:"Quick Info"}),e.jsx(B,{href:g?route("academicians.show",s.url||s.academician_id||s.id):t.result_type==="postgraduate"||s.student_type==="postgraduate"?route("postgraduates.show",s.url||s.postgraduate_id||s.id):route("undergraduates.show",s.url||s.undergraduate_id||s.id),className:"bg-green-500 text-white text-[10px] px-2 font-semibold py-1 rounded-full hover:bg-green-600",children:"Full Profile"})]})]}),e.jsxs("div",{className:"flex justify-around items-center mt-6 py-4 border-t px-10",children:[e.jsx("a",{href:"#",className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Add Friend",children:e.jsx(ae,{className:"text-lg"})}),e.jsx(B,{href:route("email.compose",{to:((P=N.find(d=>d.unique_id===(g?s.academician_id||s.id:s.postgraduate_id||s.undergraduate_id||s.id)))==null?void 0:P.email)||s.email||""}),className:"text-gray-500 text-lg cursor-pointer hover:text-blue-700",title:"Send Email",children:e.jsx(ie,{className:"text-lg"})}),e.jsx("a",{href:"#",onClick:d=>fe(s,d),className:"text-gray-500 text-lg hover:text-yellow-500",title:"Recommend",children:e.jsx(re,{className:"text-lg"})}),e.jsx(he,{bookmarkableType:g?"academician":t.result_type,bookmarkableId:h,category:g?"Academicians":"Students",iconSize:"text-lg",tooltipPosition:"top"})]})]},`${t.result_type}-${h}`)}),S.length>G.length&&e.jsx("div",{className:"col-span-full",children:e.jsx(te,{isSearching:!0,showHeader:!1,visibleCount:Math.min(3,S.length-G.length),universitiesList:v,faculties:y,users:N,researchOptions:f,searchQuery:"Loading more profiles..."})})]}),n.has_more&&e.jsx("div",{ref:k,className:"mt-8 text-center py-4",children:l?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Loading more results..."]}):e.jsx("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md",onClick:E,children:"Load more results"})})]}),!p&&n&&n.matches&&n.matches.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(de,{className:"text-gray-400 text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",children:"No matching results found"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"Try broadening your search terms or exploring different research areas."})]}),M&&i&&e.jsxs(e.Fragment,{children:[console.log("Modal opening with selectedProfile:",i),console.log("AI insights available:",i.ai_insights),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>C(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-lg relative max-h-[80vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[W?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Loading profile information..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-800",children:i.full_name}),e.jsx("hr",{className:"border-t border-gray-800 mb-4"}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-800 mb-2 flex items-center",children:[e.jsx(K,{className:"text-yellow-500 mr-2"}),"AI Match Insights"]}),console.log("Rendering AI insights section with:",{ai_insights:i.ai_insights,processedInsights:i.processedInsights}),Y?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("p",{className:"text-gray-600",children:"Generating detailed insights..."})]}):e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:i.processedInsights||i.ai_insights||"No insights available for this profile."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Short Bio"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:i.bio||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:i.academician_id?"Research Expertise":"Research Interests"}),e.jsx("div",{className:"",children:(()=>{let t=[];return i.academician_id?t=i.research_expertise||[]:i.postgraduate_id||i.student_type==="postgraduate"?t=i.field_of_research||[]:t=i.research_preference||[],Array.isArray(t)&&t.length>0?e.jsx("div",{className:"space-y-2",children:t.map((c,s)=>{const h=f.find(g=>`${g.field_of_research_id}-${g.research_area_id}-${g.niche_domain_id}`===c);return h?e.jsxs("p",{className:"text-gray-600",children:[s+1,". ",h.field_of_research_name," - ",h.research_area_name," - ",h.niche_domain_name]},s):e.jsxs("p",{className:"text-gray-600",children:[s+1,". ",c]},s)})}):e.jsx("p",{className:"text-gray-600",children:"Not Provided"})})()})]}),i.academician_id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Style of Supervision"}),e.jsx("div",{className:"space-y-2",children:Array.isArray(i.style_of_supervision)&&i.style_of_supervision.length>0?e.jsx("div",{className:"mt-2 text-normal text-gray-600",children:i.style_of_supervision.map((t,c)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"font-medium",children:[c+1,". ",t]}),e.jsxs("div",{className:"ml-4 text-sm",children:[t==="Directive Supervision"&&"Structured approach with active guidance and regular monitoring",t==="Facilitative Supervision"&&"Supportive approach encouraging student independence",t==="Coaching Supervision"&&"Focuses on personal development and academic growth",t==="Adaptive Supervision"&&"Flexible support based on student's changing needs",t==="Participatory Supervision"&&"Collaborative approach with shared decision-making"]})]},c))}):e.jsx("p",{className:"text-gray-600",children:"Not Specified"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Supervised Student"}),e.jsx("p",{className:"text-gray-600",children:i.supervised_students_count||"Not Provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Available Grant and Project"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[je()+be()," Projects/Grants"]}),e.jsxs(B,{href:route("academicians.projects",i.url||i.academician_id),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Projects"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Total Publication"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{className:"text-gray-600",children:[ve()," Publications"]}),e.jsxs(B,{href:route("academicians.publications",i.url||i.academician_id),className:"mt-2 self-start text-xs px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200 flex items-center",children:[e.jsx("span",{children:"View Publications"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Recommendation by Others"}),e.jsx(xe,{academicianId:i.academician_id||i.id})]})]}),(i.postgraduate_id||i.undergraduate_id)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Skills"}),Array.isArray(i.skills)&&i.skills.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:i.skills.map((t,c)=>{let s="";if(typeof t=="string")s=t;else if(typeof t=="object"&&t!==null&&t.name)s=t.name;else if(I&&(typeof t=="number"||!isNaN(parseInt(t)))){const h=typeof t=="number"?t:parseInt(t),g=I.find(L=>L.id===h);s=g?g.name:`Skill #${t}`}else s=`Skill #${c+1}`;return e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:s},c)})}):e.jsx("p",{className:"text-gray-600",children:"No skills listed"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Connect via"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[i.google_scholar&&e.jsx("a",{href:i.google_scholar,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-red-700",title:"Google Scholar",children:e.jsx(ne,{})}),i.personal_website&&e.jsx("a",{href:i.personal_website,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-green-700",title:"Personal Website",children:e.jsx(le,{})}),i.institution_website&&e.jsx("a",{href:i.institution_website,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-blue-700",title:"Institutional Website",children:e.jsx(ce,{})}),i.linkedin&&e.jsx("a",{href:i.linkedin,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 text-lg hover:text-blue-800",title:"LinkedIn",children:e.jsx(oe,{})})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>C(!1),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:"Close"})})]})})]}),_&&H&&e.jsx(me,{academician:H,onClose:()=>w(!1),onSuccess:pe})]})}export{Pe as default};
