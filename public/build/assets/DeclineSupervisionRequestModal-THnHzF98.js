import{q as ue,r,a as T,j as e}from"./app-Ba9NEla_.js";import{M as ge}from"./Modal-C3pBVycS.js";import{B as X}from"./button-BEWen7a0.js";import{L as p}from"./label-DiRXU-o2.js";import{T as G}from"./textarea-OFMNA4a0.js";import{C as te}from"./checkbox-DXLzqfQC.js";import{S as fe,a as je,b as ve,c as Ne,d as be}from"./select-Dz758SDW.js";import{A as ye,a as Se}from"./alert-IQKv_zRd.js";import{A as ae,a as ie}from"./avatar-DYCjIyUA.js";import{B as b}from"./badge-Dn3o0qN0.js";import{I as we}from"./input-CVXaQnVF.js";import{T as Ce,a as ke,b as Y,c as Z}from"./tabs-B8_YVRTF.js";import{c as R}from"./index-DW2eQRph.js";import{l as A}from"./logError-D4ezqrCx.js";import{R as q}from"./supervisionConstants-BuM5-H5X.js";import{C as Te}from"./circle-x-BEVhYyuW.js";import{U as ee}from"./users-DHlOkeZx.js";import{B as Re}from"./building-2-DRNQvE42.js";import{L as $}from"./loader-circle-BzQWx5Qr.js";import{S as _}from"./search-FWjCe4AE.js";import{C as Ae}from"./circle-alert-B0XxNn8a.js";import"./dialog-DI12n2Mi.js";import"./transition-DxPkQ6VA.js";import"./utils-D-KgF5mV.js";import"./index-CDEssc61.js";import"./index-CGrAONsN.js";import"./index-B75IAngf.js";import"./index-DKkZd806.js";import"./index-BGHfxR3S.js";import"./index-doDk9rCk.js";import"./check-DFql7rMx.js";import"./createLucideIcon-D9Xjp5kf.js";import"./index-BdQq_4o_.js";import"./index-BAWFi-Zq.js";import"./index-C_0yBoYj.js";import"./index-15aMhqW_.js";import"./index-xQoiVGlk.js";import"./index-7e-v4Twm.js";import"./tslib.es6-CmEaCU22.js";import"./index-edx9cnCL.js";import"./index-BnwPfEVg.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-D4cTQj6_.js";import"./chevron-down-jOf7eNbN.js";import"./chevron-up-DT_AXQO8.js";import"./index-C1WBEj0V.js";function ys({isOpen:t,request:i,onClose:c,onRejected:x}){var J,O,W;const{auth:u}=ue().props,[d,I]=r.useState(""),[j,M]=r.useState(""),[m,D]=r.useState(!1),[o,F]=r.useState([]),[v,y]=r.useState(""),[g,L]=r.useState(!1),[S,re]=r.useState("connections"),[w,ne]=r.useState([]),[C,E]=r.useState([]),[h,le]=r.useState(""),[ce,B]=r.useState(!1),[oe,P]=r.useState(!1),k=(i==null?void 0:i.student)||{},f=k.full_name||"Student",U=k.profile_picture?`/storage/${k.profile_picture}`:null,V=((J=i==null?void 0:i.postgraduate_program)==null?void 0:J.name)||"PhD Computer Science Program",K=(i==null?void 0:i.proposal_title)||"Research Topic",N=(i==null?void 0:i.research_keywords)||[],de=((W=(O=u==null?void 0:u.user)==null?void 0:O.academician)==null?void 0:W.full_name)||"Supervisor";r.useEffect(()=>{t&&(me(),N.length>0&&y(N.join(", ")))},[t]),r.useEffect(()=>{if(!m||S!=="search")return;const s=setTimeout(()=>{h.trim().length>=2?xe(h):E([])},500);return()=>clearTimeout(s)},[h,m,S]);const me=async()=>{B(!0);try{const s=await T.get(route("supervision.recommendations.supervisor-connections"));ne(s.data.data||[])}catch(s){A(s,"DeclineSupervisionRequestModal loadSupervisorConnections"),R.error("Failed to load your connections")}finally{B(!1)}},xe=async s=>{P(!0);try{const a=await T.get(route("supervision.recommendations.search-academicians"),{params:{q:s,limit:20}});E(a.data.data||[])}catch(a){A(a,"DeclineSupervisionRequestModal searchAcademicians")}finally{P(!1)}},z=d!=="",Q=s=>{F(a=>a.find(n=>n.id===s.id)?a.filter(n=>n.id!==s.id):[...a,s])},he=()=>{var l;const s=((l=q.find(n=>n.value===d))==null?void 0:l.label)||"",a=o.map(n=>n.name).join(", ");return`Dear ${f},

Thank you for your interest in working with me on your ${V} research. After carefully reviewing your proposal titled "${K}", I regret to inform you that I will not be able to supervise your research at this time.

Reason: ${s}

${j?`
${j}
`:""}
${m&&o.length>0?`
I recommend reaching out to the following supervisors who might be a better fit for your research:
${a}
`:""}
${v?`
Suggested keywords for your supervisor search: ${v}
`:""}
I wish you the best of luck in finding a suitable supervisor for your research.

Best regards,
${de}`},pe=async()=>{var s,a;if(!(!z||g)){L(!0);try{const l={reason:d,feedback:j.trim()||null,recommend_alternatives:m,recommended_supervisors:m?o.map(n=>n.id):[],suggested_keywords:v.trim()||null};await T.post(route("supervision.requests.reject",i.id),l),R.success("Rejection sent to student"),x==null||x(),c==null||c()}catch(l){A(l,"DeclineSupervisionRequestModal handleSubmit");const n=((a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to decline supervision request";R.error(n)}finally{L(!1)}}},H=()=>{g||(I(""),M(""),D(!1),F([]),y(""),c==null||c())};return e.jsx(ge,{show:t,onClose:H,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Te,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Decline Supervision Request"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Provide feedback to ",f," and optionally suggest alternative supervisors."]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Request Summary"}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(ae,{className:"h-10 w-10",children:U?e.jsx("img",{src:U,alt:f,className:"h-full w-full object-cover"}):e.jsx(ie,{className:"bg-indigo-100 text-indigo-700 text-sm",children:f.split(" ").map(s=>s[0]).join("").slice(0,2)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:f}),e.jsx("div",{className:"text-xs text-slate-500",children:V})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Research Topic"}),e.jsx("div",{className:"text-sm text-slate-900 mt-1",children:K})]}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:N.map((s,a)=>e.jsx(b,{variant:"secondary",className:"text-xs",children:s},a))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs(p,{htmlFor:"reason",children:["Reason for Declining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(fe,{value:d,onValueChange:I,children:[e.jsx(je,{id:"reason",children:e.jsx(ve,{placeholder:"Select a reason"})}),e.jsx(Ne,{children:q.map(s=>e.jsx(be,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"feedback",children:"Additional Feedback (Optional)"}),e.jsx(G,{id:"feedback",rows:4,value:j,onChange:s=>M(s.target.value),placeholder:"Any constructive feedback about the proposal or suggestions for improvement...",className:"resize-none"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{id:"recommend",checked:m,onCheckedChange:D,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{htmlFor:"recommend",className:"text-sm font-medium cursor-pointer",children:"Recommend alternative supervisors"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Help the student by suggesting other supervisors who might be a better fit"})]})]}),m&&e.jsxs("div",{className:"space-y-4 pl-7",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Select Recommended Supervisors"}),e.jsxs(Ce,{value:S,onValueChange:re,className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-2",children:[e.jsxs(Y,{value:"connections",className:"gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"My Connections (",w.length,")"]}),e.jsxs(Y,{value:"search",className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Search All"]})]}),e.jsx(Z,{value:"connections",className:"space-y-2 mt-3",children:ce?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-indigo-600"})}):w.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(ee,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{children:"No academician connections found."}),e.jsx("p",{className:"text-xs mt-1",children:'Try searching for supervisors in the "Search All" tab.'})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:w.map(s=>e.jsx(se,{supervisor:s,isSelected:!!o.find(a=>a.id===s.id),onToggle:()=>Q(s)},s.id))})}),e.jsxs(Z,{value:"search",className:"space-y-2 mt-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(we,{type:"text",placeholder:"Search by name, department, or expertise...",value:h,onChange:s=>le(s.target.value),className:"pl-10"})]}),oe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-indigo-600"})}):C.length===0&&h.trim().length>=2?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsxs("p",{children:['No supervisors found matching "',h,'"']})]}):C.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-slate-500",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 text-slate-400"}),e.jsx("p",{children:"Start typing to search for supervisors..."})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:C.map(s=>e.jsx(se,{supervisor:s,isSelected:!!o.find(a=>a.id===s.id),onToggle:()=>Q(s)},s.id))})]})]})]}),o.length>0&&e.jsxs("div",{className:"rounded-lg bg-indigo-50 p-3 border border-indigo-200",children:[e.jsxs("div",{className:"text-xs font-medium text-indigo-900 mb-1",children:[o.length," supervisor(s) selected"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:o.map(s=>e.jsx(b,{variant:"secondary",className:"text-xs",children:s.name},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"keywords",children:"Suggested Keywords for Supervisor Search"}),e.jsx(G,{id:"keywords",rows:2,value:v,onChange:s=>y(s.target.value),placeholder:"e.g., Machine Learning, Natural Language Processing, Computer Vision...",className:"resize-none"})]})]})]}),d&&e.jsxs("section",{className:"space-y-3",children:[e.jsx(p,{children:"Message Preview"}),e.jsx("p",{className:"text-xs text-slate-500",children:"This message will be sent to the student:"}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsx("pre",{className:"text-xs text-slate-700 whitespace-pre-wrap font-sans",children:he()})})]}),e.jsxs(ye,{className:"bg-red-50 border-red-200",children:[e.jsx(Ae,{className:"h-4 w-4 text-red-600"}),e.jsxs(Se,{className:"text-sm text-red-900",children:[e.jsx("strong",{className:"font-semibold",children:"Confirm Rejection"}),e.jsx("p",{className:"mt-1",children:'This action will decline the supervision request and notify the student. The request will be moved to "Rejected" status and cannot be undone.'})]})]})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t flex items-center justify-end gap-3",children:[e.jsx(X,{variant:"outline",onClick:H,disabled:g,children:"Cancel"}),e.jsxs(X,{onClick:pe,disabled:!z||g,className:"bg-red-600 hover:bg-red-700",children:[g&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Rejection & Notify Student"]})]})]})})}function se({supervisor:t,isSelected:i,onToggle:c}){const x=t.profile_picture?`/storage/${t.profile_picture}`:null,u=t.name.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${i?"border-indigo-300 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300"}`,onClick:c,children:[e.jsx(te,{checked:i,onCheckedChange:c,className:"mt-1"}),e.jsx(ae,{className:"h-10 w-10",children:x?e.jsx("img",{src:x,alt:t.name,className:"h-full w-full object-cover"}):e.jsx(ie,{className:"bg-indigo-100 text-indigo-700 text-xs",children:u})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 truncate",children:t.name}),t.verified&&e.jsx(b,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 border-blue-200",children:"Verified"}),t.is_connection&&e.jsx(b,{variant:"secondary",className:"text-xs bg-green-100 text-green-700 border-green-200",children:"Connected"})]}),e.jsx("div",{className:"text-xs text-slate-500 line-clamp-1",children:t.expertise}),(t.faculty||t.university)&&e.jsx("div",{className:"text-xs text-slate-400 truncate",children:t.faculty&&t.university?`${t.faculty} • ${t.university}`:t.faculty||t.university})]})]})}export{ys as default};
