import{r,a as f,j as e}from"./app-D7q3ZT4u.js";import{V as i}from"./index-Dc5zct_1.js";import T from"./FacultyFormModal-D9mOclRJ.js";import L from"./ConfirmationModal-CGA-uRv6.js";import{d as Q,F as V,s as R,t as q}from"./index-B9jBXe_P.js";function K(){const[w,_]=r.useState([]),[d,y]=r.useState({data:[],meta:{}}),[b,j]=r.useState(!0),[m,F]=r.useState(""),[n,S]=r.useState(""),[s,u]=r.useState({current_page:1,per_page:10,total:0,last_page:1}),[k,x]=r.useState(!1),[C,g]=r.useState(!1),[o,h]=r.useState(null),[M,v]=r.useState("create");r.useEffect(()=>{E()},[]),r.useEffect(()=>{n?p():y({data:[],meta:{from:0}})},[n,s.current_page,m]);const E=async()=>{try{const t=await f.get("/api/v1/universities",{params:{per_page:100}});_(t.data.data)}catch(t){console.error("Error fetching universities:",t),i.error("Failed to load universities")}},p=async()=>{if(n){j(!0);try{const t=await f.get("/api/v1/faculties",{params:{university_id:n,page:s.current_page,per_page:s.per_page,search:m||void 0,with_university:!0}});y({data:t.data.data,meta:t.data.meta}),u({current_page:t.data.meta.current_page,per_page:t.data.meta.per_page,total:t.data.meta.total,last_page:t.data.meta.last_page})}catch(t){console.error("Error fetching faculties:",t),i.error("Failed to load faculties")}finally{j(!1)}}},$=t=>{S(t.target.value),u(a=>({...a,current_page:1}))},c=t=>{u(a=>({...a,current_page:t}))},A=t=>{t.preventDefault(),u(a=>({...a,current_page:1}))},U=()=>{h(null),v("create"),x(!0)},D=t=>{h(t),v("edit"),x(!0)},P=t=>{h(t),g(!0)},O=()=>{if(!o)return;(async()=>{var a,N;try{await f.delete(`/api/v1/faculties/${o.id}`),i.success("Faculty deleted successfully!"),p()}catch(l){l.response?l.response.status===404?(i.error("Faculty not found. It may have been already deleted."),p()):(a=l.response.data)!=null&&a.error?i.error(l.response.data.error):(N=l.response.data)!=null&&N.message?i.error(l.response.data.message):i.error(`Error (${l.response.status}): Unable to delete faculty.`):i.error("Network error or server not responding."),console.error("Error deleting faculty:",l)}finally{g(!1)}})()},I=()=>{x(!1),p()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Faculties"}),e.jsxs("button",{onClick:()=>{n&&U()},disabled:!n,className:`inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest ${n?"hover:bg-blue-700 active:bg-blue-900":"opacity-50 cursor-not-allowed"} focus:outline-none focus:border-blue-900 focus:ring ring-blue-300`,children:[e.jsx(Q,{className:"mr-2"})," Add Faculty"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"university",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select University"}),e.jsxs("select",{id:"university",value:n,onChange:$,className:"block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a university"}),w.map(t=>e.jsx("option",{value:t.id,children:t.full_name},t.id))]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("form",{onSubmit:A,className:"flex",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(V,{className:"text-gray-400"})}),e.jsx("input",{type:"text",value:m,onChange:t=>F(t.target.value),placeholder:"Search faculties...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"})]}),e.jsx("button",{type:"submit",className:"ml-3 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Search"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Academicians"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Postgraduates"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Undergraduates"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"Loading..."})}):d.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"No faculties found"})}):d.data.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:d.meta.from+a}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.academicians_count||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.postgraduates_count||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.undergraduates_count||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsxs("button",{onClick:()=>D(t),className:"text-blue-600 hover:text-blue-900 mr-4",children:[e.jsx(R,{className:"inline"})," Edit"]}),e.jsxs("button",{onClick:()=>P(t),className:"text-red-600 hover:text-red-900",children:[e.jsx(q,{className:"inline"})," Delete"]})]})]},t.id))})]})}),!b&&d.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>c(s.current_page-1),disabled:s.current_page===1,className:`relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 ${s.current_page===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),e.jsx("button",{onClick:()=>c(s.current_page+1),disabled:s.current_page===s.last_page,className:`relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 ${s.current_page===s.last_page?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(s.current_page-1)*s.per_page+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(s.current_page*s.per_page,s.total)})," ","of ",e.jsx("span",{className:"font-medium",children:s.total})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>c(s.current_page-1),disabled:s.current_page===1,className:`relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ${s.current_page===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),"←"]}),[...Array(s.last_page).keys()].map(t=>{const a=t+1;return a===1||a===s.last_page||Math.abs(a-s.current_page)<=1?e.jsx("button",{onClick:()=>c(a),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${a===s.current_page?"bg-blue-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:outline-offset-0"}`,children:a},a):a===2&&s.current_page>3||a===s.last_page-1&&s.current_page<s.last_page-2?e.jsx("span",{className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700",children:"..."},a):null}),e.jsxs("button",{onClick:()=>c(s.current_page+1),disabled:s.current_page===s.last_page,className:`relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ${s.current_page===s.last_page?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),"→"]})]})})]})]})]}),e.jsx(T,{isOpen:k,onClose:I,faculty:o,universityId:n||null,mode:M}),e.jsx(L,{isOpen:C,title:"Delete Faculty",message:`Are you sure you want to delete ${o==null?void 0:o.name}? This action cannot be undone.`,onConfirm:O,onCancel:()=>g(!1)})]})}export{K as default};
