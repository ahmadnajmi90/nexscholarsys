import{r as i,R as Y,j as t,Y as ot,a as O}from"./app-DycluJDi.js";import{M as at}from"./MainLayout-B6p5qXtx.js";import{T as nt,a as lt,b as U,c as k}from"./tabs--JuXotzZ.js";import{c as pt}from"./index-CRoFkAwq.js";import{l as mt}from"./logError-D4ezqrCx.js";import ct from"./PotentialSupervisorList-CpnPEPC1.js";import dt from"./RequestStatusList-DgzPah5t.js";import ut from"./UnifiedRequestDetailCard-Bh558qwq.js";import gt from"./ManageSupervisorPanel-FmZmjeR1.js";import ht from"./ProposalModal-DLlocO2D.js";import xt from"./RelationshipDetailModal-B5Tvln1H.js";import ft from"./ForceUnbindRequestModal-B2Hmdlhk.js";import vt from"./RecommendedSupervisorsSection-D9JMOrAt.js";import V from"./UnifiedNotificationModal-JluQ4iu2.js";import bt from"./RecentActivityPanel-C_vYS6kY.js";import jt from"./UpcomingMeetingsPanel-B5CVUfeB.js";import{C as Rt,a as yt}from"./card--WzO-fcI.js";import{U as $}from"./RelationshipHistoryTab-BiwPbhVH.js";import{U as z}from"./users-B5watpD6.js";import{C as B}from"./calendar-clock-CmwHfodY.js";import{C as St}from"./clipboard-list-BHEDK9c8.js";import{F as Ct}from"./file-text-CM_fgsBl.js";import"./house-DuQe23QT.js";import"./createLucideIcon-D0KJwFBT.js";import"./zap-DV9Acmiq.js";import"./folder-open-Bgm5Yl-Q.js";import"./settings-CcnxK-77.js";import"./useRoles-Ex28E3oj.js";import"./chevron-left-CCTwwUf3.js";import"./proxy-BQWTDGOX.js";import"./user-round-D0HJxKcP.js";import"./dollar-sign-DggTktnR.js";import"./calendar-B99WzEhS.js";import"./message-square-DJV6gM-2.js";import"./graduation-cap-D5C30QRj.js";import"./building-0UgdvqyI.js";import"./Dropdown-YylP5fBo.js";import"./transition-CPF_n0Aj.js";import"./sparkles-BmXWKRKa.js";import"./bookmark-DgZoxyTC.js";import"./folder-kanban-DWpojK_X.js";import"./building-2-D0BlUxRJ.js";import"./database-Bdq9zUMP.js";import"./shield-CJ75fCXR.js";import"./index-D2lR-Ixd.js";import"./analytics-BQ374C1C.js";import"./index-B8HlzDGM.js";import"./iconBase--qfUO0jU.js";import"./supervisionConstants-BuM5-H5X.js";import"./button-DrpbBg5w.js";import"./utils-D-KgF5mV.js";import"./Modal-B5RxEfWL.js";import"./dialog-BhLoydV6.js";import"./PrimaryButton-BmPLB8rg.js";import"./SecondaryButton-BMDFl-bS.js";import"./x-DMdqOVgw.js";import"./chevron-right-Ccsl5LyU.js";import"./search-B-v2ubcP.js";import"./circle-check-big-CCdWVaOD.js";import"./tooltip-Bjh7jqzi.js";import"./index-CQUljECt.js";import"./index-Cyyfgiou.js";import"./index-CjkJyM6P.js";import"./index-TfP-1Own.js";import"./index-DhTYVmtt.js";import"./index-MS7JGIS8.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-DygBQkXJ.js";import"./index-C_G9iF1W.js";import"./index-Bf3MYqwD.js";import"./briefcase-B4GBZk0m.js";import"./user-gMN38dzl.js";import"./index-0qH_eg9b.js";import"./index-3QGgbkx-.js";import"./index-D7eWovwz.js";import"./ConfirmationModal-BHLx_4ig.js";import"./triangle-alert-CJCKiVvc.js";import"./formatDistanceToNow-GKXiLTrL.js";import"./constructNow-DtVD-0hX.js";import"./en-US-DNUEYIb-.js";import"./book-open-BbG8qq9y.js";import"./user-plus-DYe-3CX-.js";import"./eye-Dwc4GoVS.js";import"./send-COSqrCrt.js";import"./circle-check-DBw7ke1n.js";import"./loader-circle-DBMiS7kS.js";import"./trash-2-B8Zt6fdt.js";import"./badge-7bhQenKW.js";import"./index-CGrAONsN.js";import"./separator-VuB0UWa5.js";import"./lightbulb-ClojK8Oe.js";import"./clock-3-Dz6ZU_zD.js";import"./message-circle-Ct4Mc-YM.js";import"./circle-x-B0ePoeZ3.js";import"./format-Dv9Rm441.js";import"./avatar-DLxWZnV0.js";import"./scroll-area-DStNuix4.js";import"./index-BdQq_4o_.js";import"./textarea-CSq6H5gP.js";import"./ThreadPane-B59ibpsg.js";import"./AttachmentPreviewModal-o5AETYTO.js";import"./download-BSCvsIuy.js";import"./isSameDay-Dm-A-V7S.js";import"./AcceptSupervisorOfferModal-B81_Rofl.js";import"./label-DymNAe9a.js";import"./checkbox-Cy0T5o2F.js";import"./index-DbGR7Odn.js";import"./check-B8VjmKe5.js";import"./alert-DSLdBZdj.js";import"./circle-alert-C0Kb6UEK.js";import"./AcceptSupervisionRequestModal-DRywlDI2.js";import"./select-CATK_wLT.js";import"./index-BsSxmoif.js";import"./tslib.es6-CmEaCU22.js";import"./chevron-down-CWxqwc3h.js";import"./chevron-up-Ba7z8PNf.js";import"./DeclineSupervisionRequestModal-CPNEXl4-.js";import"./input-DGTuyCNK.js";import"./ScheduleMeetingDialog-DxmMlWVk.js";import"./useGoogleCalendar-B8hZgA0d.js";import"./external-link-C7oBCvIe.js";import"./modalAnimations-CCENKliM.js";import"./supervisionHelpers-EJT0WNFw.js";import"./video-BDzp7SjL.js";import"./mail-vd1JXS-x.js";import"./phone-Cz2eoHVX.js";import"./globe-VmxN95cK.js";import"./sticky-note-O8t9pa_K.js";import"./StudentRelationshipDetailModal-DFF1I4Hw.js";import"./UnifiedOverviewTab-Hu8ps4s-.js";import"./UnbindRequestModal-Dh6S40t4.js";import"./user-minus-Dy6Dt6Xk.js";import"./UniversityLetterUploadModal-DKEOpVdV.js";import"./upload-CkFes5p6.js";import"./CoSupervisorSearchModal-6-_jOTbs.js";import"./index-CDt3b6_8.js";import"./CoSupervisorInvitationCard-DlF6zS7M.js";import"./clock-CXQ5cZnz.js";import"./CoSupervisorInvitationDetailPanel-D9UdiBa4.js";import"./DocumentPreviewModal-BpVXpdNe.js";import"./history-C-nHJ_-o.js";import"./ResearchTab-DgcBBqsq.js";import"./plus-DH2wwcTw.js";import"./circle-Cf-nDHgh.js";import"./DocumentsTab-BPlP3H6g.js";import"./dialog-Bfq9Mh4w.js";import"./index-DFBzGmTk.js";import"./cloud-upload-DUZuy54W.js";import"./paperclip-B6LGWlAb.js";import"./RejectUnbindModal-HbW-SPs-.js";import"./arrow-right-CWOFNc3l.js";import"./MeetingActionMenu-L3cT7v54.js";import"./dropdown-menu-AR5wIcrT.js";import"./ellipsis-vertical-BBNn6lEy.js";import"./RescheduleMeetingDialog-BOcLTxdd.js";import"./map-pin-Cra05FqG.js";import"./isTomorrow-DJhbrIGS.js";import"./addDays-CAl2nVVE.js";function Ri(){const[y,g]=i.useState(()=>sessionStorage.getItem("openRequestId")?"status":"potential"),[x,S]=i.useState([]),[r,G]=i.useState([]),[m,H]=i.useState([]),[h,A]=i.useState(!0),[J,C]=i.useState(!1),[K,N]=i.useState(null),[w,c]=i.useState(null),[M,f]=i.useState(null),[L,Q]=i.useState(()=>{const e=sessionStorage.getItem("openRequestId");return e?(sessionStorage.removeItem("openRequestId"),e):null}),[W,q]=i.useState(!1),[X,_]=i.useState(!1),[Z,tt]=i.useState([]),[et,st]=i.useState([]),[F,it]=i.useState(0),l=async()=>{A(!0);try{const[e,s,a]=await Promise.all([O.get(route("supervision.shortlist.index")),O.get(route("supervision.requests.index")),O.get(route("supervision.relationships.index"))]),d=s.data.data||[];if(S(e.data.data||[]),G(d),H(a.data.data||[]),it(p=>p+1),L){const p=d.find(n=>String(n.id)===String(L));p&&c(p),Q(null)}}catch(e){mt(e,"Supervision loadData"),pt.error("Failed to load supervision data")}finally{A(!1)}};i.useEffect(()=>{l()},[]),i.useEffect(()=>{if(h||r.length===0)return;const e=r.filter(a=>a.status==="pending_student_acceptance"&&!a.offer_acknowledged_at),s=r.filter(a=>a.status==="rejected"&&!a.rejection_acknowledged_at);e.length>0?(st(e),_(!0)):s.length>0&&(tt(s),q(!0))},[r,h]);const D=m.some(e=>e.status==="active"),rt=m.find(e=>e.status==="active")||null,b=Y.useMemo(()=>{const e=m.filter(s=>s.status==="active");if(D){const s=e.filter(o=>o.role==="main").length,a=e.filter(o=>o.role==="co"||o.role==="co-supervisor").length,d=new Date,p=d.getMonth(),n=d.getFullYear(),v=e.reduce((o,u)=>{if(u.meetings&&Array.isArray(u.meetings)){const I=u.meetings.filter(j=>{if(!j.scheduled_for)return!1;const E=new Date(j.scheduled_for);return E.getMonth()===p&&E.getFullYear()===n});return o+I.length}return o},0),T=e.reduce((o,u)=>{if(u.onboarding_checklist_items&&Array.isArray(u.onboarding_checklist_items)){const I=u.onboarding_checklist_items.filter(j=>!j.completed);return o+I.length}return o},0);return{metric1:{value:s,label:"Primary Supervisors",icon:$,iconColor:"text-indigo-600",bgColor:"bg-indigo-50"},metric2:{value:a,label:"Co-supervisors",icon:z,iconColor:"text-blue-600",bgColor:"bg-blue-50"},metric3:{value:v,label:"Meetings this Month",icon:B,iconColor:"text-green-600",bgColor:"bg-green-50"},metric4:{value:T,label:"Pending Tasks",icon:St,iconColor:"text-amber-600",bgColor:"bg-amber-50"}}}else{const s=r.length,a=r.filter(n=>n.status==="pending"||n.status==="pending_student_acceptance").length,d=r.reduce((n,v)=>{if(v.meetings&&Array.isArray(v.meetings)){const T=v.meetings.filter(o=>o.scheduled_for&&new Date(o.scheduled_for)>new Date);return n+T.length}return n},0),p=x.length;return{metric1:{value:s,label:"Total Requests",icon:Ct,iconColor:"text-indigo-600",bgColor:"bg-indigo-50"},metric2:{value:a,label:"Pending Requests",icon:z,iconColor:"text-amber-600",bgColor:"bg-amber-50"},metric3:{value:d,label:"Upcoming Meetings",icon:B,iconColor:"text-green-600",bgColor:"bg-green-50"},metric4:{value:p,label:"Shortlisted",icon:$,iconColor:"text-blue-600",bgColor:"bg-blue-50"}}}},[r,m,x,D]),P=Y.useMemo(()=>{for(const e of m){const s=e.activeUnbindRequest||e.active_unbind_request;if(s&&s.status==="pending"&&s.initiated_by==="supervisor")return{unbindRequest:s,relationship:e}}return null},[m]);return t.jsxs(at,{title:"My Supervisor",children:[t.jsx(ot,{title:"My Supervisor"}),t.jsxs("div",{className:"max-w-7xl mx-auto px-3 py-3 sm:px-4 sm:py-4 md:px-5 md:py-5 lg:px-0 lg:py-0 pb-6 space-y-6",children:[!h&&t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 pb-6 border-b border-slate-200",children:[t.jsx(R,{...b.metric1}),t.jsx(R,{...b.metric2}),t.jsx(R,{...b.metric3}),t.jsx(R,{...b.metric4})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-0",children:[t.jsx("div",{className:"lg:col-span-9 lg:pr-6 lg:border-r border-slate-200",children:D?t.jsx(gt,{relationships:m,reload:l,onOpenDetail:e=>{f(e),c(null)},onOpenMeetings:e=>{f(e),c(null)}}):t.jsxs(nt,{value:y,onValueChange:g,className:"w-full space-y-4",children:[t.jsxs(lt,{className:"grid w-full grid-cols-3 bg-gray-100 p-1 rounded-lg h-12",children:[t.jsxs(U,{value:"potential",className:"data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm data-[state=inactive]:text-gray-600 rounded-md transition-all py-2",children:[t.jsx("span",{className:"hidden xs:inline",children:"Potential Supervisors"}),t.jsx("span",{className:"xs:hidden",children:"Potential"})]}),t.jsxs(U,{value:"status",className:"data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm data-[state=inactive]:text-gray-600 rounded-md transition-all py-2",children:[t.jsx("span",{className:"hidden xs:inline",children:"Proposal Status"}),t.jsx("span",{className:"xs:hidden",children:"Status"})]}),t.jsxs(U,{value:"manage",disabled:!0,className:"data-[state=active]:bg-white data-[state=active]:text-gray-900 data-[state=active]:shadow-sm data-[state=inactive]:text-gray-400 rounded-md transition-all py-2",children:[t.jsx("span",{className:"hidden xs:inline",children:"Manage Supervisor"}),t.jsx("span",{className:"xs:hidden",children:"Manage"})]})]}),t.jsx(k,{value:"potential",children:h?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),t.jsx("p",{className:"text-sm text-slate-600",children:"Loading potential supervisors..."})]})}):t.jsx(ct,{shortlist:x,requests:r,activeRelationship:rt,reload:l,isLoading:h,onRequestSupervisor:e=>{N(e),C(!0)},onViewRequest:e=>{c(e),f(null),g("status")}})}),t.jsx(k,{value:"status",children:h?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),t.jsx("p",{className:"text-sm text-slate-600",children:"Loading your requests..."})]})}):t.jsxs("div",{className:"space-y-6",children:[r.filter(e=>e.status==="rejected"&&e.recommended_supervisors&&e.recommended_supervisors.length>0).map((e,s)=>t.jsx(vt,{requestId:e.id,isFirstSection:s===0},e.id)),t.jsx(dt,{requests:r,reload:l,onOpenDetail:e=>{c(e),f(null)}})]})}),t.jsx(k,{value:"manage",children:t.jsx("div",{className:"bg-white shadow rounded-lg p-6 text-center text-gray-500",children:"No supervisors yet."})})]})}),t.jsx("div",{className:"lg:col-span-3 lg:pl-6 mt-6 lg:mt-0",children:t.jsxs("div",{className:"sticky top-6 space-y-6",children:[t.jsx(bt,{userRole:"student",triggerReload:F}),t.jsx(jt,{userRole:"student",triggerReload:F})]})})]}),t.jsx(ht,{isOpen:J,onClose:()=>{C(!1),N(null)},supervisor:K,onSubmitted:()=>{C(!1),N(null),l()}}),w&&!M&&t.jsx(ut,{request:w,onClose:()=>{c(null)},onUpdated:l,userRole:"student"}),M&&t.jsx(xt,{request:w,relationship:M,onClose:()=>{c(null),f(null)},onUpdated:l}),P&&t.jsx(ft,{unbindRequest:P.unbindRequest,relationship:P.relationship,onResponse:l,userRole:"student"}),t.jsx(V,{type:"offer",data:et,isOpen:X,onClose:()=>_(!1),onNavigate:()=>{g("status"),_(!1)}}),t.jsx(V,{type:"rejection",data:Z,isOpen:W,onClose:()=>q(!1),onNavigate:()=>{g("status"),q(!1)}})]})]})}function R({value:y,label:g,icon:x,iconColor:S,bgColor:r}){return t.jsx(Rt,{className:"border-slate-200 shadow-sm",children:t.jsx(yt,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-3xl font-bold text-slate-900",children:y}),t.jsx("p",{className:"text-sm text-slate-600 mt-1",children:g})]}),t.jsx("div",{className:`${r} p-3 rounded-lg`,children:t.jsx(x,{className:`h-6 w-6 ${S}`})})]})})})}export{Ri as default};
