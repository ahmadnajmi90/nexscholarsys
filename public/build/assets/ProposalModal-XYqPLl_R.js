import{r as o,j as e,a as O}from"./app-6KcAPae7.js";import{c as B}from"./index-DjCDrVl_.js";import{D as U,a as z,b as G,c as $,d as H}from"./dialog-RPNwQkV0.js";import{B as y}from"./button-CrdDRXAu.js";import{I as W}from"./input-mPZbvcwj.js";import{T as X}from"./textarea-BWWWuSfQ.js";import{L as m}from"./label-CB_vtBTU.js";import{A as K,a as J}from"./alert-Bq8V-QnM.js";import{C as Q}from"./checkbox-Dv3wG0nS.js";import{l as V}from"./logError-BloCzXDJ.js";import{U as Y}from"./user-round-Gn5hLxMS.js";import{G as Z}from"./graduation-cap-DsZZvawH.js";import{B as ee}from"./building-2-BOmvfrGU.js";import{L as se}from"./lightbulb-3y9Wo_FK.js";import{C as ae}from"./cloud-upload-ClVnApXi.js";import{P as te}from"./paperclip-CHupZKCg.js";import{L as re}from"./loader-circle-BGO5wi-L.js";import"./index-BT3GCukP.js";import"./index-C_9bpbuH.js";import"./index-C3-aQ1HP.js";import"./index-JAD3o4sP.js";import"./index-4gt4wYEX.js";import"./index-CANaiMod.js";import"./index-Cxfb7wM5.js";import"./index-Kc-fmclX.js";import"./index-D5o-Dx5T.js";import"./utils-CBfrqCZ4.js";import"./x-RVcZvC1Z.js";import"./createLucideIcon-Dg0NKHwN.js";import"./index-CdJFUDDL.js";import"./index-BzUL8saQ.js";import"./index-CSjGVC7d.js";import"./check-yEdCv6kj.js";const E=[{key:"proposal",label:"Research proposal (PDF/DOC/DOCX)",accept:".pdf,.doc,.docx",required:!0},{key:"transcript",label:"Academic transcript (PDF)",accept:".pdf"},{key:"background",label:"Research background (PDF/DOC/DOCX)",accept:".pdf,.doc,.docx"},{key:"portfolio",label:"Portfolio or supplementary materials",accept:"*"}],ie=a=>a?.user?.academician?.academician_id??a?.academician?.academician_id??a?.academician_id??"";function Oe({isOpen:a,supervisor:t,onClose:n,onSubmitted:p}){const[w,D]=o.useState(""),[C,S]=o.useState(""),[x,h]=o.useState(""),[f,g]=o.useState(""),[j,b]=o.useState({proposal:null,transcript:null,background:null,portfolio:null}),[_,N]=o.useState(null),[u,k]=o.useState(!1),[P,v]=o.useState(!1);o.useEffect(()=>{if(a&&t){const s=ie(t);console.log("ProposalModal opened",{supervisor:t,identifier:s,postgraduate_program_id:t?.postgraduate_program_id}),D(s?String(s):""),S(t?.postgraduate_program_id||""),h(""),g(""),b({proposal:null,transcript:null,background:null,portfolio:null}),N(null),v(!1)}else a||(D(""),S(""),h(""),g(""),b({proposal:null,transcript:null,background:null,portfolio:null}),N(null),v(!1))},[a,t]);const F=!!(w&&x?.trim()&&f?.trim()&&j?.proposal&&P),q=(s,r)=>{b(i=>({...i,[s]:r}))},T=async s=>{if(s.preventDefault(),!F||u)return;const r=new FormData;r.append("academician_id",w),C&&r.append("postgraduate_program_id",C),r.append("proposal_title",x),r.append("motivation",f),E.forEach(({key:i})=>{const l=j[i];l&&r.append(`attachments[${i}]`,l)});try{k(!0),await O.post(route("supervision.requests.store"),r,{headers:{"Content-Type":"multipart/form-data"}}),B.success("Supervision request submitted"),p?.()}catch(i){V(i,"ProposalModal handleSubmit");const l=i?.response?.data?.message||"Failed to submit your supervision request";N(l),B.error(l)}finally{k(!1)}},c=t?.academician??t,L=c?.full_name??"Supervisor",I=c?.current_position??"",M=c?.university?.name??c?.universityDetails?.full_name??"",A=c?.research_domains??[];return e.jsx(U,{open:a,onOpenChange:s=>s?null:n?.(),children:e.jsxs(z,{className:"max-h-[90vh] overflow-y-auto sm:max-w-2xl",children:[e.jsxs(G,{children:[e.jsx($,{children:"Submit supervision request"}),e.jsx(H,{children:"Provide a strong proposal and supporting documents to help your prospective supervisor understand your research direction and readiness."})]}),_&&e.jsx(K,{variant:"destructive",className:"mb-4",children:e.jsx(J,{children:_})}),e.jsx("div",{className:"rounded-lg border border-indigo-200 bg-indigo-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-indigo-100 p-2",children:e.jsx(Y,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:L}),I&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600 mt-1",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:I})]}),M&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-600 mt-1",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:M})]})]}),A.length>0&&e.jsxs("div",{className:"flex items-start gap-1.5 text-sm text-slate-700",children:[e.jsx(se,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Focus: "}),e.jsx("span",{children:A.join(", ")})]})]})]})]})}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"proposal_title",children:"Proposal title"}),e.jsx(W,{id:"proposal_title",value:x,onChange:s=>h(s.target.value),placeholder:"e.g. Exploring AI-driven multimodal learning analytics",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"motivation",children:"Motivation"}),e.jsx(X,{id:"motivation",value:f,onChange:s=>g(s.target.value),rows:6,placeholder:"Describe your research goals, why you want to work with this supervisor, and how your background supports the project.",required:!0})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Attachments"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload the required proposal and any supporting documents. PDFs are preferred for readability."})]}),e.jsx("div",{className:"space-y-4",children:E.map(({key:s,label:r,accept:i,required:l})=>{const d=j[s];return e.jsxs("div",{className:"rounded-lg border border-dashed border-slate-200 p-4",children:[e.jsxs(m,{className:"flex items-center justify-between text-sm font-medium text-slate-700",children:[e.jsxs("span",{children:[r,l&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx(y,{type:"button",variant:"outline",size:"sm",asChild:!0,children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),d?"Replace file":"Upload file",e.jsx("input",{type:"file",accept:i,className:"sr-only",onChange:R=>q(s,R.target.files?.[0]??null)})]})})]}),d?e.jsxs("div",{className:"mt-3 flex items-center gap-2 rounded-md bg-slate-50 px-3 py-2 text-xs text-slate-600",children:[e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"truncate",title:d.name,children:d.name}),e.jsxs("span",{className:"text-slate-400",children:["(",oe(d.size),")"]})]}):e.jsx("p",{className:"mt-3 text-xs text-slate-500",children:l?"Required attachment.":"Optional â€” add if it strengthens your proposal."})]},s)})})]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{id:"original-work",checked:P,onCheckedChange:v,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(m,{htmlFor:"original-work",className:"text-sm font-medium leading-relaxed text-slate-900 cursor-pointer",children:["I confirm that this proposal is original and written by me.",e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"By checking this box, you affirm that the proposal content and attached documents represent your own work and ideas."})]})]})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[e.jsx(y,{type:"button",variant:"outline",onClick:n,disabled:u,children:"Cancel"}),e.jsxs(y,{type:"submit",disabled:!F||u,children:[u?e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Submit request"]})]})]})]})})}function oe(a){if(!a)return"0 B";const t=["B","KB","MB","GB"],n=Math.min(Math.floor(Math.log(a)/Math.log(1024)),t.length-1),p=a/Math.pow(1024,n);return`${p.toFixed(p>100?0:1)} ${t[n]}`}export{Oe as default};
