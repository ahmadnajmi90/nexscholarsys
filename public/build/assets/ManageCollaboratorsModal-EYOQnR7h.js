import{c as z}from"./createLucideIcon-DxkVkVmH.js";import{q as K,r as m,W as Q,j as r,e as X,y as M}from"./app-DDFhkcsa.js";import{M as Z}from"./Modal-B3_bqs6b.js";import{I as F}from"./InputLabel-ByR71srF.js";import{I as O}from"./InputError-BS5Y__lH.js";import{P as T}from"./PrimaryButton-Db7n661F.js";import{S as $}from"./SecondaryButton-oPNWF5aW.js";import{C as ee}from"./ConfirmationModal-CIHpg0gV.js";import{c as h}from"./index-CqrFzABu.js";import{S as re}from"./react-select.esm-Kb4fiLId.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ae=z("Info",se);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],be=z("Users",ie),le=()=>{const[n,p]=m.useState(!1),e=m.useRef(null),l=m.useRef(null),c=()=>{if(e.current&&l.current){const g=e.current.getBoundingClientRect(),u=l.current.getBoundingClientRect();l.current.style.left=`${g.left-u.width/2+g.width/2}px`,l.current.style.top=`${g.top-u.height-10}px`}};return m.useEffect(()=>{if(n)return c(),window.addEventListener("scroll",c),window.addEventListener("resize",c),()=>{window.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[n]),{triggerProps:{ref:e,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)},tooltipProps:{ref:l,style:{position:"fixed",zIndex:9999,display:n?"block":"none"}},isVisible:n}},oe=({children:n,isVisible:p})=>{const[e,l]=m.useState(!1);return m.useEffect(()=>(l(!0),()=>l(!1)),[]),e?X.createPortal(n,document.body):null};function ve({show:n,onClose:p,context:e,contextType:l,connections:c=[]}){var E,I,R,A,U,x;const{auth:g}=K().props,[u,v]=m.useState(null),[_,j]=m.useState(!1),[S,C]=m.useState([]),{triggerProps:N,tooltipProps:D,isVisible:B}=le(),d=Q({user_id:"",role:"member"}),b=l==="workspace"?(e==null?void 0:e.id)||((E=e==null?void 0:e.data)==null?void 0:E.id):((I=e==null?void 0:e.data)==null?void 0:I.id)||(e==null?void 0:e.id),k=g.user.id===(l==="workspace"?((R=e==null?void 0:e.data)==null?void 0:R.owner_id)||(e==null?void 0:e.owner_id):((A=e==null?void 0:e.data)==null?void 0:A.owner_id)||(e==null?void 0:e.owner_id)),f=l==="workspace"?(U=e==null?void 0:e.data)==null?void 0:U.members:(x=e==null?void 0:e.data)==null?void 0:x.members;m.useEffect(()=>{if(n&&Array.isArray(c)&&Array.isArray(f)){const s=f.map(a=>a.id),i=c.filter(a=>!s.includes(a.id));C(i)}else C([])},[n,c,e,f]);const V=s=>{s.preventDefault();const i=l==="workspace"?"project-hub.workspaces.members.add":"project-hub.projects.members.store";d.post(route(i,b),{preserveScroll:!0,onSuccess:()=>{h.success("Member added successfully!"),d.reset()},onError:a=>{const o=a.user_id||a.role||"Failed to add member.";h.error(o)}})},P=s=>{if(!s)return{role:"User",fullName:"Unknown"};const i=s.academician||s.postgraduate||s.undergraduate;return{role:s.academician?"Academician":s.postgraduate?"Postgraduate":s.undergraduate?"Undergraduate":"User",fullName:(i==null?void 0:i.full_name)||s.name}},W=s=>{v(s)},q=(s,i)=>{j(!0);const a=l==="workspace"?"project-hub.workspaces.members.update-role":"project-hub.projects.members.update-role";let o;l==="workspace"?o={workspace:b,member:s.id}:o={project:b,member:s.id},M.put(route(a,o),{role:i},{preserveScroll:!0,onSuccess:()=>{h.success("Member role updated successfully")},onError:t=>{const y=Object.values(t).flat()[0]||"Failed to update member role";h.error(y),console.error("Error updating member role:",t)},onFinish:()=>{j(!1)}})},H=()=>{if(!u)return;j(!0);const s=l==="workspace"?"project-hub.workspaces.members.remove":"project-hub.projects.members.destroy";let i;l==="workspace"?i={workspace:b,member:u.id}:i={project:b,member:u.id},M.delete(route(s,i),{preserveScroll:!0,onSuccess:()=>{h.success("Member removed successfully"),v(null),M.reload({preserveState:!0})},onError:a=>{const o=Object.values(a).flat()[0]||"Failed to remove member";h.error(o)},onFinish:()=>{j(!1),v(null)}})},w=s=>{if(!s)return"Unknown User";const i=s.academician||s.postgraduate||s.undergraduate;return(i==null?void 0:i.full_name)||s.name},Y=s=>{var a,o,t;if(!s)return null;const i=((a=s.academician)==null?void 0:a.profile_picture)||((o=s.postgraduate)==null?void 0:o.profile_picture)||((t=s.undergraduate)==null?void 0:t.profile_picture);return i?`/storage/${i}`:null},G=l==="workspace"?"Manage Workspace Members":"Manage Project Members";return r.jsxs(r.Fragment,{children:[r.jsx(Z,{show:n,onClose:p,maxWidth:"md",children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:G}),r.jsxs("div",{className:"mb-8",children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),f&&f.length>0?r.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-1",children:f.filter(s=>{var a,o;const i=l==="workspace"?((a=e==null?void 0:e.data)==null?void 0:a.owner_id)||(e==null?void 0:e.owner_id):((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id);return s.id!==i}).map(s=>{var o,t,y,L;const i=s.id===(l==="workspace"?((o=e==null?void 0:e.data)==null?void 0:o.owner_id)||(e==null?void 0:e.owner_id):((t=e==null?void 0:e.data)==null?void 0:t.owner_id)||(e==null?void 0:e.owner_id)),a=Y(s);return r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 py-3 px-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center min-w-0",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden flex-shrink-0",children:a?r.jsx("img",{src:a,alt:w(s),className:"h-full w-full object-cover"}):r.jsx("span",{className:"text-gray-500 text-sm",children:w(s).charAt(0)})}),r.jsxs("div",{className:"ml-3 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:w(s)}),r.jsx("p",{className:"text-xs text-gray-500 capitalize",children:i?"Owner":((y=s.pivot)==null?void 0:y.role)||"Member"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0 ml-4",children:[k&&!i&&r.jsxs("select",{value:((L=s.pivot)==null?void 0:L.role)||"member",onChange:J=>q(s,J.target.value),className:"text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",disabled:_,children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),k&&!i&&r.jsx($,{onClick:()=>W(s),disabled:_,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]})]},s.id)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),k&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),S.length>0?r.jsxs("form",{onSubmit:V,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(F,{htmlFor:"user_id",value:"Select Connection"}),(()=>{const s=S.map(a=>({value:a.id,label:P(a).fullName,...a})),i=s.find(a=>a.value===d.data.user_id)||null;return r.jsx(re,{inputId:"user_id",name:"user_id",options:s,value:i,onChange:a=>d.setData("user_id",a?a.value:""),menuPortalTarget:document.body,formatOptionLabel:a=>{const{role:o,fullName:t}=P(a);return r.jsx("div",{className:"flex items-center",children:r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium",children:t}),r.jsx("div",{className:"text-xs text-gray-500",children:o})]})})},styles:{menuPortal:a=>({...a,zIndex:9999})},className:"mt-1 block w-full",classNamePrefix:"select",placeholder:"Select a connection to invite..."})})(),r.jsx(O,{message:d.errors.user_id,className:"mt-2"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(F,{htmlFor:"role",value:"Role"}),r.jsxs("div",{className:"relative ml-2 group",children:[r.jsx(ae,{className:"w-4 h-4 text-gray-400 cursor-help",ref:N.ref,onMouseEnter:N.onMouseEnter,onMouseLeave:N.onMouseLeave}),r.jsx(oe,{isVisible:B,children:r.jsxs("div",{className:"bg-gray-800 text-white text-xs rounded py-2 px-3 w-64",...D,children:[r.jsx("p",{className:"font-semibold mb-1",children:"Admin:"}),r.jsx("p",{className:"mb-2",children:"Can manage members, boards, and workspace/project settings."}),r.jsx("p",{className:"font-semibold mb-1",children:"Member:"}),r.jsx("p",{children:"Can create and edit content on boards they have access to."}),r.jsx("div",{className:"absolute bottom-0 right-0 transform translate-y-1/2 rotate-45 w-2 h-2 bg-gray-800"})]})})]})]}),r.jsxs("select",{id:"role",name:"role",value:d.data.role,onChange:s=>d.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[r.jsx("option",{value:"member",children:"Member"}),r.jsx("option",{value:"admin",children:"Admin"})]}),r.jsx(O,{message:d.errors.role,className:"mt-2"})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx(T,{type:"submit",disabled:d.processing||!d.data.user_id,children:d.processing?"Sending...":"Send Invitation"})})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:r.jsx("p",{className:"text-sm text-yellow-700",children:"You have no available connections to invite. Connect with other users first."})})]}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx($,{onClick:p,children:"Close"})})]})}),r.jsx(ee,{show:!!u,onClose:()=>v(null),onConfirm:H,title:"Remove Member",message:u?`Are you sure you want to remove ${w(u)} from this ${l}?`:""})]})}export{ve as M,be as U};
