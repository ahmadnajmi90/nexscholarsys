import{q as me,r as d,a as j,j as e}from"./app-C9aRItHR.js";import{B as b}from"./button-CSPEol7l.js";import{I as xe}from"./input-BRl5cfeF.js";import{T as pe,a as he,b as L,c as P}from"./tabs-CFEHTnnM.js";import{C as ue,a as fe}from"./card-CmBiKUHP.js";import{A as q,a as G}from"./avatar-CxvIrRZY.js";import{B as Q}from"./badge-DncnOgy3.js";import{t as _}from"./index-z8zrWhlQ.js";import{A as ge}from"./index-BXuOt4X-.js";import{m as X}from"./proxy-oGTuy5le.js";import{U as ve}from"./user-plus-CgqOgluX.js";import{X as je}from"./x-CwXSr9E4.js";import{S as H}from"./search-4BAlCTpi.js";import{G as J}from"./graduation-cap-CUV5l_Ya.js";import{c as ye}from"./createLucideIcon-BKESxhZR.js";import{U as K}from"./users-7wE4kwZt.js";import"./utils-CBfrqCZ4.js";import"./index-CrClJLlY.js";import"./index-CC4PcrzS.js";import"./index-CCAZcmHJ.js";import"./index-h1-N4bqM.js";import"./index-BqNwAq_Q.js";import"./index-COgthb8O.js";import"./index-D5McE1bZ.js";import"./index-eZvGyRKK.js";import"./index-DQC-i451.js";import"./index-CdJFUDDL.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],W=ye("Network",Ne),Ke=({isOpen:C,onClose:y,relationship:p,onInvite:Y})=>{const{auth:Z}=me().props,g=Z.user?.postgraduate!==null,[S,O]=d.useState(g?"potential":"connections"),[u,ee]=d.useState(""),[se,w]=d.useState(!1),[ae,F]=d.useState([]),[te,M]=d.useState([]),[ie,k]=d.useState([]),[A,U]=d.useState([]),[t,I]=d.useState(null),[N,z]=d.useState(""),[B,$]=d.useState(!1);d.useEffect(()=>{C&&(ne(),g&&ce(),re())},[C,g]);const ne=async()=>{try{console.log("Loading excluded academicians for relationship:",p.id,"student:",p.student_id);const a=(await j.get(`/api/v1/app/supervision/relationships/${p.id}`)).data.data||{};console.log("Relationship details:",a);const l=(await j.get("/api/v1/app/supervision/cosupervisor-invitations/my-invitations")).data.as_initiator||[];console.log("My initiated invitations:",l);const c=new Set;p.academician_id&&(c.add(p.academician_id),console.log("Excluding main supervisor:",p.academician_id));const n=a.cosupervisors||[];console.log("Co-supervisors from relationship:",n),n.forEach(i=>{i.academician_id&&(c.add(i.academician_id),console.log("Excluding active co-supervisor:",i.academician_id))});const m=l.filter(i=>i.relationship_id===p.id&&!i.cancelled_at&&i.cosupervisor_status!=="rejected"&&i.approver_status!=="rejected");console.log("Pending invitations for this relationship:",m),m.forEach(i=>{c.add(i.cosupervisor_academician_id),console.log("Excluding pending invitation to:",i.cosupervisor_academician_id)});const f=Array.from(c);console.log("Final excluded academician IDs:",f),U(f)}catch(s){console.error("Error loading excluded academicians:",s),U([])}},ce=async()=>{try{w(!0);const s=await j.get("/api/v1/app/supervision/shortlist");F(s.data.data||[])}catch(s){console.error("Error loading potential supervisors:",s),F([])}finally{w(!1)}},re=async()=>{try{const s=await j.get("/api/v1/app/supervision/recommendations/supervisor-connections");M(s.data.data||[])}catch(s){console.error("Error loading connections:",s),M([])}},le=async s=>{if(!s||s.length<2){k([]);return}try{w(!0);const a=await j.get("/api/v1/app/supervision/recommendations/search-academicians",{params:{q:s}});k(a.data.data||[])}catch(a){console.error("Error searching academicians:",a),k([])}finally{w(!1)}};d.useEffect(()=>{if(S==="all"&&u){const s=setTimeout(()=>{le(u)},500);return()=>clearTimeout(s)}},[u,S]);const oe=async s=>{if(!N.trim()){_.error("Please add a personal message");return}const a=s.academician?.academician_id||s.id;if(!a){_.error("Invalid academician selected");return}$(!0);try{const r=await j.post(`/api/v1/app/supervision/relationships/${p.id}/cosupervisor/invite`,{cosupervisor_academician_id:a,invitation_message:N});_.success("Co-supervisor invitation sent successfully!"),I(null),z(""),Y(r.data.invitation),y()}catch(r){_.error(r.response?.data?.message||"Failed to send invitation")}finally{$(!1)}},E=({academician:s,source:a})=>{const r=s.academician?.academician_id||s.id,l=s.academician?.full_name||s.name,c=s.academician?.profile_picture||s.profile_picture,n=s.academician?.department||s.department;let m="";if(a==="potential"){const x=s.academician?.research_domains||[];m=x.length>0?x.slice(0,3).join(", "):"Research expertise not specified"}else m=s.expertise||"Research expertise not specified";const f=s.academician?.verified||s.verified;let i=[];if(a==="potential"){const x=s.academician?.university?.name,v=s.academician?.faculty?.name;x&&i.push(x),v&&i.push(v),n&&i.push(n)}else{const x=s.university,v=s.faculty;x&&i.push(x),v&&v!==n&&i.push(v),n&&i.push(n)}const o=i.join(" • "),h=t&&(t.academician?.academician_id||t.id)===r,V=c?`/storage/${c}`:null,de=l?l.split(" ").map(x=>x[0]).join("").slice(0,2).toUpperCase():"??";return e.jsx(ue,{className:`cursor-pointer transition-all hover:shadow-md ${h?"ring-2 ring-indigo-500":""}`,onClick:()=>I(s),children:e.jsx(fe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{className:"h-12 w-12 flex-shrink-0",children:V?e.jsx("img",{src:V,alt:l,className:"h-full w-full object-cover"}):e.jsx(G,{className:"bg-indigo-100 text-indigo-700",children:de})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:l}),f&&e.jsx(Q,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 flex-shrink-0",children:"Verified"})]}),m&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:m}),o&&e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:o})]}),h&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-6 h-6 bg-indigo-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]})})})},R=ae.filter(s=>{const a=s.academician?.academician_id;if(a&&A.includes(a))return!1;const r=s.academician?.full_name||"",l=s.academician?.department||"",c=u.toLowerCase();return r.toLowerCase().includes(c)||l.toLowerCase().includes(c)}),T=te.filter(s=>{const a=s.id;if(a&&A.includes(a))return!1;const r=s.name||"",l=s.department||"",c=s.expertise||"",n=u.toLowerCase();return r.toLowerCase().includes(n)||l.toLowerCase().includes(n)||c.toLowerCase().includes(n)}),D=ie.filter(s=>{const a=s.id;return!(a&&A.includes(a))});return e.jsx(ge,{children:C&&e.jsxs(e.Fragment,{children:[e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:y}),e.jsx(X.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:y,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6 text-indigo-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Add Co-Supervisor"})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 mt-1 truncate",children:["Search and invite a co-supervisor for ",p.student?.user?.name]})]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:y,className:"flex-shrink-0",children:e.jsx(je,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:t?e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 overflow-y-auto",children:[e.jsx(b,{variant:"ghost",onClick:()=>I(null),className:"mb-2 sm:mb-4 text-sm sm:text-base",children:"← Back to Search"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 sm:p-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-3",children:"Selected Co-Supervisor:"}),e.jsx("div",{className:"flex items-start gap-3",children:(()=>{const s=t.academician?.full_name||t.name,a=t.academician?.profile_picture||t.profile_picture,r=t.academician?.department||t.department,l=t.academician?.verified||t.verified;let c="";if(t.academician?.research_domains){const o=t.academician.research_domains||[];c=o.length>0?o.slice(0,3).join(", "):"Research expertise not specified"}else c=t.expertise||"Research expertise not specified";let n=[];if(t.academician){const o=t.academician?.university?.name,h=t.academician?.faculty?.name;o&&n.push(o),h&&n.push(h),r&&n.push(r)}else{const o=t.university,h=t.faculty;o&&n.push(o),h&&h!==r&&n.push(h),r&&n.push(r)}const m=n.join(" • "),f=a?`/storage/${a}`:null,i=s?s.split(" ").map(o=>o[0]).join("").slice(0,2).toUpperCase():"??";return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-12 w-12 sm:h-14 sm:w-14 flex-shrink-0",children:f?e.jsx("img",{src:f,alt:s,className:"h-full w-full object-cover"}):e.jsx(G,{className:"bg-indigo-100 text-indigo-700 text-base sm:text-lg",children:i})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:s}),l&&e.jsx(Q,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 flex-shrink-0",children:"Verified"})]}),c&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:c}),m&&e.jsx("p",{className:"text-xs text-gray-500",children:m})]})]})})()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-2",children:["Personal Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 min-h-[100px] sm:min-h-[120px] text-sm sm:text-base",placeholder:"Explain why you'd like this academician to be a co-supervisor...",value:N,onChange:s=>z(s.target.value),maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[N.length,"/1000 characters"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 sm:p-6 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),e.jsx(xe,{placeholder:"Search by name or email...",value:u,onChange:s=>ee(s.target.value),className:"pl-9 sm:pl-10 text-sm sm:text-base"})]})}),e.jsxs(pe,{value:S,onValueChange:O,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(he,{className:`mx-4 sm:mx-6 mt-4 flex-shrink-0 h-auto p-1.5 grid gap-1 ${g?"grid-cols-3":"grid-cols-2"}`,children:[g&&e.jsxs(L,{value:"potential",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(J,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Shortlist"}),e.jsx("span",{className:"xs:hidden",children:"Short"}),e.jsxs("span",{className:"hidden sm:inline",children:["(",R.length,")"]})]}),e.jsxs(L,{value:"connections",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(W,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Connections"}),e.jsx("span",{className:"xs:hidden",children:"Conn"}),e.jsxs("span",{className:"hidden sm:inline",children:["(",T.length,")"]})]}),e.jsxs(L,{value:"all",className:"flex items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-2.5 sm:py-3 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(K,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"All"}),e.jsx("span",{className:"xs:hidden",children:"All"}),e.jsx("span",{className:"hidden sm:inline",children:"Academicians"})]})]}),g&&e.jsx(P,{value:"potential",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:R.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No potential supervisors in your shortlist"})]}):R.map(s=>e.jsx(E,{academician:s,source:"potential"},s.academician?.academician_id||s.id))})}),e.jsx(P,{value:"connections",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No connections found"})]}):T.map(s=>e.jsx(E,{academician:s,source:"connections"},s.id))})}),e.jsx(P,{value:"all",className:"flex-1 mt-0 overflow-y-auto",children:e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-4 space-y-3",children:u.length<2?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Type at least 2 characters to search"})]}):se?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Searching..."})]}):D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No academicians found"})]}):D.map(s=>e.jsx(E,{academician:s,source:"all"},s.id))})})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 border-t bg-gray-50 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:t?e.jsx("span",{children:"Ready to send invitation"}):e.jsx("span",{children:"Select an academician to continue"})}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx(b,{variant:"outline",onClick:y,className:"flex-1 sm:flex-none",children:"Cancel"}),t&&e.jsx(b,{onClick:()=>oe(t),disabled:B||!N.trim(),className:"flex-1 sm:flex-none",children:B?"Sending...":"Send Invitation"})]})]})]})})]})})};export{Ke as default};
