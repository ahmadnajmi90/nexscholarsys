import{j as e,r as d,a as z}from"./app-iMgHp_eS.js";import{c}from"./index---wvTow-.js";import{M as B}from"./Modal-CtrNcR4a.js";import{B as h}from"./button-Ct11kXcH.js";import{I as w}from"./input-CdYr2Bcx.js";import{T as Y}from"./textarea-C-VaV38D.js";import{L as y}from"./label-DMRicobw.js";import{A as H,a as O}from"./alert-6lJ_2Thn.js";import{l as R}from"./logError-BloCzXDJ.js";import{u as q}from"./useGoogleCalendar-Dnzaf31b.js";import{C as G}from"./calendar-D8qiMF9A.js";import{E as U}from"./external-link-CY84SH5d.js";import{X as _}from"./x-ZEpUl_jb.js";import{f as W}from"./format-BOijCLBA.js";import{L as X}from"./loader-circle-F27clpTW.js";import"./dialog-tgbUGkxp.js";import"./transition-GCCCemnQ.js";import"./index-CPRTWrZv.js";import"./utils-CBfrqCZ4.js";import"./index-CBiZf16v.js";import"./index-CdJFUDDL.js";import"./createLucideIcon-BXdi-pyk.js";import"./en-US-DIdCsyf3.js";function Z({meeting:t,promptData:r,onYes:a,onNo:n,visible:g=!0}){if(!g)return null;const{supervisor_connected:i,student_connected:x}=r||{},m=i||x,f=i&&x;return e.jsx("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 max-w-md w-full",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Add to Google Calendar?"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3 space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500",children:t.scheduled_for?W(new Date(t.scheduled_for),"PPp"):"No date set"})]}),m?f?e.jsx("div",{className:"mb-3 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:e.jsx("p",{children:"âœ“ Both participants have Google Calendar connected"})}):e.jsx("div",{className:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-700",children:e.jsx("p",{children:"You have Google Calendar connected. The other participant can add this meeting from their side."})}):e.jsxs("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Google Calendar not connected"}),e.jsx("p",{children:"Connect your Google Calendar in Profile Settings to enable sync."})]}),e.jsx("div",{className:"flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsxs(h,{size:"sm",onClick:a,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(G,{className:"w-3.5 h-3.5 mr-1.5"}),"Add to Calendar"]}),e.jsx(h,{size:"sm",variant:"outline",onClick:n,className:"flex-1",children:"Not Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",asChild:!0,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:e.jsxs("a",{href:"/profile#calendar",onClick:j=>{n()},children:[e.jsx(U,{className:"w-3.5 h-3.5 mr-1.5"}),"Connect Calendar"]})}),e.jsx(h,{size:"sm",variant:"outline",onClick:n,children:e.jsx(_,{className:"w-3.5 h-3.5"})})]})})]}),e.jsx("button",{onClick:n,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(_,{className:"w-4 h-4"})})]})})}const S=()=>{const t=new Date;t.setHours(t.getHours()+24);const r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),g=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${r}-${a}-${n}T${g}:${i}`};function ve({relationship:t=null,request:r=null,onClose:a,onScheduled:n,userRole:g="supervisor"}){const[i,x]=d.useState("Supervision Meeting"),[m,f]=d.useState(S()),[j,k]=d.useState(""),[T,M]=d.useState(""),[v,F]=d.useState(!1),[D,u]=d.useState(null),{addMeetingToCalendar:A}=q(),L=r&&!t,p=t||r,P=g==="supervisor",C=P?t?.student?.full_name||r?.student?.full_name||"student":t?.academician?.full_name||r?.academician?.full_name||"supervisor";d.useEffect(()=>{p&&(x(`Meeting with ${C}`),f(S()),k(""),M(t?.meeting_cadence?`Discuss ${t.meeting_cadence.toLowerCase()}`:""),u(null))},[p,C,t?.meeting_cadence]);const $=(s,l)=>{c.custom(o=>e.jsx(Z,{meeting:s,promptData:l,onYes:async()=>{c.dismiss(o.id),await A(s.id)},onNo:()=>c.dismiss(o.id),visible:o.visible}),{duration:1e4,position:"top-center"})},I=async s=>{if(s.preventDefault(),!(!p||v)){if(!i.trim()||!m||!j.trim()){u("Please provide a title, meeting date, and meeting link/location.");return}if(!p.id){u("Cannot schedule meeting: Invalid data. Please try again."),c.error("Invalid data");return}F(!0),u(null);try{const l=L?route("supervision.requests.meetings.store",r.id):route("supervision.meetings.store",t.id),o=m.replace("T"," ")+":00",b=await z.post(l,{title:i,scheduled_for:o,location_link:j,agenda:T}),{meeting:N,google_calendar_prompt:E}=b.data;c.success("Meeting scheduled"),E?.show_prompt&&$(N,E),n?.(),a?.()}catch(l){R(l,"Supervision schedule meeting");const o=l?.response?.data?.message||"Failed to schedule meeting. Please try again.",b=l?.response?.data?.errors;if(b){const N=Object.values(b).flat().join(", ");u(N),c.error(N)}else u(o),c.error(o)}finally{F(!1)}}};return e.jsx(B,{show:!!p,onClose:a,maxWidth:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Schedule supervision meeting"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Create a meeting invite for ",C,". ",P?"The student":"Your supervisor"," will see the meeting once scheduled."]})]}),e.jsx("button",{onClick:a,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[D&&e.jsx(H,{variant:"destructive",children:e.jsx(O,{children:D})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"meeting-title",children:"Meeting title"}),e.jsx(w,{id:"meeting-title",value:i,onChange:s=>x(s.target.value),placeholder:"e.g. Thesis direction sync",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"meeting-datetime",children:"Scheduled for"}),e.jsx(w,{id:"meeting-datetime",type:"datetime-local",value:m,onChange:s=>f(s.target.value),min:S(),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"meeting-location",children:"Meeting link / location"}),e.jsx(w,{id:"meeting-location",value:j,onChange:s=>k(s.target.value),placeholder:"Zoom / Teams link or physical venue",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"meeting-agenda",children:"Agenda / notes"}),e.jsx(Y,{id:"meeting-agenda",rows:4,value:T,onChange:s=>M(s.target.value),placeholder:"Outline talking points, materials to review, or goals for this session."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:a,disabled:v,children:"Cancel"}),e.jsxs(h,{type:"submit",disabled:v,children:[v?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Schedule meeting"]})]})]})]})})}export{ve as default};
