import{r as h,j as s,a as S}from"./app-1xdDtbuK.js";import{c as j}from"./index-D0Me3U07.js";import{l as _,L as R}from"./logError-D94OA_8l.js";import{B as g}from"./badge-BEOaklIL.js";import{C as u,a as C,b as w,c as y,d as k}from"./card-DyQ_Iwcr.js";import{B as v}from"./button-C8UkfpK0.js";import{A as T,a as M}from"./avatar-D-oPzU4f.js";import{S as U}from"./separator-CmJYoDTT.js";import D from"./RequestDetailCard-CHCwA7Vs.js";import{C as B}from"./clock-3-AKYzDFj6.js";import{F as E}from"./file-text-DtqDUria.js";import{M as F}from"./message-circle-Bd8h5Ww7.js";import{C as P}from"./circle-x-BLf-5S40.js";import{C as I}from"./circle-check-DfYwng1f.js";import{f as L}from"./AttachmentPreviewModal-Dx1qNMfB.js";import{f as O}from"./formatDistanceToNow-GKXiLTrL.js";import"./createLucideIcon-DrqMkvSZ.js";import"./index-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./utils-CIsb_jhR.js";import"./index-Xvo6Gjfs.js";import"./tabs-DT3hXYvW.js";import"./index-IKXJ_6Oa.js";import"./index-BWav5wTl.js";import"./index-BwSrKXyJ.js";import"./index-Jh8UucBw.js";import"./scroll-area-BgPQHzEc.js";import"./ThreadPane-B3HNYN8b.js";import"./Modal-LmHMcI1S.js";import"./dialog-DsNkdEs0.js";import"./transition-BnMHie4g.js";import"./AcceptSupervisorOfferModal-CpbRKK-l.js";import"./dialog-CoaUQ5Lc.js";import"./index-B4t-rvdw.js";import"./Combination-BT52CjGs.js";import"./tslib.es6-CmEaCU22.js";import"./x-BNVzQHji.js";import"./label-D7SG665j.js";import"./checkbox-BmiERlrK.js";import"./index-Bd0OtrUa.js";import"./check-YxhKEfI-.js";import"./alert-D8v-c6Ma.js";import"./circle-alert-BFvG4bOq.js";import"./message-square-BtfVHO66.js";import"./calendar-DMYC-NVM.js";import"./video-BNcDMC8p.js";import"./calendar-clock-C1Hl7tHP.js";import"./en-US-DNUEYIb-.js";import"./constructNow-DtVD-0hX.js";const N={pending:{variant:"secondary",className:"bg-amber-50 text-amber-700 border-none"},accepted:{variant:"success",className:"bg-emerald-50 text-emerald-700 border-none"},rejected:{variant:"destructive",className:"bg-rose-50 text-rose-700 border-none"},auto_cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"},cancelled:{variant:"outline",className:"bg-slate-100 text-slate-600 border-none"}},V={pending:"Awaiting supervisor review",accepted:"Accepted — next steps available",rejected:"Rejected — see feedback in details",auto_cancelled:"Automatically cancelled after another acceptance",cancelled:"Cancelled by student"};function La({requests:a=[],reload:e,onOpenDetail:r}){const[d,o]=h.useState(null),[n,c]=h.useState(null),p=async t=>{var i,m;if(t!=null&&t.id){o(t.id);try{await S.post(route("supervision.requests.cancel",t.id)),j.success("Proposal withdrawn"),e==null||e()}catch(l){_(l,"RequestStatusList handleCancel");const A=((m=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:m.message)||"Unable to cancel your request right now";j.error(A)}finally{o(null)}}},x=!Array.isArray(a)||a.length===0,f=h.useMemo(()=>Array.isArray(a)?[...a].sort((t,i)=>{const m=["cancelled","auto_cancelled"].includes(t.status),l=["cancelled","auto_cancelled"].includes(i.status);return m&&!l?1:!m&&l?-1:0}):[],[a]);return x?s.jsxs(u,{className:"border-dashed border-slate-200",children:[s.jsx(C,{children:s.jsx(w,{className:"text-lg font-semibold text-slate-800",children:"You haven\\'t sent any proposals yet"})}),s.jsx(y,{className:"text-sm text-slate-600",children:"Move supervisors from your shortlist into active proposals. Once you submit a request, progress and messaging will appear here."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:f.map(t=>s.jsx(Y,{request:t,onCancel:p,onOpenDetail:i=>c(i),isCancelling:d===t.id},t.id))}),n&&s.jsx(D,{request:n,onClose:()=>c(null),onUpdated:e})]})}function Y({request:a,onCancel:e,onOpenDetail:r,isCancelling:d}){const o=(a==null?void 0:a.academician)??{},n=o.full_name??"Supervisor",c=o.profile_picture?`/storage/${o.profile_picture}`:null,p=N[a==null?void 0:a.status]??N.pending,x=V[a==null?void 0:a.status]??"Pending supervisor response",f=a!=null&&a.submitted_at?L(new Date(a.submitted_at),"dd/MM/yyyy"):"—",t=a!=null&&a.submitted_at?O(new Date(a.submitted_at),{addSuffix:!0}):null;return s.jsxs(u,{className:"shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>r(a),children:[s.jsxs(C,{className:"pb-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(T,{className:"h-10 w-10",children:c?s.jsx("img",{src:c,alt:n,className:"h-full w-full object-cover"}):s.jsx(M,{className:"bg-indigo-50 text-indigo-600",children:n.slice(0,2).toUpperCase()})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-slate-800",children:n}),t&&s.jsxs("div",{className:"text-xs text-slate-500",children:["Submitted ",t]})]})]}),s.jsx(g,{className:p.className,children:((a==null?void 0:a.status)??"pending").split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")})]}),s.jsx("div",{className:"mt-3",children:s.jsx(w,{className:"text-base font-semibold text-slate-900 line-clamp-2",children:(a==null?void 0:a.proposal_title)??"Supervision request"})}),s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"text-xs text-slate-500",children:x})})]}),s.jsxs(y,{className:"space-y-4 text-sm text-slate-600",children:[s.jsx(U,{}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(b,{icon:B,label:"Submitted on",value:f}),s.jsx(b,{icon:E,label:"Motivation",value:$(a==null?void 0:a.motivation,100)})]})]}),s.jsxs(k,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[s.jsx("div",{className:"flex gap-2 text-xs text-slate-500",children:s.jsxs(g,{variant:"outline",className:"border-slate-200 text-slate-500",children:[s.jsx(F,{className:"mr-1 h-3.5 w-3.5"}),"Conversation ready"]})}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[s.jsxs(v,{variant:"outline",className:"sm:w-32",disabled:(a==null?void 0:a.status)!=="pending"||d,onClick:i=>{i.stopPropagation(),e==null||e(a)},children:[d?s.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(P,{className:"mr-2 h-4 w-4"}),"Cancel"]}),s.jsxs(v,{className:"sm:w-36",onClick:i=>{i.stopPropagation(),r(a)},children:[s.jsx(I,{className:"mr-2 h-4 w-4"}),"View details"]})]})]})]})}function b({icon:a,label:e,value:r}){return s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(a,{className:"mt-0.5 h-4 w-4 text-slate-400"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:e}),s.jsx("div",{className:"text-sm text-slate-700",children:r||"—"})]})]})}function $(a,e){return!a||a.length<=e?a:`${a.slice(0,e)}…`}export{La as default};
