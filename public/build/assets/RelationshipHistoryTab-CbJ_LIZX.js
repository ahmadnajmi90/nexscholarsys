import{r as d,a as u,j as t}from"./app-iMgHp_eS.js";import{l as R}from"./logError-BloCzXDJ.js";import{c as x}from"./createLucideIcon-BXdi-pyk.js";import{C as m}from"./circle-alert-Br8bwMRQ.js";import{U as y}from"./users-B-SRuXWr.js";import{L as w}from"./loader-circle-F27clpTW.js";import{f as S}from"./format-BOijCLBA.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],l=x("UserCheck",C);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],r=x("UserX",$);function k({relationship:i}){const[f,n]=d.useState(!0),[h,v]=d.useState([]),[g,p]=d.useState([]);d.useEffect(()=>{i?.id&&b()},[i?.id]);const b=async()=>{n(!0);try{const s=(await u.get(`/api/v1/app/supervision/relationships/${i.id}`)).data.data;if(v(s.unbindRequests||[]),i.student_id)try{const a=await u.get("/api/v1/app/supervision/cosupervisor-invitations/my-invitations"),j=[...a.data.as_cosupervisor||[],...a.data.to_approve||[],...a.data.as_initiator||[]].filter(N=>N.relationship?.student_id===i.student_id);p(j)}catch(a){console.log("Could not load co-supervisor events",a),p([])}}catch(e){R(e,"RelationshipHistoryTab loadActivityData")}finally{n(!1)}},o=[{id:"rel-start",title:"Relationship Started",date:i?.accepted_at,status:"completed",icon:l,color:"green"}];h.forEach((e,s)=>{e.status==="pending"?o.push({id:`unbind-${s}`,title:"Unbind Request Pending",description:`Initiated by ${e.initiated_by}`,date:e.created_at,status:"pending",icon:m,color:"yellow"}):e.status==="approved"?o.push({id:`unbind-${s}`,title:"Unbind Request Approved",description:"Relationship terminated",date:e.responded_at||e.updated_at,status:"completed",icon:r,color:"red"}):e.status==="rejected"&&o.push({id:`unbind-${s}`,title:"Unbind Request Rejected",date:e.responded_at||e.updated_at,status:"completed",icon:r,color:"gray"})}),g.forEach((e,s)=>{const a=e.cosupervisor?.full_name||e.cosupervisor?.user?.name||"Co-Supervisor";e.completed_at?o.push({id:`cosup-${s}`,title:`Co-Supervisor Added: ${a}`,description:`Initiated by ${e.initiated_by==="student"?"Student":"Main Supervisor"}`,date:e.completed_at,status:"completed",icon:y,color:"blue"}):e.cosupervisor_status==="rejected"||e.approver_status==="rejected"?o.push({id:`cosup-${s}`,title:"Co-Supervisor Invitation Rejected",description:a,date:e.updated_at,status:"completed",icon:r,color:"gray"}):e.cancelled_at?o.push({id:`cosup-${s}`,title:"Co-Supervisor Invitation Cancelled",description:a,date:e.cancelled_at,status:"completed",icon:r,color:"gray"}):o.push({id:`cosup-${s}`,title:"Co-Supervisor Invitation Pending",description:a,date:e.created_at,status:"pending",icon:y,color:"yellow"})}),i?.status==="active"&&!i?.terminated_at&&o.push({id:"rel-active",title:"Active Supervision",date:i?.accepted_at,status:"current",icon:l,color:"blue"}),i?.terminated_at&&o.push({id:"rel-terminated",title:"Relationship Terminated",date:i.terminated_at,status:"completed",icon:r,color:"red"});const c=o.filter(e=>e.date).sort((e,s)=>new Date(s.date)-new Date(e.date)),_=e=>{switch(e){case"green":return"bg-green-100 text-green-600";case"blue":return"bg-blue-100 text-blue-600";case"yellow":return"bg-yellow-100 text-yellow-600";case"red":return"bg-red-100 text-red-600";case"gray":return"bg-slate-100 text-slate-600";default:return"bg-slate-100 text-slate-600"}};return f?t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(w,{className:"h-8 w-8 animate-spin text-indigo-600"})})}):t.jsx("div",{className:"p-6",children:t.jsxs("section",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Recent Activity (",c.length,")"]}),c.length===0?t.jsxs("div",{className:"border border-slate-200 rounded-lg p-8 bg-slate-50 text-center",children:[t.jsx(m,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),t.jsx("p",{className:"text-sm text-slate-500",children:"No activity recorded yet."})]}):t.jsx("div",{className:"space-y-4",children:c.map((e,s)=>{const a=e.icon||l;return t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${_(e.color)}`,children:t.jsx(a,{className:"h-5 w-5"})}),s<c.length-1&&t.jsx("div",{className:"w-0.5 flex-1 bg-slate-200 mt-2",style:{minHeight:"40px"}})]}),t.jsxs("div",{className:"flex-1 pb-6",children:[t.jsx("h4",{className:"font-medium text-slate-900",children:e.title}),e.description&&t.jsx("p",{className:"text-sm text-slate-600 mt-1",children:e.description}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:S(new Date(e.date),"dd MMM yyyy, HH:mm")})]})]},e.id)})})]})})}const L=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"}));export{k as R,l as U,L as a};
