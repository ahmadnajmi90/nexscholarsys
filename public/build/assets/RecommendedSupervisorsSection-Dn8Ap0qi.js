import{r as n,a as y,j as e,b as I}from"./app-CRunKGlS.js";import{B as f}from"./button-CvHeaofT.js";import{B as l}from"./badge-B1g_318y.js";import{A as K,a as P}from"./avatar-Ds4ln6o3.js";import{C as R,a as E,b as O,c as U}from"./card-NTypxU8u.js";import{c as o}from"./index-BP2IIEZc.js";import{l as v}from"./logError-D4ezqrCx.js";import{L as w}from"./loader-circle-CA_94cJH.js";import{m}from"./proxy-hY7jBSjC.js";import{L as H}from"./lightbulb-D2WPlEiv.js";import{C as V}from"./chevron-down-C_mvodIi.js";import{C as X}from"./chevron-right-CAiHk8VV.js";import{X as G}from"./x-D71_YNlz.js";import{A as J}from"./index-DcBN7yqm.js";import{C as M}from"./check-DUmWpUBB.js";import{P as Q}from"./plus-DSFtevlc.js";import{E as W}from"./external-link-Cacj0Iyr.js";import"./utils-D-KgF5mV.js";import"./index-CGrAONsN.js";import"./createLucideIcon-Cn5nLR87.js";function be({requestId:s,isFirstSection:h=!1}){const[u,d]=n.useState(!0),[r,c]=n.useState([]),[S,T]=n.useState(""),[A,L]=n.useState(""),[j,x]=n.useState([]),[b,D]=n.useState(h),[$,C]=n.useState(!1);n.useEffect(()=>{s&&(localStorage.getItem(`rec_dismissed_${s}`)==="true"?(C(!0),d(!1)):z())},[s]);const z=async()=>{try{const t=await y.get(route("supervision.requests.recommendations",s));c(t.data.data||[]),T(t.data.supervisor_name||""),L(t.data.suggested_keywords||"")}catch(t){v(t,"RecommendedSupervisorsSection loadRecommendations")}finally{d(!1)}},_=()=>{localStorage.setItem(`rec_dismissed_${s}`,"true"),C(!0),o.success("Recommendation dismissed")},B=async t=>{x(i=>[...i,t]);try{await y.post(route("supervision.recommendations.add-to-shortlist"),{request_id:s,academician_ids:[t]}),c(i=>i.map(a=>a.id===t?{...a,in_shortlist:!0}:a)),o.success("Added to your potential supervisors")}catch(i){v(i,"RecommendedSupervisorsSection handleAddToShortlist"),o.error("Failed to add to shortlist")}finally{x(i=>i.filter(a=>a!==t))}},F=async()=>{const t=r.filter(a=>!a.in_shortlist);if(t.length===0){o("All supervisors are already in your shortlist",{icon:"✓"});return}const i=t.map(a=>a.id);x(i);try{const a=await y.post(route("supervision.recommendations.add-to-shortlist"),{request_id:s,academician_ids:i});c(p=>p.map(N=>i.includes(N.id)?{...N,in_shortlist:!0}:N)),o.success(a.data.message),r.every(p=>p.in_shortlist||i.includes(p.id))&&setTimeout(()=>{_()},3e3)}catch(a){v(a,"RecommendedSupervisorsSection handleAddAllToShortlist"),o.error("Failed to add supervisors to shortlist")}finally{x([])}};if($)return null;if(u)return e.jsx(R,{className:"border-indigo-200 bg-gradient-to-br from-indigo-50 to-white",children:e.jsx(E,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(w,{className:"h-6 w-6 animate-spin text-indigo-600"})})})});if(r.length===0)return null;const g=r.filter(t=>!t.in_shortlist).length,k=g===0;return e.jsx(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:"easeOut"},children:e.jsxs(R,{className:"border-indigo-200 bg-gradient-to-br from-indigo-50 to-white",children:[e.jsx(O,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg flex-shrink-0",children:e.jsx(H,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(U,{className:"text-lg text-slate-900",children:"Recommended Supervisors"}),e.jsx(l,{variant:"secondary",className:"bg-indigo-100 text-indigo-700 border-indigo-200",children:r.length}),g>0&&e.jsxs(l,{variant:"secondary",className:"bg-amber-100 text-amber-700 border-amber-200",children:[g," new"]}),k&&e.jsx(l,{variant:"secondary",className:"bg-green-100 text-green-700 border-green-200",children:"All added ✓"})]}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[S&&`Dr. ${S} has`," suggested these supervisors who might be a good fit for your research"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!k&&e.jsxs(f,{size:"sm",onClick:F,disabled:j.length>0,className:"bg-indigo-600 hover:bg-indigo-700",children:[j.length>0&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Add All (",g,")"]}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>D(!b),className:"h-8 w-8 p-0",children:b?e.jsx(V,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"ghost",onClick:_,className:"h-8 w-8 p-0 text-slate-400 hover:text-red-600 hover:bg-red-50",children:e.jsx(G,{className:"h-4 w-4"})})]})]})}),e.jsx(J,{children:b&&e.jsx(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:e.jsxs(E,{className:"space-y-3",children:[e.jsx(m.div,{className:"grid gap-3",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:r.map(t=>e.jsx(m.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},children:e.jsx(Y,{supervisor:t,isAdding:j.includes(t.id),onAddToShortlist:B})},t.id))}),A&&e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4 p-4 bg-white rounded-lg border border-indigo-200",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide mb-2",children:"Suggested Search Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:A.split(",").map((t,i)=>e.jsx(l,{variant:"secondary",className:"text-xs",children:t.trim()},i))})]})]})})})]})})}function Y({supervisor:s,isAdding:h,onAddToShortlist:u}){const d=s.profile_picture?`/storage/${s.profile_picture}`:null,r=s.name.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-white rounded-lg border border-slate-200 hover:border-indigo-300 hover:shadow-sm transition-all",children:[e.jsx(K,{className:"h-12 w-12",children:d?e.jsx("img",{src:d,alt:s.name,className:"h-full w-full object-cover"}):e.jsx(P,{className:"bg-indigo-100 text-indigo-700 text-sm",children:r})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:s.name}),s.verified&&e.jsx(l,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700 border-blue-200",children:"Verified"})]}),e.jsx("p",{className:"text-xs text-slate-600 line-clamp-2 mt-0.5",children:s.expertise}),(s.department||s.university)&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[s.department,s.department&&s.university&&" • ",s.university]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.in_shortlist?e.jsxs(l,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200 shrink-0",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"In Shortlist"]}):e.jsx(f,{size:"sm",variant:"outline",onClick:()=>u(s.id),disabled:h,className:"shrink-0",children:h?e.jsx(w,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Add"]})}),s.url&&e.jsx(I,{href:`/academicians/${s.url}`,className:"text-slate-400 hover:text-indigo-600 transition-colors",children:e.jsx(W,{className:"h-4 w-4"})})]})]})})]})}export{be as default};
