import{c as A}from"./MainLayout-OwM1FlNF.js";import{q as B,r as g,W as H,j as e,a as I}from"./app-CLtIConJ.js";import{M as L}from"./Modal-C1Nt0ktB.js";import{I as U}from"./InputLabel-CaQ37czV.js";import{I as P}from"./InputError-DDsPByGl.js";import{P as Y}from"./PrimaryButton-DqsUc73S.js";import{S as R}from"./SecondaryButton-CxncJiWv.js";import{C as z}from"./ConfirmationModal-D4VfmMeX.js";import{c as v}from"./index-DtlMuPAt.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ae=A("UserPlus",G);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],ie=A("Users",J);function le({show:j,onClose:N,context:r,contextType:d,connections:b}){var C,x,S;const{auth:F}=B().props,[t,y]=g.useState(null),[w,p]=g.useState(!1),[k,E]=g.useState([]),o=H({user_id:"",role:"member"}),M=(r==null?void 0:r.id)||d==="workspace"&&((C=r==null?void 0:r.data)==null?void 0:C.id),_=F.user.id===((r==null?void 0:r.owner_id)||d==="workspace"&&((x=r==null?void 0:r.data)==null?void 0:x.owner_id)),n=d==="workspace"?(S=r==null?void 0:r.data)==null?void 0:S.members:r==null?void 0:r.members;g.useEffect(()=>{if(j&&b&&n){const s=n.map(i=>i.id),a=b.filter(i=>!s.includes(i.id));E(a)}},[j,b,r,n]);const q=s=>{s.preventDefault(),p(!0);const a=d==="workspace"?"workspaces.members.add":"projects.members.store";I.post(route(a,M),o.data).then(i=>{v.success("Member added successfully"),o.reset(),window.location.reload()}).catch(i=>{var l,u,f,h;const m=((u=(l=i.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to add member";v.error(m),(h=(f=i.response)==null?void 0:f.data)!=null&&h.errors&&o.setError(i.response.data.errors)}).finally(()=>{p(!1)})},$=s=>{y(s)},D=()=>{if(!t)return;p(!0);const s=d==="workspace"?"workspaces.members.remove":"projects.members.destroy";I.delete(route(s,{[d]:M,member:t.id})).then(a=>{v.success("Member removed successfully"),y(null),window.location.reload()}).catch(a=>{var m,l;const i=((l=(m=a.response)==null?void 0:m.data)==null?void 0:l.message)||"Failed to remove member";v.error(i)}).finally(()=>{p(!1)})},c=s=>{if(!s)return"Unknown User";const a=s.academician||s.postgraduate||s.undergraduate;return(a==null?void 0:a.full_name)||s.name},O=s=>{var i,m,l;if(!s)return null;const a=((i=s.academician)==null?void 0:i.profile_picture)||((m=s.postgraduate)==null?void 0:m.profile_picture)||((l=s.undergraduate)==null?void 0:l.profile_picture);return a?`/storage/${a}`:null},W=d==="workspace"?"Manage Workspace Members":"Manage Project Members";return e.jsxs(e.Fragment,{children:[e.jsx(L,{show:j,onClose:N,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:W}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Current Collaborators"}),n&&n.length>0?e.jsx("div",{className:"space-y-3",children:n.filter(s=>{var a;return s.id!==((r==null?void 0:r.owner_id)||d==="workspace"&&((a=r==null?void 0:r.data)==null?void 0:a.owner_id))}).map(s=>{var m,l,u,f,h;const a=s.id===((r==null?void 0:r.owner_id)||d==="workspace"&&((m=r==null?void 0:r.data)==null?void 0:m.owner_id)),i=O(s);return e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:i?e.jsx("img",{src:i,alt:c(s),className:"h-full w-full object-cover"}):e.jsx("span",{className:"text-gray-500 text-sm",children:c(s).charAt(0)})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c(s)}),e.jsx("p",{className:"text-xs text-gray-500",children:a?"Owner":((u=(l=s.pivot)==null?void 0:l.role)==null?void 0:u.charAt(0).toUpperCase())+((h=(f=s.pivot)==null?void 0:f.role)==null?void 0:h.slice(1))||"Member"})]})]}),_&&!a&&e.jsx(R,{onClick:()=>$(s),disabled:w,className:"bg-red-50 text-red-600 hover:bg-red-100",children:"Remove"})]},s.id)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No members yet."})]}),_&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium text-gray-700 mb-3",children:"Invite New Member"}),k.length>0?e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"user_id",value:"Select Connection"}),e.jsxs("select",{id:"user_id",name:"user_id",value:o.data.user_id,onChange:s=>o.setData("user_id",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",required:!0,children:[e.jsx("option",{value:"",children:"Select a connection"}),k.map(s=>e.jsx("option",{value:s.id,children:c(s)},s.id))]}),e.jsx(P,{message:o.errors.user_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"role",value:"Role"}),e.jsxs("select",{id:"role",name:"role",value:o.data.role,onChange:s=>o.setData("role",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx(P,{message:o.errors.role,className:"mt-2"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Y,{type:"submit",disabled:w||!o.data.user_id,children:w?"Sending...":"Send Invitation"})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"You have no available connections to invite. Connect with other users first."})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(R,{onClick:N,children:"Close"})})]})}),e.jsx(z,{show:!!t,onClose:()=>y(null),onConfirm:D,title:"Remove Member",message:t?`Are you sure you want to remove ${c(t)} from this ${d}?`:""})]})}export{le as M,ie as U,ae as a};
