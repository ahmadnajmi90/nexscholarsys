import{r as a,a as l}from"./app-C9aRItHR.js";import{c as s}from"./index-XngfYQdO.js";import{l as d}from"./logError-BloCzXDJ.js";function A(){const[C,i]=a.useState(!1),[w,u]=a.useState(!1),[y,f]=a.useState(!0),[G,m]=a.useState(null),n=a.useCallback(async()=>{try{f(!0);const o=await l.get(route("supervision.google-calendar.status")),{connected:e,enabled:t,token_expires_at:r}=o.data;i(e),u(t),m(r)}catch(o){d(o,"useGoogleCalendar checkStatus"),i(!1),u(!1)}finally{f(!1)}},[]),E=a.useCallback(async()=>{try{const o=await l.get(route("supervision.google-calendar.auth-url")),{auth_url:e,debug:t}=o.data;if(t&&(console.log("🔍 Google Calendar Debug Info:"),console.log("  Redirect URI:",t.redirect_uri),console.log("  App URL:",t.app_url),console.log("  Auth URL:",e)),!e)throw new Error("No authorization URL received");const r=600,h=700,x=window.screen.width/2-r/2,F=window.screen.height/2-h/2,g=window.open(e,"Google Calendar Authorization",`width=${r},height=${h},left=${x},top=${F},scrollbars=yes,resizable=yes`);if(!g){s.error("Please allow popups to connect Google Calendar");return}const p=c=>{c.origin===window.location.origin&&c.data&&c.data.type==="google-calendar-oauth-complete"&&(window.removeEventListener("message",p),c.data.status==="success"?s.success(c.data.message||"Google Calendar connected successfully!"):s.error(c.data.message||"Failed to connect Google Calendar"),n())};window.addEventListener("message",p);const L=setInterval(()=>{g.closed&&(clearInterval(L),window.removeEventListener("message",p),setTimeout(()=>{n()},500))},500);return g}catch(o){d(o,"useGoogleCalendar connect"),s.error("Failed to connect Google Calendar")}},[n]),b=a.useCallback(async()=>{try{await l.post(route("supervision.google-calendar.disconnect")),i(!1),u(!1),m(null),s.success("Google Calendar disconnected")}catch(o){d(o,"useGoogleCalendar disconnect"),s.error("Failed to disconnect Google Calendar")}},[]),k=a.useCallback(async o=>{try{const e=await l.post(route("supervision.google-calendar.add-meeting",{meeting:o}));if(e.data.success)return s.success("Meeting added to Google Calendar"),{success:!0,meeting:e.data.meeting};if(e.data.needs_connection)return s.error("Please connect Google Calendar first"),{success:!1};throw new Error(e.data.message||"Failed to add meeting")}catch(e){if(e.response?.status===403)s.error("You do not have permission to add this meeting");else{if(e.response?.data?.already_exists)return s("This meeting is already in your Google Calendar",{icon:"ℹ️",duration:3e3}),{success:!1,alreadyExists:!0,meeting:e.response.data.meeting};e.response?.data?.needs_connection?s.error("Please connect Google Calendar first"):(d(e,"useGoogleCalendar addMeetingToCalendar"),s.error("Failed to add meeting to Google Calendar"))}return{success:!1}}},[]),v=a.useCallback(async()=>{try{const o=await l.post(route("supervision.google-calendar.sync"));if(o.data.success){const{synced:e,updated:t,deleted:r}=o.data;return e>0?s.success(`Synced ${e} meeting(s) from Google Calendar`):s.success("No changes to sync"),{synced:e,updated:t,deleted:r}}throw new Error(o.data.message||"Sync failed")}catch(o){return d(o,"useGoogleCalendar syncFromGoogle"),s.error("Failed to sync from Google Calendar"),null}},[]);return a.useEffect(()=>{n()},[n]),{isConnected:C,isEnabled:w,isLoading:y,tokenExpiresAt:G,checkStatus:n,connect:E,disconnect:b,addMeetingToCalendar:k,syncFromGoogle:v}}export{A as u};
