import{q as W,r as c,b as X,j as e,y as G}from"./app-A8xQkvSk.js";import{c as N}from"./index-Km-vM6Jb.js";import{T as K,a as Q,b as m,c as x}from"./tabs-Cbyzn-fX.js";import{B as u}from"./button-Dz_rydmG.js";import{B as Y}from"./badge-CFoP9Krf.js";import{A as Z,a as ee}from"./avatar-CbIr_OjG.js";import{S as y}from"./scroll-area-COMlVIOb.js";import{T as te}from"./textarea-DGdKxzUN.js";import{T as se,a as ae,b as re,c as q}from"./tooltip-Oo0Wz_lE.js";import le from"./ScheduleMeetingDialog-C9eLZHwe.js";import{U as de,a as ce}from"./UnbindRequestModal-2eYhJEIj.js";import ie from"./ResearchTab-B4EYMRFM.js";import oe from"./DocumentsTab-B11iV4A2.js";import{T as ne}from"./ThreadPane-CPpSuURI.js";import me from"./SupervisorOverviewTab-1AlCwSvt.js";import{l as S}from"./logError-D4ezqrCx.js";import{X as xe}from"./x-vL7g-LuD.js";import{C as ue}from"./calendar-EpaZ4Aad.js";import{V as be}from"./video-DL3IJgDp.js";import{E as ve}from"./external-link-RAq8nM7x.js";import{S as O}from"./sticky-note-C4sRMRSo.js";import{L as I}from"./loader-circle-DkpR38mE.js";import{T as fe}from"./trash-2-XEAf-v5f.js";import{f as E}from"./format-hTuirObu.js";import"./index-BEzQHz4a.js";import"./index-7Qlnuq3l.js";import"./index-CG1gsK_f.js";import"./index-DwuY8lh1.js";import"./index-OrEFxIKi.js";import"./index-DMPy21CI.js";import"./index-B0SlzLk6.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-Dp3B9jqt.js";import"./index-BlKfbGK4.js";import"./index-Cp2nhW7C.js";import"./floating-ui.dom-eiE65J5j.js";import"./index-Db3xrL5F.js";import"./Modal-D_n_zj3N.js";import"./dialog-BkDQGxoj.js";import"./transition-Bvb6H6Z4.js";import"./input-D2p8biwd.js";import"./label-BcrT7TVM.js";import"./alert-BBFXwXFc.js";import"./createLucideIcon-DPzobtnR.js";import"./triangle-alert-BND9SWEh.js";import"./separator-B59s4oDI.js";import"./plus-BqbQZKPX.js";import"./circle-check-ddCD_g9w.js";import"./circle-eov79Dsa.js";import"./en-US-DNUEYIb-.js";import"./select-BBDf1Ygo.js";import"./Combination-Bf5eV4ml.js";import"./tslib.es6-CmEaCU22.js";import"./index-rTP0VXgG.js";import"./chevron-down-qnEAqpL2.js";import"./chevron-up-hxgrcUwj.js";import"./check-BeDd_wJ7.js";import"./DocumentPreviewModal-CPJtZlTY.js";import"./file-text-BfC4OSQU.js";import"./download-CMnE0euH.js";import"./upload-DLfp_NaM.js";import"./chevron-right-Mpml_Nmb.js";import"./folder-open-Bj-Qb-PO.js";import"./eye-B05lsJ9f.js";import"./history-BxBz3cCN.js";import"./AttachmentPreviewModal-CXErbNPv.js";import"./user-round-CEZUuFcg.js";import"./mail-Dtimj1fp.js";import"./phone-D1xIudn-.js";import"./globe-B7ftxdKm.js";import"./graduation-cap-the7C-yQ.js";import"./calendar-clock-BwBj7N73.js";function Ft({relationship:t,onClose:l,onUpdated:a}){var D;const{auth:d}=W().props,o=(t==null?void 0:t.preferred_tab)||"overview",[g,b]=c.useState(o),[v,r]=c.useState(!1),[P,h]=c.useState(!1);c.useEffect(()=>{t!=null&&t.preferred_tab&&b(t.preferred_tab)},[t==null?void 0:t.preferred_tab]);const[F,B]=c.useState([]),[T,R]=c.useState(""),[_,C]=c.useState(!1),[k,M]=c.useState(null);c.useEffect(()=>{t!=null&&t.id&&H()},[t==null?void 0:t.id]);const H=async()=>{var s;if(t!=null&&t.id)try{const i=await X.get(route("supervision.relationships.show",t.id));B(((s=i.data.data)==null?void 0:s.notes)||[])}catch(i){S(i,"SupervisorRelationshipDetailModal loadNotes")}},L=async()=>{if(!(!T.trim()||_)){C(!0);try{N.success("Note added"),R("")}catch(s){S(s,"SupervisorRelationshipDetailModal handleAddNote"),N.error("Failed to add note")}finally{C(!1)}}},U=async s=>{if(!k){M(s);try{N.success("Note deleted")}catch(i){S(i,"SupervisorRelationshipDetailModal handleDeleteNote"),N.error("Failed to delete note")}finally{M(null)}}},V=()=>{G.visit(route("supervision.relationships.show",t.id))};if(!t)return null;const f=(t==null?void 0:t.student)??{},p=f.full_name??"Student",A=f.profile_picture?`/storage/${f.profile_picture}`:null,j=t.status??"active",w=t.activeUnbindRequest?"pending_unbind":j,n=j==="active"&&!t.activeUnbindRequest,$=p.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,3),z=w==="pending_unbind"?"Pending Unbind":w.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),J=s=>{switch(s){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"pending_unbind":return"bg-amber-50 text-amber-700 border-amber-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"terminated":return"bg-red-50 text-red-700 border-red-200";default:return"bg-slate-50 text-slate-700 border-slate-200"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-end bg-black/50",onClick:l,children:e.jsxs("div",{className:"w-full max-w-3xl h-full bg-white shadow-xl overflow-hidden flex flex-col animate-slide-in-right",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx(Z,{className:"h-12 w-12",children:A?e.jsx("img",{src:A,alt:p,className:"h-full w-full object-cover"}):e.jsx(ee,{className:"bg-indigo-100 text-indigo-700 text-sm font-semibold",children:$})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:p}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Student Â· ",t.role==="main"?"Main Supervisor":"Co-Supervisor"]}),e.jsx("div",{className:"mt-2",children:e.jsx(Y,{className:`${J(w)} border`,children:z})})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(xe,{className:"h-5 w-5 text-slate-500"})})]})}),e.jsxs("div",{className:"px-6 py-4 border-b bg-slate-50",children:[n&&e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs(u,{variant:"outline",className:"flex-1",onClick:()=>r(!0),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Schedule Meeting"]}),e.jsxs(u,{className:"flex-1 bg-slate-900 hover:bg-slate-800",disabled:!(t!=null&&t.meetings)||t.meetings.length===0||!((D=t.meetings[0])!=null&&D.location_link),onClick:()=>{var i;const s=(i=t==null?void 0:t.meetings)==null?void 0:i[0];s!=null&&s.location_link&&window.open(s.location_link,"_blank","noopener,noreferrer")},children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Join Meeting"]})]}),e.jsxs("div",{className:"flex gap-3",children:[n&&e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(re,{asChild:!0,children:e.jsx("div",{className:"flex-1",children:e.jsxs(u,{variant:"outline",className:"w-full border-red-300 text-red-700 hover:bg-red-50",onClick:()=>h(!0),disabled:t.activeUnbindRequest||j!=="active",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Remove Relationship"]})})}),t.activeUnbindRequest&&e.jsx(q,{children:e.jsx("p",{children:"Unbind request pending student approval"})}),j!=="active"&&!t.activeUnbindRequest&&e.jsx(q,{children:e.jsx("p",{children:"Relationship is no longer active"})})]})}),e.jsxs(u,{variant:"outline",className:n?"flex-1":"w-full",onClick:V,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Show Full Page"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(K,{value:g,onValueChange:b,className:"h-full flex flex-col",children:[e.jsxs(Q,{className:"px-6 bg-gray-100 w-full justify-start rounded-none h-auto p-0 gap-0",children:[e.jsx(m,{value:"overview",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Overview"}),e.jsx(m,{value:"research",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Research"}),e.jsx(m,{value:"documents",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Documents"}),e.jsx(m,{value:"chat",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Chat"}),e.jsx(m,{value:"notes",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"Notes"}),e.jsx(m,{value:"history",className:"data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-indigo-600 data-[state=inactive]:bg-transparent rounded-none px-6 py-3",children:"History"})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx(x,{value:"overview",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(me,{relationship:t,student:f,activeUnbindRequest:t.activeUnbindRequest})})}),e.jsx(x,{value:"research",className:"mt-0 h-full",children:e.jsx(ie,{relationship:t,onUpdated:a,isReadOnly:!n})}),e.jsx(x,{value:"documents",className:"mt-0 h-full",children:e.jsx(oe,{relationship:t,onUpdated:a,isReadOnly:!n})}),e.jsx(x,{value:"chat",className:"mt-0 h-full",children:t!=null&&t.conversation_id?e.jsx("div",{className:"p-6 h-full",children:e.jsx("div",{className:"border border-slate-200 rounded-lg bg-white shadow-sm h-full overflow-hidden",children:e.jsx(ne,{conversationId:t.conversation_id,auth:d,onConversationRead:()=>{},onConversationIncrementUnread:()=>{},onAfterSend:()=>a==null?void 0:a()})})}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No conversation available yet."})})})}),e.jsx(x,{value:"notes",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(je,{notesList:F,newNote:T,setNewNote:R,isAddingNote:_,isDeletingNoteId:k,onAddNote:L,onDeleteNote:U,isReadOnly:!n})})}),e.jsx(x,{value:"history",className:"mt-0 h-full",children:e.jsx(y,{className:"h-full",children:e.jsx(Ne,{relationship:t})})})]})]})})]})}),e.jsx(le,{relationship:v?t:null,onClose:()=>r(!1),onScheduled:()=>{r(!1),a==null||a()},userRole:"supervisor"}),e.jsx(ce,{isOpen:P,relationship:t,onClose:()=>h(!1),onUnbindInitiated:()=>{h(!1),l==null||l(),a==null||a()},userRole:"supervisor"})]})}function je({notesList:t,newNote:l,setNewNote:a,isAddingNote:d,isDeletingNoteId:o,onAddNote:g,onDeleteNote:b,isReadOnly:v}){return e.jsxs("div",{className:"p-6 space-y-6",children:[!v&&e.jsxs("section",{className:"border border-slate-200 rounded-lg p-6 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Add Private Note"})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"These notes are private and only visible to you. Students cannot see them."}),e.jsx(te,{rows:4,value:l,onChange:r=>a(r.target.value),placeholder:"Write your note here...",className:"mb-3"}),e.jsxs(u,{onClick:g,disabled:!l.trim()||d,children:[d&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Add Note"]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["All Notes (",t.length,")"]}),t.length===0?e.jsxs("div",{className:"border border-slate-200 rounded-lg p-6 bg-slate-50 text-center",children:[e.jsx(O,{className:"h-8 w-8 text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No notes yet. Add your first note above."})]}):e.jsx("div",{className:"space-y-3",children:t.map(r=>e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-xs text-slate-500",children:r.created_at?E(new Date(r.created_at),"dd/MM/yyyy HH:mm"):"Just now"})}),!v&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>b(r.id),disabled:o===r.id,className:"h-8 w-8 p-0 hover:bg-red-50 hover:text-red-600",children:o===r.id?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(fe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line leading-relaxed",children:r.note})]},r.id))})]})]})}function Ne({relationship:t}){const l=[{id:1,title:"Relationship Started",date:t==null?void 0:t.accepted_at,status:"completed"},{id:2,title:"Active Supervision",date:t==null?void 0:t.accepted_at,status:(t==null?void 0:t.status)==="active"?"current":"completed"}];t!=null&&t.terminated_at&&l.push({id:3,title:"Relationship Terminated",date:t.terminated_at,status:"completed"});const a=d=>{switch(d){case"completed":return"bg-green-500";case"current":return"bg-blue-500";case"pending":return"bg-slate-300";default:return"bg-slate-300"}};return e.jsx("div",{className:"p-6",children:e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Timeline"}),e.jsx("div",{className:"space-y-4",children:l.map((d,o)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a(d.status)}`}),o<l.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-slate-200 mt-2"})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:d.title}),e.jsx("p",{className:"text-sm text-slate-500",children:d.date?E(new Date(d.date),"dd/MM/yyyy"):"TBD"})]})]},d.id))})]})})}export{Ft as default};
