import{r as l,j as e,b as K}from"./app-A8xQkvSk.js";import{M as V}from"./Modal-D_n_zj3N.js";import{B as D}from"./button-Dz_rydmG.js";import{L as o}from"./label-BcrT7TVM.js";import{T as I}from"./textarea-DGdKxzUN.js";import{C as L}from"./checkbox-DDgIuOJc.js";import{S as O,a as z,b as H,c as W,d as J}from"./select-BBDf1Ygo.js";import{A as X,a as G}from"./alert-BBFXwXFc.js";import{A as Q,a as U}from"./avatar-CbIr_OjG.js";import{B as Y}from"./badge-CFoP9Krf.js";import{c as M}from"./index-Km-vM6Jb.js";import{l as Z}from"./logError-D4ezqrCx.js";import{C as q}from"./circle-x-R0AwPcda.js";import{C as ee}from"./circle-alert-CPnO62Yc.js";import{L as se}from"./loader-circle-DkpR38mE.js";import"./dialog-BkDQGxoj.js";import"./transition-Bvb6H6Z4.js";import"./utils-CIsb_jhR.js";import"./clsx-B-dksMZM.js";import"./index-7Qlnuq3l.js";import"./index-Dp3B9jqt.js";import"./index-BEzQHz4a.js";import"./index-DMPy21CI.js";import"./index-rTP0VXgG.js";import"./index-Db3xrL5F.js";import"./check-BeDd_wJ7.js";import"./createLucideIcon-DPzobtnR.js";import"./index-B0SlzLk6.js";import"./index-CG1gsK_f.js";import"./index-BlKfbGK4.js";import"./index-OrEFxIKi.js";import"./Combination-Bf5eV4ml.js";import"./tslib.es6-CmEaCU22.js";import"./index-DwuY8lh1.js";import"./index-Cp2nhW7C.js";import"./floating-ui.dom-eiE65J5j.js";import"./chevron-down-qnEAqpL2.js";import"./chevron-up-hxgrcUwj.js";const F=[{value:"capacity_full",label:"Capacity full - Not accepting new students"},{value:"research_mismatch",label:"Research interests do not align"},{value:"expertise_mismatch",label:"Outside my area of expertise"},{value:"timing",label:"Timing not suitable (sabbatical/other commitments)"},{value:"qualification",label:"Student qualifications do not meet requirements"},{value:"other",label:"Other reason (please specify)"}];function Ve({isOpen:f,request:t,onClose:n,onRejected:j}){var $;const[c,N]=l.useState(""),[p,y]=l.useState(""),[d,S]=l.useState(!1),[m,w]=l.useState([]),[u,v]=l.useState(""),[h,k]=l.useState(!1),g=((t==null?void 0:t.student)||{}).full_name||"Student",C=(($=t==null?void 0:t.postgraduate_program)==null?void 0:$.name)||"PhD Computer Science Program",R=(t==null?void 0:t.proposal_title)||"Research Topic",x=(t==null?void 0:t.research_keywords)||[];l.useEffect(()=>{f&&x.length>0&&v(x.join(", "))},[f,x]);const T=c!=="",A=s=>{w(a=>a.find(r=>r.id===s.id)?a.filter(r=>r.id!==s.id):[...a,s])},P=[{id:1,name:"Dr. Sarah Kim",expertise:"Machine Learning, NLP"},{id:2,name:"Prof. Michael Tan",expertise:"Human-Computer Interaction"},{id:3,name:"Dr. Lisa Wang",expertise:"Computer Vision, AI"}],E=()=>{var i,r;const s=((i=F.find(b=>b.value===c))==null?void 0:i.label)||"",a=m.map(b=>b.name).join(", ");return`Dear ${g},

Thank you for your interest in working with me on your ${C} research. After carefully reviewing your proposal titled "${R}", I regret to inform you that I will not be able to supervise your research at this time.

Reason: ${s}

${p?`
${p}
`:""}
${d&&m.length>0?`
I recommend reaching out to the following supervisors who might be a better fit for your research:
${a}
`:""}
${u?`
Suggested keywords for your supervisor search: ${u}
`:""}
I wish you the best of luck in finding a suitable supervisor for your research.

Best regards,
Dr. ${((r=t==null?void 0:t.academician)==null?void 0:r.full_name)||"Supervisor"}`},B=async()=>{var s,a;if(!(!T||h)){k(!0);try{const i={reason:c,feedback:p.trim()||null,recommend_alternatives:d,recommended_supervisors:d?m.map(r=>r.id):[],suggested_keywords:u.trim()||null};await K.post(route("supervision.requests.reject",t.id),i),M.success("Rejection sent to student"),j==null||j(),n==null||n()}catch(i){Z(i,"DeclineSupervisionRequestModal handleSubmit");const r=((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to decline supervision request";M.error(r)}finally{k(!1)}}},_=()=>{h||(N(""),y(""),S(!1),w([]),v(""),n==null||n())};return e.jsx(V,{show:f,onClose:_,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"h-6 w-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Decline Supervision Request"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Provide feedback to ",g," and optionally suggest alternative supervisors."]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Request Summary"}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Q,{className:"h-10 w-10",children:e.jsx(U,{className:"bg-indigo-100 text-indigo-700 text-sm",children:g.split(" ").map(s=>s[0]).join("").slice(0,2)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:g}),e.jsx("div",{className:"text-xs text-slate-500",children:C})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Research Topic"}),e.jsx("div",{className:"text-sm text-slate-900 mt-1",children:R})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:x.map((s,a)=>e.jsx(Y,{variant:"secondary",className:"text-xs",children:s},a))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs(o,{htmlFor:"reason",children:["Reason for Declining ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(O,{value:c,onValueChange:N,children:[e.jsx(z,{id:"reason",children:e.jsx(H,{placeholder:"Select a reason"})}),e.jsx(W,{children:F.map(s=>e.jsx(J,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx(o,{htmlFor:"feedback",children:"Additional Feedback (Optional)"}),e.jsx(I,{id:"feedback",rows:4,value:p,onChange:s=>y(s.target.value),placeholder:"Any constructive feedback about the proposal or suggestions for improvement...",className:"resize-none"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{id:"recommend",checked:d,onCheckedChange:S,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{htmlFor:"recommend",className:"text-sm font-medium cursor-pointer",children:"Recommend alternative supervisors"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Help the student by suggesting other supervisors who might be a better fit"})]})]}),d&&e.jsxs("div",{className:"space-y-4 pl-7",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Select Recommended Supervisors"}),e.jsx("div",{className:"space-y-2",children:P.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${m.find(a=>a.id===s.id)?"border-indigo-300 bg-indigo-50":"border-slate-200 bg-white hover:border-slate-300"}`,onClick:()=>A(s),children:[e.jsx(L,{checked:!!m.find(a=>a.id===s.id),onCheckedChange:()=>A(s),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.expertise})]})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"keywords",children:"Suggested Keywords for Supervisor Search"}),e.jsx(I,{id:"keywords",rows:2,value:u,onChange:s=>v(s.target.value),placeholder:"e.g., Machine Learning, Natural Language Processing, Computer Vision...",className:"resize-none"})]})]})]}),c&&e.jsxs("section",{className:"space-y-3",children:[e.jsx(o,{children:"Message Preview"}),e.jsx("p",{className:"text-xs text-slate-500",children:"This message will be sent to the student:"}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:e.jsx("pre",{className:"text-xs text-slate-700 whitespace-pre-wrap font-sans",children:E()})})]}),e.jsxs(X,{className:"bg-red-50 border-red-200",children:[e.jsx(ee,{className:"h-4 w-4 text-red-600"}),e.jsxs(G,{className:"text-sm text-red-900",children:[e.jsx("strong",{className:"font-semibold",children:"Confirm Rejection"}),e.jsx("p",{className:"mt-1",children:'This action will decline the supervision request and notify the student. The request will be moved to "Rejected" status and cannot be undone.'})]})]})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t flex items-center justify-end gap-3",children:[e.jsx(D,{variant:"outline",onClick:_,disabled:h,children:"Cancel"}),e.jsxs(D,{onClick:B,disabled:!T||h,className:"bg-red-600 hover:bg-red-700",children:[h&&e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Rejection & Notify Student"]})]})]})})}export{Ve as default};
